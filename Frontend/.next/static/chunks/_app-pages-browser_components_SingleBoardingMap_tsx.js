"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["_app-pages-browser_components_SingleBoardingMap_tsx"],{

/***/ "(app-pages-browser)/./node_modules/@react-google-maps/api/dist/esm.js":
/*!*********************************************************!*\
  !*** ./node_modules/@react-google-maps/api/dist/esm.js ***!
  \*********************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Autocomplete: function() { return /* binding */ Autocomplete; },\n/* harmony export */   BicyclingLayer: function() { return /* binding */ BicyclingLayer; },\n/* harmony export */   BicyclingLayerF: function() { return /* binding */ BicyclingLayerF; },\n/* harmony export */   Circle: function() { return /* binding */ Circle; },\n/* harmony export */   CircleF: function() { return /* binding */ CircleF; },\n/* harmony export */   Data: function() { return /* binding */ Data; },\n/* harmony export */   DataF: function() { return /* binding */ DataF; },\n/* harmony export */   DirectionsRenderer: function() { return /* binding */ DirectionsRenderer; },\n/* harmony export */   DirectionsService: function() { return /* binding */ DirectionsService; },\n/* harmony export */   DistanceMatrixService: function() { return /* binding */ DistanceMatrixService; },\n/* harmony export */   DrawingManager: function() { return /* binding */ DrawingManager; },\n/* harmony export */   DrawingManagerF: function() { return /* binding */ DrawingManagerF; },\n/* harmony export */   FLOAT_PANE: function() { return /* binding */ FLOAT_PANE; },\n/* harmony export */   GoogleMap: function() { return /* binding */ GoogleMap; },\n/* harmony export */   GoogleMapsMarkerClusterer: function() { return /* binding */ index_esm; },\n/* harmony export */   GoogleMarkerClusterer: function() { return /* binding */ GoogleMarkerClusterer$1; },\n/* harmony export */   GroundOverlay: function() { return /* binding */ GroundOverlay; },\n/* harmony export */   GroundOverlayF: function() { return /* binding */ GroundOverlayF; },\n/* harmony export */   HeatmapLayer: function() { return /* binding */ HeatmapLayer; },\n/* harmony export */   HeatmapLayerF: function() { return /* binding */ HeatmapLayerF; },\n/* harmony export */   InfoBox: function() { return /* binding */ InfoBoxComponent; },\n/* harmony export */   InfoBoxF: function() { return /* binding */ InfoBoxF; },\n/* harmony export */   InfoWindow: function() { return /* binding */ InfoWindow; },\n/* harmony export */   InfoWindowF: function() { return /* binding */ InfoWindowF; },\n/* harmony export */   KmlLayer: function() { return /* binding */ KmlLayer; },\n/* harmony export */   LoadScript: function() { return /* binding */ LoadScript; },\n/* harmony export */   LoadScriptNext: function() { return /* binding */ LoadScriptNext$1; },\n/* harmony export */   MAP_PANE: function() { return /* binding */ MAP_PANE; },\n/* harmony export */   MARKER_LAYER: function() { return /* binding */ MARKER_LAYER; },\n/* harmony export */   MapContext: function() { return /* binding */ MapContext; },\n/* harmony export */   Marker: function() { return /* binding */ Marker; },\n/* harmony export */   MarkerClusterer: function() { return /* binding */ ClustererComponent; },\n/* harmony export */   MarkerClustererF: function() { return /* binding */ MarkerClustererF; },\n/* harmony export */   MarkerF: function() { return /* binding */ MarkerF; },\n/* harmony export */   OVERLAY_LAYER: function() { return /* binding */ OVERLAY_LAYER; },\n/* harmony export */   OVERLAY_MOUSE_TARGET: function() { return /* binding */ OVERLAY_MOUSE_TARGET; },\n/* harmony export */   OverlayView: function() { return /* binding */ OverlayView; },\n/* harmony export */   OverlayViewF: function() { return /* binding */ OverlayViewF; },\n/* harmony export */   Polygon: function() { return /* binding */ Polygon; },\n/* harmony export */   PolygonF: function() { return /* binding */ PolygonF; },\n/* harmony export */   Polyline: function() { return /* binding */ Polyline; },\n/* harmony export */   PolylineF: function() { return /* binding */ PolylineF; },\n/* harmony export */   Rectangle: function() { return /* binding */ Rectangle; },\n/* harmony export */   RectangleF: function() { return /* binding */ RectangleF; },\n/* harmony export */   StandaloneSearchBox: function() { return /* binding */ StandaloneSearchBox; },\n/* harmony export */   StreetViewPanorama: function() { return /* binding */ StreetViewPanorama; },\n/* harmony export */   StreetViewService: function() { return /* binding */ StreetViewService; },\n/* harmony export */   TrafficLayer: function() { return /* binding */ TrafficLayer; },\n/* harmony export */   TrafficLayerF: function() { return /* binding */ TrafficLayerF; },\n/* harmony export */   TransitLayer: function() { return /* binding */ TransitLayer; },\n/* harmony export */   TransitLayerF: function() { return /* binding */ TransitLayerF; },\n/* harmony export */   useGoogleMap: function() { return /* binding */ useGoogleMap; },\n/* harmony export */   useJsApiLoader: function() { return /* binding */ useJsApiLoader; },\n/* harmony export */   useLoadScript: function() { return /* binding */ useLoadScript; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/jsx-runtime.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-dom */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react-dom/index.js\");\n\r\n\r\n\r\n\r\n\r\nfunction _typeof(o) {\r\n  \"@babel/helpers - typeof\";\r\n\r\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\r\n    return typeof o;\r\n  } : function (o) {\r\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\r\n  }, _typeof(o);\r\n}\r\n\r\nfunction toPrimitive(t, r) {\r\n  if (\"object\" != _typeof(t) || !t) return t;\r\n  var e = t[Symbol.toPrimitive];\r\n  if (void 0 !== e) {\r\n    var i = e.call(t, r || \"default\");\r\n    if (\"object\" != _typeof(i)) return i;\r\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\r\n  }\r\n  return (\"string\" === r ? String : Number)(t);\r\n}\r\n\r\nfunction toPropertyKey(t) {\r\n  var i = toPrimitive(t, \"string\");\r\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\r\n}\r\n\r\nfunction _defineProperty(e, r, t) {\r\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\r\n    value: t,\r\n    enumerable: !0,\r\n    configurable: !0,\r\n    writable: !0\r\n  }) : e[r] = t, e;\r\n}\r\n\r\nfunction getDefaultExportFromCjs$1 (x) {\r\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\r\n}\r\n\r\n/**\r\n * Copyright (c) 2013-present, Facebook, Inc.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n */\r\nvar invariant_1;\r\nvar hasRequiredInvariant;\r\nfunction requireInvariant() {\r\n  if (hasRequiredInvariant) return invariant_1;\r\n  hasRequiredInvariant = 1;\r\n\r\n  /**\r\n   * Use invariant() to assert state which your program assumes to be true.\r\n   *\r\n   * Provide sprintf-style format (only %s is supported) and arguments\r\n   * to provide information about what broke and what you were\r\n   * expecting.\r\n   *\r\n   * The invariant message will be stripped in production, but the invariant\r\n   * will remain to ensure logic does not differ in production.\r\n   */\r\n\r\n  var NODE_ENV = \"development\";\r\n  var invariant = function invariant(condition, format, a, b, c, d, e, f) {\r\n    if (NODE_ENV !== 'production') {\r\n      if (format === undefined) {\r\n        throw new Error('invariant requires an error message argument');\r\n      }\r\n    }\r\n    if (!condition) {\r\n      var error;\r\n      if (format === undefined) {\r\n        error = new Error('Minified exception occurred; use the non-minified dev environment ' + 'for the full error message and additional helpful warnings.');\r\n      } else {\r\n        var args = [a, b, c, d, e, f];\r\n        var argIndex = 0;\r\n        error = new Error(format.replace(/%s/g, function () {\r\n          return args[argIndex++];\r\n        }));\r\n        error.name = 'Invariant Violation';\r\n      }\r\n      error.framesToPop = 1; // we don't care about invariant's own frame\r\n      throw error;\r\n    }\r\n  };\r\n  invariant_1 = invariant;\r\n  return invariant_1;\r\n}\r\n\r\nvar invariantExports = requireInvariant();\r\nvar invariant = /*@__PURE__*/getDefaultExportFromCjs$1(invariantExports);\r\n\r\nvar MapContext = (0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(null);\r\nfunction useGoogleMap() {\r\n  invariant(!!react__WEBPACK_IMPORTED_MODULE_1__.useContext, 'useGoogleMap is React hook and requires React version 16.8+');\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  invariant(!!map, 'useGoogleMap needs a GoogleMap available up in the tree');\r\n  return map;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction reduce(obj, fn, acc) {\r\n  return Object.keys(obj).reduce(function reducer(newAcc, key) {\r\n    return fn(newAcc, obj[key], key);\r\n  }, acc);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction forEach(obj, fn) {\r\n  Object.keys(obj).forEach(key => {\r\n    return fn(obj[key], key);\r\n  });\r\n}\r\n\r\n/* global google */\r\n/* eslint-disable filenames/match-regex */\r\nfunction applyUpdaterToNextProps(\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nupdaterMap,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nprevProps,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nnextProps,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ninstance\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n) {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  var map = {};\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  var iter = (fn, key) => {\r\n    var nextValue = nextProps[key];\r\n    if (nextValue !== prevProps[key]) {\r\n      map[key] = nextValue;\r\n      fn(instance, nextValue);\r\n    }\r\n  };\r\n  forEach(updaterMap, iter);\r\n  return map;\r\n}\r\nfunction registerEvents(\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nprops,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ninstance, eventMap) {\r\n  var registeredList = reduce(eventMap, function reducer(acc, googleEventName,\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  onEventName) {\r\n    if (typeof props[onEventName] === 'function') {\r\n      acc.push(google.maps.event.addListener(instance, googleEventName, props[onEventName]));\r\n    }\r\n    return acc;\r\n  }, []);\r\n  return registeredList;\r\n}\r\nfunction unregisterEvent(registered) {\r\n  google.maps.event.removeListener(registered);\r\n}\r\nfunction unregisterEvents() {\r\n  var events = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n  events.forEach(unregisterEvent);\r\n}\r\nfunction applyUpdatersToPropsAndRegisterEvents(_ref) {\r\n  var {\r\n    updaterMap,\r\n    eventMap,\r\n    prevProps,\r\n    nextProps,\r\n    instance\r\n  } = _ref;\r\n  var registeredEvents = registerEvents(nextProps, instance, eventMap);\r\n  applyUpdaterToNextProps(updaterMap, prevProps, nextProps, instance);\r\n  return registeredEvents;\r\n}\r\n\r\nvar eventMap$i = {\r\n  onDblClick: 'dblclick',\r\n  onDragEnd: 'dragend',\r\n  onDragStart: 'dragstart',\r\n  onMapTypeIdChanged: 'maptypeid_changed',\r\n  onMouseMove: 'mousemove',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseDown: 'mousedown',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick',\r\n  onTilesLoaded: 'tilesloaded',\r\n  onBoundsChanged: 'bounds_changed',\r\n  onCenterChanged: 'center_changed',\r\n  onClick: 'click',\r\n  onDrag: 'drag',\r\n  onHeadingChanged: 'heading_changed',\r\n  onIdle: 'idle',\r\n  onProjectionChanged: 'projection_changed',\r\n  onResize: 'resize',\r\n  onTiltChanged: 'tilt_changed',\r\n  onZoomChanged: 'zoom_changed'\r\n};\r\nvar updaterMap$i = {\r\n  extraMapTypes(map, extra) {\r\n    extra.forEach(function forEachExtra(it, i) {\r\n      map.mapTypes.set(String(i), it);\r\n    });\r\n  },\r\n  center(map, center) {\r\n    map.setCenter(center);\r\n  },\r\n  clickableIcons(map, clickable) {\r\n    map.setClickableIcons(clickable);\r\n  },\r\n  heading(map, heading) {\r\n    map.setHeading(heading);\r\n  },\r\n  mapTypeId(map, mapTypeId) {\r\n    map.setMapTypeId(mapTypeId);\r\n  },\r\n  options(map, options) {\r\n    map.setOptions(options);\r\n  },\r\n  streetView(map, streetView) {\r\n    map.setStreetView(streetView);\r\n  },\r\n  tilt(map, tilt) {\r\n    map.setTilt(tilt);\r\n  },\r\n  zoom(map, zoom) {\r\n    map.setZoom(zoom);\r\n  }\r\n};\r\n// TODO: unfinished!\r\nfunction GoogleMapFunctional(_ref) {\r\n  var {\r\n    children,\r\n    options,\r\n    id,\r\n    mapContainerStyle,\r\n    mapContainerClassName,\r\n    center,\r\n    // clickableIcons,\r\n    // extraMapTypes,\r\n    // heading,\r\n    // mapTypeId,\r\n    onClick,\r\n    onDblClick,\r\n    onDrag,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseDown,\r\n    onMouseUp,\r\n    onRightClick,\r\n    // onMapTypeIdChanged,\r\n    // onTilesLoaded,\r\n    // onBoundsChanged,\r\n    onCenterChanged,\r\n    // onHeadingChanged,\r\n    // onIdle,\r\n    // onProjectionChanged,\r\n    // onResize,\r\n    // onTiltChanged,\r\n    // onZoomChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var [map, setMap] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var ref = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\r\n  // const [extraMapTypesListener, setExtraMapTypesListener] = useState<google.maps.MapsEventListener | null>(null)\r\n  var [centerChangedListener, setCenterChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && map !== null) {\r\n      map.setOptions(options);\r\n    }\r\n  }, [map, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map !== null && typeof center !== 'undefined') {\r\n      map.setCenter(center);\r\n    }\r\n  }, [map, center]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(map, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onDragEnd) {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(map, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onDragStart) {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(map, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(map, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onMouseMove) {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(map, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(map, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(map, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(map, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onRightClick) {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(map, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(map, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onDrag) {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(map, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && onCenterChanged) {\r\n      if (centerChangedListener !== null) {\r\n        google.maps.event.removeListener(centerChangedListener);\r\n      }\r\n      setCenterChangedListener(google.maps.event.addListener(map, 'center_changed', onCenterChanged));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var map = ref.current === null ? null : new google.maps.Map(ref.current, options);\r\n    setMap(map);\r\n    if (map !== null && onLoad) {\r\n      onLoad(map);\r\n    }\r\n    return () => {\r\n      if (map !== null) {\r\n        if (onUnmount) {\r\n          onUnmount(map);\r\n        }\r\n      }\r\n    };\r\n  }, []);\r\n  return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n    id: id,\r\n    ref: ref,\r\n    style: mapContainerStyle,\r\n    className: mapContainerClassName,\r\n    children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(MapContext.Provider, {\r\n      value: map,\r\n      children: map !== null ? children : null\r\n    })\r\n  });\r\n}\r\n(0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(GoogleMapFunctional);\r\nclass GoogleMap extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      map: null\r\n    });\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"mapRef\", null);\r\n    _defineProperty(this, \"getInstance\", () => {\r\n      if (this.mapRef === null) {\r\n        return null;\r\n      }\r\n      return new google.maps.Map(this.mapRef, this.props.options);\r\n    });\r\n    _defineProperty(this, \"panTo\", latLng => {\r\n      var map = this.getInstance();\r\n      if (map) {\r\n        map.panTo(latLng);\r\n      }\r\n    });\r\n    _defineProperty(this, \"setMapCallback\", () => {\r\n      if (this.state.map !== null) {\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.map);\r\n        }\r\n      }\r\n    });\r\n    _defineProperty(this, \"getRef\", ref => {\r\n      this.mapRef = ref;\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var map = this.getInstance();\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$i,\r\n      eventMap: eventMap$i,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: map\r\n    });\r\n    this.setState(function setMap() {\r\n      return {\r\n        map\r\n      };\r\n    }, this.setMapCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.map !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$i,\r\n        eventMap: eventMap$i,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.map\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.map !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.map);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n    }\r\n  }\r\n  render() {\r\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n      id: this.props.id,\r\n      ref: this.getRef,\r\n      style: this.props.mapContainerStyle,\r\n      className: this.props.mapContainerClassName,\r\n      children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(MapContext.Provider, {\r\n        value: this.state.map,\r\n        children: this.state.map !== null ? this.props.children : null\r\n      })\r\n    });\r\n  }\r\n}\r\n\r\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\r\n  try {\r\n    var i = n[a](c),\r\n      u = i.value;\r\n  } catch (n) {\r\n    return void e(n);\r\n  }\r\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\r\n}\r\nfunction _asyncToGenerator(n) {\r\n  return function () {\r\n    var t = this,\r\n      e = arguments;\r\n    return new Promise(function (r, o) {\r\n      var a = n.apply(t, e);\r\n      function _next(n) {\r\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\r\n      }\r\n      function _throw(n) {\r\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\r\n      }\r\n      _next(void 0);\r\n    });\r\n  };\r\n}\r\n\r\nfunction makeLoadScriptUrl(_ref) {\r\n  var {\r\n    googleMapsApiKey,\r\n    googleMapsClientId,\r\n    version = 'weekly',\r\n    language,\r\n    region,\r\n    libraries,\r\n    channel,\r\n    mapIds,\r\n    authReferrerPolicy,\r\n    apiUrl = 'https://maps.googleapis.com'\r\n  } = _ref;\r\n  var params = [];\r\n  invariant(googleMapsApiKey && googleMapsClientId || !(googleMapsApiKey && googleMapsClientId), 'You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time.');\r\n  if (googleMapsApiKey) {\r\n    params.push(\"key=\".concat(googleMapsApiKey));\r\n  } else if (googleMapsClientId) {\r\n    params.push(\"client=\".concat(googleMapsClientId));\r\n  }\r\n  if (version) {\r\n    params.push(\"v=\".concat(version));\r\n  }\r\n  if (language) {\r\n    params.push(\"language=\".concat(language));\r\n  }\r\n  if (region) {\r\n    params.push(\"region=\".concat(region));\r\n  }\r\n  if (libraries && libraries.length) {\r\n    params.push(\"libraries=\".concat(libraries.sort().join(',')));\r\n  }\r\n  if (channel) {\r\n    params.push(\"channel=\".concat(channel));\r\n  }\r\n  if (mapIds && mapIds.length) {\r\n    params.push(\"map_ids=\".concat(mapIds.join(',')));\r\n  }\r\n  if (authReferrerPolicy) {\r\n    params.push(\"auth_referrer_policy=\".concat(authReferrerPolicy));\r\n  }\r\n  params.push('loading=async');\r\n  params.push('callback=initMap');\r\n  return \"\".concat(apiUrl, \"/maps/api/js?\").concat(params.join('&'));\r\n}\r\n\r\nvar isBrowser = typeof document !== 'undefined';\r\n\r\nfunction injectScript(_ref) {\r\n  var {\r\n    url,\r\n    id,\r\n    nonce\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  } = _ref;\r\n  if (!isBrowser) {\r\n    return Promise.reject(new Error('document is undefined'));\r\n  }\r\n  return new Promise(function injectScriptCallback(resolve, reject) {\r\n    var existingScript = document.getElementById(id);\r\n    var windowWithGoogleMap = window;\r\n    if (existingScript) {\r\n      // Same script id/url: keep same script\r\n      var dataStateAttribute = existingScript.getAttribute('data-state');\r\n      if (existingScript.src === url && dataStateAttribute !== 'error') {\r\n        if (dataStateAttribute === 'ready') {\r\n          return resolve(id);\r\n        } else {\r\n          var originalInitMap = windowWithGoogleMap.initMap;\r\n          var originalErrorCallback = existingScript.onerror;\r\n          windowWithGoogleMap.initMap = function initMap() {\r\n            if (originalInitMap) {\r\n              originalInitMap();\r\n            }\r\n            resolve(id);\r\n          };\r\n          existingScript.onerror = function (err) {\r\n            if (originalErrorCallback) {\r\n              originalErrorCallback(err);\r\n            }\r\n            reject(err);\r\n          };\r\n          return;\r\n        }\r\n      }\r\n      // Same script id, but either\r\n      // 1. requested URL is different\r\n      // 2. script failed to load\r\n      else {\r\n        existingScript.remove();\r\n      }\r\n    }\r\n    var script = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n    script.src = url;\r\n    script.id = id;\r\n    script.async = true;\r\n    script.nonce = nonce || '';\r\n    script.onerror = function onerror(err) {\r\n      script.setAttribute('data-state', 'error');\r\n      reject(err);\r\n    };\r\n    windowWithGoogleMap.initMap = function onload() {\r\n      script.setAttribute('data-state', 'ready');\r\n      resolve(id);\r\n    };\r\n    document.head.appendChild(script);\r\n  }).catch(err => {\r\n    console.error('injectScript error: ', err);\r\n    throw err;\r\n  });\r\n}\r\n\r\nfunction isGoogleFontStyle(element) {\r\n  // 'Roboto' or 'Google Sans Text' font download\r\n  var href = element.href;\r\n  if (href && (href.indexOf('https://fonts.googleapis.com/css?family=Roboto') === 0 || href.indexOf('https://fonts.googleapis.com/css?family=Google+Sans+Text') === 0)) {\r\n    return true;\r\n  }\r\n  // font style elements\r\n  if (\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.tagName.toLowerCase() === 'style' &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.styleSheet &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.styleSheet.cssText &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.styleSheet.cssText.replace('\\r\\n', '').indexOf('.gm-style') === 0) {\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    element.styleSheet.cssText = '';\r\n    return true;\r\n  }\r\n  // font style elements for other browsers\r\n  if (\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.tagName.toLowerCase() === 'style' &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.innerHTML &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.innerHTML.replace('\\r\\n', '').indexOf('.gm-style') === 0) {\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    element.innerHTML = '';\r\n    return true;\r\n  }\r\n  // when google tries to add empty style\r\n  if (\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  element.tagName.toLowerCase() === 'style' &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  !element.styleSheet &&\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  !element.innerHTML) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n// Preventing the Google Maps library from downloading an extra font\r\nfunction preventGoogleFonts() {\r\n  // we override these methods only for one particular head element\r\n  // default methods for other elements are not affected\r\n  var head = document.getElementsByTagName('head')[0];\r\n  if (head) {\r\n    var trueInsertBefore = head.insertBefore.bind(head);\r\n    // TODO: adding return before reflect solves the TS issue\r\n    head.insertBefore = function insertBefore(newElement, referenceElement) {\r\n      if (!isGoogleFontStyle(newElement)) {\r\n        Reflect.apply(trueInsertBefore, head, [newElement, referenceElement]);\r\n      }\r\n      return newElement;\r\n    };\r\n    var trueAppend = head.appendChild.bind(head);\r\n    // TODO: adding return before reflect solves the TS issue\r\n    head.appendChild = function appendChild(textNode) {\r\n      if (!isGoogleFontStyle(textNode)) {\r\n        Reflect.apply(trueAppend, head, [textNode]);\r\n      }\r\n      return textNode;\r\n    };\r\n  }\r\n}\r\n\r\nvar cleaningUp = false;\r\nfunction DefaultLoadingElement() {\r\n  return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n    children: \"Loading...\"\r\n  });\r\n}\r\nvar defaultLoadScriptProps = {\r\n  id: 'script-loader',\r\n  version: 'weekly'\r\n};\r\nclass LoadScript extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"check\", null);\r\n    _defineProperty(this, \"state\", {\r\n      loaded: false\r\n    });\r\n    _defineProperty(this, \"cleanupCallback\", () => {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      delete window.google.maps;\r\n      this.injectScript();\r\n    });\r\n    _defineProperty(this, \"isCleaningUp\", /*#__PURE__*/_asyncToGenerator(function* () {\r\n      function promiseCallback(resolve) {\r\n        if (!cleaningUp) {\r\n          resolve();\r\n        } else {\r\n          if (isBrowser) {\r\n            var timer = window.setInterval(function interval() {\r\n              if (!cleaningUp) {\r\n                window.clearInterval(timer);\r\n                resolve();\r\n              }\r\n            }, 1);\r\n          }\r\n        }\r\n        return;\r\n      }\r\n      return new Promise(promiseCallback);\r\n    }));\r\n    _defineProperty(this, \"cleanup\", () => {\r\n      cleaningUp = true;\r\n      var script = document.getElementById(this.props.id);\r\n      if (script && script.parentNode) {\r\n        script.parentNode.removeChild(script);\r\n      }\r\n      Array.prototype.slice.call(document.getElementsByTagName('script')).filter(function filter(script) {\r\n        return typeof script.src === 'string' && script.src.includes('maps.googleapis');\r\n      }).forEach(function forEach(script) {\r\n        if (script.parentNode) {\r\n          script.parentNode.removeChild(script);\r\n        }\r\n      });\r\n      Array.prototype.slice.call(document.getElementsByTagName('link')).filter(function filter(link) {\r\n        return link.href === 'https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans';\r\n      }).forEach(function forEach(link) {\r\n        if (link.parentNode) {\r\n          link.parentNode.removeChild(link);\r\n        }\r\n      });\r\n      Array.prototype.slice.call(document.getElementsByTagName('style')).filter(function filter(style) {\r\n        return style.innerText !== undefined && style.innerText.length > 0 && style.innerText.includes('.gm-');\r\n      }).forEach(function forEach(style) {\r\n        if (style.parentNode) {\r\n          style.parentNode.removeChild(style);\r\n        }\r\n      });\r\n    });\r\n    _defineProperty(this, \"injectScript\", () => {\r\n      if (this.props.preventGoogleFontsLoading) {\r\n        preventGoogleFonts();\r\n      }\r\n      invariant(!!this.props.id, 'LoadScript requires \"id\" prop to be a string: %s', this.props.id);\r\n      var injectScriptOptions = {\r\n        id: this.props.id,\r\n        nonce: this.props.nonce,\r\n        url: makeLoadScriptUrl(this.props)\r\n      };\r\n      injectScript(injectScriptOptions).then(() => {\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad();\r\n        }\r\n        this.setState(function setLoaded() {\r\n          return {\r\n            loaded: true\r\n          };\r\n        });\r\n        return;\r\n      }).catch(err => {\r\n        if (this.props.onError) {\r\n          this.props.onError(err);\r\n        }\r\n        console.error(\"\\n          There has been an Error with loading Google Maps API script, please check that you provided correct google API key (\".concat(this.props.googleMapsApiKey || '-', \") or Client ID (\").concat(this.props.googleMapsClientId || '-', \") to <LoadScript />\\n          Otherwise it is a Network issue.\\n        \"));\r\n      });\r\n    });\r\n    _defineProperty(this, \"getRef\", el => {\r\n      this.check = el;\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    if (isBrowser) {\r\n      if (window.google && window.google.maps && !cleaningUp) {\r\n        console.error('google api is already presented');\r\n        return;\r\n      }\r\n      this.isCleaningUp().then(this.injectScript).catch(function error(err) {\r\n        console.error('Error at injecting script after cleaning up: ', err);\r\n      });\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.libraries !== prevProps.libraries) {\r\n      console.warn('Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables');\r\n    }\r\n    if (isBrowser && prevProps.language !== this.props.language) {\r\n      this.cleanup();\r\n      // TODO: refactor to use gDSFP maybe... wait for hooks refactoring.\r\n      this.setState(function setLoaded() {\r\n        return {\r\n          loaded: false\r\n        };\r\n      }, this.cleanupCallback);\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (isBrowser) {\r\n      this.cleanup();\r\n      var timeoutCallback = () => {\r\n        if (!this.check) {\r\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n          // @ts-ignore\r\n          delete window.google;\r\n          cleaningUp = false;\r\n        }\r\n      };\r\n      window.setTimeout(timeoutCallback, 1);\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount();\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, {\r\n      children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n        ref: this.getRef\r\n      }), this.state.loaded ? this.props.children : this.props.loadingElement || (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DefaultLoadingElement, {})]\r\n    });\r\n  }\r\n}\r\n_defineProperty(LoadScript, \"defaultProps\", defaultLoadScriptProps);\r\n\r\nfunction _objectWithoutPropertiesLoose(r, e) {\r\n  if (null == r) return {};\r\n  var t = {};\r\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\r\n    if (e.includes(n)) continue;\r\n    t[n] = r[n];\r\n  }\r\n  return t;\r\n}\r\n\r\nfunction _objectWithoutProperties(e, t) {\r\n  if (null == e) return {};\r\n  var o,\r\n    r,\r\n    i = _objectWithoutPropertiesLoose(e, t);\r\n  if (Object.getOwnPropertySymbols) {\r\n    var s = Object.getOwnPropertySymbols(e);\r\n    for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\r\n  }\r\n  return i;\r\n}\r\n\r\n/* eslint-disable filenames/match-regex */\r\nvar previouslyLoadedUrl;\r\nfunction useLoadScript(_ref) {\r\n  var {\r\n    id = defaultLoadScriptProps.id,\r\n    version = defaultLoadScriptProps.version,\r\n    nonce,\r\n    googleMapsApiKey,\r\n    googleMapsClientId,\r\n    language,\r\n    region,\r\n    libraries,\r\n    preventGoogleFontsLoading,\r\n    channel,\r\n    mapIds,\r\n    authReferrerPolicy,\r\n    apiUrl = \"https://maps.googleapis.com\"\r\n  } = _ref;\r\n  var isMounted = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);\r\n  var [isLoaded, setLoaded] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\r\n  var [loadError, setLoadError] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(undefined);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function trackMountedState() {\r\n    isMounted.current = true;\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n  }, []);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function applyPreventGoogleFonts() {\r\n    if (isBrowser && preventGoogleFontsLoading) {\r\n      preventGoogleFonts();\r\n    }\r\n  }, [preventGoogleFontsLoading]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function validateLoadedState() {\r\n    if (isLoaded) {\r\n      invariant(!!window.google, 'useLoadScript was marked as loaded, but window.google is not present. Something went wrong.');\r\n    }\r\n  }, [isLoaded]);\r\n  var url = makeLoadScriptUrl({\r\n    version,\r\n    googleMapsApiKey,\r\n    googleMapsClientId,\r\n    language,\r\n    region,\r\n    libraries,\r\n    channel,\r\n    mapIds,\r\n    authReferrerPolicy,\r\n    apiUrl\r\n  });\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function loadScriptAndModifyLoadedState() {\r\n    if (!isBrowser) {\r\n      return;\r\n    }\r\n    function setLoadedIfMounted() {\r\n      if (isMounted.current) {\r\n        setLoaded(true);\r\n        previouslyLoadedUrl = url;\r\n      }\r\n    }\r\n    if (window.google && window.google.maps && previouslyLoadedUrl === url) {\r\n      setLoadedIfMounted();\r\n      return;\r\n    }\r\n    injectScript({\r\n      id,\r\n      url,\r\n      nonce\r\n    }).then(setLoadedIfMounted).catch(function handleInjectError(err) {\r\n      if (isMounted.current) {\r\n        setLoadError(err);\r\n      }\r\n      console.warn(\"\\n        There has been an Error with loading Google Maps API script, please check that you provided correct google API key (\".concat(googleMapsApiKey || '-', \") or Client ID (\").concat(googleMapsClientId || '-', \")\\n        Otherwise it is a Network issue.\\n      \"));\r\n      console.error(err);\r\n    });\r\n  }, [id, url, nonce]);\r\n  var prevLibraries = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(undefined);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function checkPerformance() {\r\n    if (prevLibraries.current && libraries !== prevLibraries.current) {\r\n      console.warn('Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables');\r\n    }\r\n    prevLibraries.current = libraries;\r\n  }, [libraries]);\r\n  return {\r\n    isLoaded,\r\n    loadError,\r\n    url\r\n  };\r\n}\r\n\r\nvar _excluded$1 = [\"loadingElement\", \"onLoad\", \"onError\", \"onUnmount\", \"children\"];\r\nvar defaultLoadingElement = (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(DefaultLoadingElement, {});\r\nfunction LoadScriptNext(_ref) {\r\n  var {\r\n      loadingElement,\r\n      onLoad,\r\n      onError,\r\n      onUnmount,\r\n      children\r\n    } = _ref,\r\n    hookOptions = _objectWithoutProperties(_ref, _excluded$1);\r\n  var {\r\n    isLoaded,\r\n    loadError\r\n  } = useLoadScript(hookOptions);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function handleOnLoad() {\r\n    if (isLoaded && typeof onLoad === 'function') {\r\n      onLoad();\r\n    }\r\n  }, [isLoaded, onLoad]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function handleOnError() {\r\n    if (loadError && typeof onError === 'function') {\r\n      onError(loadError);\r\n    }\r\n  }, [loadError, onError]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function handleOnUnmount() {\r\n    return () => {\r\n      if (onUnmount) {\r\n        onUnmount();\r\n      }\r\n    };\r\n  }, [onUnmount]);\r\n  return isLoaded ? children : loadingElement || defaultLoadingElement;\r\n}\r\nvar LoadScriptNext$1 = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(LoadScriptNext);\r\n\r\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n  function adopt(value) {\r\n    return value instanceof P ? value : new P(function (resolve) {\r\n      resolve(value);\r\n    });\r\n  }\r\n  return new (P || (P = Promise))(function (resolve, reject) {\r\n    function fulfilled(value) {\r\n      try {\r\n        step(generator.next(value));\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    }\r\n    function rejected(value) {\r\n      try {\r\n        step(generator[\"throw\"](value));\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    }\r\n    function step(result) {\r\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\r\n    }\r\n    step((generator = generator.apply(thisArg, [])).next());\r\n  });\r\n}\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n  var e = new Error(message);\r\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\nfunction getDefaultExportFromCjs(x) {\r\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\r\n}\r\n\r\n// do not edit .js files directly - edit src/index.jst\r\n\r\nvar fastDeepEqual$1 = function equal(a, b) {\r\n  if (a === b) return true;\r\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\r\n    if (a.constructor !== b.constructor) return false;\r\n    var length, i, keys;\r\n    if (Array.isArray(a)) {\r\n      length = a.length;\r\n      if (length != b.length) return false;\r\n      for (i = length; i-- !== 0;) if (!equal(a[i], b[i])) return false;\r\n      return true;\r\n    }\r\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\r\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\r\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\r\n    keys = Object.keys(a);\r\n    length = keys.length;\r\n    if (length !== Object.keys(b).length) return false;\r\n    for (i = length; i-- !== 0;) if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\r\n    for (i = length; i-- !== 0;) {\r\n      var key = keys[i];\r\n      if (!equal(a[key], b[key])) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // true if both NaN, false otherwise\r\n  return a !== a && b !== b;\r\n};\r\nvar isEqual = /*@__PURE__*/getDefaultExportFromCjs(fastDeepEqual$1);\r\n\r\n/**\r\n * Copyright 2019 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at.\r\n *\r\n *      Http://www.apache.org/licenses/LICENSE-2.0.\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_ID = \"__googleMapsScriptId\";\r\n/**\r\n * The status of the [[Loader]].\r\n */\r\nvar LoaderStatus;\r\n(function (LoaderStatus) {\r\n  LoaderStatus[LoaderStatus[\"INITIALIZED\"] = 0] = \"INITIALIZED\";\r\n  LoaderStatus[LoaderStatus[\"LOADING\"] = 1] = \"LOADING\";\r\n  LoaderStatus[LoaderStatus[\"SUCCESS\"] = 2] = \"SUCCESS\";\r\n  LoaderStatus[LoaderStatus[\"FAILURE\"] = 3] = \"FAILURE\";\r\n})(LoaderStatus || (LoaderStatus = {}));\r\n/**\r\n * [[Loader]] makes it easier to add Google Maps JavaScript API to your application\r\n * dynamically using\r\n * [Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise).\r\n * It works by dynamically creating and appending a script node to the the\r\n * document head and wrapping the callback function so as to return a promise.\r\n *\r\n * ```\r\n * const loader = new Loader({\r\n *   apiKey: \"\",\r\n *   version: \"weekly\",\r\n *   libraries: [\"places\"]\r\n * });\r\n *\r\n * loader.load().then((google) => {\r\n *   const map = new google.maps.Map(...)\r\n * })\r\n * ```\r\n */\r\nclass Loader {\r\n  /**\r\n   * Creates an instance of Loader using [[LoaderOptions]]. No defaults are set\r\n   * using this library, instead the defaults are set by the Google Maps\r\n   * JavaScript API server.\r\n   *\r\n   * ```\r\n   * const loader = Loader({apiKey, version: 'weekly', libraries: ['places']});\r\n   * ```\r\n   */\r\n  constructor(_ref) {\r\n    var {\r\n      apiKey,\r\n      authReferrerPolicy,\r\n      channel,\r\n      client,\r\n      id = DEFAULT_ID,\r\n      language,\r\n      libraries = [],\r\n      mapIds,\r\n      nonce,\r\n      region,\r\n      retries = 3,\r\n      url = \"https://maps.googleapis.com/maps/api/js\",\r\n      version\r\n    } = _ref;\r\n    this.callbacks = [];\r\n    this.done = false;\r\n    this.loading = false;\r\n    this.errors = [];\r\n    this.apiKey = apiKey;\r\n    this.authReferrerPolicy = authReferrerPolicy;\r\n    this.channel = channel;\r\n    this.client = client;\r\n    this.id = id || DEFAULT_ID; // Do not allow empty string\r\n    this.language = language;\r\n    this.libraries = libraries;\r\n    this.mapIds = mapIds;\r\n    this.nonce = nonce;\r\n    this.region = region;\r\n    this.retries = retries;\r\n    this.url = url;\r\n    this.version = version;\r\n    if (Loader.instance) {\r\n      if (!isEqual(this.options, Loader.instance.options)) {\r\n        throw new Error(\"Loader must not be called again with different options. \".concat(JSON.stringify(this.options), \" !== \").concat(JSON.stringify(Loader.instance.options)));\r\n      }\r\n      return Loader.instance;\r\n    }\r\n    Loader.instance = this;\r\n  }\r\n  get options() {\r\n    return {\r\n      version: this.version,\r\n      apiKey: this.apiKey,\r\n      channel: this.channel,\r\n      client: this.client,\r\n      id: this.id,\r\n      libraries: this.libraries,\r\n      language: this.language,\r\n      region: this.region,\r\n      mapIds: this.mapIds,\r\n      nonce: this.nonce,\r\n      url: this.url,\r\n      authReferrerPolicy: this.authReferrerPolicy\r\n    };\r\n  }\r\n  get status() {\r\n    if (this.errors.length) {\r\n      return LoaderStatus.FAILURE;\r\n    }\r\n    if (this.done) {\r\n      return LoaderStatus.SUCCESS;\r\n    }\r\n    if (this.loading) {\r\n      return LoaderStatus.LOADING;\r\n    }\r\n    return LoaderStatus.INITIALIZED;\r\n  }\r\n  get failed() {\r\n    return this.done && !this.loading && this.errors.length >= this.retries + 1;\r\n  }\r\n  /**\r\n   * CreateUrl returns the Google Maps JavaScript API script url given the [[LoaderOptions]].\r\n   *\r\n   * @ignore\r\n   * @deprecated\r\n   */\r\n  createUrl() {\r\n    var url = this.url;\r\n    url += \"?callback=__googleMapsCallback&loading=async\";\r\n    if (this.apiKey) {\r\n      url += \"&key=\".concat(this.apiKey);\r\n    }\r\n    if (this.channel) {\r\n      url += \"&channel=\".concat(this.channel);\r\n    }\r\n    if (this.client) {\r\n      url += \"&client=\".concat(this.client);\r\n    }\r\n    if (this.libraries.length > 0) {\r\n      url += \"&libraries=\".concat(this.libraries.join(\",\"));\r\n    }\r\n    if (this.language) {\r\n      url += \"&language=\".concat(this.language);\r\n    }\r\n    if (this.region) {\r\n      url += \"&region=\".concat(this.region);\r\n    }\r\n    if (this.version) {\r\n      url += \"&v=\".concat(this.version);\r\n    }\r\n    if (this.mapIds) {\r\n      url += \"&map_ids=\".concat(this.mapIds.join(\",\"));\r\n    }\r\n    if (this.authReferrerPolicy) {\r\n      url += \"&auth_referrer_policy=\".concat(this.authReferrerPolicy);\r\n    }\r\n    return url;\r\n  }\r\n  deleteScript() {\r\n    var script = document.getElementById(this.id);\r\n    if (script) {\r\n      script.remove();\r\n    }\r\n  }\r\n  /**\r\n   * Load the Google Maps JavaScript API script and return a Promise.\r\n   * @deprecated, use importLibrary() instead.\r\n   */\r\n  load() {\r\n    return this.loadPromise();\r\n  }\r\n  /**\r\n   * Load the Google Maps JavaScript API script and return a Promise.\r\n   *\r\n   * @ignore\r\n   * @deprecated, use importLibrary() instead.\r\n   */\r\n  loadPromise() {\r\n    return new Promise((resolve, reject) => {\r\n      this.loadCallback(err => {\r\n        if (!err) {\r\n          resolve(window.google);\r\n        } else {\r\n          reject(err.error);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  importLibrary(name) {\r\n    this.execute();\r\n    return google.maps.importLibrary(name);\r\n  }\r\n  /**\r\n   * Load the Google Maps JavaScript API script with a callback.\r\n   * @deprecated, use importLibrary() instead.\r\n   */\r\n  loadCallback(fn) {\r\n    this.callbacks.push(fn);\r\n    this.execute();\r\n  }\r\n  /**\r\n   * Set the script on document.\r\n   */\r\n  setScript() {\r\n    var _a, _b;\r\n    if (document.getElementById(this.id)) {\r\n      // TODO wrap onerror callback for cases where the script was loaded elsewhere\r\n      this.callback();\r\n      return;\r\n    }\r\n    var params = {\r\n      key: this.apiKey,\r\n      channel: this.channel,\r\n      client: this.client,\r\n      libraries: this.libraries.length && this.libraries,\r\n      v: this.version,\r\n      mapIds: this.mapIds,\r\n      language: this.language,\r\n      region: this.region,\r\n      authReferrerPolicy: this.authReferrerPolicy\r\n    };\r\n    // keep the URL minimal:\r\n    Object.keys(params).forEach(\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    key => !params[key] && delete params[key]);\r\n    if (!((_b = (_a = window === null || window === void 0 ? void 0 : window.google) === null || _a === void 0 ? void 0 : _a.maps) === null || _b === void 0 ? void 0 : _b.importLibrary)) {\r\n      // tweaked copy of https://developers.google.com/maps/documentation/javascript/load-maps-js-api#dynamic-library-import\r\n      // which also sets the base url, the id, and the nonce\r\n      /* eslint-disable */\r\n      (g => {\r\n        // @ts-ignore\r\n        var h,\r\n          a,\r\n          k,\r\n          p = \"The Google Maps JavaScript API\",\r\n          c = \"google\",\r\n          l = \"importLibrary\",\r\n          q = \"__ib__\",\r\n          m = document,\r\n          b = window;\r\n        // @ts-ignore\r\n        b = b[c] || (b[c] = {});\r\n        // @ts-ignore\r\n        var d = b.maps || (b.maps = {}),\r\n          r = new Set(),\r\n          e = new URLSearchParams(),\r\n          u = () =>\r\n          // @ts-ignore\r\n          h || (h = new Promise((f, n) => __awaiter(this, void 0, void 0, function* () {\r\n            var _a;\r\n            yield a = m.createElement(\"script\");\r\n            a.id = this.id;\r\n            e.set(\"libraries\", [...r] + \"\");\r\n            // @ts-ignore\r\n            for (k in g) e.set(k.replace(/[A-Z]/g, t => \"_\" + t[0].toLowerCase()), g[k]);\r\n            e.set(\"callback\", c + \".maps.\" + q);\r\n            a.src = this.url + \"?\" + e;\r\n            d[q] = f;\r\n            a.onerror = () => h = n(Error(p + \" could not load.\"));\r\n            // @ts-ignore\r\n            a.nonce = this.nonce || ((_a = m.querySelector(\"script[nonce]\")) === null || _a === void 0 ? void 0 : _a.nonce) || \"\";\r\n            m.head.append(a);\r\n          })));\r\n        // @ts-ignore\r\n        d[l] ? console.warn(p + \" only loads once. Ignoring:\", g) : d[l] = function (f) {\r\n          for (var _len = arguments.length, n = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\r\n            n[_key - 1] = arguments[_key];\r\n          }\r\n          return r.add(f) && u().then(() => d[l](f, ...n));\r\n        };\r\n      })(params);\r\n      /* eslint-enable */\r\n    }\r\n    // While most libraries populate the global namespace when loaded via bootstrap params,\r\n    // this is not the case for \"marker\" when used with the inline bootstrap loader\r\n    // (and maybe others in the future). So ensure there is an importLibrary for each:\r\n    var libraryPromises = this.libraries.map(library => this.importLibrary(library));\r\n    // ensure at least one library, to kick off loading...\r\n    if (!libraryPromises.length) {\r\n      libraryPromises.push(this.importLibrary(\"core\"));\r\n    }\r\n    Promise.all(libraryPromises).then(() => this.callback(), error => {\r\n      var event = new ErrorEvent(\"error\", {\r\n        error\r\n      }); // for backwards compat\r\n      this.loadErrorCallback(event);\r\n    });\r\n  }\r\n  /**\r\n   * Reset the loader state.\r\n   */\r\n  reset() {\r\n    this.deleteScript();\r\n    this.done = false;\r\n    this.loading = false;\r\n    this.errors = [];\r\n    this.onerrorEvent = null;\r\n  }\r\n  resetIfRetryingFailed() {\r\n    if (this.failed) {\r\n      this.reset();\r\n    }\r\n  }\r\n  loadErrorCallback(e) {\r\n    this.errors.push(e);\r\n    if (this.errors.length <= this.retries) {\r\n      var delay = this.errors.length * Math.pow(2, this.errors.length);\r\n      console.error(\"Failed to load Google Maps script, retrying in \".concat(delay, \" ms.\"));\r\n      setTimeout(() => {\r\n        this.deleteScript();\r\n        this.setScript();\r\n      }, delay);\r\n    } else {\r\n      this.onerrorEvent = e;\r\n      this.callback();\r\n    }\r\n  }\r\n  callback() {\r\n    this.done = true;\r\n    this.loading = false;\r\n    this.callbacks.forEach(cb => {\r\n      cb(this.onerrorEvent);\r\n    });\r\n    this.callbacks = [];\r\n  }\r\n  execute() {\r\n    this.resetIfRetryingFailed();\r\n    if (this.loading) {\r\n      // do nothing but wait\r\n      return;\r\n    }\r\n    if (this.done) {\r\n      this.callback();\r\n    } else {\r\n      // short circuit and warn if google.maps is already loaded\r\n      if (window.google && window.google.maps && window.google.maps.version) {\r\n        console.warn(\"Google Maps already loaded outside @googlemaps/js-api-loader. \" + \"This may result in undesirable behavior as options and script parameters may not match.\");\r\n        this.callback();\r\n        return;\r\n      }\r\n      this.loading = true;\r\n      this.setScript();\r\n    }\r\n  }\r\n}\r\n\r\nvar defaultLibraries = ['maps'];\r\nfunction useJsApiLoader(_ref) {\r\n  var {\r\n    id = defaultLoadScriptProps.id,\r\n    version = defaultLoadScriptProps.version,\r\n    nonce,\r\n    googleMapsApiKey,\r\n    // googleMapsClientId,\r\n    language,\r\n    region,\r\n    libraries = defaultLibraries,\r\n    preventGoogleFontsLoading,\r\n    // channel,\r\n    mapIds,\r\n    authReferrerPolicy\r\n  } = _ref;\r\n  var isMounted = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(false);\r\n  var [isLoaded, setLoaded] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);\r\n  var [loadError, setLoadError] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(undefined);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function trackMountedState() {\r\n    isMounted.current = true;\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n  }, []);\r\n  var loader = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => {\r\n    return new Loader({\r\n      id,\r\n      apiKey: googleMapsApiKey,\r\n      version,\r\n      libraries,\r\n      language: language || 'en',\r\n      region: region || 'US',\r\n      mapIds: mapIds || [],\r\n      nonce: nonce || '',\r\n      authReferrerPolicy: authReferrerPolicy || 'origin'\r\n    });\r\n  }, [id, googleMapsApiKey, version, libraries, language, region, mapIds, nonce, authReferrerPolicy]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function effect() {\r\n    if (isLoaded) {\r\n      return;\r\n    } else {\r\n      loader.load().then(() => {\r\n        if (isMounted.current) {\r\n          setLoaded(true);\r\n        }\r\n        return;\r\n      }).catch(error => {\r\n        setLoadError(error);\r\n      });\r\n    }\r\n  }, []);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (isBrowser && preventGoogleFontsLoading) {\r\n      preventGoogleFonts();\r\n    }\r\n  }, [preventGoogleFontsLoading]);\r\n  var prevLibraries = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)();\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (prevLibraries.current && libraries !== prevLibraries.current) {\r\n      console.warn('Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables');\r\n    }\r\n    prevLibraries.current = libraries;\r\n  }, [libraries]);\r\n  return {\r\n    isLoaded,\r\n    loadError\r\n  };\r\n}\r\n\r\nfunction ownKeys$f(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$f(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$f(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$f(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$h = {};\r\nvar updaterMap$h = {\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  }\r\n};\r\nfunction TrafficLayerFunctional(_ref) {\r\n  var {\r\n    options,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var trafficLayer = new google.maps.TrafficLayer(_objectSpread$f(_objectSpread$f({}, options), {}, {\r\n      map\r\n    }));\r\n    setInstance(trafficLayer);\r\n    if (onLoad) {\r\n      onLoad(trafficLayer);\r\n    }\r\n    return () => {\r\n      if (instance !== null) {\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar TrafficLayerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(TrafficLayerFunctional);\r\nclass TrafficLayer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      trafficLayer: null\r\n    });\r\n    _defineProperty(this, \"setTrafficLayerCallback\", () => {\r\n      if (this.state.trafficLayer !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.trafficLayer);\r\n      }\r\n    });\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n  }\r\n  componentDidMount() {\r\n    var trafficLayer = new google.maps.TrafficLayer(_objectSpread$f(_objectSpread$f({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$h,\r\n      eventMap: eventMap$h,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: trafficLayer\r\n    });\r\n    this.setState(function setTrafficLayer() {\r\n      return {\r\n        trafficLayer\r\n      };\r\n    }, this.setTrafficLayerCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.trafficLayer !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$h,\r\n        eventMap: eventMap$h,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.trafficLayer\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.trafficLayer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.trafficLayer);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.trafficLayer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(TrafficLayer, \"contextType\", MapContext);\r\n\r\nfunction BicyclingLayerFunctional(_ref) {\r\n  var {\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var bicyclingLayer = new google.maps.BicyclingLayer();\r\n    setInstance(bicyclingLayer);\r\n    bicyclingLayer.setMap(map);\r\n    if (onLoad) {\r\n      onLoad(bicyclingLayer);\r\n    }\r\n    return () => {\r\n      if (bicyclingLayer !== null) {\r\n        if (onUnmount) {\r\n          onUnmount(bicyclingLayer);\r\n        }\r\n        bicyclingLayer.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar BicyclingLayerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(BicyclingLayerFunctional);\r\nclass BicyclingLayer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      bicyclingLayer: null\r\n    });\r\n    _defineProperty(this, \"setBicyclingLayerCallback\", () => {\r\n      if (this.state.bicyclingLayer !== null) {\r\n        this.state.bicyclingLayer.setMap(this.context);\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.bicyclingLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var bicyclingLayer = new google.maps.BicyclingLayer();\r\n    this.setState(() => {\r\n      return {\r\n        bicyclingLayer\r\n      };\r\n    }, this.setBicyclingLayerCallback);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.bicyclingLayer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.bicyclingLayer);\r\n      }\r\n      this.state.bicyclingLayer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(BicyclingLayer, \"contextType\", MapContext);\r\n\r\nfunction TransitLayerFunctional(_ref) {\r\n  var {\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var transitLayer = new google.maps.TransitLayer();\r\n    setInstance(transitLayer);\r\n    transitLayer.setMap(map);\r\n    if (onLoad) {\r\n      onLoad(transitLayer);\r\n    }\r\n    return () => {\r\n      if (instance !== null) {\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar TransitLayerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(TransitLayerFunctional);\r\nclass TransitLayer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      transitLayer: null\r\n    });\r\n    _defineProperty(this, \"setTransitLayerCallback\", () => {\r\n      if (this.state.transitLayer !== null) {\r\n        this.state.transitLayer.setMap(this.context);\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.transitLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var transitLayer = new google.maps.TransitLayer();\r\n    this.setState(function setTransitLayer() {\r\n      return {\r\n        transitLayer\r\n      };\r\n    }, this.setTransitLayerCallback);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.transitLayer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.transitLayer);\r\n      }\r\n      this.state.transitLayer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(TransitLayer, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$e(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$e(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$e(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$e(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$g = {\r\n  onCircleComplete: 'circlecomplete',\r\n  onMarkerComplete: 'markercomplete',\r\n  onOverlayComplete: 'overlaycomplete',\r\n  onPolygonComplete: 'polygoncomplete',\r\n  onPolylineComplete: 'polylinecomplete',\r\n  onRectangleComplete: 'rectanglecomplete'\r\n};\r\nvar updaterMap$g = {\r\n  drawingMode(instance, drawingMode) {\r\n    instance.setDrawingMode(drawingMode);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  }\r\n};\r\nfunction DrawingManagerFunctional(_ref) {\r\n  var {\r\n    options,\r\n    drawingMode,\r\n    onCircleComplete,\r\n    onMarkerComplete,\r\n    onOverlayComplete,\r\n    onPolygonComplete,\r\n    onPolylineComplete,\r\n    onRectangleComplete,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [circlecompleteListener, setCircleCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [markercompleteListener, setMarkerCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [overlaycompleteListener, setOverlayCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [polygoncompleteListener, setPolygonCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [polylinecompleteListener, setPolylineCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rectanglecompleteListener, setRectangleCompleteListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setDrawingMode(drawingMode !== null && drawingMode !== void 0 ? drawingMode : null);\r\n    }\r\n  }, [instance, drawingMode]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onCircleComplete) {\r\n      if (circlecompleteListener !== null) {\r\n        google.maps.event.removeListener(circlecompleteListener);\r\n      }\r\n      setCircleCompleteListener(google.maps.event.addListener(instance, 'circlecomplete', onCircleComplete));\r\n    }\r\n  }, [instance, onCircleComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMarkerComplete) {\r\n      if (markercompleteListener !== null) {\r\n        google.maps.event.removeListener(markercompleteListener);\r\n      }\r\n      setMarkerCompleteListener(google.maps.event.addListener(instance, 'markercomplete', onMarkerComplete));\r\n    }\r\n  }, [instance, onMarkerComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onOverlayComplete) {\r\n      if (overlaycompleteListener !== null) {\r\n        google.maps.event.removeListener(overlaycompleteListener);\r\n      }\r\n      setOverlayCompleteListener(google.maps.event.addListener(instance, 'overlaycomplete', onOverlayComplete));\r\n    }\r\n  }, [instance, onOverlayComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onPolygonComplete) {\r\n      if (polygoncompleteListener !== null) {\r\n        google.maps.event.removeListener(polygoncompleteListener);\r\n      }\r\n      setPolygonCompleteListener(google.maps.event.addListener(instance, 'polygoncomplete', onPolygonComplete));\r\n    }\r\n  }, [instance, onPolygonComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onPolylineComplete) {\r\n      if (polylinecompleteListener !== null) {\r\n        google.maps.event.removeListener(polylinecompleteListener);\r\n      }\r\n      setPolylineCompleteListener(google.maps.event.addListener(instance, 'polylinecomplete', onPolylineComplete));\r\n    }\r\n  }, [instance, onPolylineComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRectangleComplete) {\r\n      if (rectanglecompleteListener !== null) {\r\n        google.maps.event.removeListener(rectanglecompleteListener);\r\n      }\r\n      setRectangleCompleteListener(google.maps.event.addListener(instance, 'rectanglecomplete', onRectangleComplete));\r\n    }\r\n  }, [instance, onRectangleComplete]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    invariant(!!google.maps.drawing, \"Did you include prop libraries={['drawing']} in the URL? %s\", google.maps.drawing);\r\n    var drawingManager = new google.maps.drawing.DrawingManager(_objectSpread$e(_objectSpread$e({}, options), {}, {\r\n      map\r\n    }));\r\n    if (drawingMode) {\r\n      drawingManager.setDrawingMode(drawingMode);\r\n    }\r\n    if (onCircleComplete) {\r\n      setCircleCompleteListener(google.maps.event.addListener(drawingManager, 'circlecomplete', onCircleComplete));\r\n    }\r\n    if (onMarkerComplete) {\r\n      setMarkerCompleteListener(google.maps.event.addListener(drawingManager, 'markercomplete', onMarkerComplete));\r\n    }\r\n    if (onOverlayComplete) {\r\n      setOverlayCompleteListener(google.maps.event.addListener(drawingManager, 'overlaycomplete', onOverlayComplete));\r\n    }\r\n    if (onPolygonComplete) {\r\n      setPolygonCompleteListener(google.maps.event.addListener(drawingManager, 'polygoncomplete', onPolygonComplete));\r\n    }\r\n    if (onPolylineComplete) {\r\n      setPolylineCompleteListener(google.maps.event.addListener(drawingManager, 'polylinecomplete', onPolylineComplete));\r\n    }\r\n    if (onRectangleComplete) {\r\n      setRectangleCompleteListener(google.maps.event.addListener(drawingManager, 'rectanglecomplete', onRectangleComplete));\r\n    }\r\n    setInstance(drawingManager);\r\n    if (onLoad) {\r\n      onLoad(drawingManager);\r\n    }\r\n    return () => {\r\n      if (instance !== null) {\r\n        if (circlecompleteListener) {\r\n          google.maps.event.removeListener(circlecompleteListener);\r\n        }\r\n        if (markercompleteListener) {\r\n          google.maps.event.removeListener(markercompleteListener);\r\n        }\r\n        if (overlaycompleteListener) {\r\n          google.maps.event.removeListener(overlaycompleteListener);\r\n        }\r\n        if (polygoncompleteListener) {\r\n          google.maps.event.removeListener(polygoncompleteListener);\r\n        }\r\n        if (polylinecompleteListener) {\r\n          google.maps.event.removeListener(polylinecompleteListener);\r\n        }\r\n        if (rectanglecompleteListener) {\r\n          google.maps.event.removeListener(rectanglecompleteListener);\r\n        }\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar DrawingManagerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(DrawingManagerFunctional);\r\nclass DrawingManager extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      drawingManager: null\r\n    });\r\n    _defineProperty(this, \"setDrawingManagerCallback\", () => {\r\n      if (this.state.drawingManager !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.drawingManager);\r\n      }\r\n    });\r\n    invariant(!!google.maps.drawing, \"Did you include prop libraries={['drawing']} in the URL? %s\", google.maps.drawing);\r\n  }\r\n  componentDidMount() {\r\n    var drawingManager = new google.maps.drawing.DrawingManager(_objectSpread$e(_objectSpread$e({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$g,\r\n      eventMap: eventMap$g,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: drawingManager\r\n    });\r\n    this.setState(function setDrawingManager() {\r\n      return {\r\n        drawingManager\r\n      };\r\n    }, this.setDrawingManagerCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.drawingManager !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$g,\r\n        eventMap: eventMap$g,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.drawingManager\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.drawingManager !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.drawingManager);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.drawingManager.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(DrawingManager, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$d(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$d(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$d(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$d(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$f = {\r\n  onAnimationChanged: 'animation_changed',\r\n  onClick: 'click',\r\n  onClickableChanged: 'clickable_changed',\r\n  onCursorChanged: 'cursor_changed',\r\n  onDblClick: 'dblclick',\r\n  onDrag: 'drag',\r\n  onDragEnd: 'dragend',\r\n  onDraggableChanged: 'draggable_changed',\r\n  onDragStart: 'dragstart',\r\n  onFlatChanged: 'flat_changed',\r\n  onIconChanged: 'icon_changed',\r\n  onMouseDown: 'mousedown',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onPositionChanged: 'position_changed',\r\n  onRightClick: 'rightclick',\r\n  onShapeChanged: 'shape_changed',\r\n  onTitleChanged: 'title_changed',\r\n  onVisibleChanged: 'visible_changed',\r\n  onZindexChanged: 'zindex_changed'\r\n};\r\nvar updaterMap$f = {\r\n  animation(instance, animation) {\r\n    instance.setAnimation(animation);\r\n  },\r\n  clickable(instance, clickable) {\r\n    instance.setClickable(clickable);\r\n  },\r\n  cursor(instance, cursor) {\r\n    instance.setCursor(cursor);\r\n  },\r\n  draggable(instance, draggable) {\r\n    instance.setDraggable(draggable);\r\n  },\r\n  icon(instance, icon) {\r\n    instance.setIcon(icon);\r\n  },\r\n  label(instance, label) {\r\n    instance.setLabel(label);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  opacity(instance, opacity) {\r\n    instance.setOpacity(opacity);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  position(instance, position) {\r\n    instance.setPosition(position);\r\n  },\r\n  shape(instance, shape) {\r\n    instance.setShape(shape);\r\n  },\r\n  title(instance, title) {\r\n    instance.setTitle(title);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  },\r\n  zIndex(instance, zIndex) {\r\n    instance.setZIndex(zIndex);\r\n  }\r\n};\r\nvar defaultOptions$5 = {};\r\nfunction MarkerFunctional(_ref) {\r\n  var {\r\n    position,\r\n    options,\r\n    clusterer,\r\n    noClustererRedraw,\r\n    children,\r\n    draggable,\r\n    visible,\r\n    animation,\r\n    clickable,\r\n    cursor,\r\n    icon,\r\n    label,\r\n    opacity,\r\n    shape,\r\n    title,\r\n    zIndex,\r\n    onClick,\r\n    onDblClick,\r\n    onDrag,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onMouseDown,\r\n    onRightClick,\r\n    onClickableChanged,\r\n    onCursorChanged,\r\n    onAnimationChanged,\r\n    onDraggableChanged,\r\n    onFlatChanged,\r\n    onIconChanged,\r\n    onPositionChanged,\r\n    onShapeChanged,\r\n    onTitleChanged,\r\n    onVisibleChanged,\r\n    onZindexChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickableChangedListener, setClickableChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [cursorChangedListener, setCursorChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [animationChangedListener, setAnimationChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [draggableChangedListener, setDraggableChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [flatChangedListener, setFlatChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [iconChangedListener, setIconChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [positionChangedListener, setPositionChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [shapeChangedListener, setShapeChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [titleChangedListener, setTitleChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [visibleChangedListener, setVisibleChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [zIndexChangedListener, setZindexChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof options !== 'undefined' && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof draggable !== 'undefined' && instance !== null) {\r\n      instance.setDraggable(draggable);\r\n    }\r\n  }, [instance, draggable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (position && instance !== null) {\r\n      instance.setPosition(position);\r\n    }\r\n  }, [instance, position]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && instance !== null) {\r\n      instance.setVisible(visible);\r\n    }\r\n  }, [instance, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    instance === null || instance === void 0 || instance.setAnimation(animation);\r\n  }, [instance, animation]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && clickable !== undefined) {\r\n      instance.setClickable(clickable);\r\n    }\r\n  }, [instance, clickable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && cursor !== undefined) {\r\n      instance.setCursor(cursor);\r\n    }\r\n  }, [instance, cursor]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && icon !== undefined) {\r\n      instance.setIcon(icon);\r\n    }\r\n  }, [instance, icon]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && label !== undefined) {\r\n      instance.setLabel(label);\r\n    }\r\n  }, [instance, label]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && opacity !== undefined) {\r\n      instance.setOpacity(opacity);\r\n    }\r\n  }, [instance, opacity]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && shape !== undefined) {\r\n      instance.setShape(shape);\r\n    }\r\n  }, [instance, shape]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && title !== undefined) {\r\n      instance.setTitle(title);\r\n    }\r\n  }, [instance, title]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && zIndex !== undefined) {\r\n      instance.setZIndex(zIndex);\r\n    }\r\n  }, [instance, zIndex]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragEnd) {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(instance, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragStart) {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(instance, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRightClick) {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDrag) {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(instance, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClickableChanged) {\r\n      if (clickableChangedListener !== null) {\r\n        google.maps.event.removeListener(clickableChangedListener);\r\n      }\r\n      setClickableChangedListener(google.maps.event.addListener(instance, 'clickable_changed', onClickableChanged));\r\n    }\r\n  }, [onClickableChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onCursorChanged) {\r\n      if (cursorChangedListener !== null) {\r\n        google.maps.event.removeListener(cursorChangedListener);\r\n      }\r\n      setCursorChangedListener(google.maps.event.addListener(instance, 'cursor_changed', onCursorChanged));\r\n    }\r\n  }, [onCursorChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onAnimationChanged) {\r\n      if (animationChangedListener !== null) {\r\n        google.maps.event.removeListener(animationChangedListener);\r\n      }\r\n      setAnimationChangedListener(google.maps.event.addListener(instance, 'animation_changed', onAnimationChanged));\r\n    }\r\n  }, [onAnimationChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDraggableChanged) {\r\n      if (draggableChangedListener !== null) {\r\n        google.maps.event.removeListener(draggableChangedListener);\r\n      }\r\n      setDraggableChangedListener(google.maps.event.addListener(instance, 'draggable_changed', onDraggableChanged));\r\n    }\r\n  }, [onDraggableChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onFlatChanged) {\r\n      if (flatChangedListener !== null) {\r\n        google.maps.event.removeListener(flatChangedListener);\r\n      }\r\n      setFlatChangedListener(google.maps.event.addListener(instance, 'flat_changed', onFlatChanged));\r\n    }\r\n  }, [onFlatChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onIconChanged) {\r\n      if (iconChangedListener !== null) {\r\n        google.maps.event.removeListener(iconChangedListener);\r\n      }\r\n      setIconChangedListener(google.maps.event.addListener(instance, 'icon_changed', onIconChanged));\r\n    }\r\n  }, [onIconChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onPositionChanged) {\r\n      if (positionChangedListener !== null) {\r\n        google.maps.event.removeListener(positionChangedListener);\r\n      }\r\n      setPositionChangedListener(google.maps.event.addListener(instance, 'position_changed', onPositionChanged));\r\n    }\r\n  }, [onPositionChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onShapeChanged) {\r\n      if (shapeChangedListener !== null) {\r\n        google.maps.event.removeListener(shapeChangedListener);\r\n      }\r\n      setShapeChangedListener(google.maps.event.addListener(instance, 'shape_changed', onShapeChanged));\r\n    }\r\n  }, [onShapeChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onTitleChanged) {\r\n      if (titleChangedListener !== null) {\r\n        google.maps.event.removeListener(titleChangedListener);\r\n      }\r\n      setTitleChangedListener(google.maps.event.addListener(instance, 'title_changed', onTitleChanged));\r\n    }\r\n  }, [onTitleChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onVisibleChanged) {\r\n      if (visibleChangedListener !== null) {\r\n        google.maps.event.removeListener(visibleChangedListener);\r\n      }\r\n      setVisibleChangedListener(google.maps.event.addListener(instance, 'visible_changed', onVisibleChanged));\r\n    }\r\n  }, [onVisibleChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onZindexChanged) {\r\n      if (zIndexChangedListener !== null) {\r\n        google.maps.event.removeListener(zIndexChangedListener);\r\n      }\r\n      setZindexChangedListener(google.maps.event.addListener(instance, 'zindex_changed', onZindexChanged));\r\n    }\r\n  }, [onZindexChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var markerOptions = _objectSpread$d(_objectSpread$d(_objectSpread$d({}, options || defaultOptions$5), clusterer ? defaultOptions$5 : {\r\n      map\r\n    }), {}, {\r\n      position\r\n    });\r\n    var marker = new google.maps.Marker(markerOptions);\r\n    if (clusterer) {\r\n      clusterer.addMarker(marker, !!noClustererRedraw);\r\n    } else {\r\n      marker.setMap(map);\r\n    }\r\n    if (position) {\r\n      marker.setPosition(position);\r\n    }\r\n    if (typeof visible !== 'undefined') {\r\n      marker.setVisible(visible);\r\n    }\r\n    if (typeof draggable !== 'undefined') {\r\n      marker.setDraggable(draggable);\r\n    }\r\n    if (typeof clickable !== 'undefined') {\r\n      marker.setClickable(clickable);\r\n    }\r\n    if (typeof cursor === 'string') {\r\n      marker.setCursor(cursor);\r\n    }\r\n    if (icon) {\r\n      marker.setIcon(icon);\r\n    }\r\n    if (typeof label !== 'undefined') {\r\n      marker.setLabel(label);\r\n    }\r\n    if (typeof opacity !== 'undefined') {\r\n      marker.setOpacity(opacity);\r\n    }\r\n    if (shape) {\r\n      marker.setShape(shape);\r\n    }\r\n    if (typeof title === 'string') {\r\n      marker.setTitle(title);\r\n    }\r\n    if (typeof zIndex === 'number') {\r\n      marker.setZIndex(zIndex);\r\n    }\r\n    if (onDblClick) {\r\n      setDblclickListener(google.maps.event.addListener(marker, 'dblclick', onDblClick));\r\n    }\r\n    if (onDragEnd) {\r\n      setDragendListener(google.maps.event.addListener(marker, 'dragend', onDragEnd));\r\n    }\r\n    if (onDragStart) {\r\n      setDragstartListener(google.maps.event.addListener(marker, 'dragstart', onDragStart));\r\n    }\r\n    if (onMouseDown) {\r\n      setMousedownListener(google.maps.event.addListener(marker, 'mousedown', onMouseDown));\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(marker, 'mouseout', onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(marker, 'mouseover', onMouseOver));\r\n    }\r\n    if (onMouseUp) {\r\n      setMouseupListener(google.maps.event.addListener(marker, 'mouseup', onMouseUp));\r\n    }\r\n    if (onRightClick) {\r\n      setRightclickListener(google.maps.event.addListener(marker, 'rightclick', onRightClick));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(marker, 'click', onClick));\r\n    }\r\n    if (onDrag) {\r\n      setDragListener(google.maps.event.addListener(marker, 'drag', onDrag));\r\n    }\r\n    if (onClickableChanged) {\r\n      setClickableChangedListener(google.maps.event.addListener(marker, 'clickable_changed', onClickableChanged));\r\n    }\r\n    if (onCursorChanged) {\r\n      setCursorChangedListener(google.maps.event.addListener(marker, 'cursor_changed', onCursorChanged));\r\n    }\r\n    if (onAnimationChanged) {\r\n      setAnimationChangedListener(google.maps.event.addListener(marker, 'animation_changed', onAnimationChanged));\r\n    }\r\n    if (onDraggableChanged) {\r\n      setDraggableChangedListener(google.maps.event.addListener(marker, 'draggable_changed', onDraggableChanged));\r\n    }\r\n    if (onFlatChanged) {\r\n      setFlatChangedListener(google.maps.event.addListener(marker, 'flat_changed', onFlatChanged));\r\n    }\r\n    if (onIconChanged) {\r\n      setIconChangedListener(google.maps.event.addListener(marker, 'icon_changed', onIconChanged));\r\n    }\r\n    if (onPositionChanged) {\r\n      setPositionChangedListener(google.maps.event.addListener(marker, 'position_changed', onPositionChanged));\r\n    }\r\n    if (onShapeChanged) {\r\n      setShapeChangedListener(google.maps.event.addListener(marker, 'shape_changed', onShapeChanged));\r\n    }\r\n    if (onTitleChanged) {\r\n      setTitleChangedListener(google.maps.event.addListener(marker, 'title_changed', onTitleChanged));\r\n    }\r\n    if (onVisibleChanged) {\r\n      setVisibleChangedListener(google.maps.event.addListener(marker, 'visible_changed', onVisibleChanged));\r\n    }\r\n    if (onZindexChanged) {\r\n      setZindexChangedListener(google.maps.event.addListener(marker, 'zindex_changed', onZindexChanged));\r\n    }\r\n    setInstance(marker);\r\n    if (onLoad) {\r\n      onLoad(marker);\r\n    }\r\n    return () => {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (clickableChangedListener !== null) {\r\n        google.maps.event.removeListener(clickableChangedListener);\r\n      }\r\n      if (cursorChangedListener !== null) {\r\n        google.maps.event.removeListener(cursorChangedListener);\r\n      }\r\n      if (animationChangedListener !== null) {\r\n        google.maps.event.removeListener(animationChangedListener);\r\n      }\r\n      if (draggableChangedListener !== null) {\r\n        google.maps.event.removeListener(draggableChangedListener);\r\n      }\r\n      if (flatChangedListener !== null) {\r\n        google.maps.event.removeListener(flatChangedListener);\r\n      }\r\n      if (iconChangedListener !== null) {\r\n        google.maps.event.removeListener(iconChangedListener);\r\n      }\r\n      if (positionChangedListener !== null) {\r\n        google.maps.event.removeListener(positionChangedListener);\r\n      }\r\n      if (titleChangedListener !== null) {\r\n        google.maps.event.removeListener(titleChangedListener);\r\n      }\r\n      if (visibleChangedListener !== null) {\r\n        google.maps.event.removeListener(visibleChangedListener);\r\n      }\r\n      if (zIndexChangedListener !== null) {\r\n        google.maps.event.removeListener(zIndexChangedListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(marker);\r\n      }\r\n      if (clusterer) {\r\n        clusterer.removeMarker(marker, !!noClustererRedraw);\r\n      } else if (marker) {\r\n        marker.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  var chx = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => {\r\n    return children ? react__WEBPACK_IMPORTED_MODULE_1__.Children.map(children, child => {\r\n      if (!(0,react__WEBPACK_IMPORTED_MODULE_1__.isValidElement)(child)) {\r\n        return child;\r\n      }\r\n      var elementChild = child;\r\n      return (0,react__WEBPACK_IMPORTED_MODULE_1__.cloneElement)(elementChild, {\r\n        anchor: instance\r\n      });\r\n    }) : null;\r\n  }, [children, instance]);\r\n  return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, {\r\n    children: chx\r\n  }) || null;\r\n}\r\nvar MarkerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(MarkerFunctional);\r\nclass Marker extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n  }\r\n  componentDidMount() {\r\n    var _this = this;\r\n    return _asyncToGenerator(function* () {\r\n      var markerOptions = _objectSpread$d(_objectSpread$d(_objectSpread$d({}, _this.props.options || defaultOptions$5), _this.props.clusterer ? defaultOptions$5 : {\r\n        map: _this.context\r\n      }), {}, {\r\n        position: _this.props.position\r\n      });\r\n      // Unfortunately we can't just do this in the contstructor, because the\r\n      // `MapContext` might not be filled in yet.\r\n      _this.marker = new google.maps.Marker(markerOptions);\r\n      if (_this.props.clusterer) {\r\n        _this.props.clusterer.addMarker(_this.marker, !!_this.props.noClustererRedraw);\r\n      } else {\r\n        _this.marker.setMap(_this.context);\r\n      }\r\n      _this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$f,\r\n        eventMap: eventMap$f,\r\n        prevProps: {},\r\n        nextProps: _this.props,\r\n        instance: _this.marker\r\n      });\r\n      if (_this.props.onLoad) {\r\n        _this.props.onLoad(_this.marker);\r\n      }\r\n    })();\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.marker) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$f,\r\n        eventMap: eventMap$f,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.marker\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (!this.marker) {\r\n      return;\r\n    }\r\n    if (this.props.onUnmount) {\r\n      this.props.onUnmount(this.marker);\r\n    }\r\n    unregisterEvents(this.registeredEvents);\r\n    if (this.props.clusterer) {\r\n      this.props.clusterer.removeMarker(this.marker, !!this.props.noClustererRedraw);\r\n    } else if (this.marker) {\r\n      this.marker.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    var children = this.props.children ? react__WEBPACK_IMPORTED_MODULE_1__.Children.map(this.props.children, child => {\r\n      if (!(0,react__WEBPACK_IMPORTED_MODULE_1__.isValidElement)(child)) {\r\n        return child;\r\n      }\r\n      var elementChild = child;\r\n      return (0,react__WEBPACK_IMPORTED_MODULE_1__.cloneElement)(elementChild, {\r\n        anchor: this.marker\r\n      });\r\n    }) : null;\r\n    return children || null;\r\n  }\r\n}\r\n_defineProperty(Marker, \"contextType\", MapContext);\r\n\r\nvar ClusterIcon = /** @class */function () {\r\n  function ClusterIcon(cluster, styles) {\r\n    cluster.getClusterer().extend(ClusterIcon, google.maps.OverlayView);\r\n    this.cluster = cluster;\r\n    this.clusterClassName = this.cluster.getClusterer().getClusterClass();\r\n    this.className = this.clusterClassName;\r\n    this.styles = styles;\r\n    this.center = undefined;\r\n    this.div = null;\r\n    this.sums = null;\r\n    this.visible = false;\r\n    this.boundsChangedListener = null;\r\n    this.url = '';\r\n    this.height = 0;\r\n    this.width = 0;\r\n    this.anchorText = [0, 0];\r\n    this.anchorIcon = [0, 0];\r\n    this.textColor = 'black';\r\n    this.textSize = 11;\r\n    this.textDecoration = 'none';\r\n    this.fontWeight = 'bold';\r\n    this.fontStyle = 'normal';\r\n    this.fontFamily = 'Arial,sans-serif';\r\n    this.backgroundPosition = '0 0';\r\n    this.cMouseDownInCluster = null;\r\n    this.cDraggingMapByCluster = null;\r\n    this.timeOut = null;\r\n    this.setMap(cluster.getMap()); // Note: this causes onAdd to be called\r\n    this.onBoundsChanged = this.onBoundsChanged.bind(this);\r\n    this.onMouseDown = this.onMouseDown.bind(this);\r\n    this.onClick = this.onClick.bind(this);\r\n    this.onMouseOver = this.onMouseOver.bind(this);\r\n    this.onMouseOut = this.onMouseOut.bind(this);\r\n    this.onAdd = this.onAdd.bind(this);\r\n    this.onRemove = this.onRemove.bind(this);\r\n    this.draw = this.draw.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.useStyle = this.useStyle.bind(this);\r\n    this.setCenter = this.setCenter.bind(this);\r\n    this.getPosFromLatLng = this.getPosFromLatLng.bind(this);\r\n  }\r\n  ClusterIcon.prototype.onBoundsChanged = function () {\r\n    this.cDraggingMapByCluster = this.cMouseDownInCluster;\r\n  };\r\n  ClusterIcon.prototype.onMouseDown = function () {\r\n    this.cMouseDownInCluster = true;\r\n    this.cDraggingMapByCluster = false;\r\n  };\r\n  ClusterIcon.prototype.onClick = function (event) {\r\n    this.cMouseDownInCluster = false;\r\n    if (!this.cDraggingMapByCluster) {\r\n      var markerClusterer_1 = this.cluster.getClusterer();\r\n      /**\r\n       * This event is fired when a cluster marker is clicked.\r\n       * @name MarkerClusterer#click\r\n       * @param {Cluster} c The cluster that was clicked.\r\n       * @event\r\n       */\r\n      google.maps.event.trigger(markerClusterer_1, 'click', this.cluster);\r\n      google.maps.event.trigger(markerClusterer_1, 'clusterclick', this.cluster); // deprecated name\r\n      // The default click handler follows. Disable it by setting\r\n      // the zoomOnClick property to false.\r\n      if (markerClusterer_1.getZoomOnClick()) {\r\n        // Zoom into the cluster.\r\n        var maxZoom_1 = markerClusterer_1.getMaxZoom();\r\n        var bounds_1 = this.cluster.getBounds();\r\n        var map = markerClusterer_1.getMap();\r\n        if (map !== null && 'fitBounds' in map) {\r\n          map.fitBounds(bounds_1);\r\n        }\r\n        // There is a fix for Issue 170 here:\r\n        this.timeOut = window.setTimeout(function () {\r\n          var map = markerClusterer_1.getMap();\r\n          if (map !== null) {\r\n            if ('fitBounds' in map) {\r\n              map.fitBounds(bounds_1);\r\n            }\r\n            var zoom = map.getZoom() || 0;\r\n            // Don't zoom beyond the max zoom level\r\n            if (maxZoom_1 !== null && zoom > maxZoom_1) {\r\n              map.setZoom(maxZoom_1 + 1);\r\n            }\r\n          }\r\n        }, 100);\r\n      }\r\n      // Prevent event propagation to the map:\r\n      event.cancelBubble = true;\r\n      if (event.stopPropagation) {\r\n        event.stopPropagation();\r\n      }\r\n    }\r\n  };\r\n  ClusterIcon.prototype.onMouseOver = function () {\r\n    /**\r\n     * This event is fired when the mouse moves over a cluster marker.\r\n     * @name MarkerClusterer#mouseover\r\n     * @param {Cluster} c The cluster that the mouse moved over.\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this.cluster.getClusterer(), 'mouseover', this.cluster);\r\n  };\r\n  ClusterIcon.prototype.onMouseOut = function () {\r\n    /**\r\n     * This event is fired when the mouse moves out of a cluster marker.\r\n     * @name MarkerClusterer#mouseout\r\n     * @param {Cluster} c The cluster that the mouse moved out of.\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this.cluster.getClusterer(), 'mouseout', this.cluster);\r\n  };\r\n  ClusterIcon.prototype.onAdd = function () {\r\n    var _a;\r\n    this.div = document.createElement('div');\r\n    this.div.className = this.className;\r\n    if (this.visible) {\r\n      this.show();\r\n    }\r\n    (_a = this.getPanes()) === null || _a === void 0 ? void 0 : _a.overlayMouseTarget.appendChild(this.div);\r\n    var map = this.getMap();\r\n    if (map !== null) {\r\n      // Fix for Issue 157\r\n      this.boundsChangedListener = google.maps.event.addListener(map, 'bounds_changed', this.onBoundsChanged);\r\n      this.div.addEventListener('mousedown', this.onMouseDown);\r\n      this.div.addEventListener('click', this.onClick);\r\n      this.div.addEventListener('mouseover', this.onMouseOver);\r\n      this.div.addEventListener('mouseout', this.onMouseOut);\r\n    }\r\n  };\r\n  ClusterIcon.prototype.onRemove = function () {\r\n    if (this.div && this.div.parentNode) {\r\n      this.hide();\r\n      if (this.boundsChangedListener !== null) {\r\n        google.maps.event.removeListener(this.boundsChangedListener);\r\n      }\r\n      this.div.removeEventListener('mousedown', this.onMouseDown);\r\n      this.div.removeEventListener('click', this.onClick);\r\n      this.div.removeEventListener('mouseover', this.onMouseOver);\r\n      this.div.removeEventListener('mouseout', this.onMouseOut);\r\n      this.div.parentNode.removeChild(this.div);\r\n      if (this.timeOut !== null) {\r\n        window.clearTimeout(this.timeOut);\r\n        this.timeOut = null;\r\n      }\r\n      this.div = null;\r\n    }\r\n  };\r\n  ClusterIcon.prototype.draw = function () {\r\n    if (this.visible && this.div !== null && this.center) {\r\n      var pos = this.getPosFromLatLng(this.center);\r\n      this.div.style.top = pos !== null ? \"\".concat(pos.y, \"px\") : '0';\r\n      this.div.style.left = pos !== null ? \"\".concat(pos.x, \"px\") : '0';\r\n    }\r\n  };\r\n  ClusterIcon.prototype.hide = function () {\r\n    if (this.div) {\r\n      this.div.style.display = 'none';\r\n    }\r\n    this.visible = false;\r\n  };\r\n  ClusterIcon.prototype.show = function () {\r\n    var _a, _b, _c, _d, _e, _f;\r\n    if (this.div && this.center) {\r\n      var divTitle = this.sums === null || typeof this.sums.title === 'undefined' || this.sums.title === '' ? this.cluster.getClusterer().getTitle() : this.sums.title;\r\n      // NOTE: values must be specified in px units\r\n      var bp = this.backgroundPosition.split(' ');\r\n      var spriteH = parseInt(((_a = bp[0]) === null || _a === void 0 ? void 0 : _a.replace(/^\\s+|\\s+$/g, '')) || '0', 10);\r\n      var spriteV = parseInt(((_b = bp[1]) === null || _b === void 0 ? void 0 : _b.replace(/^\\s+|\\s+$/g, '')) || '0', 10);\r\n      var pos = this.getPosFromLatLng(this.center);\r\n      this.div.className = this.className;\r\n      this.div.setAttribute('style', \"cursor: pointer; position: absolute; top: \".concat(pos !== null ? \"\".concat(pos.y, \"px\") : '0', \"; left: \").concat(pos !== null ? \"\".concat(pos.x, \"px\") : '0', \"; width: \").concat(this.width, \"px; height: \").concat(this.height, \"px; \"));\r\n      var img = document.createElement('img');\r\n      img.alt = divTitle;\r\n      img.src = this.url;\r\n      img.width = this.width;\r\n      img.height = this.height;\r\n      img.setAttribute('style', \"position: absolute; top: \".concat(spriteV, \"px; left: \").concat(spriteH, \"px\"));\r\n      if (!this.cluster.getClusterer().enableRetinaIcons) {\r\n        img.style.clip = \"rect(-\".concat(spriteV, \"px, -\").concat(spriteH + this.width, \"px, -\").concat(spriteV + this.height, \", -\").concat(spriteH, \")\");\r\n      }\r\n      var textElm = document.createElement('div');\r\n      textElm.setAttribute('style', \"position: absolute; top: \".concat(this.anchorText[0], \"px; left: \").concat(this.anchorText[1], \"px; color: \").concat(this.textColor, \"; font-size: \").concat(this.textSize, \"px; font-family: \").concat(this.fontFamily, \"; font-weight: \").concat(this.fontWeight, \"; fontStyle: \").concat(this.fontStyle, \"; text-decoration: \").concat(this.textDecoration, \"; text-align: center; width: \").concat(this.width, \"px; line-height: \").concat(this.height, \"px\"));\r\n      if ((_c = this.sums) === null || _c === void 0 ? void 0 : _c.text) textElm.innerText = \"\".concat((_d = this.sums) === null || _d === void 0 ? void 0 : _d.text);\r\n      if ((_e = this.sums) === null || _e === void 0 ? void 0 : _e.html) textElm.innerHTML = \"\".concat((_f = this.sums) === null || _f === void 0 ? void 0 : _f.html);\r\n      this.div.innerHTML = '';\r\n      this.div.appendChild(img);\r\n      this.div.appendChild(textElm);\r\n      this.div.title = divTitle;\r\n      this.div.style.display = '';\r\n    }\r\n    this.visible = true;\r\n  };\r\n  ClusterIcon.prototype.useStyle = function (sums) {\r\n    this.sums = sums;\r\n    var styles = this.cluster.getClusterer().getStyles();\r\n    var style = styles[Math.min(styles.length - 1, Math.max(0, sums.index - 1))];\r\n    if (style) {\r\n      this.url = style.url;\r\n      this.height = style.height;\r\n      this.width = style.width;\r\n      if (style.className) {\r\n        this.className = \"\".concat(this.clusterClassName, \" \").concat(style.className);\r\n      }\r\n      this.anchorText = style.anchorText || [0, 0];\r\n      this.anchorIcon = style.anchorIcon || [this.height / 2, this.width / 2];\r\n      this.textColor = style.textColor || 'black';\r\n      this.textSize = style.textSize || 11;\r\n      this.textDecoration = style.textDecoration || 'none';\r\n      this.fontWeight = style.fontWeight || 'bold';\r\n      this.fontStyle = style.fontStyle || 'normal';\r\n      this.fontFamily = style.fontFamily || 'Arial,sans-serif';\r\n      this.backgroundPosition = style.backgroundPosition || '0 0';\r\n    }\r\n  };\r\n  ClusterIcon.prototype.setCenter = function (center) {\r\n    this.center = center;\r\n  };\r\n  ClusterIcon.prototype.getPosFromLatLng = function (latlng) {\r\n    var pos = this.getProjection().fromLatLngToDivPixel(latlng);\r\n    if (pos !== null) {\r\n      pos.x -= this.anchorIcon[1];\r\n      pos.y -= this.anchorIcon[0];\r\n    }\r\n    return pos;\r\n  };\r\n  return ClusterIcon;\r\n}();\r\n\r\n/* global google */\r\nvar Cluster$1 = /** @class */function () {\r\n  function Cluster(markerClusterer) {\r\n    this.markerClusterer = markerClusterer;\r\n    this.map = this.markerClusterer.getMap();\r\n    this.gridSize = this.markerClusterer.getGridSize();\r\n    this.minClusterSize = this.markerClusterer.getMinimumClusterSize();\r\n    this.averageCenter = this.markerClusterer.getAverageCenter();\r\n    this.markers = [];\r\n    this.center = undefined;\r\n    this.bounds = null;\r\n    this.clusterIcon = new ClusterIcon(this, this.markerClusterer.getStyles());\r\n    this.getSize = this.getSize.bind(this);\r\n    this.getMarkers = this.getMarkers.bind(this);\r\n    this.getCenter = this.getCenter.bind(this);\r\n    this.getMap = this.getMap.bind(this);\r\n    this.getClusterer = this.getClusterer.bind(this);\r\n    this.getBounds = this.getBounds.bind(this);\r\n    this.remove = this.remove.bind(this);\r\n    this.addMarker = this.addMarker.bind(this);\r\n    this.isMarkerInClusterBounds = this.isMarkerInClusterBounds.bind(this);\r\n    this.calculateBounds = this.calculateBounds.bind(this);\r\n    this.updateIcon = this.updateIcon.bind(this);\r\n    this.isMarkerAlreadyAdded = this.isMarkerAlreadyAdded.bind(this);\r\n  }\r\n  Cluster.prototype.getSize = function () {\r\n    return this.markers.length;\r\n  };\r\n  Cluster.prototype.getMarkers = function () {\r\n    return this.markers;\r\n  };\r\n  Cluster.prototype.getCenter = function () {\r\n    return this.center;\r\n  };\r\n  Cluster.prototype.getMap = function () {\r\n    return this.map;\r\n  };\r\n  Cluster.prototype.getClusterer = function () {\r\n    return this.markerClusterer;\r\n  };\r\n  Cluster.prototype.getBounds = function () {\r\n    var bounds = new google.maps.LatLngBounds(this.center, this.center);\r\n    var markers = this.getMarkers();\r\n    for (var _i = 0, markers_1 = markers; _i < markers_1.length; _i++) {\r\n      var marker = markers_1[_i];\r\n      var position = marker.getPosition();\r\n      if (position) {\r\n        bounds.extend(position);\r\n      }\r\n    }\r\n    return bounds;\r\n  };\r\n  Cluster.prototype.remove = function () {\r\n    this.clusterIcon.setMap(null);\r\n    this.markers = [];\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    delete this.markers;\r\n  };\r\n  Cluster.prototype.addMarker = function (marker) {\r\n    var _a;\r\n    if (this.isMarkerAlreadyAdded(marker)) {\r\n      return false;\r\n    }\r\n    if (!this.center) {\r\n      var position = marker.getPosition();\r\n      if (position) {\r\n        this.center = position;\r\n        this.calculateBounds();\r\n      }\r\n    } else {\r\n      if (this.averageCenter) {\r\n        var position = marker.getPosition();\r\n        if (position) {\r\n          var length_1 = this.markers.length + 1;\r\n          this.center = new google.maps.LatLng((this.center.lat() * (length_1 - 1) + position.lat()) / length_1, (this.center.lng() * (length_1 - 1) + position.lng()) / length_1);\r\n          this.calculateBounds();\r\n        }\r\n      }\r\n    }\r\n    marker.isAdded = true;\r\n    this.markers.push(marker);\r\n    var mCount = this.markers.length;\r\n    var maxZoom = this.markerClusterer.getMaxZoom();\r\n    var zoom = (_a = this.map) === null || _a === void 0 ? void 0 : _a.getZoom();\r\n    if (maxZoom !== null && typeof zoom !== 'undefined' && zoom > maxZoom) {\r\n      // Zoomed in past max zoom, so show the marker.\r\n      if (marker.getMap() !== this.map) {\r\n        marker.setMap(this.map);\r\n      }\r\n    } else if (mCount < this.minClusterSize) {\r\n      // Min cluster size not reached so show the marker.\r\n      if (marker.getMap() !== this.map) {\r\n        marker.setMap(this.map);\r\n      }\r\n    } else if (mCount === this.minClusterSize) {\r\n      // Hide the markers that were showing.\r\n      for (var _i = 0, _b = this.markers; _i < _b.length; _i++) {\r\n        var markerElement = _b[_i];\r\n        markerElement.setMap(null);\r\n      }\r\n    } else {\r\n      marker.setMap(null);\r\n    }\r\n    return true;\r\n  };\r\n  Cluster.prototype.isMarkerInClusterBounds = function (marker) {\r\n    if (this.bounds !== null) {\r\n      var position = marker.getPosition();\r\n      if (position) {\r\n        return this.bounds.contains(position);\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n  Cluster.prototype.calculateBounds = function () {\r\n    this.bounds = this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center, this.center));\r\n  };\r\n  Cluster.prototype.updateIcon = function () {\r\n    var _a;\r\n    var mCount = this.markers.length;\r\n    var maxZoom = this.markerClusterer.getMaxZoom();\r\n    var zoom = (_a = this.map) === null || _a === void 0 ? void 0 : _a.getZoom();\r\n    if (maxZoom !== null && typeof zoom !== 'undefined' && zoom > maxZoom) {\r\n      this.clusterIcon.hide();\r\n      return;\r\n    }\r\n    if (mCount < this.minClusterSize) {\r\n      // Min cluster size not yet reached.\r\n      this.clusterIcon.hide();\r\n      return;\r\n    }\r\n    if (this.center) {\r\n      this.clusterIcon.setCenter(this.center);\r\n    }\r\n    this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers, this.markerClusterer.getStyles().length));\r\n    this.clusterIcon.show();\r\n  };\r\n  Cluster.prototype.isMarkerAlreadyAdded = function (marker) {\r\n    if (this.markers.includes) {\r\n      return this.markers.includes(marker);\r\n    }\r\n    for (var i = 0; i < this.markers.length; i++) {\r\n      if (marker === this.markers[i]) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n  return Cluster;\r\n}();\r\n\r\n/* global google */\r\n/* eslint-disable filenames/match-regex */\r\n/**\r\n * Supports up to 9007199254740991 (Number.MAX_SAFE_INTEGER) markers\r\n * which is not a problem as max array length is 4294967296 (2**32)\r\n */\r\nfunction CALCULATOR(markers, numStyles) {\r\n  var count = markers.length;\r\n  var numberOfDigits = count.toString().length;\r\n  var index = Math.min(numberOfDigits, numStyles);\r\n  return {\r\n    text: count.toString(),\r\n    index: index,\r\n    title: ''\r\n  };\r\n}\r\nvar BATCH_SIZE = 2000;\r\nvar BATCH_SIZE_IE = 500;\r\nvar IMAGE_PATH = 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m';\r\nvar IMAGE_EXTENSION = 'png';\r\nvar IMAGE_SIZES = [53, 56, 66, 78, 90];\r\nvar CLUSTERER_CLASS = 'cluster';\r\nvar Clusterer = /** @class */function () {\r\n  function Clusterer(map, optMarkers, optOptions) {\r\n    if (optMarkers === void 0) {\r\n      optMarkers = [];\r\n    }\r\n    if (optOptions === void 0) {\r\n      optOptions = {};\r\n    }\r\n    this.getMinimumClusterSize = this.getMinimumClusterSize.bind(this);\r\n    this.setMinimumClusterSize = this.setMinimumClusterSize.bind(this);\r\n    this.getEnableRetinaIcons = this.getEnableRetinaIcons.bind(this);\r\n    this.setEnableRetinaIcons = this.setEnableRetinaIcons.bind(this);\r\n    this.addToClosestCluster = this.addToClosestCluster.bind(this);\r\n    this.getImageExtension = this.getImageExtension.bind(this);\r\n    this.setImageExtension = this.setImageExtension.bind(this);\r\n    this.getExtendedBounds = this.getExtendedBounds.bind(this);\r\n    this.getAverageCenter = this.getAverageCenter.bind(this);\r\n    this.setAverageCenter = this.setAverageCenter.bind(this);\r\n    this.getTotalClusters = this.getTotalClusters.bind(this);\r\n    this.fitMapToMarkers = this.fitMapToMarkers.bind(this);\r\n    this.getIgnoreHidden = this.getIgnoreHidden.bind(this);\r\n    this.setIgnoreHidden = this.setIgnoreHidden.bind(this);\r\n    this.getClusterClass = this.getClusterClass.bind(this);\r\n    this.setClusterClass = this.setClusterClass.bind(this);\r\n    this.getTotalMarkers = this.getTotalMarkers.bind(this);\r\n    this.getZoomOnClick = this.getZoomOnClick.bind(this);\r\n    this.setZoomOnClick = this.setZoomOnClick.bind(this);\r\n    this.getBatchSizeIE = this.getBatchSizeIE.bind(this);\r\n    this.setBatchSizeIE = this.setBatchSizeIE.bind(this);\r\n    this.createClusters = this.createClusters.bind(this);\r\n    this.onZoomChanged = this.onZoomChanged.bind(this);\r\n    this.getImageSizes = this.getImageSizes.bind(this);\r\n    this.setImageSizes = this.setImageSizes.bind(this);\r\n    this.getCalculator = this.getCalculator.bind(this);\r\n    this.setCalculator = this.setCalculator.bind(this);\r\n    this.removeMarkers = this.removeMarkers.bind(this);\r\n    this.resetViewport = this.resetViewport.bind(this);\r\n    this.getImagePath = this.getImagePath.bind(this);\r\n    this.setImagePath = this.setImagePath.bind(this);\r\n    this.pushMarkerTo = this.pushMarkerTo.bind(this);\r\n    this.removeMarker = this.removeMarker.bind(this);\r\n    this.clearMarkers = this.clearMarkers.bind(this);\r\n    this.setupStyles = this.setupStyles.bind(this);\r\n    this.getGridSize = this.getGridSize.bind(this);\r\n    this.setGridSize = this.setGridSize.bind(this);\r\n    this.getClusters = this.getClusters.bind(this);\r\n    this.getMaxZoom = this.getMaxZoom.bind(this);\r\n    this.setMaxZoom = this.setMaxZoom.bind(this);\r\n    this.getMarkers = this.getMarkers.bind(this);\r\n    this.addMarkers = this.addMarkers.bind(this);\r\n    this.getStyles = this.getStyles.bind(this);\r\n    this.setStyles = this.setStyles.bind(this);\r\n    this.addMarker = this.addMarker.bind(this);\r\n    this.onRemove = this.onRemove.bind(this);\r\n    this.getTitle = this.getTitle.bind(this);\r\n    this.setTitle = this.setTitle.bind(this);\r\n    this.repaint = this.repaint.bind(this);\r\n    this.onIdle = this.onIdle.bind(this);\r\n    this.redraw = this.redraw.bind(this);\r\n    this.onAdd = this.onAdd.bind(this);\r\n    this.draw = this.draw.bind(this);\r\n    this.extend = this.extend.bind(this);\r\n    this.extend(Clusterer, google.maps.OverlayView);\r\n    this.markers = [];\r\n    this.clusters = [];\r\n    this.listeners = [];\r\n    this.activeMap = null;\r\n    this.ready = false;\r\n    this.gridSize = optOptions.gridSize || 60;\r\n    this.minClusterSize = optOptions.minimumClusterSize || 2;\r\n    this.maxZoom = optOptions.maxZoom || null;\r\n    this.styles = optOptions.styles || [];\r\n    this.title = optOptions.title || '';\r\n    this.zoomOnClick = true;\r\n    if (optOptions.zoomOnClick !== undefined) {\r\n      this.zoomOnClick = optOptions.zoomOnClick;\r\n    }\r\n    this.averageCenter = false;\r\n    if (optOptions.averageCenter !== undefined) {\r\n      this.averageCenter = optOptions.averageCenter;\r\n    }\r\n    this.ignoreHidden = false;\r\n    if (optOptions.ignoreHidden !== undefined) {\r\n      this.ignoreHidden = optOptions.ignoreHidden;\r\n    }\r\n    this.enableRetinaIcons = false;\r\n    if (optOptions.enableRetinaIcons !== undefined) {\r\n      this.enableRetinaIcons = optOptions.enableRetinaIcons;\r\n    }\r\n    this.imagePath = optOptions.imagePath || IMAGE_PATH;\r\n    this.imageExtension = optOptions.imageExtension || IMAGE_EXTENSION;\r\n    this.imageSizes = optOptions.imageSizes || IMAGE_SIZES;\r\n    this.calculator = optOptions.calculator || CALCULATOR;\r\n    this.batchSize = optOptions.batchSize || BATCH_SIZE;\r\n    this.batchSizeIE = optOptions.batchSizeIE || BATCH_SIZE_IE;\r\n    this.clusterClass = optOptions.clusterClass || CLUSTERER_CLASS;\r\n    if (navigator.userAgent.toLowerCase().indexOf('msie') !== -1) {\r\n      // Try to avoid IE timeout when processing a huge number of markers:\r\n      this.batchSize = this.batchSizeIE;\r\n    }\r\n    this.timerRefStatic = null;\r\n    this.setupStyles();\r\n    this.addMarkers(optMarkers, true);\r\n    this.setMap(map); // Note: this causes onAdd to be called\r\n  }\r\n  Clusterer.prototype.onZoomChanged = function () {\r\n    var _a, _b;\r\n    this.resetViewport(false);\r\n    // Workaround for this Google bug: when map is at level 0 and \"-\" of\r\n    // zoom slider is clicked, a \"zoom_changed\" event is fired even though\r\n    // the map doesn't zoom out any further. In this situation, no \"idle\"\r\n    // event is triggered so the cluster markers that have been removed\r\n    // do not get redrawn. Same goes for a zoom in at maxZoom.\r\n    if (((_a = this.getMap()) === null || _a === void 0 ? void 0 : _a.getZoom()) === (this.get('minZoom') || 0) || ((_b = this.getMap()) === null || _b === void 0 ? void 0 : _b.getZoom()) === this.get('maxZoom')) {\r\n      google.maps.event.trigger(this, 'idle');\r\n    }\r\n  };\r\n  Clusterer.prototype.onIdle = function () {\r\n    this.redraw();\r\n  };\r\n  Clusterer.prototype.onAdd = function () {\r\n    var map = this.getMap();\r\n    this.activeMap = map;\r\n    this.ready = true;\r\n    this.repaint();\r\n    if (map !== null) {\r\n      // Add the map event listeners\r\n      this.listeners = [google.maps.event.addListener(map, 'zoom_changed', this.onZoomChanged), google.maps.event.addListener(map, 'idle', this.onIdle)];\r\n    }\r\n  };\r\n  Clusterer.prototype.onRemove = function () {\r\n    // Put all the managed markers back on the map:\r\n    for (var _i = 0, _a = this.markers; _i < _a.length; _i++) {\r\n      var marker = _a[_i];\r\n      if (marker.getMap() !== this.activeMap) {\r\n        marker.setMap(this.activeMap);\r\n      }\r\n    }\r\n    // Remove all clusters:\r\n    for (var _b = 0, _c = this.clusters; _b < _c.length; _b++) {\r\n      var cluster = _c[_b];\r\n      cluster.remove();\r\n    }\r\n    this.clusters = [];\r\n    // Remove map event listeners:\r\n    for (var _d = 0, _e = this.listeners; _d < _e.length; _d++) {\r\n      var listener = _e[_d];\r\n      google.maps.event.removeListener(listener);\r\n    }\r\n    this.listeners = [];\r\n    this.activeMap = null;\r\n    this.ready = false;\r\n  };\r\n  Clusterer.prototype.draw = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.getMap = function () {\r\n    return null;\r\n  };\r\n  Clusterer.prototype.getPanes = function () {\r\n    return null;\r\n  };\r\n  Clusterer.prototype.getProjection = function () {\r\n    return {\r\n      fromContainerPixelToLatLng: function fromContainerPixelToLatLng() {\r\n        return null;\r\n      },\r\n      fromDivPixelToLatLng: function fromDivPixelToLatLng() {\r\n        return null;\r\n      },\r\n      fromLatLngToContainerPixel: function fromLatLngToContainerPixel() {\r\n        return null;\r\n      },\r\n      fromLatLngToDivPixel: function fromLatLngToDivPixel() {\r\n        return null;\r\n      },\r\n      getVisibleRegion: function getVisibleRegion() {\r\n        return null;\r\n      },\r\n      getWorldWidth: function getWorldWidth() {\r\n        return 0;\r\n      }\r\n    };\r\n  };\r\n  Clusterer.prototype.setMap = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.addListener = function () {\r\n    return {\r\n      remove: function remove() {\r\n        return;\r\n      }\r\n    };\r\n  };\r\n  Clusterer.prototype.bindTo = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.get = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.notify = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.set = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.setValues = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.unbind = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.unbindAll = function () {\r\n    return;\r\n  };\r\n  Clusterer.prototype.setupStyles = function () {\r\n    if (this.styles.length > 0) {\r\n      return;\r\n    }\r\n    for (var i = 0; i < this.imageSizes.length; i++) {\r\n      this.styles.push({\r\n        url: \"\".concat(this.imagePath + (i + 1), \".\").concat(this.imageExtension),\r\n        height: this.imageSizes[i] || 0,\r\n        width: this.imageSizes[i] || 0\r\n      });\r\n    }\r\n  };\r\n  Clusterer.prototype.fitMapToMarkers = function () {\r\n    var markers = this.getMarkers();\r\n    var bounds = new google.maps.LatLngBounds();\r\n    for (var _i = 0, markers_1 = markers; _i < markers_1.length; _i++) {\r\n      var marker = markers_1[_i];\r\n      var position = marker.getPosition();\r\n      if (position) {\r\n        bounds.extend(position);\r\n      }\r\n    }\r\n    var map = this.getMap();\r\n    if (map !== null && 'fitBounds' in map) {\r\n      map.fitBounds(bounds);\r\n    }\r\n  };\r\n  Clusterer.prototype.getGridSize = function () {\r\n    return this.gridSize;\r\n  };\r\n  Clusterer.prototype.setGridSize = function (gridSize) {\r\n    this.gridSize = gridSize;\r\n  };\r\n  Clusterer.prototype.getMinimumClusterSize = function () {\r\n    return this.minClusterSize;\r\n  };\r\n  Clusterer.prototype.setMinimumClusterSize = function (minimumClusterSize) {\r\n    this.minClusterSize = minimumClusterSize;\r\n  };\r\n  Clusterer.prototype.getMaxZoom = function () {\r\n    return this.maxZoom;\r\n  };\r\n  Clusterer.prototype.setMaxZoom = function (maxZoom) {\r\n    this.maxZoom = maxZoom;\r\n  };\r\n  Clusterer.prototype.getStyles = function () {\r\n    return this.styles;\r\n  };\r\n  Clusterer.prototype.setStyles = function (styles) {\r\n    this.styles = styles;\r\n  };\r\n  Clusterer.prototype.getTitle = function () {\r\n    return this.title;\r\n  };\r\n  Clusterer.prototype.setTitle = function (title) {\r\n    this.title = title;\r\n  };\r\n  Clusterer.prototype.getZoomOnClick = function () {\r\n    return this.zoomOnClick;\r\n  };\r\n  Clusterer.prototype.setZoomOnClick = function (zoomOnClick) {\r\n    this.zoomOnClick = zoomOnClick;\r\n  };\r\n  Clusterer.prototype.getAverageCenter = function () {\r\n    return this.averageCenter;\r\n  };\r\n  Clusterer.prototype.setAverageCenter = function (averageCenter) {\r\n    this.averageCenter = averageCenter;\r\n  };\r\n  Clusterer.prototype.getIgnoreHidden = function () {\r\n    return this.ignoreHidden;\r\n  };\r\n  Clusterer.prototype.setIgnoreHidden = function (ignoreHidden) {\r\n    this.ignoreHidden = ignoreHidden;\r\n  };\r\n  Clusterer.prototype.getEnableRetinaIcons = function () {\r\n    return this.enableRetinaIcons;\r\n  };\r\n  Clusterer.prototype.setEnableRetinaIcons = function (enableRetinaIcons) {\r\n    this.enableRetinaIcons = enableRetinaIcons;\r\n  };\r\n  Clusterer.prototype.getImageExtension = function () {\r\n    return this.imageExtension;\r\n  };\r\n  Clusterer.prototype.setImageExtension = function (imageExtension) {\r\n    this.imageExtension = imageExtension;\r\n  };\r\n  Clusterer.prototype.getImagePath = function () {\r\n    return this.imagePath;\r\n  };\r\n  Clusterer.prototype.setImagePath = function (imagePath) {\r\n    this.imagePath = imagePath;\r\n  };\r\n  Clusterer.prototype.getImageSizes = function () {\r\n    return this.imageSizes;\r\n  };\r\n  Clusterer.prototype.setImageSizes = function (imageSizes) {\r\n    this.imageSizes = imageSizes;\r\n  };\r\n  Clusterer.prototype.getCalculator = function () {\r\n    return this.calculator;\r\n  };\r\n  Clusterer.prototype.setCalculator = function (calculator) {\r\n    this.calculator = calculator;\r\n  };\r\n  Clusterer.prototype.getBatchSizeIE = function () {\r\n    return this.batchSizeIE;\r\n  };\r\n  Clusterer.prototype.setBatchSizeIE = function (batchSizeIE) {\r\n    this.batchSizeIE = batchSizeIE;\r\n  };\r\n  Clusterer.prototype.getClusterClass = function () {\r\n    return this.clusterClass;\r\n  };\r\n  Clusterer.prototype.setClusterClass = function (clusterClass) {\r\n    this.clusterClass = clusterClass;\r\n  };\r\n  Clusterer.prototype.getMarkers = function () {\r\n    return this.markers;\r\n  };\r\n  Clusterer.prototype.getTotalMarkers = function () {\r\n    return this.markers.length;\r\n  };\r\n  Clusterer.prototype.getClusters = function () {\r\n    return this.clusters;\r\n  };\r\n  Clusterer.prototype.getTotalClusters = function () {\r\n    return this.clusters.length;\r\n  };\r\n  Clusterer.prototype.addMarker = function (marker, optNoDraw) {\r\n    this.pushMarkerTo(marker);\r\n    if (!optNoDraw) {\r\n      this.redraw();\r\n    }\r\n  };\r\n  Clusterer.prototype.addMarkers = function (markers, optNoDraw) {\r\n    for (var key in markers) {\r\n      if (Object.prototype.hasOwnProperty.call(markers, key)) {\r\n        var marker = markers[key];\r\n        if (marker) {\r\n          this.pushMarkerTo(marker);\r\n        }\r\n      }\r\n    }\r\n    if (!optNoDraw) {\r\n      this.redraw();\r\n    }\r\n  };\r\n  Clusterer.prototype.pushMarkerTo = function (marker) {\r\n    var _this = this;\r\n    // If the marker is draggable add a listener so we can update the clusters on the dragend:\r\n    if (marker.getDraggable()) {\r\n      google.maps.event.addListener(marker, 'dragend', function () {\r\n        if (_this.ready) {\r\n          marker.isAdded = false;\r\n          _this.repaint();\r\n        }\r\n      });\r\n    }\r\n    marker.isAdded = false;\r\n    this.markers.push(marker);\r\n  };\r\n  Clusterer.prototype.removeMarker_ = function (marker) {\r\n    var index = -1;\r\n    if (this.markers.indexOf) {\r\n      index = this.markers.indexOf(marker);\r\n    } else {\r\n      for (var i = 0; i < this.markers.length; i++) {\r\n        if (marker === this.markers[i]) {\r\n          index = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (index === -1) {\r\n      // Marker is not in our list of markers, so do nothing:\r\n      return false;\r\n    }\r\n    marker.setMap(null);\r\n    this.markers.splice(index, 1); // Remove the marker from the list of managed markers\r\n    return true;\r\n  };\r\n  Clusterer.prototype.removeMarker = function (marker, optNoDraw) {\r\n    var removed = this.removeMarker_(marker);\r\n    if (!optNoDraw && removed) {\r\n      this.repaint();\r\n    }\r\n    return removed;\r\n  };\r\n  Clusterer.prototype.removeMarkers = function (markers, optNoDraw) {\r\n    var removed = false;\r\n    for (var _i = 0, markers_2 = markers; _i < markers_2.length; _i++) {\r\n      var marker = markers_2[_i];\r\n      removed = removed || this.removeMarker_(marker);\r\n    }\r\n    if (!optNoDraw && removed) {\r\n      this.repaint();\r\n    }\r\n    return removed;\r\n  };\r\n  Clusterer.prototype.clearMarkers = function () {\r\n    this.resetViewport(true);\r\n    this.markers = [];\r\n  };\r\n  Clusterer.prototype.repaint = function () {\r\n    var oldClusters = this.clusters.slice();\r\n    this.clusters = [];\r\n    this.resetViewport(false);\r\n    this.redraw();\r\n    // Remove the old clusters.\r\n    // Do it in a timeout to prevent blinking effect.\r\n    setTimeout(function timeout() {\r\n      for (var _i = 0, oldClusters_1 = oldClusters; _i < oldClusters_1.length; _i++) {\r\n        var oldCluster = oldClusters_1[_i];\r\n        oldCluster.remove();\r\n      }\r\n    }, 0);\r\n  };\r\n  Clusterer.prototype.getExtendedBounds = function (bounds) {\r\n    var projection = this.getProjection();\r\n    // Convert the points to pixels and the extend out by the grid size.\r\n    var trPix = projection.fromLatLngToDivPixel(\r\n    // Turn the bounds into latlng.\r\n    new google.maps.LatLng(bounds.getNorthEast().lat(), bounds.getNorthEast().lng()));\r\n    if (trPix !== null) {\r\n      trPix.x += this.gridSize;\r\n      trPix.y -= this.gridSize;\r\n    }\r\n    var blPix = projection.fromLatLngToDivPixel(\r\n    // Turn the bounds into latlng.\r\n    new google.maps.LatLng(bounds.getSouthWest().lat(), bounds.getSouthWest().lng()));\r\n    if (blPix !== null) {\r\n      blPix.x -= this.gridSize;\r\n      blPix.y += this.gridSize;\r\n    }\r\n    // Extend the bounds to contain the new bounds.\r\n    if (trPix !== null) {\r\n      // Convert the pixel points back to LatLng nw\r\n      var point1 = projection.fromDivPixelToLatLng(trPix);\r\n      if (point1 !== null) {\r\n        bounds.extend(point1);\r\n      }\r\n    }\r\n    if (blPix !== null) {\r\n      // Convert the pixel points back to LatLng sw\r\n      var point2 = projection.fromDivPixelToLatLng(blPix);\r\n      if (point2 !== null) {\r\n        bounds.extend(point2);\r\n      }\r\n    }\r\n    return bounds;\r\n  };\r\n  Clusterer.prototype.redraw = function () {\r\n    // Redraws all the clusters.\r\n    this.createClusters(0);\r\n  };\r\n  Clusterer.prototype.resetViewport = function (optHide) {\r\n    // Remove all the clusters\r\n    for (var _i = 0, _a = this.clusters; _i < _a.length; _i++) {\r\n      var cluster = _a[_i];\r\n      cluster.remove();\r\n    }\r\n    this.clusters = [];\r\n    // Reset the markers to not be added and to be removed from the map.\r\n    for (var _b = 0, _c = this.markers; _b < _c.length; _b++) {\r\n      var marker = _c[_b];\r\n      marker.isAdded = false;\r\n      if (optHide) {\r\n        marker.setMap(null);\r\n      }\r\n    }\r\n  };\r\n  Clusterer.prototype.distanceBetweenPoints = function (p1, p2) {\r\n    var R = 6371; // Radius of the Earth in km\r\n    var dLat = (p2.lat() - p1.lat()) * Math.PI / 180;\r\n    var dLon = (p2.lng() - p1.lng()) * Math.PI / 180;\r\n    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(p1.lat() * Math.PI / 180) * Math.cos(p2.lat() * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));\r\n  };\r\n  Clusterer.prototype.isMarkerInBounds = function (marker, bounds) {\r\n    var position = marker.getPosition();\r\n    if (position) {\r\n      return bounds.contains(position);\r\n    }\r\n    return false;\r\n  };\r\n  Clusterer.prototype.addToClosestCluster = function (marker) {\r\n    var cluster;\r\n    var distance = 40000; // Some large number\r\n    var clusterToAddTo = null;\r\n    for (var _i = 0, _a = this.clusters; _i < _a.length; _i++) {\r\n      var clusterElement = _a[_i];\r\n      cluster = clusterElement;\r\n      var center = cluster.getCenter();\r\n      var position = marker.getPosition();\r\n      if (center && position) {\r\n        var d = this.distanceBetweenPoints(center, position);\r\n        if (d < distance) {\r\n          distance = d;\r\n          clusterToAddTo = cluster;\r\n        }\r\n      }\r\n    }\r\n    if (clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)) {\r\n      clusterToAddTo.addMarker(marker);\r\n    } else {\r\n      cluster = new Cluster$1(this);\r\n      cluster.addMarker(marker);\r\n      this.clusters.push(cluster);\r\n    }\r\n  };\r\n  Clusterer.prototype.createClusters = function (iFirst) {\r\n    var _this = this;\r\n    if (!this.ready) {\r\n      return;\r\n    }\r\n    // Cancel previous batch processing if we're working on the first batch:\r\n    if (iFirst === 0) {\r\n      /**\r\n       * This event is fired when the <code>Clusterer</code> begins\r\n       *  clustering markers.\r\n       * @name Clusterer#clusteringbegin\r\n       * @param {Clusterer} mc The Clusterer whose markers are being clustered.\r\n       * @event\r\n       */\r\n      google.maps.event.trigger(this, 'clusteringbegin', this);\r\n      if (this.timerRefStatic !== null) {\r\n        window.clearTimeout(this.timerRefStatic);\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        delete this.timerRefStatic;\r\n      }\r\n    }\r\n    var map = this.getMap();\r\n    var bounds = map !== null && 'getBounds' in map ? map.getBounds() : null;\r\n    var zoom = (map === null || map === void 0 ? void 0 : map.getZoom()) || 0;\r\n    // Get our current map view bounds.\r\n    // Create a new bounds object so we don't affect the map.\r\n    //\r\n    // See Comments 9 & 11 on Issue 3651 relating to this workaround for a Google Maps bug:\r\n    var mapBounds = zoom > 3 ? new google.maps.LatLngBounds(bounds === null || bounds === void 0 ? void 0 : bounds.getSouthWest(), bounds === null || bounds === void 0 ? void 0 : bounds.getNorthEast()) : new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472, -178.48388434375), new google.maps.LatLng(-85.08136444384544, 178.00048865625));\r\n    var extendedMapBounds = this.getExtendedBounds(mapBounds);\r\n    var iLast = Math.min(iFirst + this.batchSize, this.markers.length);\r\n    for (var i = iFirst; i < iLast; i++) {\r\n      var marker = this.markers[i];\r\n      if (marker && !marker.isAdded && this.isMarkerInBounds(marker, extendedMapBounds) && (!this.ignoreHidden || this.ignoreHidden && marker.getVisible())) {\r\n        this.addToClosestCluster(marker);\r\n      }\r\n    }\r\n    if (iLast < this.markers.length) {\r\n      this.timerRefStatic = window.setTimeout(function () {\r\n        _this.createClusters(iLast);\r\n      }, 0);\r\n    } else {\r\n      this.timerRefStatic = null;\r\n      /**\r\n       * This event is fired when the <code>Clusterer</code> stops\r\n       *  clustering markers.\r\n       * @name Clusterer#clusteringend\r\n       * @param {Clusterer} mc The Clusterer whose markers are being clustered.\r\n       * @event\r\n       */\r\n      google.maps.event.trigger(this, 'clusteringend', this);\r\n      for (var _i = 0, _a = this.clusters; _i < _a.length; _i++) {\r\n        var cluster = _a[_i];\r\n        cluster.updateIcon();\r\n      }\r\n    }\r\n  };\r\n  Clusterer.prototype.extend = function (obj1, obj2) {\r\n    return function applyExtend(object) {\r\n      for (var property in object.prototype) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-types\r\n        var prop = property;\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        this.prototype[prop] = object.prototype[prop];\r\n      }\r\n      return this;\r\n    }.apply(obj1, [obj2]);\r\n  };\r\n  return Clusterer;\r\n}();\r\n\r\nfunction ownKeys$c(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$c(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$c(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$c(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$e = {\r\n  onClick: 'click',\r\n  onClusteringBegin: 'clusteringbegin',\r\n  onClusteringEnd: 'clusteringend',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover'\r\n};\r\nvar updaterMap$e = {\r\n  averageCenter(instance, averageCenter) {\r\n    instance.setAverageCenter(averageCenter);\r\n  },\r\n  batchSizeIE(instance, batchSizeIE) {\r\n    instance.setBatchSizeIE(batchSizeIE);\r\n  },\r\n  calculator(instance, calculator) {\r\n    instance.setCalculator(calculator);\r\n  },\r\n  clusterClass(instance, clusterClass) {\r\n    instance.setClusterClass(clusterClass);\r\n  },\r\n  enableRetinaIcons(instance, enableRetinaIcons) {\r\n    instance.setEnableRetinaIcons(enableRetinaIcons);\r\n  },\r\n  gridSize(instance, gridSize) {\r\n    instance.setGridSize(gridSize);\r\n  },\r\n  ignoreHidden(instance, ignoreHidden) {\r\n    instance.setIgnoreHidden(ignoreHidden);\r\n  },\r\n  imageExtension(instance, imageExtension) {\r\n    instance.setImageExtension(imageExtension);\r\n  },\r\n  imagePath(instance, imagePath) {\r\n    instance.setImagePath(imagePath);\r\n  },\r\n  imageSizes(instance, imageSizes) {\r\n    instance.setImageSizes(imageSizes);\r\n  },\r\n  maxZoom(instance, maxZoom) {\r\n    instance.setMaxZoom(maxZoom);\r\n  },\r\n  minimumClusterSize(instance, minimumClusterSize) {\r\n    instance.setMinimumClusterSize(minimumClusterSize);\r\n  },\r\n  styles(instance, styles) {\r\n    instance.setStyles(styles);\r\n  },\r\n  title(instance, title) {\r\n    instance.setTitle(title);\r\n  },\r\n  zoomOnClick(instance, zoomOnClick) {\r\n    instance.setZoomOnClick(zoomOnClick);\r\n  }\r\n};\r\nvar defaultOptions$4 = {};\r\nfunction MarkerClustererFunctional(props) {\r\n  var {\r\n    children,\r\n    options,\r\n    averageCenter,\r\n    batchSizeIE,\r\n    calculator,\r\n    clusterClass,\r\n    enableRetinaIcons,\r\n    gridSize,\r\n    ignoreHidden,\r\n    imageExtension,\r\n    imagePath,\r\n    imageSizes,\r\n    maxZoom,\r\n    minimumClusterSize,\r\n    styles,\r\n    title,\r\n    zoomOnClick,\r\n    onClick,\r\n    onClusteringBegin,\r\n    onClusteringEnd,\r\n    onMouseOver,\r\n    onMouseOut,\r\n    onLoad,\r\n    onUnmount\r\n  } = props;\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clusteringBeginListener, setClusteringBeginListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clusteringEndListener, setClusteringEndListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, eventMap$e.onMouseOut, onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, eventMap$e.onMouseOver, onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, eventMap$e.onClick, onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClusteringBegin) {\r\n      if (clusteringBeginListener !== null) {\r\n        google.maps.event.removeListener(clusteringBeginListener);\r\n      }\r\n      setClusteringBeginListener(google.maps.event.addListener(instance, eventMap$e.onClusteringBegin, onClusteringBegin));\r\n    }\r\n  }, [onClusteringBegin]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClusteringEnd) {\r\n      if (clusteringEndListener !== null) {\r\n        google.maps.event.removeListener(clusteringEndListener);\r\n      }\r\n      setClusteringBeginListener(google.maps.event.addListener(instance, eventMap$e.onClusteringEnd, onClusteringEnd));\r\n    }\r\n  }, [onClusteringEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof averageCenter !== 'undefined' && instance !== null) {\r\n      updaterMap$e.averageCenter(instance, averageCenter);\r\n    }\r\n  }, [instance, averageCenter]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof batchSizeIE !== 'undefined' && instance !== null) {\r\n      updaterMap$e.batchSizeIE(instance, batchSizeIE);\r\n    }\r\n  }, [instance, batchSizeIE]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof calculator !== 'undefined' && instance !== null) {\r\n      updaterMap$e.calculator(instance, calculator);\r\n    }\r\n  }, [instance, calculator]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof clusterClass !== 'undefined' && instance !== null) {\r\n      updaterMap$e.clusterClass(instance, clusterClass);\r\n    }\r\n  }, [instance, clusterClass]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof enableRetinaIcons !== 'undefined' && instance !== null) {\r\n      updaterMap$e.enableRetinaIcons(instance, enableRetinaIcons);\r\n    }\r\n  }, [instance, enableRetinaIcons]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof gridSize !== 'undefined' && instance !== null) {\r\n      updaterMap$e.gridSize(instance, gridSize);\r\n    }\r\n  }, [instance, gridSize]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof ignoreHidden !== 'undefined' && instance !== null) {\r\n      updaterMap$e.ignoreHidden(instance, ignoreHidden);\r\n    }\r\n  }, [instance, ignoreHidden]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof imageExtension !== 'undefined' && instance !== null) {\r\n      updaterMap$e.imageExtension(instance, imageExtension);\r\n    }\r\n  }, [instance, imageExtension]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof imagePath !== 'undefined' && instance !== null) {\r\n      updaterMap$e.imagePath(instance, imagePath);\r\n    }\r\n  }, [instance, imagePath]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof imageSizes !== 'undefined' && instance !== null) {\r\n      updaterMap$e.imageSizes(instance, imageSizes);\r\n    }\r\n  }, [instance, imageSizes]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof maxZoom !== 'undefined' && instance !== null) {\r\n      updaterMap$e.maxZoom(instance, maxZoom);\r\n    }\r\n  }, [instance, maxZoom]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof minimumClusterSize !== 'undefined' && instance !== null) {\r\n      updaterMap$e.minimumClusterSize(instance, minimumClusterSize);\r\n    }\r\n  }, [instance, minimumClusterSize]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof styles !== 'undefined' && instance !== null) {\r\n      updaterMap$e.styles(instance, styles);\r\n    }\r\n  }, [instance, styles]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof title !== 'undefined' && instance !== null) {\r\n      updaterMap$e.title(instance, title);\r\n    }\r\n  }, [instance, title]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof zoomOnClick !== 'undefined' && instance !== null) {\r\n      updaterMap$e.zoomOnClick(instance, zoomOnClick);\r\n    }\r\n  }, [instance, zoomOnClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (!map) return;\r\n    var clustererOptions = _objectSpread$c({}, options || defaultOptions$4);\r\n    var clusterer = new Clusterer(map, [], clustererOptions);\r\n    if (averageCenter) {\r\n      updaterMap$e.averageCenter(clusterer, averageCenter);\r\n    }\r\n    if (batchSizeIE) {\r\n      updaterMap$e.batchSizeIE(clusterer, batchSizeIE);\r\n    }\r\n    if (calculator) {\r\n      updaterMap$e.calculator(clusterer, calculator);\r\n    }\r\n    if (clusterClass) {\r\n      updaterMap$e.clusterClass(clusterer, clusterClass);\r\n    }\r\n    if (enableRetinaIcons) {\r\n      updaterMap$e.enableRetinaIcons(clusterer, enableRetinaIcons);\r\n    }\r\n    if (gridSize) {\r\n      updaterMap$e.gridSize(clusterer, gridSize);\r\n    }\r\n    if (ignoreHidden) {\r\n      updaterMap$e.ignoreHidden(clusterer, ignoreHidden);\r\n    }\r\n    if (imageExtension) {\r\n      updaterMap$e.imageExtension(clusterer, imageExtension);\r\n    }\r\n    if (imagePath) {\r\n      updaterMap$e.imagePath(clusterer, imagePath);\r\n    }\r\n    if (imageSizes) {\r\n      updaterMap$e.imageSizes(clusterer, imageSizes);\r\n    }\r\n    if (maxZoom) {\r\n      updaterMap$e.maxZoom(clusterer, maxZoom);\r\n    }\r\n    if (minimumClusterSize) {\r\n      updaterMap$e.minimumClusterSize(clusterer, minimumClusterSize);\r\n    }\r\n    if (styles) {\r\n      updaterMap$e.styles(clusterer, styles);\r\n    }\r\n    if (title) {\r\n      updaterMap$e.title(clusterer, title);\r\n    }\r\n    if (zoomOnClick) {\r\n      updaterMap$e.zoomOnClick(clusterer, zoomOnClick);\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(clusterer, eventMap$e.onMouseOut, onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(clusterer, eventMap$e.onMouseOver, onMouseOver));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(clusterer, eventMap$e.onClick, onClick));\r\n    }\r\n    if (onClusteringBegin) {\r\n      setClusteringBeginListener(google.maps.event.addListener(clusterer, eventMap$e.onClusteringBegin, onClusteringBegin));\r\n    }\r\n    if (onClusteringEnd) {\r\n      setClusteringEndListener(google.maps.event.addListener(clusterer, eventMap$e.onClusteringEnd, onClusteringEnd));\r\n    }\r\n    setInstance(clusterer);\r\n    if (onLoad) {\r\n      onLoad(clusterer);\r\n    }\r\n    return () => {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (clusteringBeginListener !== null) {\r\n        google.maps.event.removeListener(clusteringBeginListener);\r\n      }\r\n      if (clusteringEndListener !== null) {\r\n        google.maps.event.removeListener(clusteringEndListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(clusterer);\r\n      }\r\n    };\r\n  }, []);\r\n  return instance !== null ? children(instance) || null : null;\r\n}\r\nvar MarkerClustererF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(MarkerClustererFunctional);\r\nclass ClustererComponent extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      markerClusterer: null\r\n    });\r\n    _defineProperty(this, \"setClustererCallback\", () => {\r\n      if (this.state.markerClusterer !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.markerClusterer);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    if (this.context) {\r\n      var markerClusterer = new Clusterer(this.context, [], this.props.options);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$e,\r\n        eventMap: eventMap$e,\r\n        prevProps: {},\r\n        nextProps: this.props,\r\n        instance: markerClusterer\r\n      });\r\n      this.setState(() => {\r\n        return {\r\n          markerClusterer\r\n        };\r\n      }, this.setClustererCallback);\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.markerClusterer) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$e,\r\n        eventMap: eventMap$e,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.markerClusterer\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.markerClusterer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.markerClusterer);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      this.state.markerClusterer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return this.state.markerClusterer !== null ? this.props.children(this.state.markerClusterer) : null;\r\n  }\r\n}\r\n_defineProperty(ClustererComponent, \"contextType\", MapContext);\r\n\r\n// This handler prevents an event in the InfoBox from being passed on to the map.\r\nfunction cancelHandler(event) {\r\n  event.cancelBubble = true;\r\n  if (event.stopPropagation) {\r\n    event.stopPropagation();\r\n  }\r\n}\r\nvar InfoBox = /** @class */function () {\r\n  function InfoBox(options) {\r\n    if (options === void 0) {\r\n      options = {};\r\n    }\r\n    this.getCloseClickHandler = this.getCloseClickHandler.bind(this);\r\n    this.closeClickHandler = this.closeClickHandler.bind(this);\r\n    this.createInfoBoxDiv = this.createInfoBoxDiv.bind(this);\r\n    this.addClickHandler = this.addClickHandler.bind(this);\r\n    this.getCloseBoxImg = this.getCloseBoxImg.bind(this);\r\n    this.getBoxWidths = this.getBoxWidths.bind(this);\r\n    this.setBoxStyle = this.setBoxStyle.bind(this);\r\n    this.setPosition = this.setPosition.bind(this);\r\n    this.getPosition = this.getPosition.bind(this);\r\n    this.setOptions = this.setOptions.bind(this);\r\n    this.setContent = this.setContent.bind(this);\r\n    this.setVisible = this.setVisible.bind(this);\r\n    this.getContent = this.getContent.bind(this);\r\n    this.getVisible = this.getVisible.bind(this);\r\n    this.setZIndex = this.setZIndex.bind(this);\r\n    this.getZIndex = this.getZIndex.bind(this);\r\n    this.onRemove = this.onRemove.bind(this);\r\n    this.panBox = this.panBox.bind(this);\r\n    this.extend = this.extend.bind(this);\r\n    this.close = this.close.bind(this);\r\n    this.draw = this.draw.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n    this.open = this.open.bind(this);\r\n    this.extend(InfoBox, google.maps.OverlayView);\r\n    // Standard options (in common with google.maps.InfoWindow):\r\n    this.content = options.content || '';\r\n    this.disableAutoPan = options.disableAutoPan || false;\r\n    this.maxWidth = options.maxWidth || 0;\r\n    this.pixelOffset = options.pixelOffset || new google.maps.Size(0, 0);\r\n    this.position = options.position || new google.maps.LatLng(0, 0);\r\n    this.zIndex = options.zIndex || null;\r\n    // Additional options (unique to InfoBox):\r\n    this.boxClass = options.boxClass || 'infoBox';\r\n    this.boxStyle = options.boxStyle || {};\r\n    this.closeBoxMargin = options.closeBoxMargin || '2px';\r\n    this.closeBoxURL = options.closeBoxURL || 'http://www.google.com/intl/en_us/mapfiles/close.gif';\r\n    if (options.closeBoxURL === '') {\r\n      this.closeBoxURL = '';\r\n    }\r\n    this.infoBoxClearance = options.infoBoxClearance || new google.maps.Size(1, 1);\r\n    if (typeof options.visible === 'undefined') {\r\n      if (typeof options.isHidden === 'undefined') {\r\n        options.visible = true;\r\n      } else {\r\n        options.visible = !options.isHidden;\r\n      }\r\n    }\r\n    this.isHidden = !options.visible;\r\n    this.alignBottom = options.alignBottom || false;\r\n    this.pane = options.pane || 'floatPane';\r\n    this.enableEventPropagation = options.enableEventPropagation || false;\r\n    this.div = null;\r\n    this.closeListener = null;\r\n    this.moveListener = null;\r\n    this.mapListener = null;\r\n    this.contextListener = null;\r\n    this.eventListeners = null;\r\n    this.fixedWidthSet = null;\r\n  }\r\n  InfoBox.prototype.createInfoBoxDiv = function () {\r\n    var _this = this;\r\n    // This handler ignores the current event in the InfoBox and conditionally prevents\r\n    // the event from being passed on to the map. It is used for the contextmenu event.\r\n    var ignoreHandler = function ignoreHandler(event) {\r\n      event.returnValue = false;\r\n      if (event.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n      if (!_this.enableEventPropagation) {\r\n        cancelHandler(event);\r\n      }\r\n    };\r\n    if (!this.div) {\r\n      this.div = document.createElement('div');\r\n      this.setBoxStyle();\r\n      if (typeof this.content === 'string') {\r\n        this.div.innerHTML = this.getCloseBoxImg() + this.content;\r\n      } else {\r\n        this.div.innerHTML = this.getCloseBoxImg();\r\n        this.div.appendChild(this.content);\r\n      }\r\n      var panes = this.getPanes();\r\n      if (panes !== null) {\r\n        panes[this.pane].appendChild(this.div); // Add the InfoBox div to the DOM\r\n      }\r\n      this.addClickHandler();\r\n      if (this.div.style.width) {\r\n        this.fixedWidthSet = true;\r\n      } else {\r\n        if (this.maxWidth !== 0 && this.div.offsetWidth > this.maxWidth) {\r\n          this.div.style.width = this.maxWidth + 'px';\r\n          this.fixedWidthSet = true;\r\n        } else {\r\n          // The following code is needed to overcome problems with MSIE\r\n          var bw = this.getBoxWidths();\r\n          this.div.style.width = this.div.offsetWidth - bw.left - bw.right + 'px';\r\n          this.fixedWidthSet = false;\r\n        }\r\n      }\r\n      this.panBox(this.disableAutoPan);\r\n      if (!this.enableEventPropagation) {\r\n        this.eventListeners = [];\r\n        // Cancel event propagation.\r\n        // Note: mousemove not included (to resolve Issue 152)\r\n        var events = ['mousedown', 'mouseover', 'mouseout', 'mouseup', 'click', 'dblclick', 'touchstart', 'touchend', 'touchmove'];\r\n        for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\r\n          var event_1 = events_1[_i];\r\n          this.eventListeners.push(google.maps.event.addListener(this.div, event_1, cancelHandler));\r\n        }\r\n        // Workaround for Google bug that causes the cursor to change to a pointer\r\n        // when the mouse moves over a marker underneath InfoBox.\r\n        this.eventListeners.push(google.maps.event.addListener(this.div, 'mouseover', function () {\r\n          if (_this.div) {\r\n            _this.div.style.cursor = 'default';\r\n          }\r\n        }));\r\n      }\r\n      this.contextListener = google.maps.event.addListener(this.div, 'contextmenu', ignoreHandler);\r\n      /**\r\n       * This event is fired when the DIV containing the InfoBox's content is attached to the DOM.\r\n       * @name InfoBox#domready\r\n       * @event\r\n       */\r\n      google.maps.event.trigger(this, 'domready');\r\n    }\r\n  };\r\n  InfoBox.prototype.getCloseBoxImg = function () {\r\n    var img = '';\r\n    if (this.closeBoxURL !== '') {\r\n      img = '<img alt=\"\"';\r\n      img += ' aria-hidden=\"true\"';\r\n      img += \" src='\" + this.closeBoxURL + \"'\";\r\n      img += ' align=right'; // Do this because Opera chokes on style='float: right;'\r\n      img += \" style='\";\r\n      img += ' position: relative;'; // Required by MSIE\r\n      img += ' cursor: pointer;';\r\n      img += ' margin: ' + this.closeBoxMargin + ';';\r\n      img += \"'>\";\r\n    }\r\n    return img;\r\n  };\r\n  InfoBox.prototype.addClickHandler = function () {\r\n    this.closeListener = this.div && this.div.firstChild && this.closeBoxURL !== '' ? google.maps.event.addListener(this.div.firstChild, 'click', this.getCloseClickHandler()) : null;\r\n  };\r\n  InfoBox.prototype.closeClickHandler = function (event) {\r\n    // 1.0.3 fix: Always prevent propagation of a close box click to the map:\r\n    event.cancelBubble = true;\r\n    if (event.stopPropagation) {\r\n      event.stopPropagation();\r\n    }\r\n    /**\r\n     * This event is fired when the InfoBox's close box is clicked.\r\n     * @name InfoBox#closeclick\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this, 'closeclick');\r\n    this.close();\r\n  };\r\n  InfoBox.prototype.getCloseClickHandler = function () {\r\n    return this.closeClickHandler;\r\n  };\r\n  InfoBox.prototype.panBox = function (disablePan) {\r\n    if (this.div && !disablePan) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      var map = this.getMap();\r\n      // Only pan if attached to map, not panorama\r\n      if (map instanceof google.maps.Map) {\r\n        var xOffset = 0;\r\n        var yOffset = 0;\r\n        var bounds = map.getBounds();\r\n        if (bounds && !bounds.contains(this.position)) {\r\n          // Marker not in visible area of map, so set center\r\n          // of map to the marker position first.\r\n          map.setCenter(this.position);\r\n        }\r\n        var mapDiv = map.getDiv();\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        var mapWidth = mapDiv.offsetWidth;\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        var mapHeight = mapDiv.offsetHeight;\r\n        var iwOffsetX = this.pixelOffset.width;\r\n        var iwOffsetY = this.pixelOffset.height;\r\n        var iwWidth = this.div.offsetWidth;\r\n        var iwHeight = this.div.offsetHeight;\r\n        var padX = this.infoBoxClearance.width;\r\n        var padY = this.infoBoxClearance.height;\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        var projection = this.getProjection();\r\n        var pixPosition = projection.fromLatLngToContainerPixel(this.position);\r\n        if (pixPosition !== null) {\r\n          if (pixPosition.x < -iwOffsetX + padX) {\r\n            xOffset = pixPosition.x + iwOffsetX - padX;\r\n          } else if (pixPosition.x + iwWidth + iwOffsetX + padX > mapWidth) {\r\n            xOffset = pixPosition.x + iwWidth + iwOffsetX + padX - mapWidth;\r\n          }\r\n          if (this.alignBottom) {\r\n            if (pixPosition.y < -iwOffsetY + padY + iwHeight) {\r\n              yOffset = pixPosition.y + iwOffsetY - padY - iwHeight;\r\n            } else if (pixPosition.y + iwOffsetY + padY > mapHeight) {\r\n              yOffset = pixPosition.y + iwOffsetY + padY - mapHeight;\r\n            }\r\n          } else {\r\n            if (pixPosition.y < -iwOffsetY + padY) {\r\n              yOffset = pixPosition.y + iwOffsetY - padY;\r\n            } else if (pixPosition.y + iwHeight + iwOffsetY + padY > mapHeight) {\r\n              yOffset = pixPosition.y + iwHeight + iwOffsetY + padY - mapHeight;\r\n            }\r\n          }\r\n        }\r\n        if (!(xOffset === 0 && yOffset === 0)) {\r\n          // Move the map to the shifted center.\r\n          map.panBy(xOffset, yOffset);\r\n        }\r\n      }\r\n    }\r\n  };\r\n  InfoBox.prototype.setBoxStyle = function () {\r\n    if (this.div) {\r\n      // Apply style values from the style sheet defined in the boxClass parameter:\r\n      this.div.className = this.boxClass;\r\n      // Clear existing inline style values:\r\n      this.div.style.cssText = '';\r\n      // Apply style values defined in the boxStyle parameter:\r\n      var boxStyle = this.boxStyle;\r\n      for (var i in boxStyle) {\r\n        if (Object.prototype.hasOwnProperty.call(boxStyle, i)) {\r\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n          // @ts-ignore\r\n          this.div.style[i] = boxStyle[i];\r\n        }\r\n      }\r\n      // Fix for iOS disappearing InfoBox problem\r\n      // See http://stackoverflow.com/questions/9229535/google-maps-markers-disappear-at-certain-zoom-level-only-on-iphone-ipad\r\n      this.div.style.webkitTransform = 'translateZ(0)';\r\n      // Fix up opacity style for benefit of MSIE\r\n      if (typeof this.div.style.opacity !== 'undefined' && this.div.style.opacity !== '') {\r\n        // See http://www.quirksmode.org/css/opacity.html\r\n        var opacity = parseFloat(this.div.style.opacity || '');\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        this.div.style.msFilter = '\"progid:DXImageTransform.Microsoft.Alpha(Opacity=' + opacity * 100 + ')\"';\r\n        this.div.style.filter = 'alpha(opacity=' + opacity * 100 + ')';\r\n      }\r\n      // Apply required styles\r\n      this.div.style.position = 'absolute';\r\n      this.div.style.visibility = 'hidden';\r\n      if (this.zIndex !== null) {\r\n        this.div.style.zIndex = this.zIndex + '';\r\n      }\r\n      if (!this.div.style.overflow) {\r\n        this.div.style.overflow = 'auto';\r\n      }\r\n    }\r\n  };\r\n  InfoBox.prototype.getBoxWidths = function () {\r\n    var bw = {\r\n      top: 0,\r\n      bottom: 0,\r\n      left: 0,\r\n      right: 0\r\n    };\r\n    if (!this.div) {\r\n      return bw;\r\n    }\r\n    if (document.defaultView) {\r\n      var ownerDocument = this.div.ownerDocument;\r\n      var computedStyle = ownerDocument && ownerDocument.defaultView ? ownerDocument.defaultView.getComputedStyle(this.div, '') : null;\r\n      if (computedStyle) {\r\n        // The computed styles are always in pixel units (good!)\r\n        bw.top = parseInt(computedStyle.borderTopWidth || '', 10) || 0;\r\n        bw.bottom = parseInt(computedStyle.borderBottomWidth || '', 10) || 0;\r\n        bw.left = parseInt(computedStyle.borderLeftWidth || '', 10) || 0;\r\n        bw.right = parseInt(computedStyle.borderRightWidth || '', 10) || 0;\r\n      }\r\n    } else if (\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    document.documentElement.currentStyle // MSIE\r\n    ) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      var currentStyle = this.div.currentStyle;\r\n      if (currentStyle) {\r\n        // The current styles may not be in pixel units, but assume they are (bad!)\r\n        bw.top = parseInt(currentStyle.borderTopWidth || '', 10) || 0;\r\n        bw.bottom = parseInt(currentStyle.borderBottomWidth || '', 10) || 0;\r\n        bw.left = parseInt(currentStyle.borderLeftWidth || '', 10) || 0;\r\n        bw.right = parseInt(currentStyle.borderRightWidth || '', 10) || 0;\r\n      }\r\n    }\r\n    return bw;\r\n  };\r\n  InfoBox.prototype.onRemove = function () {\r\n    if (this.div && this.div.parentNode) {\r\n      this.div.parentNode.removeChild(this.div);\r\n      this.div = null;\r\n    }\r\n  };\r\n  InfoBox.prototype.draw = function () {\r\n    this.createInfoBoxDiv();\r\n    if (this.div) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      var projection = this.getProjection();\r\n      var pixPosition = projection.fromLatLngToDivPixel(this.position);\r\n      if (pixPosition !== null) {\r\n        this.div.style.left = pixPosition.x + this.pixelOffset.width + 'px';\r\n        if (this.alignBottom) {\r\n          this.div.style.bottom = -(pixPosition.y + this.pixelOffset.height) + 'px';\r\n        } else {\r\n          this.div.style.top = pixPosition.y + this.pixelOffset.height + 'px';\r\n        }\r\n      }\r\n      if (this.isHidden) {\r\n        this.div.style.visibility = 'hidden';\r\n      } else {\r\n        this.div.style.visibility = 'visible';\r\n      }\r\n    }\r\n  };\r\n  InfoBox.prototype.setOptions = function (options) {\r\n    if (options === void 0) {\r\n      options = {};\r\n    }\r\n    if (typeof options.boxClass !== 'undefined') {\r\n      // Must be first\r\n      this.boxClass = options.boxClass;\r\n      this.setBoxStyle();\r\n    }\r\n    if (typeof options.boxStyle !== 'undefined') {\r\n      // Must be second\r\n      this.boxStyle = options.boxStyle;\r\n      this.setBoxStyle();\r\n    }\r\n    if (typeof options.content !== 'undefined') {\r\n      this.setContent(options.content);\r\n    }\r\n    if (typeof options.disableAutoPan !== 'undefined') {\r\n      this.disableAutoPan = options.disableAutoPan;\r\n    }\r\n    if (typeof options.maxWidth !== 'undefined') {\r\n      this.maxWidth = options.maxWidth;\r\n    }\r\n    if (typeof options.pixelOffset !== 'undefined') {\r\n      this.pixelOffset = options.pixelOffset;\r\n    }\r\n    if (typeof options.alignBottom !== 'undefined') {\r\n      this.alignBottom = options.alignBottom;\r\n    }\r\n    if (typeof options.position !== 'undefined') {\r\n      this.setPosition(options.position);\r\n    }\r\n    if (typeof options.zIndex !== 'undefined') {\r\n      this.setZIndex(options.zIndex);\r\n    }\r\n    if (typeof options.closeBoxMargin !== 'undefined') {\r\n      this.closeBoxMargin = options.closeBoxMargin;\r\n    }\r\n    if (typeof options.closeBoxURL !== 'undefined') {\r\n      this.closeBoxURL = options.closeBoxURL;\r\n    }\r\n    if (typeof options.infoBoxClearance !== 'undefined') {\r\n      this.infoBoxClearance = options.infoBoxClearance;\r\n    }\r\n    if (typeof options.isHidden !== 'undefined') {\r\n      this.isHidden = options.isHidden;\r\n    }\r\n    if (typeof options.visible !== 'undefined') {\r\n      this.isHidden = !options.visible;\r\n    }\r\n    if (typeof options.enableEventPropagation !== 'undefined') {\r\n      this.enableEventPropagation = options.enableEventPropagation;\r\n    }\r\n    if (this.div) {\r\n      this.draw();\r\n    }\r\n  };\r\n  InfoBox.prototype.setContent = function (content) {\r\n    this.content = content;\r\n    if (this.div) {\r\n      if (this.closeListener) {\r\n        google.maps.event.removeListener(this.closeListener);\r\n        this.closeListener = null;\r\n      }\r\n      // Odd code required to make things work with MSIE.\r\n      if (!this.fixedWidthSet) {\r\n        this.div.style.width = '';\r\n      }\r\n      if (typeof content === 'string') {\r\n        this.div.innerHTML = this.getCloseBoxImg() + content;\r\n      } else {\r\n        this.div.innerHTML = this.getCloseBoxImg();\r\n        this.div.appendChild(content);\r\n      }\r\n      // Perverse code required to make things work with MSIE.\r\n      // (Ensures the close box does, in fact, float to the right.)\r\n      if (!this.fixedWidthSet) {\r\n        this.div.style.width = this.div.offsetWidth + 'px';\r\n        if (typeof content === 'string') {\r\n          this.div.innerHTML = this.getCloseBoxImg() + content;\r\n        } else {\r\n          this.div.innerHTML = this.getCloseBoxImg();\r\n          this.div.appendChild(content);\r\n        }\r\n      }\r\n      this.addClickHandler();\r\n    }\r\n    /**\r\n     * This event is fired when the content of the InfoBox changes.\r\n     * @name InfoBox#content_changed\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this, 'content_changed');\r\n  };\r\n  InfoBox.prototype.setPosition = function (latLng) {\r\n    this.position = latLng;\r\n    if (this.div) {\r\n      this.draw();\r\n    }\r\n    /**\r\n     * This event is fired when the position of the InfoBox changes.\r\n     * @name InfoBox#position_changed\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this, 'position_changed');\r\n  };\r\n  InfoBox.prototype.setVisible = function (isVisible) {\r\n    this.isHidden = !isVisible;\r\n    if (this.div) {\r\n      this.div.style.visibility = this.isHidden ? 'hidden' : 'visible';\r\n    }\r\n  };\r\n  InfoBox.prototype.setZIndex = function (index) {\r\n    this.zIndex = index;\r\n    if (this.div) {\r\n      this.div.style.zIndex = index + '';\r\n    }\r\n    /**\r\n     * This event is fired when the zIndex of the InfoBox changes.\r\n     * @name InfoBox#zindex_changed\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this, 'zindex_changed');\r\n  };\r\n  InfoBox.prototype.getContent = function () {\r\n    return this.content;\r\n  };\r\n  InfoBox.prototype.getPosition = function () {\r\n    return this.position;\r\n  };\r\n  InfoBox.prototype.getZIndex = function () {\r\n    return this.zIndex;\r\n  };\r\n  InfoBox.prototype.getVisible = function () {\r\n    var map = this.getMap();\r\n    return typeof map === 'undefined' || map === null ? false : !this.isHidden;\r\n  };\r\n  InfoBox.prototype.show = function () {\r\n    this.isHidden = false;\r\n    if (this.div) {\r\n      this.div.style.visibility = 'visible';\r\n    }\r\n  };\r\n  InfoBox.prototype.hide = function () {\r\n    this.isHidden = true;\r\n    if (this.div) {\r\n      this.div.style.visibility = 'hidden';\r\n    }\r\n  };\r\n  InfoBox.prototype.open = function (map, anchor) {\r\n    var _this = this;\r\n    if (anchor) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      this.position = anchor.getPosition();\r\n      this.moveListener = google.maps.event.addListener(anchor, 'position_changed', function () {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        var position = anchor.getPosition();\r\n        _this.setPosition(position);\r\n      });\r\n      this.mapListener = google.maps.event.addListener(anchor, 'map_changed', function () {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        _this.setMap(anchor.map);\r\n      });\r\n    }\r\n    this.setMap(map);\r\n    if (this.div) {\r\n      this.panBox();\r\n    }\r\n  };\r\n  InfoBox.prototype.close = function () {\r\n    if (this.closeListener) {\r\n      google.maps.event.removeListener(this.closeListener);\r\n      this.closeListener = null;\r\n    }\r\n    if (this.eventListeners) {\r\n      for (var _i = 0, _a = this.eventListeners; _i < _a.length; _i++) {\r\n        var eventListener = _a[_i];\r\n        google.maps.event.removeListener(eventListener);\r\n      }\r\n      this.eventListeners = null;\r\n    }\r\n    if (this.moveListener) {\r\n      google.maps.event.removeListener(this.moveListener);\r\n      this.moveListener = null;\r\n    }\r\n    if (this.mapListener) {\r\n      google.maps.event.removeListener(this.mapListener);\r\n      this.mapListener = null;\r\n    }\r\n    if (this.contextListener) {\r\n      google.maps.event.removeListener(this.contextListener);\r\n      this.contextListener = null;\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    this.setMap(null);\r\n  };\r\n  InfoBox.prototype.extend = function (obj1, obj2) {\r\n    return function applyExtend(object) {\r\n      for (var property in object.prototype) {\r\n        if (!Object.prototype.hasOwnProperty.call(this, property)) {\r\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n          // @ts-ignore\r\n          this.prototype[property] = object.prototype[property];\r\n        }\r\n      }\r\n      return this;\r\n    }.apply(obj1, [obj2]);\r\n  };\r\n  return InfoBox;\r\n}();\r\n\r\nvar _excluded = [\"position\"],\r\n  _excluded2 = [\"position\"];\r\nfunction ownKeys$b(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$b(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$b(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$b(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$d = {\r\n  onCloseClick: 'closeclick',\r\n  onContentChanged: 'content_changed',\r\n  onDomReady: 'domready',\r\n  onPositionChanged: 'position_changed',\r\n  onZindexChanged: 'zindex_changed'\r\n};\r\nvar updaterMap$d = {\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  position(instance, position) {\r\n    if (position instanceof google.maps.LatLng) {\r\n      instance.setPosition(position);\r\n    } else {\r\n      instance.setPosition(new google.maps.LatLng(position.lat, position.lng));\r\n    }\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  },\r\n  zIndex(instance, zIndex) {\r\n    instance.setZIndex(zIndex);\r\n  }\r\n};\r\nvar defaultOptions$3 = {};\r\nfunction InfoBoxFunctional(_ref) {\r\n  var {\r\n    children,\r\n    anchor,\r\n    options,\r\n    position,\r\n    zIndex,\r\n    onCloseClick,\r\n    onDomReady,\r\n    onContentChanged,\r\n    onPositionChanged,\r\n    onZindexChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [closeClickListener, setCloseClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [domReadyClickListener, setDomReadyClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [contentChangedClickListener, setContentChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [positionChangedClickListener, setPositionChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [zIndexChangedClickListener, setZindexChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var containerElementRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && instance !== null) {\r\n      instance.close();\r\n      if (anchor) {\r\n        instance.open(map, anchor);\r\n      } else if (instance.getPosition()) {\r\n        instance.open(map);\r\n      }\r\n    }\r\n  }, [map, instance, anchor]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (position && instance !== null) {\r\n      var positionLatLng = position instanceof google.maps.LatLng ? position :\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      new google.maps.LatLng(position.lat, position.lng);\r\n      instance.setPosition(positionLatLng);\r\n    }\r\n  }, [position]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof zIndex === 'number' && instance !== null) {\r\n      instance.setZIndex(zIndex);\r\n    }\r\n  }, [zIndex]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onCloseClick) {\r\n      if (closeClickListener !== null) {\r\n        google.maps.event.removeListener(closeClickListener);\r\n      }\r\n      setCloseClickListener(google.maps.event.addListener(instance, 'closeclick', onCloseClick));\r\n    }\r\n  }, [onCloseClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDomReady) {\r\n      if (domReadyClickListener !== null) {\r\n        google.maps.event.removeListener(domReadyClickListener);\r\n      }\r\n      setDomReadyClickListener(google.maps.event.addListener(instance, 'domready', onDomReady));\r\n    }\r\n  }, [onDomReady]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onContentChanged) {\r\n      if (contentChangedClickListener !== null) {\r\n        google.maps.event.removeListener(contentChangedClickListener);\r\n      }\r\n      setContentChangedClickListener(google.maps.event.addListener(instance, 'content_changed', onContentChanged));\r\n    }\r\n  }, [onContentChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onPositionChanged) {\r\n      if (positionChangedClickListener !== null) {\r\n        google.maps.event.removeListener(positionChangedClickListener);\r\n      }\r\n      setPositionChangedClickListener(google.maps.event.addListener(instance, 'position_changed', onPositionChanged));\r\n    }\r\n  }, [onPositionChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onZindexChanged) {\r\n      if (zIndexChangedClickListener !== null) {\r\n        google.maps.event.removeListener(zIndexChangedClickListener);\r\n      }\r\n      setZindexChangedClickListener(google.maps.event.addListener(instance, 'zindex_changed', onZindexChanged));\r\n    }\r\n  }, [onZindexChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map) {\r\n      var _ref2 = options || defaultOptions$3,\r\n        {\r\n          position: _position\r\n        } = _ref2,\r\n        infoBoxOptions = _objectWithoutProperties(_ref2, _excluded);\r\n      var positionLatLng;\r\n      if (_position && !(_position instanceof google.maps.LatLng)) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        positionLatLng = new google.maps.LatLng(_position.lat, _position.lng);\r\n      }\r\n      var infoBox = new InfoBox(_objectSpread$b(_objectSpread$b({}, infoBoxOptions), positionLatLng ? {\r\n        position: positionLatLng\r\n      } : {}));\r\n      containerElementRef.current = document.createElement('div');\r\n      setInstance(infoBox);\r\n      if (onCloseClick) {\r\n        setCloseClickListener(google.maps.event.addListener(infoBox, 'closeclick', onCloseClick));\r\n      }\r\n      if (onDomReady) {\r\n        setDomReadyClickListener(google.maps.event.addListener(infoBox, 'domready', onDomReady));\r\n      }\r\n      if (onContentChanged) {\r\n        setContentChangedClickListener(google.maps.event.addListener(infoBox, 'content_changed', onContentChanged));\r\n      }\r\n      if (onPositionChanged) {\r\n        setPositionChangedClickListener(google.maps.event.addListener(infoBox, 'position_changed', onPositionChanged));\r\n      }\r\n      if (onZindexChanged) {\r\n        setZindexChangedClickListener(google.maps.event.addListener(infoBox, 'zindex_changed', onZindexChanged));\r\n      }\r\n      infoBox.setContent(containerElementRef.current);\r\n      if (anchor) {\r\n        infoBox.open(map, anchor);\r\n      } else if (infoBox.getPosition()) {\r\n        infoBox.open(map);\r\n      } else {\r\n        invariant(false, 'You must provide either an anchor or a position prop for <InfoBox>.');\r\n      }\r\n      if (onLoad) {\r\n        onLoad(infoBox);\r\n      }\r\n    }\r\n    return () => {\r\n      if (instance !== null) {\r\n        if (closeClickListener) {\r\n          google.maps.event.removeListener(closeClickListener);\r\n        }\r\n        if (contentChangedClickListener) {\r\n          google.maps.event.removeListener(contentChangedClickListener);\r\n        }\r\n        if (domReadyClickListener) {\r\n          google.maps.event.removeListener(domReadyClickListener);\r\n        }\r\n        if (positionChangedClickListener) {\r\n          google.maps.event.removeListener(positionChangedClickListener);\r\n        }\r\n        if (zIndexChangedClickListener) {\r\n          google.maps.event.removeListener(zIndexChangedClickListener);\r\n        }\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.close();\r\n      }\r\n    };\r\n  }, []);\r\n  return containerElementRef.current ? (0,react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal)(react__WEBPACK_IMPORTED_MODULE_1__.Children.only(children), containerElementRef.current) : null;\r\n}\r\nvar InfoBoxF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(InfoBoxFunctional);\r\nclass InfoBoxComponent extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"containerElement\", null);\r\n    _defineProperty(this, \"state\", {\r\n      infoBox: null\r\n    });\r\n    _defineProperty(this, \"open\", (infoBox, anchor) => {\r\n      if (anchor) {\r\n        if (this.context !== null) {\r\n          infoBox.open(this.context, anchor);\r\n        }\r\n      } else if (infoBox.getPosition()) {\r\n        if (this.context !== null) {\r\n          infoBox.open(this.context);\r\n        }\r\n      } else {\r\n        invariant(false, 'You must provide either an anchor or a position prop for <InfoBox>.');\r\n      }\r\n    });\r\n    _defineProperty(this, \"setInfoBoxCallback\", () => {\r\n      if (this.state.infoBox !== null && this.containerElement !== null) {\r\n        this.state.infoBox.setContent(this.containerElement);\r\n        this.open(this.state.infoBox, this.props.anchor);\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.infoBox);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var _ref3 = this.props.options || {},\r\n      {\r\n        position\r\n      } = _ref3,\r\n      infoBoxOptions = _objectWithoutProperties(_ref3, _excluded2);\r\n    var positionLatLng;\r\n    if (position && !(position instanceof google.maps.LatLng)) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      positionLatLng = new google.maps.LatLng(position.lat, position.lng);\r\n    }\r\n    var infoBox = new InfoBox(_objectSpread$b(_objectSpread$b({}, infoBoxOptions), positionLatLng ? {\r\n      position: positionLatLng\r\n    } : {}));\r\n    this.containerElement = document.createElement('div');\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$d,\r\n      eventMap: eventMap$d,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: infoBox\r\n    });\r\n    this.setState({\r\n      infoBox\r\n    }, this.setInfoBoxCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    var {\r\n      infoBox\r\n    } = this.state;\r\n    if (infoBox !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$d,\r\n        eventMap: eventMap$d,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: infoBox\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    var {\r\n      onUnmount\r\n    } = this.props;\r\n    var {\r\n      infoBox\r\n    } = this.state;\r\n    if (infoBox !== null) {\r\n      if (onUnmount) {\r\n        onUnmount(infoBox);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      infoBox.close();\r\n    }\r\n  }\r\n  render() {\r\n    return this.containerElement ? (0,react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal)(react__WEBPACK_IMPORTED_MODULE_1__.Children.only(this.props.children), this.containerElement) : null;\r\n  }\r\n}\r\n_defineProperty(InfoBoxComponent, \"contextType\", MapContext);\r\n\r\nvar fastDeepEqual;\r\nvar hasRequiredFastDeepEqual;\r\nfunction requireFastDeepEqual() {\r\n  if (hasRequiredFastDeepEqual) return fastDeepEqual;\r\n  hasRequiredFastDeepEqual = 1;\r\n\r\n  // do not edit .js files directly - edit src/index.jst\r\n\r\n  fastDeepEqual = function equal(a, b) {\r\n    if (a === b) return true;\r\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\r\n      if (a.constructor !== b.constructor) return false;\r\n      var length, i, keys;\r\n      if (Array.isArray(a)) {\r\n        length = a.length;\r\n        if (length != b.length) return false;\r\n        for (i = length; i-- !== 0;) if (!equal(a[i], b[i])) return false;\r\n        return true;\r\n      }\r\n      if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\r\n      if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\r\n      if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\r\n      keys = Object.keys(a);\r\n      length = keys.length;\r\n      if (length !== Object.keys(b).length) return false;\r\n      for (i = length; i-- !== 0;) if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\r\n      for (i = length; i-- !== 0;) {\r\n        var key = keys[i];\r\n        if (!equal(a[key], b[key])) return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // true if both NaN, false otherwise\r\n    return a !== a && b !== b;\r\n  };\r\n  return fastDeepEqual;\r\n}\r\n\r\nvar fastDeepEqualExports = requireFastDeepEqual();\r\nvar equal = /*@__PURE__*/getDefaultExportFromCjs$1(fastDeepEqualExports);\r\n\r\nvar ARRAY_TYPES = [Int8Array, Uint8Array, Uint8ClampedArray, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, Float64Array];\r\n\r\n/** @typedef {Int8ArrayConstructor | Uint8ArrayConstructor | Uint8ClampedArrayConstructor | Int16ArrayConstructor | Uint16ArrayConstructor | Int32ArrayConstructor | Uint32ArrayConstructor | Float32ArrayConstructor | Float64ArrayConstructor} TypedArrayConstructor */\r\n\r\nvar VERSION = 1; // serialized format version\r\nvar HEADER_SIZE = 8;\r\nclass KDBush {\r\n  /**\r\n   * Creates an index from raw `ArrayBuffer` data.\r\n   * @param {ArrayBuffer} data\r\n   */\r\n  static from(data) {\r\n    if (!(data instanceof ArrayBuffer)) {\r\n      throw new Error('Data must be an instance of ArrayBuffer.');\r\n    }\r\n    var [magic, versionAndType] = new Uint8Array(data, 0, 2);\r\n    if (magic !== 0xdb) {\r\n      throw new Error('Data does not appear to be in a KDBush format.');\r\n    }\r\n    var version = versionAndType >> 4;\r\n    if (version !== VERSION) {\r\n      throw new Error(\"Got v\".concat(version, \" data when expected v\").concat(VERSION, \".\"));\r\n    }\r\n    var ArrayType = ARRAY_TYPES[versionAndType & 0x0f];\r\n    if (!ArrayType) {\r\n      throw new Error('Unrecognized array type.');\r\n    }\r\n    var [nodeSize] = new Uint16Array(data, 2, 1);\r\n    var [numItems] = new Uint32Array(data, 4, 1);\r\n    return new KDBush(numItems, nodeSize, ArrayType, data);\r\n  }\r\n\r\n  /**\r\n   * Creates an index that will hold a given number of items.\r\n   * @param {number} numItems\r\n   * @param {number} [nodeSize=64] Size of the KD-tree node (64 by default).\r\n   * @param {TypedArrayConstructor} [ArrayType=Float64Array] The array type used for coordinates storage (`Float64Array` by default).\r\n   * @param {ArrayBuffer} [data] (For internal use only)\r\n   */\r\n  constructor(numItems) {\r\n    var nodeSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 64;\r\n    var ArrayType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Float64Array;\r\n    var data = arguments.length > 3 ? arguments[3] : undefined;\r\n    if (isNaN(numItems) || numItems < 0) throw new Error(\"Unpexpected numItems value: \".concat(numItems, \".\"));\r\n    this.numItems = +numItems;\r\n    this.nodeSize = Math.min(Math.max(+nodeSize, 2), 65535);\r\n    this.ArrayType = ArrayType;\r\n    this.IndexArrayType = numItems < 65536 ? Uint16Array : Uint32Array;\r\n    var arrayTypeIndex = ARRAY_TYPES.indexOf(this.ArrayType);\r\n    var coordsByteSize = numItems * 2 * this.ArrayType.BYTES_PER_ELEMENT;\r\n    var idsByteSize = numItems * this.IndexArrayType.BYTES_PER_ELEMENT;\r\n    var padCoords = (8 - idsByteSize % 8) % 8;\r\n    if (arrayTypeIndex < 0) {\r\n      throw new Error(\"Unexpected typed array class: \".concat(ArrayType, \".\"));\r\n    }\r\n    if (data && data instanceof ArrayBuffer) {\r\n      // reconstruct an index from a buffer\r\n      this.data = data;\r\n      this.ids = new this.IndexArrayType(this.data, HEADER_SIZE, numItems);\r\n      this.coords = new this.ArrayType(this.data, HEADER_SIZE + idsByteSize + padCoords, numItems * 2);\r\n      this._pos = numItems * 2;\r\n      this._finished = true;\r\n    } else {\r\n      // initialize a new index\r\n      this.data = new ArrayBuffer(HEADER_SIZE + coordsByteSize + idsByteSize + padCoords);\r\n      this.ids = new this.IndexArrayType(this.data, HEADER_SIZE, numItems);\r\n      this.coords = new this.ArrayType(this.data, HEADER_SIZE + idsByteSize + padCoords, numItems * 2);\r\n      this._pos = 0;\r\n      this._finished = false;\r\n\r\n      // set header\r\n      new Uint8Array(this.data, 0, 2).set([0xdb, (VERSION << 4) + arrayTypeIndex]);\r\n      new Uint16Array(this.data, 2, 1)[0] = nodeSize;\r\n      new Uint32Array(this.data, 4, 1)[0] = numItems;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a point to the index.\r\n   * @param {number} x\r\n   * @param {number} y\r\n   * @returns {number} An incremental index associated with the added item (starting from `0`).\r\n   */\r\n  add(x, y) {\r\n    var index = this._pos >> 1;\r\n    this.ids[index] = index;\r\n    this.coords[this._pos++] = x;\r\n    this.coords[this._pos++] = y;\r\n    return index;\r\n  }\r\n\r\n  /**\r\n   * Perform indexing of the added points.\r\n   */\r\n  finish() {\r\n    var numAdded = this._pos >> 1;\r\n    if (numAdded !== this.numItems) {\r\n      throw new Error(\"Added \".concat(numAdded, \" items when expected \").concat(this.numItems, \".\"));\r\n    }\r\n    // kd-sort both arrays for efficient search\r\n    sort(this.ids, this.coords, this.nodeSize, 0, this.numItems - 1, 0);\r\n    this._finished = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Search the index for items within a given bounding box.\r\n   * @param {number} minX\r\n   * @param {number} minY\r\n   * @param {number} maxX\r\n   * @param {number} maxY\r\n   * @returns {number[]} An array of indices correponding to the found items.\r\n   */\r\n  range(minX, minY, maxX, maxY) {\r\n    if (!this._finished) throw new Error('Data not yet indexed - call index.finish().');\r\n    var {\r\n      ids,\r\n      coords,\r\n      nodeSize\r\n    } = this;\r\n    var stack = [0, ids.length - 1, 0];\r\n    var result = [];\r\n\r\n    // recursively search for items in range in the kd-sorted arrays\r\n    while (stack.length) {\r\n      var axis = stack.pop() || 0;\r\n      var right = stack.pop() || 0;\r\n      var left = stack.pop() || 0;\r\n\r\n      // if we reached \"tree node\", search linearly\r\n      if (right - left <= nodeSize) {\r\n        for (var i = left; i <= right; i++) {\r\n          var _x = coords[2 * i];\r\n          var _y = coords[2 * i + 1];\r\n          if (_x >= minX && _x <= maxX && _y >= minY && _y <= maxY) result.push(ids[i]);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // otherwise find the middle index\r\n      var m = left + right >> 1;\r\n\r\n      // include the middle item if it's in range\r\n      var x = coords[2 * m];\r\n      var y = coords[2 * m + 1];\r\n      if (x >= minX && x <= maxX && y >= minY && y <= maxY) result.push(ids[m]);\r\n\r\n      // queue search in halves that intersect the query\r\n      if (axis === 0 ? minX <= x : minY <= y) {\r\n        stack.push(left);\r\n        stack.push(m - 1);\r\n        stack.push(1 - axis);\r\n      }\r\n      if (axis === 0 ? maxX >= x : maxY >= y) {\r\n        stack.push(m + 1);\r\n        stack.push(right);\r\n        stack.push(1 - axis);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Search the index for items within a given radius.\r\n   * @param {number} qx\r\n   * @param {number} qy\r\n   * @param {number} r Query radius.\r\n   * @returns {number[]} An array of indices correponding to the found items.\r\n   */\r\n  within(qx, qy, r) {\r\n    if (!this._finished) throw new Error('Data not yet indexed - call index.finish().');\r\n    var {\r\n      ids,\r\n      coords,\r\n      nodeSize\r\n    } = this;\r\n    var stack = [0, ids.length - 1, 0];\r\n    var result = [];\r\n    var r2 = r * r;\r\n\r\n    // recursively search for items within radius in the kd-sorted arrays\r\n    while (stack.length) {\r\n      var axis = stack.pop() || 0;\r\n      var right = stack.pop() || 0;\r\n      var left = stack.pop() || 0;\r\n\r\n      // if we reached \"tree node\", search linearly\r\n      if (right - left <= nodeSize) {\r\n        for (var i = left; i <= right; i++) {\r\n          if (sqDist(coords[2 * i], coords[2 * i + 1], qx, qy) <= r2) result.push(ids[i]);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // otherwise find the middle index\r\n      var m = left + right >> 1;\r\n\r\n      // include the middle item if it's in range\r\n      var x = coords[2 * m];\r\n      var y = coords[2 * m + 1];\r\n      if (sqDist(x, y, qx, qy) <= r2) result.push(ids[m]);\r\n\r\n      // queue search in halves that intersect the query\r\n      if (axis === 0 ? qx - r <= x : qy - r <= y) {\r\n        stack.push(left);\r\n        stack.push(m - 1);\r\n        stack.push(1 - axis);\r\n      }\r\n      if (axis === 0 ? qx + r >= x : qy + r >= y) {\r\n        stack.push(m + 1);\r\n        stack.push(right);\r\n        stack.push(1 - axis);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Uint16Array | Uint32Array} ids\r\n * @param {InstanceType<TypedArrayConstructor>} coords\r\n * @param {number} nodeSize\r\n * @param {number} left\r\n * @param {number} right\r\n * @param {number} axis\r\n */\r\nfunction sort(ids, coords, nodeSize, left, right, axis) {\r\n  if (right - left <= nodeSize) return;\r\n  var m = left + right >> 1; // middle index\r\n\r\n  // sort ids and coords around the middle index so that the halves lie\r\n  // either left/right or top/bottom correspondingly (taking turns)\r\n  select(ids, coords, m, left, right, axis);\r\n\r\n  // recursively kd-sort first half and second half on the opposite axis\r\n  sort(ids, coords, nodeSize, left, m - 1, 1 - axis);\r\n  sort(ids, coords, nodeSize, m + 1, right, 1 - axis);\r\n}\r\n\r\n/**\r\n * Custom Floyd-Rivest selection algorithm: sort ids and coords so that\r\n * [left..k-1] items are smaller than k-th item (on either x or y axis)\r\n * @param {Uint16Array | Uint32Array} ids\r\n * @param {InstanceType<TypedArrayConstructor>} coords\r\n * @param {number} k\r\n * @param {number} left\r\n * @param {number} right\r\n * @param {number} axis\r\n */\r\nfunction select(ids, coords, k, left, right, axis) {\r\n  while (right > left) {\r\n    if (right - left > 600) {\r\n      var n = right - left + 1;\r\n      var m = k - left + 1;\r\n      var z = Math.log(n);\r\n      var s = 0.5 * Math.exp(2 * z / 3);\r\n      var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\r\n      var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\r\n      var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\r\n      select(ids, coords, k, newLeft, newRight, axis);\r\n    }\r\n    var t = coords[2 * k + axis];\r\n    var i = left;\r\n    var j = right;\r\n    swapItem(ids, coords, left, k);\r\n    if (coords[2 * right + axis] > t) swapItem(ids, coords, left, right);\r\n    while (i < j) {\r\n      swapItem(ids, coords, i, j);\r\n      i++;\r\n      j--;\r\n      while (coords[2 * i + axis] < t) i++;\r\n      while (coords[2 * j + axis] > t) j--;\r\n    }\r\n    if (coords[2 * left + axis] === t) swapItem(ids, coords, left, j);else {\r\n      j++;\r\n      swapItem(ids, coords, j, right);\r\n    }\r\n    if (j <= k) left = j + 1;\r\n    if (k <= j) right = j - 1;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Uint16Array | Uint32Array} ids\r\n * @param {InstanceType<TypedArrayConstructor>} coords\r\n * @param {number} i\r\n * @param {number} j\r\n */\r\nfunction swapItem(ids, coords, i, j) {\r\n  swap(ids, i, j);\r\n  swap(coords, 2 * i, 2 * j);\r\n  swap(coords, 2 * i + 1, 2 * j + 1);\r\n}\r\n\r\n/**\r\n * @param {InstanceType<TypedArrayConstructor>} arr\r\n * @param {number} i\r\n * @param {number} j\r\n */\r\nfunction swap(arr, i, j) {\r\n  var tmp = arr[i];\r\n  arr[i] = arr[j];\r\n  arr[j] = tmp;\r\n}\r\n\r\n/**\r\n * @param {number} ax\r\n * @param {number} ay\r\n * @param {number} bx\r\n * @param {number} by\r\n */\r\nfunction sqDist(ax, ay, bx, by) {\r\n  var dx = ax - bx;\r\n  var dy = ay - by;\r\n  return dx * dx + dy * dy;\r\n}\r\n\r\nvar defaultOptions$2 = {\r\n  minZoom: 0,\r\n  // min zoom to generate clusters on\r\n  maxZoom: 16,\r\n  // max zoom level to cluster the points on\r\n  minPoints: 2,\r\n  // minimum points to form a cluster\r\n  radius: 40,\r\n  // cluster radius in pixels\r\n  extent: 512,\r\n  // tile extent (radius is calculated relative to it)\r\n  nodeSize: 64,\r\n  // size of the KD-tree leaf node, affects performance\r\n  log: false,\r\n  // whether to log timing info\r\n\r\n  // whether to generate numeric ids for input features (in vector tiles)\r\n  generateId: false,\r\n  // a reduce function for calculating custom cluster properties\r\n  reduce: null,\r\n  // (accumulated, props) => { accumulated.sum += props.sum; }\r\n\r\n  // properties to use for individual points when running the reducer\r\n  map: props => props // props => ({sum: props.my_value})\r\n};\r\nvar fround = Math.fround || (tmp => x => {\r\n  tmp[0] = +x;\r\n  return tmp[0];\r\n})(new Float32Array(1));\r\nvar OFFSET_ZOOM = 2;\r\nvar OFFSET_ID = 3;\r\nvar OFFSET_PARENT = 4;\r\nvar OFFSET_NUM = 5;\r\nvar OFFSET_PROP = 6;\r\nclass Supercluster {\r\n  constructor(options) {\r\n    this.options = Object.assign(Object.create(defaultOptions$2), options);\r\n    this.trees = new Array(this.options.maxZoom + 1);\r\n    this.stride = this.options.reduce ? 7 : 6;\r\n    this.clusterProps = [];\r\n  }\r\n  load(points) {\r\n    var {\r\n      log,\r\n      minZoom,\r\n      maxZoom\r\n    } = this.options;\r\n    if (log) console.time('total time');\r\n    var timerId = \"prepare \".concat(points.length, \" points\");\r\n    if (log) console.time(timerId);\r\n    this.points = points;\r\n\r\n    // generate a cluster object for each point and index input points into a KD-tree\r\n    var data = [];\r\n    for (var i = 0; i < points.length; i++) {\r\n      var p = points[i];\r\n      if (!p.geometry) continue;\r\n      var [lng, lat] = p.geometry.coordinates;\r\n      var x = fround(lngX(lng));\r\n      var y = fround(latY(lat));\r\n      // store internal point/cluster data in flat numeric arrays for performance\r\n      data.push(x, y,\r\n      // projected point coordinates\r\n      Infinity,\r\n      // the last zoom the point was processed at\r\n      i,\r\n      // index of the source feature in the original input array\r\n      -1,\r\n      // parent cluster id\r\n      1 // number of points in a cluster\r\n      );\r\n      if (this.options.reduce) data.push(0); // noop\r\n    }\r\n    var tree = this.trees[maxZoom + 1] = this._createTree(data);\r\n    if (log) console.timeEnd(timerId);\r\n\r\n    // cluster points on max zoom, then cluster the results on previous zoom, etc.;\r\n    // results in a cluster hierarchy across zoom levels\r\n    for (var z = maxZoom; z >= minZoom; z--) {\r\n      var now = +Date.now();\r\n\r\n      // create a new set of clusters for the zoom and index them with a KD-tree\r\n      tree = this.trees[z] = this._createTree(this._cluster(tree, z));\r\n      if (log) console.log('z%d: %d clusters in %dms', z, tree.numItems, +Date.now() - now);\r\n    }\r\n    if (log) console.timeEnd('total time');\r\n    return this;\r\n  }\r\n  getClusters(bbox, zoom) {\r\n    var minLng = ((bbox[0] + 180) % 360 + 360) % 360 - 180;\r\n    var minLat = Math.max(-90, Math.min(90, bbox[1]));\r\n    var maxLng = bbox[2] === 180 ? 180 : ((bbox[2] + 180) % 360 + 360) % 360 - 180;\r\n    var maxLat = Math.max(-90, Math.min(90, bbox[3]));\r\n    if (bbox[2] - bbox[0] >= 360) {\r\n      minLng = -180;\r\n      maxLng = 180;\r\n    } else if (minLng > maxLng) {\r\n      var easternHem = this.getClusters([minLng, minLat, 180, maxLat], zoom);\r\n      var westernHem = this.getClusters([-180, minLat, maxLng, maxLat], zoom);\r\n      return easternHem.concat(westernHem);\r\n    }\r\n    var tree = this.trees[this._limitZoom(zoom)];\r\n    var ids = tree.range(lngX(minLng), latY(maxLat), lngX(maxLng), latY(minLat));\r\n    var data = tree.data;\r\n    var clusters = [];\r\n    for (var id of ids) {\r\n      var k = this.stride * id;\r\n      clusters.push(data[k + OFFSET_NUM] > 1 ? getClusterJSON(data, k, this.clusterProps) : this.points[data[k + OFFSET_ID]]);\r\n    }\r\n    return clusters;\r\n  }\r\n  getChildren(clusterId) {\r\n    var originId = this._getOriginId(clusterId);\r\n    var originZoom = this._getOriginZoom(clusterId);\r\n    var errorMsg = 'No cluster with the specified id.';\r\n    var tree = this.trees[originZoom];\r\n    if (!tree) throw new Error(errorMsg);\r\n    var data = tree.data;\r\n    if (originId * this.stride >= data.length) throw new Error(errorMsg);\r\n    var r = this.options.radius / (this.options.extent * Math.pow(2, originZoom - 1));\r\n    var x = data[originId * this.stride];\r\n    var y = data[originId * this.stride + 1];\r\n    var ids = tree.within(x, y, r);\r\n    var children = [];\r\n    for (var id of ids) {\r\n      var k = id * this.stride;\r\n      if (data[k + OFFSET_PARENT] === clusterId) {\r\n        children.push(data[k + OFFSET_NUM] > 1 ? getClusterJSON(data, k, this.clusterProps) : this.points[data[k + OFFSET_ID]]);\r\n      }\r\n    }\r\n    if (children.length === 0) throw new Error(errorMsg);\r\n    return children;\r\n  }\r\n  getLeaves(clusterId, limit, offset) {\r\n    limit = limit || 10;\r\n    offset = offset || 0;\r\n    var leaves = [];\r\n    this._appendLeaves(leaves, clusterId, limit, offset, 0);\r\n    return leaves;\r\n  }\r\n  getTile(z, x, y) {\r\n    var tree = this.trees[this._limitZoom(z)];\r\n    var z2 = Math.pow(2, z);\r\n    var {\r\n      extent,\r\n      radius\r\n    } = this.options;\r\n    var p = radius / extent;\r\n    var top = (y - p) / z2;\r\n    var bottom = (y + 1 + p) / z2;\r\n    var tile = {\r\n      features: []\r\n    };\r\n    this._addTileFeatures(tree.range((x - p) / z2, top, (x + 1 + p) / z2, bottom), tree.data, x, y, z2, tile);\r\n    if (x === 0) {\r\n      this._addTileFeatures(tree.range(1 - p / z2, top, 1, bottom), tree.data, z2, y, z2, tile);\r\n    }\r\n    if (x === z2 - 1) {\r\n      this._addTileFeatures(tree.range(0, top, p / z2, bottom), tree.data, -1, y, z2, tile);\r\n    }\r\n    return tile.features.length ? tile : null;\r\n  }\r\n  getClusterExpansionZoom(clusterId) {\r\n    var expansionZoom = this._getOriginZoom(clusterId) - 1;\r\n    while (expansionZoom <= this.options.maxZoom) {\r\n      var children = this.getChildren(clusterId);\r\n      expansionZoom++;\r\n      if (children.length !== 1) break;\r\n      clusterId = children[0].properties.cluster_id;\r\n    }\r\n    return expansionZoom;\r\n  }\r\n  _appendLeaves(result, clusterId, limit, offset, skipped) {\r\n    var children = this.getChildren(clusterId);\r\n    for (var child of children) {\r\n      var props = child.properties;\r\n      if (props && props.cluster) {\r\n        if (skipped + props.point_count <= offset) {\r\n          // skip the whole cluster\r\n          skipped += props.point_count;\r\n        } else {\r\n          // enter the cluster\r\n          skipped = this._appendLeaves(result, props.cluster_id, limit, offset, skipped);\r\n          // exit the cluster\r\n        }\r\n      } else if (skipped < offset) {\r\n        // skip a single point\r\n        skipped++;\r\n      } else {\r\n        // add a single point\r\n        result.push(child);\r\n      }\r\n      if (result.length === limit) break;\r\n    }\r\n    return skipped;\r\n  }\r\n  _createTree(data) {\r\n    var tree = new KDBush(data.length / this.stride | 0, this.options.nodeSize, Float32Array);\r\n    for (var i = 0; i < data.length; i += this.stride) tree.add(data[i], data[i + 1]);\r\n    tree.finish();\r\n    tree.data = data;\r\n    return tree;\r\n  }\r\n  _addTileFeatures(ids, data, x, y, z2, tile) {\r\n    for (var i of ids) {\r\n      var k = i * this.stride;\r\n      var isCluster = data[k + OFFSET_NUM] > 1;\r\n      var tags = void 0,\r\n        px = void 0,\r\n        py = void 0;\r\n      if (isCluster) {\r\n        tags = getClusterProperties(data, k, this.clusterProps);\r\n        px = data[k];\r\n        py = data[k + 1];\r\n      } else {\r\n        var p = this.points[data[k + OFFSET_ID]];\r\n        tags = p.properties;\r\n        var [lng, lat] = p.geometry.coordinates;\r\n        px = lngX(lng);\r\n        py = latY(lat);\r\n      }\r\n      var f = {\r\n        type: 1,\r\n        geometry: [[Math.round(this.options.extent * (px * z2 - x)), Math.round(this.options.extent * (py * z2 - y))]],\r\n        tags\r\n      };\r\n\r\n      // assign id\r\n      var id = void 0;\r\n      if (isCluster || this.options.generateId) {\r\n        // optionally generate id for points\r\n        id = data[k + OFFSET_ID];\r\n      } else {\r\n        // keep id if already assigned\r\n        id = this.points[data[k + OFFSET_ID]].id;\r\n      }\r\n      if (id !== undefined) f.id = id;\r\n      tile.features.push(f);\r\n    }\r\n  }\r\n  _limitZoom(z) {\r\n    return Math.max(this.options.minZoom, Math.min(Math.floor(+z), this.options.maxZoom + 1));\r\n  }\r\n  _cluster(tree, zoom) {\r\n    var {\r\n      radius,\r\n      extent,\r\n      reduce,\r\n      minPoints\r\n    } = this.options;\r\n    var r = radius / (extent * Math.pow(2, zoom));\r\n    var data = tree.data;\r\n    var nextData = [];\r\n    var stride = this.stride;\r\n\r\n    // loop through each point\r\n    for (var i = 0; i < data.length; i += stride) {\r\n      // if we've already visited the point at this zoom level, skip it\r\n      if (data[i + OFFSET_ZOOM] <= zoom) continue;\r\n      data[i + OFFSET_ZOOM] = zoom;\r\n\r\n      // find all nearby points\r\n      var x = data[i];\r\n      var y = data[i + 1];\r\n      var neighborIds = tree.within(data[i], data[i + 1], r);\r\n      var numPointsOrigin = data[i + OFFSET_NUM];\r\n      var numPoints = numPointsOrigin;\r\n\r\n      // count the number of points in a potential cluster\r\n      for (var neighborId of neighborIds) {\r\n        var k = neighborId * stride;\r\n        // filter out neighbors that are already processed\r\n        if (data[k + OFFSET_ZOOM] > zoom) numPoints += data[k + OFFSET_NUM];\r\n      }\r\n\r\n      // if there were neighbors to merge, and there are enough points to form a cluster\r\n      if (numPoints > numPointsOrigin && numPoints >= minPoints) {\r\n        var wx = x * numPointsOrigin;\r\n        var wy = y * numPointsOrigin;\r\n        var clusterProperties = void 0;\r\n        var clusterPropIndex = -1;\r\n\r\n        // encode both zoom and point index on which the cluster originated -- offset by total length of features\r\n        var id = ((i / stride | 0) << 5) + (zoom + 1) + this.points.length;\r\n        for (var _neighborId of neighborIds) {\r\n          var _k = _neighborId * stride;\r\n          if (data[_k + OFFSET_ZOOM] <= zoom) continue;\r\n          data[_k + OFFSET_ZOOM] = zoom; // save the zoom (so it doesn't get processed twice)\r\n\r\n          var numPoints2 = data[_k + OFFSET_NUM];\r\n          wx += data[_k] * numPoints2; // accumulate coordinates for calculating weighted center\r\n          wy += data[_k + 1] * numPoints2;\r\n          data[_k + OFFSET_PARENT] = id;\r\n          if (reduce) {\r\n            if (!clusterProperties) {\r\n              clusterProperties = this._map(data, i, true);\r\n              clusterPropIndex = this.clusterProps.length;\r\n              this.clusterProps.push(clusterProperties);\r\n            }\r\n            reduce(clusterProperties, this._map(data, _k));\r\n          }\r\n        }\r\n        data[i + OFFSET_PARENT] = id;\r\n        nextData.push(wx / numPoints, wy / numPoints, Infinity, id, -1, numPoints);\r\n        if (reduce) nextData.push(clusterPropIndex);\r\n      } else {\r\n        // left points as unclustered\r\n        for (var j = 0; j < stride; j++) nextData.push(data[i + j]);\r\n        if (numPoints > 1) {\r\n          for (var _neighborId2 of neighborIds) {\r\n            var _k2 = _neighborId2 * stride;\r\n            if (data[_k2 + OFFSET_ZOOM] <= zoom) continue;\r\n            data[_k2 + OFFSET_ZOOM] = zoom;\r\n            for (var _j = 0; _j < stride; _j++) nextData.push(data[_k2 + _j]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return nextData;\r\n  }\r\n\r\n  // get index of the point from which the cluster originated\r\n  _getOriginId(clusterId) {\r\n    return clusterId - this.points.length >> 5;\r\n  }\r\n\r\n  // get zoom of the point from which the cluster originated\r\n  _getOriginZoom(clusterId) {\r\n    return (clusterId - this.points.length) % 32;\r\n  }\r\n  _map(data, i, clone) {\r\n    if (data[i + OFFSET_NUM] > 1) {\r\n      var props = this.clusterProps[data[i + OFFSET_PROP]];\r\n      return clone ? Object.assign({}, props) : props;\r\n    }\r\n    var original = this.points[data[i + OFFSET_ID]].properties;\r\n    var result = this.options.map(original);\r\n    return clone && result === original ? Object.assign({}, result) : result;\r\n  }\r\n}\r\nfunction getClusterJSON(data, i, clusterProps) {\r\n  return {\r\n    type: 'Feature',\r\n    id: data[i + OFFSET_ID],\r\n    properties: getClusterProperties(data, i, clusterProps),\r\n    geometry: {\r\n      type: 'Point',\r\n      coordinates: [xLng(data[i]), yLat(data[i + 1])]\r\n    }\r\n  };\r\n}\r\nfunction getClusterProperties(data, i, clusterProps) {\r\n  var count = data[i + OFFSET_NUM];\r\n  var abbrev = count >= 10000 ? \"\".concat(Math.round(count / 1000), \"k\") : count >= 1000 ? \"\".concat(Math.round(count / 100) / 10, \"k\") : count;\r\n  var propIndex = data[i + OFFSET_PROP];\r\n  var properties = propIndex === -1 ? {} : Object.assign({}, clusterProps[propIndex]);\r\n  return Object.assign(properties, {\r\n    cluster: true,\r\n    cluster_id: data[i + OFFSET_ID],\r\n    point_count: count,\r\n    point_count_abbreviated: abbrev\r\n  });\r\n}\r\n\r\n// longitude/latitude to spherical mercator in [0..1] range\r\nfunction lngX(lng) {\r\n  return lng / 360 + 0.5;\r\n}\r\nfunction latY(lat) {\r\n  var sin = Math.sin(lat * Math.PI / 180);\r\n  var y = 0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI;\r\n  return y < 0 ? 0 : y > 1 ? 1 : y;\r\n}\r\n\r\n// spherical mercator to longitude/latitude\r\nfunction xLng(x) {\r\n  return (x - 0.5) * 360;\r\n}\r\nfunction yLat(y) {\r\n  var y2 = (180 - y * 360) * Math.PI / 180;\r\n  return 360 * Math.atan(Math.exp(y2)) / Math.PI - 90;\r\n}\r\n\r\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n  var t = {};\r\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\r\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\r\n  }\r\n  return t;\r\n}\r\n\r\n/**\r\n * Copyright 2023 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * util class that creates a common set of convenience functions to wrap\r\n * shared behavior of Advanced Markers and Markers.\r\n */\r\nclass MarkerUtils {\r\n  static isAdvancedMarkerAvailable(map) {\r\n    return google.maps.marker && map.getMapCapabilities().isAdvancedMarkersAvailable === true;\r\n  }\r\n  static isAdvancedMarker(marker) {\r\n    return google.maps.marker && marker instanceof google.maps.marker.AdvancedMarkerElement;\r\n  }\r\n  static setMap(marker, map) {\r\n    if (this.isAdvancedMarker(marker)) {\r\n      marker.map = map;\r\n    } else {\r\n      marker.setMap(map);\r\n    }\r\n  }\r\n  static getPosition(marker) {\r\n    // SuperClusterAlgorithm.calculate expects a LatLng instance so we fake it for Adv Markers\r\n    if (this.isAdvancedMarker(marker)) {\r\n      if (marker.position) {\r\n        if (marker.position instanceof google.maps.LatLng) {\r\n          return marker.position;\r\n        }\r\n        // since we can't cast to LatLngLiteral for reasons =(\r\n        if (marker.position.lat && marker.position.lng) {\r\n          return new google.maps.LatLng(marker.position.lat, marker.position.lng);\r\n        }\r\n      }\r\n      return new google.maps.LatLng(null);\r\n    }\r\n    return marker.getPosition();\r\n  }\r\n  static getVisible(marker) {\r\n    if (this.isAdvancedMarker(marker)) {\r\n      /**\r\n       * Always return true for Advanced Markers because the clusterer\r\n       * uses getVisible as a way to count legacy markers not as an actual\r\n       * indicator of visibility for some reason. Even when markers are hidden\r\n       * Marker.getVisible returns `true` and this is used to set the marker count\r\n       * on the cluster. See the behavior of Cluster.count\r\n       */\r\n      return true;\r\n    }\r\n    return marker.getVisible();\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Cluster {\r\n  constructor(_ref) {\r\n    var {\r\n      markers,\r\n      position\r\n    } = _ref;\r\n    this.markers = markers;\r\n    if (position) {\r\n      if (position instanceof google.maps.LatLng) {\r\n        this._position = position;\r\n      } else {\r\n        this._position = new google.maps.LatLng(position);\r\n      }\r\n    }\r\n  }\r\n  get bounds() {\r\n    if (this.markers.length === 0 && !this._position) {\r\n      return;\r\n    }\r\n    var bounds = new google.maps.LatLngBounds(this._position, this._position);\r\n    for (var marker of this.markers) {\r\n      bounds.extend(MarkerUtils.getPosition(marker));\r\n    }\r\n    return bounds;\r\n  }\r\n  get position() {\r\n    return this._position || this.bounds.getCenter();\r\n  }\r\n  /**\r\n   * Get the count of **visible** markers.\r\n   */\r\n  get count() {\r\n    return this.markers.filter(m => MarkerUtils.getVisible(m)).length;\r\n  }\r\n  /**\r\n   * Add a marker to the cluster.\r\n   */\r\n  push(marker) {\r\n    this.markers.push(marker);\r\n  }\r\n  /**\r\n   * Cleanup references and remove marker from map.\r\n   */\r\n  delete() {\r\n    if (this.marker) {\r\n      MarkerUtils.setMap(this.marker, null);\r\n      this.marker = undefined;\r\n    }\r\n    this.markers.length = 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the markers visible in a padded map viewport\r\n *\r\n * @param map\r\n * @param mapCanvasProjection\r\n * @param markers The list of marker to filter\r\n * @param viewportPaddingPixels The padding in pixel\r\n * @returns The list of markers in the padded viewport\r\n */\r\nvar filterMarkersToPaddedViewport = (map, mapCanvasProjection, markers, viewportPaddingPixels) => {\r\n  var extendedMapBounds = extendBoundsToPaddedViewport(map.getBounds(), mapCanvasProjection, viewportPaddingPixels);\r\n  return markers.filter(marker => extendedMapBounds.contains(MarkerUtils.getPosition(marker)));\r\n};\r\n/**\r\n * Extends a bounds by a number of pixels in each direction\r\n */\r\nvar extendBoundsToPaddedViewport = (bounds, projection, numPixels) => {\r\n  var {\r\n    northEast,\r\n    southWest\r\n  } = latLngBoundsToPixelBounds(bounds, projection);\r\n  var extendedPixelBounds = extendPixelBounds({\r\n    northEast,\r\n    southWest\r\n  }, numPixels);\r\n  return pixelBoundsToLatLngBounds(extendedPixelBounds, projection);\r\n};\r\n/**\r\n * Gets the extended bounds as a bbox [westLng, southLat, eastLng, northLat]\r\n */\r\nvar getPaddedViewport = (bounds, projection, pixels) => {\r\n  var extended = extendBoundsToPaddedViewport(bounds, projection, pixels);\r\n  var ne = extended.getNorthEast();\r\n  var sw = extended.getSouthWest();\r\n  return [sw.lng(), sw.lat(), ne.lng(), ne.lat()];\r\n};\r\n/**\r\n * Returns the distance between 2 positions.\r\n *\r\n * @hidden\r\n */\r\nvar distanceBetweenPoints = (p1, p2) => {\r\n  var R = 6371; // Radius of the Earth in km\r\n  var dLat = (p2.lat - p1.lat) * Math.PI / 180;\r\n  var dLon = (p2.lng - p1.lng) * Math.PI / 180;\r\n  var sinDLat = Math.sin(dLat / 2);\r\n  var sinDLon = Math.sin(dLon / 2);\r\n  var a = sinDLat * sinDLat + Math.cos(p1.lat * Math.PI / 180) * Math.cos(p2.lat * Math.PI / 180) * sinDLon * sinDLon;\r\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;\r\n};\r\n/**\r\n * Converts a LatLng bound to pixels.\r\n *\r\n * @hidden\r\n */\r\nvar latLngBoundsToPixelBounds = (bounds, projection) => {\r\n  return {\r\n    northEast: projection.fromLatLngToDivPixel(bounds.getNorthEast()),\r\n    southWest: projection.fromLatLngToDivPixel(bounds.getSouthWest())\r\n  };\r\n};\r\n/**\r\n * Extends a pixel bounds by numPixels in all directions.\r\n *\r\n * @hidden\r\n */\r\nvar extendPixelBounds = (_ref2, numPixels) => {\r\n  var {\r\n    northEast,\r\n    southWest\r\n  } = _ref2;\r\n  northEast.x += numPixels;\r\n  northEast.y -= numPixels;\r\n  southWest.x -= numPixels;\r\n  southWest.y += numPixels;\r\n  return {\r\n    northEast,\r\n    southWest\r\n  };\r\n};\r\n/**\r\n * @hidden\r\n */\r\nvar pixelBoundsToLatLngBounds = (_ref3, projection) => {\r\n  var {\r\n    northEast,\r\n    southWest\r\n  } = _ref3;\r\n  var sw = projection.fromDivPixelToLatLng(southWest);\r\n  var ne = projection.fromDivPixelToLatLng(northEast);\r\n  return new google.maps.LatLngBounds(sw, ne);\r\n};\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @hidden\r\n */\r\nclass AbstractAlgorithm {\r\n  constructor(_ref4) {\r\n    var {\r\n      maxZoom = 16\r\n    } = _ref4;\r\n    this.maxZoom = maxZoom;\r\n  }\r\n  /**\r\n   * Helper function to bypass clustering based upon some map state such as\r\n   * zoom, number of markers, etc.\r\n   *\r\n   * ```typescript\r\n   *  cluster({markers, map}: AlgorithmInput): Cluster[] {\r\n   *    if (shouldBypassClustering(map)) {\r\n   *      return this.noop({markers})\r\n   *    }\r\n   * }\r\n   * ```\r\n   */\r\n  noop(_ref5) {\r\n    var {\r\n      markers\r\n    } = _ref5;\r\n    return noop$1(markers);\r\n  }\r\n}\r\n/**\r\n * Abstract viewport algorithm proves a class to filter markers by a padded\r\n * viewport. This is a common optimization.\r\n *\r\n * @hidden\r\n */\r\nclass AbstractViewportAlgorithm extends AbstractAlgorithm {\r\n  constructor(_a) {\r\n    var {\r\n        viewportPadding = 60\r\n      } = _a,\r\n      options = __rest(_a, [\"viewportPadding\"]);\r\n    super(options);\r\n    this.viewportPadding = 60;\r\n    this.viewportPadding = viewportPadding;\r\n  }\r\n  calculate(_ref6) {\r\n    var {\r\n      markers,\r\n      map,\r\n      mapCanvasProjection\r\n    } = _ref6;\r\n    if (map.getZoom() >= this.maxZoom) {\r\n      return {\r\n        clusters: this.noop({\r\n          markers\r\n        }),\r\n        changed: false\r\n      };\r\n    }\r\n    return {\r\n      clusters: this.cluster({\r\n        markers: filterMarkersToPaddedViewport(map, mapCanvasProjection, markers, this.viewportPadding),\r\n        map,\r\n        mapCanvasProjection\r\n      })\r\n    };\r\n  }\r\n}\r\n/**\r\n * @hidden\r\n */\r\nvar noop$1 = markers => {\r\n  var clusters = markers.map(marker => new Cluster({\r\n    position: MarkerUtils.getPosition(marker),\r\n    markers: [marker]\r\n  }));\r\n  return clusters;\r\n};\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The default Grid algorithm historically used in Google Maps marker\r\n * clustering.\r\n *\r\n * The Grid algorithm does not implement caching and markers may flash as the\r\n * viewport changes. Instead use {@link SuperClusterAlgorithm}.\r\n */\r\nclass GridAlgorithm extends AbstractViewportAlgorithm {\r\n  constructor(_a) {\r\n    var {\r\n        maxDistance = 40000,\r\n        gridSize = 40\r\n      } = _a,\r\n      options = __rest(_a, [\"maxDistance\", \"gridSize\"]);\r\n    super(options);\r\n    this.clusters = [];\r\n    this.state = {\r\n      zoom: -1\r\n    };\r\n    this.maxDistance = maxDistance;\r\n    this.gridSize = gridSize;\r\n  }\r\n  calculate(_ref7) {\r\n    var {\r\n      markers,\r\n      map,\r\n      mapCanvasProjection\r\n    } = _ref7;\r\n    var state = {\r\n      zoom: map.getZoom()\r\n    };\r\n    var changed = false;\r\n    if (this.state.zoom >= this.maxZoom && state.zoom >= this.maxZoom) ;else {\r\n      changed = !equal(this.state, state);\r\n    }\r\n    this.state = state;\r\n    if (map.getZoom() >= this.maxZoom) {\r\n      return {\r\n        clusters: this.noop({\r\n          markers\r\n        }),\r\n        changed\r\n      };\r\n    }\r\n    return {\r\n      clusters: this.cluster({\r\n        markers: filterMarkersToPaddedViewport(map, mapCanvasProjection, markers, this.viewportPadding),\r\n        map,\r\n        mapCanvasProjection\r\n      })\r\n    };\r\n  }\r\n  cluster(_ref8) {\r\n    var {\r\n      markers,\r\n      map,\r\n      mapCanvasProjection\r\n    } = _ref8;\r\n    this.clusters = [];\r\n    markers.forEach(marker => {\r\n      this.addToClosestCluster(marker, map, mapCanvasProjection);\r\n    });\r\n    return this.clusters;\r\n  }\r\n  addToClosestCluster(marker, map, projection) {\r\n    var maxDistance = this.maxDistance; // Some large number\r\n    var cluster = null;\r\n    for (var i = 0; i < this.clusters.length; i++) {\r\n      var candidate = this.clusters[i];\r\n      var distance = distanceBetweenPoints(candidate.bounds.getCenter().toJSON(), MarkerUtils.getPosition(marker).toJSON());\r\n      if (distance < maxDistance) {\r\n        maxDistance = distance;\r\n        cluster = candidate;\r\n      }\r\n    }\r\n    if (cluster && extendBoundsToPaddedViewport(cluster.bounds, projection, this.gridSize).contains(MarkerUtils.getPosition(marker))) {\r\n      cluster.push(marker);\r\n    } else {\r\n      var _cluster = new Cluster({\r\n        markers: [marker]\r\n      });\r\n      this.clusters.push(_cluster);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Noop algorithm does not generate any clusters or filter markers by the an extended viewport.\r\n */\r\nclass NoopAlgorithm extends AbstractAlgorithm {\r\n  constructor(_a) {\r\n    var options = __rest(_a, []);\r\n    super(options);\r\n  }\r\n  calculate(_ref9) {\r\n    var {\r\n      markers,\r\n      map,\r\n      mapCanvasProjection\r\n    } = _ref9;\r\n    return {\r\n      clusters: this.cluster({\r\n        markers,\r\n        map,\r\n        mapCanvasProjection\r\n      }),\r\n      changed: false\r\n    };\r\n  }\r\n  cluster(input) {\r\n    return this.noop(input);\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A very fast JavaScript algorithm for geospatial point clustering using KD trees.\r\n *\r\n * @see https://www.npmjs.com/package/supercluster for more information on options.\r\n */\r\nclass SuperClusterAlgorithm extends AbstractAlgorithm {\r\n  constructor(_a) {\r\n    var {\r\n        maxZoom,\r\n        radius = 60\r\n      } = _a,\r\n      options = __rest(_a, [\"maxZoom\", \"radius\"]);\r\n    super({\r\n      maxZoom\r\n    });\r\n    this.state = {\r\n      zoom: -1\r\n    };\r\n    this.superCluster = new Supercluster(Object.assign({\r\n      maxZoom: this.maxZoom,\r\n      radius\r\n    }, options));\r\n  }\r\n  calculate(input) {\r\n    var changed = false;\r\n    var state = {\r\n      zoom: input.map.getZoom()\r\n    };\r\n    if (!equal(input.markers, this.markers)) {\r\n      changed = true;\r\n      // TODO use proxy to avoid copy?\r\n      this.markers = [...input.markers];\r\n      var points = this.markers.map(marker => {\r\n        var position = MarkerUtils.getPosition(marker);\r\n        var coordinates = [position.lng(), position.lat()];\r\n        return {\r\n          type: \"Feature\",\r\n          geometry: {\r\n            type: \"Point\",\r\n            coordinates\r\n          },\r\n          properties: {\r\n            marker\r\n          }\r\n        };\r\n      });\r\n      this.superCluster.load(points);\r\n    }\r\n    if (!changed) {\r\n      if (this.state.zoom <= this.maxZoom || state.zoom <= this.maxZoom) {\r\n        changed = !equal(this.state, state);\r\n      }\r\n    }\r\n    this.state = state;\r\n    if (changed) {\r\n      this.clusters = this.cluster(input);\r\n    }\r\n    return {\r\n      clusters: this.clusters,\r\n      changed\r\n    };\r\n  }\r\n  cluster(_ref10) {\r\n    var {\r\n      map\r\n    } = _ref10;\r\n    return this.superCluster.getClusters([-180, -90, 180, 90], Math.round(map.getZoom())).map(feature => this.transformCluster(feature));\r\n  }\r\n  transformCluster(_ref11) {\r\n    var {\r\n      geometry: {\r\n        coordinates: [lng, lat]\r\n      },\r\n      properties\r\n    } = _ref11;\r\n    if (properties.cluster) {\r\n      return new Cluster({\r\n        markers: this.superCluster.getLeaves(properties.cluster_id, Infinity).map(leaf => leaf.properties.marker),\r\n        position: {\r\n          lat,\r\n          lng\r\n        }\r\n      });\r\n    }\r\n    var marker = properties.marker;\r\n    return new Cluster({\r\n      markers: [marker],\r\n      position: MarkerUtils.getPosition(marker)\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A very fast JavaScript algorithm for geospatial point clustering using KD trees.\r\n *\r\n * @see https://www.npmjs.com/package/supercluster for more information on options.\r\n */\r\nclass SuperClusterViewportAlgorithm extends AbstractViewportAlgorithm {\r\n  constructor(_a) {\r\n    var {\r\n        maxZoom,\r\n        radius = 60,\r\n        viewportPadding = 60\r\n      } = _a,\r\n      options = __rest(_a, [\"maxZoom\", \"radius\", \"viewportPadding\"]);\r\n    super({\r\n      maxZoom,\r\n      viewportPadding\r\n    });\r\n    this.superCluster = new Supercluster(Object.assign({\r\n      maxZoom: this.maxZoom,\r\n      radius\r\n    }, options));\r\n    this.state = {\r\n      zoom: -1,\r\n      view: [0, 0, 0, 0]\r\n    };\r\n  }\r\n  calculate(input) {\r\n    var state = {\r\n      zoom: Math.round(input.map.getZoom()),\r\n      view: getPaddedViewport(input.map.getBounds(), input.mapCanvasProjection, this.viewportPadding)\r\n    };\r\n    var changed = !equal(this.state, state);\r\n    if (!equal(input.markers, this.markers)) {\r\n      changed = true;\r\n      // TODO use proxy to avoid copy?\r\n      this.markers = [...input.markers];\r\n      var points = this.markers.map(marker => {\r\n        var position = MarkerUtils.getPosition(marker);\r\n        var coordinates = [position.lng(), position.lat()];\r\n        return {\r\n          type: \"Feature\",\r\n          geometry: {\r\n            type: \"Point\",\r\n            coordinates\r\n          },\r\n          properties: {\r\n            marker\r\n          }\r\n        };\r\n      });\r\n      this.superCluster.load(points);\r\n    }\r\n    if (changed) {\r\n      this.clusters = this.cluster(input);\r\n      this.state = state;\r\n    }\r\n    return {\r\n      clusters: this.clusters,\r\n      changed\r\n    };\r\n  }\r\n  cluster(_ref12) {\r\n    var {\r\n      map,\r\n      mapCanvasProjection\r\n    } = _ref12;\r\n    /* recalculate new state because we can't use the cached version. */\r\n    var state = {\r\n      zoom: Math.round(map.getZoom()),\r\n      view: getPaddedViewport(map.getBounds(), mapCanvasProjection, this.viewportPadding)\r\n    };\r\n    return this.superCluster.getClusters(state.view, state.zoom).map(feature => this.transformCluster(feature));\r\n  }\r\n  transformCluster(_ref13) {\r\n    var {\r\n      geometry: {\r\n        coordinates: [lng, lat]\r\n      },\r\n      properties\r\n    } = _ref13;\r\n    if (properties.cluster) {\r\n      return new Cluster({\r\n        markers: this.superCluster.getLeaves(properties.cluster_id, Infinity).map(leaf => leaf.properties.marker),\r\n        position: {\r\n          lat,\r\n          lng\r\n        }\r\n      });\r\n    }\r\n    var marker = properties.marker;\r\n    return new Cluster({\r\n      markers: [marker],\r\n      position: MarkerUtils.getPosition(marker)\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provides statistics on all clusters in the current render cycle for use in {@link Renderer.render}.\r\n */\r\nclass ClusterStats {\r\n  constructor(markers, clusters) {\r\n    this.markers = {\r\n      sum: markers.length\r\n    };\r\n    var clusterMarkerCounts = clusters.map(a => a.count);\r\n    var clusterMarkerSum = clusterMarkerCounts.reduce((a, b) => a + b, 0);\r\n    this.clusters = {\r\n      count: clusters.length,\r\n      markers: {\r\n        mean: clusterMarkerSum / clusters.length,\r\n        sum: clusterMarkerSum,\r\n        min: Math.min(...clusterMarkerCounts),\r\n        max: Math.max(...clusterMarkerCounts)\r\n      }\r\n    };\r\n  }\r\n}\r\nclass DefaultRenderer {\r\n  /**\r\n   * The default render function for the library used by {@link MarkerClusterer}.\r\n   *\r\n   * Currently set to use the following:\r\n   *\r\n   * ```typescript\r\n   * // change color if this cluster has more markers than the mean cluster\r\n   * const color =\r\n   *   count > Math.max(10, stats.clusters.markers.mean)\r\n   *     ? \"#ff0000\"\r\n   *     : \"#0000ff\";\r\n   *\r\n   * // create svg url with fill color\r\n   * const svg = window.btoa(`\r\n   * <svg fill=\"${color}\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 240 240\">\r\n   *   <circle cx=\"120\" cy=\"120\" opacity=\".6\" r=\"70\" />\r\n   *   <circle cx=\"120\" cy=\"120\" opacity=\".3\" r=\"90\" />\r\n   *   <circle cx=\"120\" cy=\"120\" opacity=\".2\" r=\"110\" />\r\n   *   <circle cx=\"120\" cy=\"120\" opacity=\".1\" r=\"130\" />\r\n   * </svg>`);\r\n   *\r\n   * // create marker using svg icon\r\n   * return new google.maps.Marker({\r\n   *   position,\r\n   *   icon: {\r\n   *     url: `data:image/svg+xml;base64,${svg}`,\r\n   *     scaledSize: new google.maps.Size(45, 45),\r\n   *   },\r\n   *   label: {\r\n   *     text: String(count),\r\n   *     color: \"rgba(255,255,255,0.9)\",\r\n   *     fontSize: \"12px\",\r\n   *   },\r\n   *   // adjust zIndex to be above other markers\r\n   *   zIndex: 1000 + count,\r\n   * });\r\n   * ```\r\n   */\r\n  render(_ref14, stats, map) {\r\n    var {\r\n      count,\r\n      position\r\n    } = _ref14;\r\n    // change color if this cluster has more markers than the mean cluster\r\n    var color = count > Math.max(10, stats.clusters.markers.mean) ? \"#ff0000\" : \"#0000ff\";\r\n    // create svg literal with fill color\r\n    var svg = \"<svg fill=\\\"\".concat(color, \"\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 240 240\\\" width=\\\"50\\\" height=\\\"50\\\">\\n<circle cx=\\\"120\\\" cy=\\\"120\\\" opacity=\\\".6\\\" r=\\\"70\\\" />\\n<circle cx=\\\"120\\\" cy=\\\"120\\\" opacity=\\\".3\\\" r=\\\"90\\\" />\\n<circle cx=\\\"120\\\" cy=\\\"120\\\" opacity=\\\".2\\\" r=\\\"110\\\" />\\n<text x=\\\"50%\\\" y=\\\"50%\\\" style=\\\"fill:#fff\\\" text-anchor=\\\"middle\\\" font-size=\\\"50\\\" dominant-baseline=\\\"middle\\\" font-family=\\\"roboto,arial,sans-serif\\\">\").concat(count, \"</text>\\n</svg>\");\r\n    var title = \"Cluster of \".concat(count, \" markers\"),\r\n      // adjust zIndex to be above other markers\r\n      zIndex = Number(google.maps.Marker.MAX_ZINDEX) + count;\r\n    if (MarkerUtils.isAdvancedMarkerAvailable(map)) {\r\n      // create cluster SVG element\r\n      var parser = new DOMParser();\r\n      var svgEl = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\r\n      svgEl.setAttribute(\"transform\", \"translate(0 25)\");\r\n      var _clusterOptions = {\r\n        map,\r\n        position,\r\n        zIndex,\r\n        title,\r\n        content: svgEl\r\n      };\r\n      return new google.maps.marker.AdvancedMarkerElement(_clusterOptions);\r\n    }\r\n    var clusterOptions = {\r\n      position,\r\n      zIndex,\r\n      title,\r\n      icon: {\r\n        url: \"data:image/svg+xml;base64,\".concat(btoa(svg)),\r\n        anchor: new google.maps.Point(25, 25)\r\n      }\r\n    };\r\n    return new google.maps.Marker(clusterOptions);\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2019 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Extends an object's prototype by another's.\r\n *\r\n * @param type1 The Type to be extended.\r\n * @param type2 The Type to extend with.\r\n * @ignore\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction extend(type1, type2) {\r\n  /* istanbul ignore next */\r\n  // eslint-disable-next-line prefer-const\r\n  for (var property in type2.prototype) {\r\n    type1.prototype[property] = type2.prototype[property];\r\n  }\r\n}\r\n/**\r\n * @ignore\r\n */\r\nclass OverlayViewSafe {\r\n  constructor() {\r\n    // MarkerClusterer implements google.maps.OverlayView interface. We use the\r\n    // extend function to extend MarkerClusterer with google.maps.OverlayView\r\n    // because it might not always be available when the code is defined so we\r\n    // look for it at the last possible moment. If it doesn't exist now then\r\n    // there is no point going ahead :)\r\n    extend(OverlayViewSafe, google.maps.OverlayView);\r\n  }\r\n}\r\n\r\n/**\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MarkerClustererEvents;\r\n(function (MarkerClustererEvents) {\r\n  MarkerClustererEvents[\"CLUSTERING_BEGIN\"] = \"clusteringbegin\";\r\n  MarkerClustererEvents[\"CLUSTERING_END\"] = \"clusteringend\";\r\n  MarkerClustererEvents[\"CLUSTER_CLICK\"] = \"click\";\r\n})(MarkerClustererEvents || (MarkerClustererEvents = {}));\r\nvar defaultOnClusterClickHandler = (_, cluster, map) => {\r\n  map.fitBounds(cluster.bounds);\r\n};\r\n/**\r\n * MarkerClusterer creates and manages per-zoom-level clusters for large amounts\r\n * of markers. See {@link MarkerClustererOptions} for more details.\r\n *\r\n */\r\nclass MarkerClusterer extends OverlayViewSafe {\r\n  constructor(_ref15) {\r\n    var {\r\n      map,\r\n      markers = [],\r\n      algorithmOptions = {},\r\n      algorithm = new SuperClusterAlgorithm(algorithmOptions),\r\n      renderer = new DefaultRenderer(),\r\n      onClusterClick = defaultOnClusterClickHandler\r\n    } = _ref15;\r\n    super();\r\n    this.markers = [...markers];\r\n    this.clusters = [];\r\n    this.algorithm = algorithm;\r\n    this.renderer = renderer;\r\n    this.onClusterClick = onClusterClick;\r\n    if (map) {\r\n      this.setMap(map);\r\n    }\r\n  }\r\n  addMarker(marker, noDraw) {\r\n    if (this.markers.includes(marker)) {\r\n      return;\r\n    }\r\n    this.markers.push(marker);\r\n    if (!noDraw) {\r\n      this.render();\r\n    }\r\n  }\r\n  addMarkers(markers, noDraw) {\r\n    markers.forEach(marker => {\r\n      this.addMarker(marker, true);\r\n    });\r\n    if (!noDraw) {\r\n      this.render();\r\n    }\r\n  }\r\n  removeMarker(marker, noDraw) {\r\n    var index = this.markers.indexOf(marker);\r\n    if (index === -1) {\r\n      // Marker is not in our list of markers, so do nothing:\r\n      return false;\r\n    }\r\n    MarkerUtils.setMap(marker, null);\r\n    this.markers.splice(index, 1); // Remove the marker from the list of managed markers\r\n    if (!noDraw) {\r\n      this.render();\r\n    }\r\n    return true;\r\n  }\r\n  removeMarkers(markers, noDraw) {\r\n    var removed = false;\r\n    markers.forEach(marker => {\r\n      removed = this.removeMarker(marker, true) || removed;\r\n    });\r\n    if (removed && !noDraw) {\r\n      this.render();\r\n    }\r\n    return removed;\r\n  }\r\n  clearMarkers(noDraw) {\r\n    this.markers.length = 0;\r\n    if (!noDraw) {\r\n      this.render();\r\n    }\r\n  }\r\n  /**\r\n   * Recalculates and draws all the marker clusters.\r\n   */\r\n  render() {\r\n    var map = this.getMap();\r\n    if (map instanceof google.maps.Map && map.getProjection()) {\r\n      google.maps.event.trigger(this, MarkerClustererEvents.CLUSTERING_BEGIN, this);\r\n      var {\r\n        clusters,\r\n        changed\r\n      } = this.algorithm.calculate({\r\n        markers: this.markers,\r\n        map,\r\n        mapCanvasProjection: this.getProjection()\r\n      });\r\n      // Allow algorithms to return flag on whether the clusters/markers have changed.\r\n      if (changed || changed == undefined) {\r\n        // Accumulate the markers of the clusters composed of a single marker.\r\n        // Those clusters directly use the marker.\r\n        // Clusters with more than one markers use a group marker generated by a renderer.\r\n        var singleMarker = new Set();\r\n        for (var cluster of clusters) {\r\n          if (cluster.markers.length == 1) {\r\n            singleMarker.add(cluster.markers[0]);\r\n          }\r\n        }\r\n        var groupMarkers = [];\r\n        // Iterate the clusters that are currently rendered.\r\n        for (var _cluster2 of this.clusters) {\r\n          if (_cluster2.marker == null) {\r\n            continue;\r\n          }\r\n          if (_cluster2.markers.length == 1) {\r\n            if (!singleMarker.has(_cluster2.marker)) {\r\n              // The marker:\r\n              // - was previously rendered because it is from a cluster with 1 marker,\r\n              // - should no more be rendered as it is not in singleMarker.\r\n              MarkerUtils.setMap(_cluster2.marker, null);\r\n            }\r\n          } else {\r\n            // Delay the removal of old group markers to avoid flickering.\r\n            groupMarkers.push(_cluster2.marker);\r\n          }\r\n        }\r\n        this.clusters = clusters;\r\n        this.renderClusters();\r\n        // Delayed removal of the markers of the former groups.\r\n        requestAnimationFrame(() => groupMarkers.forEach(marker => MarkerUtils.setMap(marker, null)));\r\n      }\r\n      google.maps.event.trigger(this, MarkerClustererEvents.CLUSTERING_END, this);\r\n    }\r\n  }\r\n  onAdd() {\r\n    this.idleListener = this.getMap().addListener(\"idle\", this.render.bind(this));\r\n    this.render();\r\n  }\r\n  onRemove() {\r\n    google.maps.event.removeListener(this.idleListener);\r\n    this.reset();\r\n  }\r\n  reset() {\r\n    this.markers.forEach(marker => MarkerUtils.setMap(marker, null));\r\n    this.clusters.forEach(cluster => cluster.delete());\r\n    this.clusters = [];\r\n  }\r\n  renderClusters() {\r\n    // Generate stats to pass to renderers.\r\n    var stats = new ClusterStats(this.markers, this.clusters);\r\n    var map = this.getMap();\r\n    this.clusters.forEach(cluster => {\r\n      if (cluster.markers.length === 1) {\r\n        cluster.marker = cluster.markers[0];\r\n      } else {\r\n        // Generate the marker to represent the group.\r\n        cluster.marker = this.renderer.render(cluster, stats, map);\r\n        // Make sure all individual markers are removed from the map.\r\n        cluster.markers.forEach(marker => MarkerUtils.setMap(marker, null));\r\n        if (this.onClusterClick) {\r\n          cluster.marker.addListener(\"click\", /* istanbul ignore next */\r\n          event => {\r\n            google.maps.event.trigger(this, MarkerClustererEvents.CLUSTER_CLICK, cluster);\r\n            this.onClusterClick(event, cluster, map);\r\n          });\r\n        }\r\n      }\r\n      MarkerUtils.setMap(cluster.marker, map);\r\n    });\r\n  }\r\n}\r\n\r\nvar index_esm = /*#__PURE__*/Object.freeze({\r\n  __proto__: null,\r\n  AbstractAlgorithm: AbstractAlgorithm,\r\n  AbstractViewportAlgorithm: AbstractViewportAlgorithm,\r\n  Cluster: Cluster,\r\n  ClusterStats: ClusterStats,\r\n  DefaultRenderer: DefaultRenderer,\r\n  GridAlgorithm: GridAlgorithm,\r\n  MarkerClusterer: MarkerClusterer,\r\n  get MarkerClustererEvents () { return MarkerClustererEvents; },\r\n  MarkerUtils: MarkerUtils,\r\n  NoopAlgorithm: NoopAlgorithm,\r\n  SuperClusterAlgorithm: SuperClusterAlgorithm,\r\n  SuperClusterViewportAlgorithm: SuperClusterViewportAlgorithm,\r\n  defaultOnClusterClickHandler: defaultOnClusterClickHandler,\r\n  distanceBetweenPoints: distanceBetweenPoints,\r\n  extendBoundsToPaddedViewport: extendBoundsToPaddedViewport,\r\n  extendPixelBounds: extendPixelBounds,\r\n  filterMarkersToPaddedViewport: filterMarkersToPaddedViewport,\r\n  getPaddedViewport: getPaddedViewport,\r\n  noop: noop$1,\r\n  pixelBoundsToLatLngBounds: pixelBoundsToLatLngBounds\r\n});\r\n\r\nfunction ownKeys$a(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$a(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$a(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$a(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nfunction useGoogleMarkerClusterer(options) {\r\n  var map = useGoogleMap();\r\n  var [markerClusterer, setMarkerClusterer] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map && markerClusterer === null) {\r\n      var markerCluster = new MarkerClusterer(_objectSpread$a(_objectSpread$a({}, options), {}, {\r\n        map\r\n      }));\r\n      setMarkerClusterer(markerCluster);\r\n    }\r\n  }, [map]);\r\n  return markerClusterer;\r\n}\r\n/** Wrapper around [@googlemaps/markerclusterer](https://github.com/googlemaps/js-markerclusterer)\r\n *\r\n * Accepts {@link  MarkerClustererOptionsSubset} which is a subset of  {@link MarkerClustererOptions}\r\n */\r\nfunction GoogleMarkerClusterer(_ref) {\r\n  var {\r\n    children,\r\n    options\r\n  } = _ref;\r\n  var markerClusterer = useGoogleMarkerClusterer(options);\r\n  return markerClusterer !== null ? children(markerClusterer) : null;\r\n}\r\nvar GoogleMarkerClusterer$1 = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(GoogleMarkerClusterer);\r\n\r\nvar eventMap$c = {\r\n  onCloseClick: 'closeclick',\r\n  onContentChanged: 'content_changed',\r\n  onDomReady: 'domready',\r\n  onPositionChanged: 'position_changed',\r\n  onZindexChanged: 'zindex_changed'\r\n};\r\nvar updaterMap$c = {\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  position(instance, position) {\r\n    instance.setPosition(position);\r\n  },\r\n  zIndex(instance, zIndex) {\r\n    instance.setZIndex(zIndex);\r\n  }\r\n};\r\nfunction InfoWindowFunctional(_ref) {\r\n  var {\r\n    children,\r\n    anchor,\r\n    options,\r\n    position,\r\n    zIndex,\r\n    onCloseClick,\r\n    onDomReady,\r\n    onContentChanged,\r\n    onPositionChanged,\r\n    onZindexChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [closeclickListener, setCloseClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [domreadyclickListener, setDomReadyClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [contentchangedclickListener, setContentChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [positionchangedclickListener, setPositionChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [zindexchangedclickListener, setZindexChangedClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var containerElementRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.close();\r\n      if (anchor) {\r\n        instance.open(map, anchor);\r\n      } else if (instance.getPosition()) {\r\n        instance.open(map);\r\n      }\r\n    }\r\n  }, [map, instance, anchor]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (position && instance !== null) {\r\n      instance.setPosition(position);\r\n    }\r\n  }, [position]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof zIndex === 'number' && instance !== null) {\r\n      instance.setZIndex(zIndex);\r\n    }\r\n  }, [zIndex]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onCloseClick) {\r\n      if (closeclickListener !== null) {\r\n        google.maps.event.removeListener(closeclickListener);\r\n      }\r\n      setCloseClickListener(google.maps.event.addListener(instance, 'closeclick', onCloseClick));\r\n    }\r\n  }, [onCloseClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDomReady) {\r\n      if (domreadyclickListener !== null) {\r\n        google.maps.event.removeListener(domreadyclickListener);\r\n      }\r\n      setDomReadyClickListener(google.maps.event.addListener(instance, 'domready', onDomReady));\r\n    }\r\n  }, [onDomReady]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onContentChanged) {\r\n      if (contentchangedclickListener !== null) {\r\n        google.maps.event.removeListener(contentchangedclickListener);\r\n      }\r\n      setContentChangedClickListener(google.maps.event.addListener(instance, 'content_changed', onContentChanged));\r\n    }\r\n  }, [onContentChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onPositionChanged) {\r\n      if (positionchangedclickListener !== null) {\r\n        google.maps.event.removeListener(positionchangedclickListener);\r\n      }\r\n      setPositionChangedClickListener(google.maps.event.addListener(instance, 'position_changed', onPositionChanged));\r\n    }\r\n  }, [onPositionChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onZindexChanged) {\r\n      if (zindexchangedclickListener !== null) {\r\n        google.maps.event.removeListener(zindexchangedclickListener);\r\n      }\r\n      setZindexChangedClickListener(google.maps.event.addListener(instance, 'zindex_changed', onZindexChanged));\r\n    }\r\n  }, [onZindexChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var infoWindow = new google.maps.InfoWindow(options);\r\n    setInstance(infoWindow);\r\n    containerElementRef.current = document.createElement('div');\r\n    if (onCloseClick) {\r\n      setCloseClickListener(google.maps.event.addListener(infoWindow, 'closeclick', onCloseClick));\r\n    }\r\n    if (onDomReady) {\r\n      setDomReadyClickListener(google.maps.event.addListener(infoWindow, 'domready', onDomReady));\r\n    }\r\n    if (onContentChanged) {\r\n      setContentChangedClickListener(google.maps.event.addListener(infoWindow, 'content_changed', onContentChanged));\r\n    }\r\n    if (onPositionChanged) {\r\n      setPositionChangedClickListener(google.maps.event.addListener(infoWindow, 'position_changed', onPositionChanged));\r\n    }\r\n    if (onZindexChanged) {\r\n      setZindexChangedClickListener(google.maps.event.addListener(infoWindow, 'zindex_changed', onZindexChanged));\r\n    }\r\n    infoWindow.setContent(containerElementRef.current);\r\n    if (position) {\r\n      infoWindow.setPosition(position);\r\n    }\r\n    if (zIndex) {\r\n      infoWindow.setZIndex(zIndex);\r\n    }\r\n    if (anchor) {\r\n      infoWindow.open(map, anchor);\r\n    } else if (infoWindow.getPosition()) {\r\n      infoWindow.open(map);\r\n    } else {\r\n      invariant(false, \"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.\");\r\n    }\r\n    if (onLoad) {\r\n      onLoad(infoWindow);\r\n    }\r\n    return () => {\r\n      if (closeclickListener) {\r\n        google.maps.event.removeListener(closeclickListener);\r\n      }\r\n      if (contentchangedclickListener) {\r\n        google.maps.event.removeListener(contentchangedclickListener);\r\n      }\r\n      if (domreadyclickListener) {\r\n        google.maps.event.removeListener(domreadyclickListener);\r\n      }\r\n      if (positionchangedclickListener) {\r\n        google.maps.event.removeListener(positionchangedclickListener);\r\n      }\r\n      if (zindexchangedclickListener) {\r\n        google.maps.event.removeListener(zindexchangedclickListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(infoWindow);\r\n      }\r\n      infoWindow.close();\r\n    };\r\n  }, []);\r\n  return containerElementRef.current ? (0,react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal)(react__WEBPACK_IMPORTED_MODULE_1__.Children.only(children), containerElementRef.current) : null;\r\n}\r\nvar InfoWindowF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(InfoWindowFunctional);\r\nclass InfoWindow extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"containerElement\", null);\r\n    _defineProperty(this, \"state\", {\r\n      infoWindow: null\r\n    });\r\n    _defineProperty(this, \"open\", (infoWindow, anchor) => {\r\n      if (anchor) {\r\n        infoWindow.open(this.context, anchor);\r\n      } else if (infoWindow.getPosition()) {\r\n        infoWindow.open(this.context);\r\n      } else {\r\n        invariant(false, \"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.\");\r\n      }\r\n    });\r\n    _defineProperty(this, \"setInfoWindowCallback\", () => {\r\n      if (this.state.infoWindow !== null && this.containerElement !== null) {\r\n        this.state.infoWindow.setContent(this.containerElement);\r\n        this.open(this.state.infoWindow, this.props.anchor);\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.infoWindow);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var infoWindow = new google.maps.InfoWindow(this.props.options);\r\n    this.containerElement = document.createElement('div');\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$c,\r\n      eventMap: eventMap$c,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: infoWindow\r\n    });\r\n    this.setState(() => {\r\n      return {\r\n        infoWindow\r\n      };\r\n    }, this.setInfoWindowCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.infoWindow !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$c,\r\n        eventMap: eventMap$c,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.infoWindow\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.infoWindow !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.infoWindow);\r\n      }\r\n      this.state.infoWindow.close();\r\n    }\r\n  }\r\n  render() {\r\n    return this.containerElement ? (0,react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal)(react__WEBPACK_IMPORTED_MODULE_1__.Children.only(this.props.children), this.containerElement) : null;\r\n  }\r\n}\r\n_defineProperty(InfoWindow, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$9(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$9(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$9(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$9(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$b = {\r\n  onClick: 'click',\r\n  onDblClick: 'dblclick',\r\n  onDrag: 'drag',\r\n  onDragEnd: 'dragend',\r\n  onDragStart: 'dragstart',\r\n  onMouseDown: 'mousedown',\r\n  onMouseMove: 'mousemove',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick'\r\n};\r\nvar updaterMap$b = {\r\n  draggable(instance, draggable) {\r\n    instance.setDraggable(draggable);\r\n  },\r\n  editable(instance, editable) {\r\n    instance.setEditable(editable);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  path(instance, path) {\r\n    instance.setPath(path);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  }\r\n};\r\nvar defaultOptions$1 = {};\r\nfunction PolylineFunctional(_ref) {\r\n  var {\r\n    options,\r\n    draggable,\r\n    editable,\r\n    visible,\r\n    path,\r\n    onDblClick,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseDown,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onRightClick,\r\n    onClick,\r\n    onDrag,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof options !== 'undefined' && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof draggable !== 'undefined' && instance !== null) {\r\n      instance.setDraggable(draggable);\r\n    }\r\n  }, [instance, draggable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof editable !== 'undefined' && instance !== null) {\r\n      instance.setEditable(editable);\r\n    }\r\n  }, [instance, editable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && instance !== null) {\r\n      instance.setVisible(visible);\r\n    }\r\n  }, [instance, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof path !== 'undefined' && instance !== null) {\r\n      instance.setPath(path);\r\n    }\r\n  }, [instance, path]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragEnd) {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(instance, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragStart) {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(instance, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseMove) {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(instance, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRightClick) {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDrag) {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(instance, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var polyline = new google.maps.Polyline(_objectSpread$9(_objectSpread$9({}, options || defaultOptions$1), {}, {\r\n      map\r\n    }));\r\n    if (path) {\r\n      polyline.setPath(path);\r\n    }\r\n    if (typeof visible !== 'undefined') {\r\n      polyline.setVisible(visible);\r\n    }\r\n    if (typeof editable !== 'undefined') {\r\n      polyline.setEditable(editable);\r\n    }\r\n    if (typeof draggable !== 'undefined') {\r\n      polyline.setDraggable(draggable);\r\n    }\r\n    if (onDblClick) {\r\n      setDblclickListener(google.maps.event.addListener(polyline, 'dblclick', onDblClick));\r\n    }\r\n    if (onDragEnd) {\r\n      setDragendListener(google.maps.event.addListener(polyline, 'dragend', onDragEnd));\r\n    }\r\n    if (onDragStart) {\r\n      setDragstartListener(google.maps.event.addListener(polyline, 'dragstart', onDragStart));\r\n    }\r\n    if (onMouseDown) {\r\n      setMousedownListener(google.maps.event.addListener(polyline, 'mousedown', onMouseDown));\r\n    }\r\n    if (onMouseMove) {\r\n      setMousemoveListener(google.maps.event.addListener(polyline, 'mousemove', onMouseMove));\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(polyline, 'mouseout', onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(polyline, 'mouseover', onMouseOver));\r\n    }\r\n    if (onMouseUp) {\r\n      setMouseupListener(google.maps.event.addListener(polyline, 'mouseup', onMouseUp));\r\n    }\r\n    if (onRightClick) {\r\n      setRightclickListener(google.maps.event.addListener(polyline, 'rightclick', onRightClick));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(polyline, 'click', onClick));\r\n    }\r\n    if (onDrag) {\r\n      setDragListener(google.maps.event.addListener(polyline, 'drag', onDrag));\r\n    }\r\n    setInstance(polyline);\r\n    if (onLoad) {\r\n      onLoad(polyline);\r\n    }\r\n    return () => {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(polyline);\r\n      }\r\n      polyline.setMap(null);\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar PolylineF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(PolylineFunctional);\r\nclass Polyline extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      polyline: null\r\n    });\r\n    _defineProperty(this, \"setPolylineCallback\", () => {\r\n      if (this.state.polyline !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.polyline);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var polyline = new google.maps.Polyline(_objectSpread$9(_objectSpread$9({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$b,\r\n      eventMap: eventMap$b,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: polyline\r\n    });\r\n    this.setState(function setPolyline() {\r\n      return {\r\n        polyline\r\n      };\r\n    }, this.setPolylineCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.polyline !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$b,\r\n        eventMap: eventMap$b,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.polyline\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.polyline === null) {\r\n      return;\r\n    }\r\n    if (this.props.onUnmount) {\r\n      this.props.onUnmount(this.state.polyline);\r\n    }\r\n    unregisterEvents(this.registeredEvents);\r\n    this.state.polyline.setMap(null);\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(Polyline, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$8(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$8(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$8(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$8(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$a = {\r\n  onClick: 'click',\r\n  onDblClick: 'dblclick',\r\n  onDrag: 'drag',\r\n  onDragEnd: 'dragend',\r\n  onDragStart: 'dragstart',\r\n  onMouseDown: 'mousedown',\r\n  onMouseMove: 'mousemove',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick'\r\n};\r\nvar updaterMap$a = {\r\n  draggable(instance, draggable) {\r\n    instance.setDraggable(draggable);\r\n  },\r\n  editable(instance, editable) {\r\n    instance.setEditable(editable);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  path(instance, path) {\r\n    instance.setPath(path);\r\n  },\r\n  paths(instance, paths) {\r\n    instance.setPaths(paths);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  }\r\n};\r\nfunction PolygonFunctional(_ref) {\r\n  var {\r\n    options,\r\n    draggable,\r\n    editable,\r\n    visible,\r\n    path,\r\n    paths,\r\n    onDblClick,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseDown,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onRightClick,\r\n    onClick,\r\n    onDrag,\r\n    onLoad,\r\n    onUnmount,\r\n    onEdit\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof options !== 'undefined' && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof draggable !== 'undefined' && instance !== null) {\r\n      instance.setDraggable(draggable);\r\n    }\r\n  }, [instance, draggable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof editable !== 'undefined' && instance !== null) {\r\n      instance.setEditable(editable);\r\n    }\r\n  }, [instance, editable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && instance !== null) {\r\n      instance.setVisible(visible);\r\n    }\r\n  }, [instance, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof path !== 'undefined' && instance !== null) {\r\n      instance.setPath(path);\r\n    }\r\n  }, [instance, path]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof paths !== 'undefined' && instance !== null) {\r\n      instance.setPaths(paths);\r\n    }\r\n  }, [instance, paths]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onDblClick === 'function') {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (!instance) {\r\n      return;\r\n    }\r\n    google.maps.event.addListener(instance.getPath(), 'insert_at', () => {\r\n      onEdit === null || onEdit === void 0 || onEdit(instance);\r\n    });\r\n    google.maps.event.addListener(instance.getPath(), 'set_at', () => {\r\n      onEdit === null || onEdit === void 0 || onEdit(instance);\r\n    });\r\n    google.maps.event.addListener(instance.getPath(), 'remove_at', () => {\r\n      onEdit === null || onEdit === void 0 || onEdit(instance);\r\n    });\r\n  }, [instance, onEdit]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onDragEnd === 'function') {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(instance, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onDragStart === 'function') {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(instance, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onMouseDown === 'function') {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onMouseMove === 'function') {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(instance, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onMouseOut === 'function') {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onMouseOver === 'function') {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onMouseUp === 'function') {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onRightClick === 'function') {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onClick === 'function') {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && typeof onDrag === 'function') {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(instance, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var polygon = new google.maps.Polygon(_objectSpread$8(_objectSpread$8({}, options), {}, {\r\n      map\r\n    }));\r\n    if (path) {\r\n      polygon.setPath(path);\r\n    }\r\n    if (paths) {\r\n      polygon.setPaths(paths);\r\n    }\r\n    if (typeof visible !== 'undefined') {\r\n      polygon.setVisible(visible);\r\n    }\r\n    if (typeof editable !== 'undefined') {\r\n      polygon.setEditable(editable);\r\n    }\r\n    if (typeof draggable !== 'undefined') {\r\n      polygon.setDraggable(draggable);\r\n    }\r\n    if (onDblClick) {\r\n      setDblclickListener(google.maps.event.addListener(polygon, 'dblclick', onDblClick));\r\n    }\r\n    if (onDragEnd) {\r\n      setDragendListener(google.maps.event.addListener(polygon, 'dragend', onDragEnd));\r\n    }\r\n    if (onDragStart) {\r\n      setDragstartListener(google.maps.event.addListener(polygon, 'dragstart', onDragStart));\r\n    }\r\n    if (onMouseDown) {\r\n      setMousedownListener(google.maps.event.addListener(polygon, 'mousedown', onMouseDown));\r\n    }\r\n    if (onMouseMove) {\r\n      setMousemoveListener(google.maps.event.addListener(polygon, 'mousemove', onMouseMove));\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(polygon, 'mouseout', onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(polygon, 'mouseover', onMouseOver));\r\n    }\r\n    if (onMouseUp) {\r\n      setMouseupListener(google.maps.event.addListener(polygon, 'mouseup', onMouseUp));\r\n    }\r\n    if (onRightClick) {\r\n      setRightclickListener(google.maps.event.addListener(polygon, 'rightclick', onRightClick));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(polygon, 'click', onClick));\r\n    }\r\n    if (onDrag) {\r\n      setDragListener(google.maps.event.addListener(polygon, 'drag', onDrag));\r\n    }\r\n    setInstance(polygon);\r\n    if (onLoad) {\r\n      onLoad(polygon);\r\n    }\r\n    return () => {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(polygon);\r\n      }\r\n      polygon.setMap(null);\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar PolygonF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(PolygonFunctional);\r\nclass Polygon extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n  }\r\n  componentDidMount() {\r\n    var polygonOptions = this.props.options || {};\r\n    this.polygon = new google.maps.Polygon(polygonOptions);\r\n    this.polygon.setMap(this.context);\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$a,\r\n      eventMap: eventMap$a,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: this.polygon\r\n    });\r\n    if (this.props.onLoad) {\r\n      this.props.onLoad(this.polygon);\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.polygon) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$a,\r\n        eventMap: eventMap$a,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.polygon\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.polygon) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.polygon);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      if (this.polygon) {\r\n        this.polygon.setMap(null);\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(Polygon, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$7(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$7(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$7(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$7(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$9 = {\r\n  onBoundsChanged: 'bounds_changed',\r\n  onClick: 'click',\r\n  onDblClick: 'dblclick',\r\n  onDrag: 'drag',\r\n  onDragEnd: 'dragend',\r\n  onDragStart: 'dragstart',\r\n  onMouseDown: 'mousedown',\r\n  onMouseMove: 'mousemove',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick'\r\n};\r\nvar updaterMap$9 = {\r\n  bounds(instance, bounds) {\r\n    instance.setBounds(bounds);\r\n  },\r\n  draggable(instance, draggable) {\r\n    instance.setDraggable(draggable);\r\n  },\r\n  editable(instance, editable) {\r\n    instance.setEditable(editable);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  }\r\n};\r\nfunction RectangleFunctional(_ref) {\r\n  var {\r\n    options,\r\n    bounds,\r\n    draggable,\r\n    editable,\r\n    visible,\r\n    onDblClick,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseDown,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onRightClick,\r\n    onClick,\r\n    onDrag,\r\n    onBoundsChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightClickListener, setRightClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [boundsChangedListener, setBoundsChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof options !== 'undefined' && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof draggable !== 'undefined' && instance !== null) {\r\n      instance.setDraggable(draggable);\r\n    }\r\n  }, [instance, draggable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof editable !== 'undefined' && instance !== null) {\r\n      instance.setEditable(editable);\r\n    }\r\n  }, [instance, editable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && instance !== null) {\r\n      instance.setVisible(visible);\r\n    }\r\n  }, [instance, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof bounds !== 'undefined' && instance !== null) {\r\n      instance.setBounds(bounds);\r\n    }\r\n  }, [instance, bounds]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragEnd) {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(instance, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragStart) {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(instance, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseMove) {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(instance, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRightClick) {\r\n      if (rightClickListener !== null) {\r\n        google.maps.event.removeListener(rightClickListener);\r\n      }\r\n      setRightClickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDrag) {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(instance, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onBoundsChanged) {\r\n      if (boundsChangedListener !== null) {\r\n        google.maps.event.removeListener(boundsChangedListener);\r\n      }\r\n      setBoundsChangedListener(google.maps.event.addListener(instance, 'bounds_changed', onBoundsChanged));\r\n    }\r\n  }, [onBoundsChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var rectangle = new google.maps.Rectangle(_objectSpread$7(_objectSpread$7({}, options), {}, {\r\n      map\r\n    }));\r\n    if (typeof visible !== 'undefined') {\r\n      rectangle.setVisible(visible);\r\n    }\r\n    if (typeof editable !== 'undefined') {\r\n      rectangle.setEditable(editable);\r\n    }\r\n    if (typeof draggable !== 'undefined') {\r\n      rectangle.setDraggable(draggable);\r\n    }\r\n    if (typeof bounds !== 'undefined') {\r\n      rectangle.setBounds(bounds);\r\n    }\r\n    if (onDblClick) {\r\n      setDblclickListener(google.maps.event.addListener(rectangle, 'dblclick', onDblClick));\r\n    }\r\n    if (onDragEnd) {\r\n      setDragendListener(google.maps.event.addListener(rectangle, 'dragend', onDragEnd));\r\n    }\r\n    if (onDragStart) {\r\n      setDragstartListener(google.maps.event.addListener(rectangle, 'dragstart', onDragStart));\r\n    }\r\n    if (onMouseDown) {\r\n      setMousedownListener(google.maps.event.addListener(rectangle, 'mousedown', onMouseDown));\r\n    }\r\n    if (onMouseMove) {\r\n      setMousemoveListener(google.maps.event.addListener(rectangle, 'mousemove', onMouseMove));\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(rectangle, 'mouseout', onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(rectangle, 'mouseover', onMouseOver));\r\n    }\r\n    if (onMouseUp) {\r\n      setMouseupListener(google.maps.event.addListener(rectangle, 'mouseup', onMouseUp));\r\n    }\r\n    if (onRightClick) {\r\n      setRightClickListener(google.maps.event.addListener(rectangle, 'rightclick', onRightClick));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(rectangle, 'click', onClick));\r\n    }\r\n    if (onDrag) {\r\n      setDragListener(google.maps.event.addListener(rectangle, 'drag', onDrag));\r\n    }\r\n    if (onBoundsChanged) {\r\n      setBoundsChangedListener(google.maps.event.addListener(rectangle, 'bounds_changed', onBoundsChanged));\r\n    }\r\n    setInstance(rectangle);\r\n    if (onLoad) {\r\n      onLoad(rectangle);\r\n    }\r\n    return () => {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      if (rightClickListener !== null) {\r\n        google.maps.event.removeListener(rightClickListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      if (boundsChangedListener !== null) {\r\n        google.maps.event.removeListener(boundsChangedListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(rectangle);\r\n      }\r\n      rectangle.setMap(null);\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar RectangleF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(RectangleFunctional);\r\nclass Rectangle extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      rectangle: null\r\n    });\r\n    _defineProperty(this, \"setRectangleCallback\", () => {\r\n      if (this.state.rectangle !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.rectangle);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var rectangle = new google.maps.Rectangle(_objectSpread$7(_objectSpread$7({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$9,\r\n      eventMap: eventMap$9,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: rectangle\r\n    });\r\n    this.setState(function setRectangle() {\r\n      return {\r\n        rectangle\r\n      };\r\n    }, this.setRectangleCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.rectangle !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$9,\r\n        eventMap: eventMap$9,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.rectangle\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.rectangle !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.rectangle);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.rectangle.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(Rectangle, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$6(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$6(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$6(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$6(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$8 = {\r\n  onCenterChanged: 'center_changed',\r\n  onRadiusChanged: 'radius_changed',\r\n  onClick: 'click',\r\n  onDblClick: 'dblclick',\r\n  onDrag: 'drag',\r\n  onDragEnd: 'dragend',\r\n  onDragStart: 'dragstart',\r\n  onMouseDown: 'mousedown',\r\n  onMouseMove: 'mousemove',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick'\r\n};\r\nvar updaterMap$8 = {\r\n  center(instance, center) {\r\n    instance.setCenter(center);\r\n  },\r\n  draggable(instance, draggable) {\r\n    instance.setDraggable(draggable);\r\n  },\r\n  editable(instance, editable) {\r\n    instance.setEditable(editable);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  radius(instance, radius) {\r\n    instance.setRadius(radius);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  }\r\n};\r\nvar defaultOptions = {};\r\nfunction CircleFunctional(_ref) {\r\n  var {\r\n    options,\r\n    center,\r\n    radius,\r\n    draggable,\r\n    editable,\r\n    visible,\r\n    onDblClick,\r\n    onDragEnd,\r\n    onDragStart,\r\n    onMouseDown,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onRightClick,\r\n    onClick,\r\n    onDrag,\r\n    onCenterChanged,\r\n    onRadiusChanged,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragendListener, setDragendListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragstartListener, setDragstartListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dragListener, setDragListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [centerChangedListener, setCenterChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [radiusChangedListener, setRadiusChangedListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof options !== 'undefined' && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof draggable !== 'undefined' && instance !== null) {\r\n      instance.setDraggable(draggable);\r\n    }\r\n  }, [instance, draggable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof editable !== 'undefined' && instance !== null) {\r\n      instance.setEditable(editable);\r\n    }\r\n  }, [instance, editable]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && instance !== null) {\r\n      instance.setVisible(visible);\r\n    }\r\n  }, [instance, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof radius === 'number' && instance !== null) {\r\n      instance.setRadius(radius);\r\n    }\r\n  }, [instance, radius]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof center !== 'undefined' && instance !== null) {\r\n      instance.setCenter(center);\r\n    }\r\n  }, [instance, center]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragEnd) {\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      setDragendListener(google.maps.event.addListener(instance, 'dragend', onDragEnd));\r\n    }\r\n  }, [onDragEnd]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDragStart) {\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      setDragstartListener(google.maps.event.addListener(instance, 'dragstart', onDragStart));\r\n    }\r\n  }, [onDragStart]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseMove) {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(instance, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRightClick) {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDrag) {\r\n      if (dragListener !== null) {\r\n        google.maps.event.removeListener(dragListener);\r\n      }\r\n      setDragListener(google.maps.event.addListener(instance, 'drag', onDrag));\r\n    }\r\n  }, [onDrag]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onCenterChanged) {\r\n      if (centerChangedListener !== null) {\r\n        google.maps.event.removeListener(centerChangedListener);\r\n      }\r\n      setCenterChangedListener(google.maps.event.addListener(instance, 'center_changed', onCenterChanged));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRadiusChanged) {\r\n      if (radiusChangedListener !== null) {\r\n        google.maps.event.removeListener(radiusChangedListener);\r\n      }\r\n      setRadiusChangedListener(google.maps.event.addListener(instance, 'radius_changed', onRadiusChanged));\r\n    }\r\n  }, [onRadiusChanged]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var circle = new google.maps.Circle(_objectSpread$6(_objectSpread$6({}, options || defaultOptions), {}, {\r\n      map\r\n    }));\r\n    if (typeof radius === 'number') {\r\n      circle.setRadius(radius);\r\n    }\r\n    if (typeof center !== 'undefined') {\r\n      circle.setCenter(center);\r\n    }\r\n    if (typeof radius === 'number') {\r\n      circle.setRadius(radius);\r\n    }\r\n    if (typeof visible !== 'undefined') {\r\n      circle.setVisible(visible);\r\n    }\r\n    if (typeof editable !== 'undefined') {\r\n      circle.setEditable(editable);\r\n    }\r\n    if (typeof draggable !== 'undefined') {\r\n      circle.setDraggable(draggable);\r\n    }\r\n    if (onDblClick) {\r\n      setDblclickListener(google.maps.event.addListener(circle, 'dblclick', onDblClick));\r\n    }\r\n    if (onDragEnd) {\r\n      setDragendListener(google.maps.event.addListener(circle, 'dragend', onDragEnd));\r\n    }\r\n    if (onDragStart) {\r\n      setDragstartListener(google.maps.event.addListener(circle, 'dragstart', onDragStart));\r\n    }\r\n    if (onMouseDown) {\r\n      setMousedownListener(google.maps.event.addListener(circle, 'mousedown', onMouseDown));\r\n    }\r\n    if (onMouseMove) {\r\n      setMousemoveListener(google.maps.event.addListener(circle, 'mousemove', onMouseMove));\r\n    }\r\n    if (onMouseOut) {\r\n      setMouseoutListener(google.maps.event.addListener(circle, 'mouseout', onMouseOut));\r\n    }\r\n    if (onMouseOver) {\r\n      setMouseoverListener(google.maps.event.addListener(circle, 'mouseover', onMouseOver));\r\n    }\r\n    if (onMouseUp) {\r\n      setMouseupListener(google.maps.event.addListener(circle, 'mouseup', onMouseUp));\r\n    }\r\n    if (onRightClick) {\r\n      setRightclickListener(google.maps.event.addListener(circle, 'rightclick', onRightClick));\r\n    }\r\n    if (onClick) {\r\n      setClickListener(google.maps.event.addListener(circle, 'click', onClick));\r\n    }\r\n    if (onDrag) {\r\n      setDragListener(google.maps.event.addListener(circle, 'drag', onDrag));\r\n    }\r\n    if (onCenterChanged) {\r\n      setCenterChangedListener(google.maps.event.addListener(circle, 'center_changed', onCenterChanged));\r\n    }\r\n    if (onRadiusChanged) {\r\n      setRadiusChangedListener(google.maps.event.addListener(circle, 'radius_changed', onRadiusChanged));\r\n    }\r\n    setInstance(circle);\r\n    if (onLoad) {\r\n      onLoad(circle);\r\n    }\r\n    return () => {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      if (dragendListener !== null) {\r\n        google.maps.event.removeListener(dragendListener);\r\n      }\r\n      if (dragstartListener !== null) {\r\n        google.maps.event.removeListener(dragstartListener);\r\n      }\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      if (centerChangedListener !== null) {\r\n        google.maps.event.removeListener(centerChangedListener);\r\n      }\r\n      if (radiusChangedListener !== null) {\r\n        google.maps.event.removeListener(radiusChangedListener);\r\n      }\r\n      if (onUnmount) {\r\n        onUnmount(circle);\r\n      }\r\n      circle.setMap(null);\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar CircleF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(CircleFunctional);\r\nclass Circle extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      circle: null\r\n    });\r\n    _defineProperty(this, \"setCircleCallback\", () => {\r\n      if (this.state.circle !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.circle);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var circle = new google.maps.Circle(_objectSpread$6(_objectSpread$6({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$8,\r\n      eventMap: eventMap$8,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: circle\r\n    });\r\n    this.setState(function setCircle() {\r\n      return {\r\n        circle\r\n      };\r\n    }, this.setCircleCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.circle !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$8,\r\n        eventMap: eventMap$8,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.circle\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.circle !== null) {\r\n      var _this$state$circle;\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.circle);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      (_this$state$circle = this.state.circle) === null || _this$state$circle === void 0 || _this$state$circle.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(Circle, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$5(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$5(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$5(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$5(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$7 = {\r\n  onClick: 'click',\r\n  onDblClick: 'dblclick',\r\n  onMouseDown: 'mousedown',\r\n  onMouseOut: 'mouseout',\r\n  onMouseOver: 'mouseover',\r\n  onMouseUp: 'mouseup',\r\n  onRightClick: 'rightclick',\r\n  onAddFeature: 'addfeature',\r\n  onRemoveFeature: 'removefeature',\r\n  onRemoveProperty: 'removeproperty',\r\n  onSetGeometry: 'setgeometry',\r\n  onSetProperty: 'setproperty'\r\n};\r\nvar updaterMap$7 = {\r\n  add(instance, feature) {\r\n    instance.add(feature);\r\n  },\r\n  addgeojson(instance, geojson, options) {\r\n    instance.addGeoJson(geojson, options);\r\n  },\r\n  contains(instance, feature) {\r\n    instance.contains(feature);\r\n  },\r\n  foreach(instance, callback) {\r\n    instance.forEach(callback);\r\n  },\r\n  loadgeojson(instance, url, options, callback) {\r\n    instance.loadGeoJson(url, options, callback);\r\n  },\r\n  overridestyle(instance, feature, style) {\r\n    instance.overrideStyle(feature, style);\r\n  },\r\n  remove(instance, feature) {\r\n    instance.remove(feature);\r\n  },\r\n  revertstyle(instance, feature) {\r\n    instance.revertStyle(feature);\r\n  },\r\n  controlposition(instance, controlPosition) {\r\n    instance.setControlPosition(controlPosition);\r\n  },\r\n  controls(instance, controls) {\r\n    instance.setControls(controls);\r\n  },\r\n  drawingmode(instance, mode) {\r\n    instance.setDrawingMode(mode);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  style(instance, style) {\r\n    instance.setStyle(style);\r\n  },\r\n  togeojson(instance, callback) {\r\n    instance.toGeoJson(callback);\r\n  }\r\n};\r\nfunction DataFunctional(_ref) {\r\n  var {\r\n    options,\r\n    onClick,\r\n    onDblClick,\r\n    onMouseDown,\r\n    onMouseMove,\r\n    onMouseOut,\r\n    onMouseOver,\r\n    onMouseUp,\r\n    onRightClick,\r\n    onAddFeature,\r\n    onRemoveFeature,\r\n    onRemoveProperty,\r\n    onSetGeometry,\r\n    onSetProperty,\r\n    onLoad,\r\n    onUnmount\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [dblclickListener, setDblclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousedownListener, setMousedownListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mousemoveListener, setMousemoveListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoutListener, setMouseoutListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseoverListener, setMouseoverListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [mouseupListener, setMouseupListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [rightclickListener, setRightclickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [clickListener, setClickListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [addFeatureListener, setAddFeatureListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [removeFeatureListener, setRemoveFeatureListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [removePropertyListener, setRemovePropertyListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [setGeometryListener, setSetGeometryListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  var [setPropertyListener, setSetPropertyListener] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onDblClick) {\r\n      if (dblclickListener !== null) {\r\n        google.maps.event.removeListener(dblclickListener);\r\n      }\r\n      setDblclickListener(google.maps.event.addListener(instance, 'dblclick', onDblClick));\r\n    }\r\n  }, [onDblClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseDown) {\r\n      if (mousedownListener !== null) {\r\n        google.maps.event.removeListener(mousedownListener);\r\n      }\r\n      setMousedownListener(google.maps.event.addListener(instance, 'mousedown', onMouseDown));\r\n    }\r\n  }, [onMouseDown]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseMove) {\r\n      if (mousemoveListener !== null) {\r\n        google.maps.event.removeListener(mousemoveListener);\r\n      }\r\n      setMousemoveListener(google.maps.event.addListener(instance, 'mousemove', onMouseMove));\r\n    }\r\n  }, [onMouseMove]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOut) {\r\n      if (mouseoutListener !== null) {\r\n        google.maps.event.removeListener(mouseoutListener);\r\n      }\r\n      setMouseoutListener(google.maps.event.addListener(instance, 'mouseout', onMouseOut));\r\n    }\r\n  }, [onMouseOut]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseOver) {\r\n      if (mouseoverListener !== null) {\r\n        google.maps.event.removeListener(mouseoverListener);\r\n      }\r\n      setMouseoverListener(google.maps.event.addListener(instance, 'mouseover', onMouseOver));\r\n    }\r\n  }, [onMouseOver]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onMouseUp) {\r\n      if (mouseupListener !== null) {\r\n        google.maps.event.removeListener(mouseupListener);\r\n      }\r\n      setMouseupListener(google.maps.event.addListener(instance, 'mouseup', onMouseUp));\r\n    }\r\n  }, [onMouseUp]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRightClick) {\r\n      if (rightclickListener !== null) {\r\n        google.maps.event.removeListener(rightclickListener);\r\n      }\r\n      setRightclickListener(google.maps.event.addListener(instance, 'rightclick', onRightClick));\r\n    }\r\n  }, [onRightClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onClick) {\r\n      if (clickListener !== null) {\r\n        google.maps.event.removeListener(clickListener);\r\n      }\r\n      setClickListener(google.maps.event.addListener(instance, 'click', onClick));\r\n    }\r\n  }, [onClick]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onAddFeature) {\r\n      if (addFeatureListener !== null) {\r\n        google.maps.event.removeListener(addFeatureListener);\r\n      }\r\n      setAddFeatureListener(google.maps.event.addListener(instance, 'addfeature', onAddFeature));\r\n    }\r\n  }, [onAddFeature]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRemoveFeature) {\r\n      if (removeFeatureListener !== null) {\r\n        google.maps.event.removeListener(removeFeatureListener);\r\n      }\r\n      setRemoveFeatureListener(google.maps.event.addListener(instance, 'removefeature', onRemoveFeature));\r\n    }\r\n  }, [onRemoveFeature]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onRemoveProperty) {\r\n      if (removePropertyListener !== null) {\r\n        google.maps.event.removeListener(removePropertyListener);\r\n      }\r\n      setRemovePropertyListener(google.maps.event.addListener(instance, 'removeproperty', onRemoveProperty));\r\n    }\r\n  }, [onRemoveProperty]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onSetGeometry) {\r\n      if (setGeometryListener !== null) {\r\n        google.maps.event.removeListener(setGeometryListener);\r\n      }\r\n      setSetGeometryListener(google.maps.event.addListener(instance, 'setgeometry', onSetGeometry));\r\n    }\r\n  }, [onSetGeometry]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance && onSetProperty) {\r\n      if (setPropertyListener !== null) {\r\n        google.maps.event.removeListener(setPropertyListener);\r\n      }\r\n      setSetPropertyListener(google.maps.event.addListener(instance, 'setproperty', onSetProperty));\r\n    }\r\n  }, [onSetProperty]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (map !== null) {\r\n      var data = new google.maps.Data(_objectSpread$5(_objectSpread$5({}, options), {}, {\r\n        map\r\n      }));\r\n      if (onDblClick) {\r\n        setDblclickListener(google.maps.event.addListener(data, 'dblclick', onDblClick));\r\n      }\r\n      if (onMouseDown) {\r\n        setMousedownListener(google.maps.event.addListener(data, 'mousedown', onMouseDown));\r\n      }\r\n      if (onMouseMove) {\r\n        setMousemoveListener(google.maps.event.addListener(data, 'mousemove', onMouseMove));\r\n      }\r\n      if (onMouseOut) {\r\n        setMouseoutListener(google.maps.event.addListener(data, 'mouseout', onMouseOut));\r\n      }\r\n      if (onMouseOver) {\r\n        setMouseoverListener(google.maps.event.addListener(data, 'mouseover', onMouseOver));\r\n      }\r\n      if (onMouseUp) {\r\n        setMouseupListener(google.maps.event.addListener(data, 'mouseup', onMouseUp));\r\n      }\r\n      if (onRightClick) {\r\n        setRightclickListener(google.maps.event.addListener(data, 'rightclick', onRightClick));\r\n      }\r\n      if (onClick) {\r\n        setClickListener(google.maps.event.addListener(data, 'click', onClick));\r\n      }\r\n      if (onAddFeature) {\r\n        setAddFeatureListener(google.maps.event.addListener(data, 'addfeature', onAddFeature));\r\n      }\r\n      if (onRemoveFeature) {\r\n        setRemoveFeatureListener(google.maps.event.addListener(data, 'removefeature', onRemoveFeature));\r\n      }\r\n      if (onRemoveProperty) {\r\n        setRemovePropertyListener(google.maps.event.addListener(data, 'removeproperty', onRemoveProperty));\r\n      }\r\n      if (onSetGeometry) {\r\n        setSetGeometryListener(google.maps.event.addListener(data, 'setgeometry', onSetGeometry));\r\n      }\r\n      if (onSetProperty) {\r\n        setSetPropertyListener(google.maps.event.addListener(data, 'setproperty', onSetProperty));\r\n      }\r\n      setInstance(data);\r\n      if (onLoad) {\r\n        onLoad(data);\r\n      }\r\n    }\r\n    return () => {\r\n      if (instance) {\r\n        if (dblclickListener !== null) {\r\n          google.maps.event.removeListener(dblclickListener);\r\n        }\r\n        if (mousedownListener !== null) {\r\n          google.maps.event.removeListener(mousedownListener);\r\n        }\r\n        if (mousemoveListener !== null) {\r\n          google.maps.event.removeListener(mousemoveListener);\r\n        }\r\n        if (mouseoutListener !== null) {\r\n          google.maps.event.removeListener(mouseoutListener);\r\n        }\r\n        if (mouseoverListener !== null) {\r\n          google.maps.event.removeListener(mouseoverListener);\r\n        }\r\n        if (mouseupListener !== null) {\r\n          google.maps.event.removeListener(mouseupListener);\r\n        }\r\n        if (rightclickListener !== null) {\r\n          google.maps.event.removeListener(rightclickListener);\r\n        }\r\n        if (clickListener !== null) {\r\n          google.maps.event.removeListener(clickListener);\r\n        }\r\n        if (addFeatureListener !== null) {\r\n          google.maps.event.removeListener(addFeatureListener);\r\n        }\r\n        if (removeFeatureListener !== null) {\r\n          google.maps.event.removeListener(removeFeatureListener);\r\n        }\r\n        if (removePropertyListener !== null) {\r\n          google.maps.event.removeListener(removePropertyListener);\r\n        }\r\n        if (setGeometryListener !== null) {\r\n          google.maps.event.removeListener(setGeometryListener);\r\n        }\r\n        if (setPropertyListener !== null) {\r\n          google.maps.event.removeListener(setPropertyListener);\r\n        }\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar DataF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(DataFunctional);\r\nclass Data extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      data: null\r\n    });\r\n    _defineProperty(this, \"setDataCallback\", () => {\r\n      if (this.state.data !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.data);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    if (this.context !== null) {\r\n      var data = new google.maps.Data(_objectSpread$5(_objectSpread$5({}, this.props.options), {}, {\r\n        map: this.context\r\n      }));\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$7,\r\n        eventMap: eventMap$7,\r\n        prevProps: {},\r\n        nextProps: this.props,\r\n        instance: data\r\n      });\r\n      this.setState(() => {\r\n        return {\r\n          data\r\n        };\r\n      }, this.setDataCallback);\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.data !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$7,\r\n        eventMap: eventMap$7,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.data\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.data !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.data);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      if (this.state.data) {\r\n        this.state.data.setMap(null);\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(Data, \"contextType\", MapContext);\r\n\r\nfunction ownKeys$4(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$4(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$4(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$4(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$6 = {\r\n  onClick: 'click',\r\n  onDefaultViewportChanged: 'defaultviewport_changed',\r\n  onStatusChanged: 'status_changed'\r\n};\r\nvar updaterMap$6 = {\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  url(instance, url) {\r\n    instance.setUrl(url);\r\n  },\r\n  zIndex(instance, zIndex) {\r\n    instance.setZIndex(zIndex);\r\n  }\r\n};\r\nclass KmlLayer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      kmlLayer: null\r\n    });\r\n    _defineProperty(this, \"setKmlLayerCallback\", () => {\r\n      if (this.state.kmlLayer !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.kmlLayer);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var kmlLayer = new google.maps.KmlLayer(_objectSpread$4(_objectSpread$4({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$6,\r\n      eventMap: eventMap$6,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: kmlLayer\r\n    });\r\n    this.setState(function setLmlLayer() {\r\n      return {\r\n        kmlLayer\r\n      };\r\n    }, this.setKmlLayerCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.kmlLayer !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$6,\r\n        eventMap: eventMap$6,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.kmlLayer\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.kmlLayer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.kmlLayer);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.kmlLayer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(KmlLayer, \"contextType\", MapContext);\r\n\r\nfunction getOffsetOverride(containerElement, getPixelPositionOffset) {\r\n  return typeof getPixelPositionOffset === 'function' ? getPixelPositionOffset(containerElement.offsetWidth, containerElement.offsetHeight) : {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n}\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction createLatLng(inst, Type) {\r\n  return new Type(inst.lat, inst.lng);\r\n}\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction createLatLngBounds(inst, Type) {\r\n  return new Type(new google.maps.LatLng(inst.ne.lat, inst.ne.lng), new google.maps.LatLng(inst.sw.lat, inst.sw.lng));\r\n}\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfunction ensureOfType(inst,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfactory\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n) {\r\n  return inst instanceof type ? inst : factory(inst, type);\r\n}\r\nfunction ensureOfTypeBounds(inst,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype,\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nfactory\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n) {\r\n  return inst instanceof type ? inst : factory(inst, type);\r\n}\r\nfunction getLayoutStylesByBounds(mapCanvasProjection, offset, bounds) {\r\n  var ne = mapCanvasProjection && mapCanvasProjection.fromLatLngToDivPixel(bounds.getNorthEast());\r\n  var sw = mapCanvasProjection && mapCanvasProjection.fromLatLngToDivPixel(bounds.getSouthWest());\r\n  if (ne && sw) {\r\n    return {\r\n      left: \"\".concat(sw.x + offset.x, \"px\"),\r\n      top: \"\".concat(ne.y + offset.y, \"px\"),\r\n      width: \"\".concat(ne.x - sw.x - offset.x, \"px\"),\r\n      height: \"\".concat(sw.y - ne.y - offset.y, \"px\")\r\n    };\r\n  }\r\n  return {\r\n    left: '-9999px',\r\n    top: '-9999px'\r\n  };\r\n}\r\nfunction getLayoutStylesByPosition(mapCanvasProjection, offset, position) {\r\n  var point = mapCanvasProjection && mapCanvasProjection.fromLatLngToDivPixel(position);\r\n  if (point) {\r\n    var {\r\n      x,\r\n      y\r\n    } = point;\r\n    return {\r\n      left: \"\".concat(x + offset.x, \"px\"),\r\n      top: \"\".concat(y + offset.y, \"px\")\r\n    };\r\n  }\r\n  return {\r\n    left: '-9999px',\r\n    top: '-9999px'\r\n  };\r\n}\r\nfunction getLayoutStyles(mapCanvasProjection, offset, bounds, position) {\r\n  return bounds !== undefined ? getLayoutStylesByBounds(mapCanvasProjection, offset, ensureOfTypeBounds(bounds, google.maps.LatLngBounds, createLatLngBounds)) : getLayoutStylesByPosition(mapCanvasProjection, offset, ensureOfType(position, google.maps.LatLng, createLatLng));\r\n}\r\nfunction arePositionsEqual(currentPosition, previousPosition) {\r\n  return currentPosition.left === previousPosition.left && currentPosition.top === previousPosition.top && currentPosition.width === previousPosition.height && currentPosition.height === previousPosition.height;\r\n}\r\n\r\nfunction ownKeys$3(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$3(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$3(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$3(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nfunction createOverlay(container, pane, position, bounds, getPixelPositionOffset) {\r\n  class Overlay extends google.maps.OverlayView {\r\n    constructor(container, pane, position, bounds) {\r\n      super();\r\n      this.container = container;\r\n      this.pane = pane;\r\n      this.position = position;\r\n      this.bounds = bounds;\r\n    }\r\n    onAdd() {\r\n      var _this$getPanes;\r\n      var pane = (_this$getPanes = this.getPanes()) === null || _this$getPanes === void 0 ? void 0 : _this$getPanes[this.pane];\r\n      pane === null || pane === void 0 || pane.appendChild(this.container);\r\n    }\r\n    draw() {\r\n      var projection = this.getProjection();\r\n      var offset = _objectSpread$3({}, this.container ? getOffsetOverride(this.container, getPixelPositionOffset) : {\r\n        x: 0,\r\n        y: 0\r\n      });\r\n      var layoutStyles = getLayoutStyles(projection, offset, this.bounds, this.position);\r\n      for (var [key, value] of Object.entries(layoutStyles)) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        this.container.style[key] = value;\r\n      }\r\n    }\r\n    onRemove() {\r\n      if (this.container.parentNode !== null) {\r\n        this.container.parentNode.removeChild(this.container);\r\n      }\r\n    }\r\n  }\r\n  return new Overlay(container, pane, position, bounds);\r\n}\r\n\r\nfunction ownKeys$2(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$2(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$2(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$2(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nfunction convertToLatLngString(latLngLike) {\r\n  if (!latLngLike) {\r\n    return '';\r\n  }\r\n  var latLng = latLngLike instanceof google.maps.LatLng ? latLngLike : new google.maps.LatLng(latLngLike.lat, latLngLike.lng);\r\n  return latLng + '';\r\n}\r\nfunction convertToLatLngBoundsString(latLngBoundsLike) {\r\n  if (!latLngBoundsLike) {\r\n    return '';\r\n  }\r\n  var latLngBounds = latLngBoundsLike instanceof google.maps.LatLngBounds ? latLngBoundsLike : new google.maps.LatLngBounds(new google.maps.LatLng(latLngBoundsLike.south, latLngBoundsLike.east), new google.maps.LatLng(latLngBoundsLike.north, latLngBoundsLike.west));\r\n  return latLngBounds + '';\r\n}\r\nvar FLOAT_PANE = \"floatPane\";\r\nvar MAP_PANE = \"mapPane\";\r\nvar MARKER_LAYER = \"markerLayer\";\r\nvar OVERLAY_LAYER = \"overlayLayer\";\r\nvar OVERLAY_MOUSE_TARGET = \"overlayMouseTarget\";\r\nfunction OverlayViewFunctional(_ref) {\r\n  var {\r\n    position,\r\n    bounds,\r\n    mapPaneName,\r\n    zIndex,\r\n    onLoad,\r\n    onUnmount,\r\n    getPixelPositionOffset,\r\n    children\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var container = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => {\r\n    var div = document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    return div;\r\n  }, []);\r\n  var overlay = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => {\r\n    return createOverlay(container, mapPaneName, position, bounds, getPixelPositionOffset);\r\n  }, [container, mapPaneName, position, bounds]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    onLoad === null || onLoad === void 0 || onLoad(overlay);\r\n    overlay === null || overlay === void 0 || overlay.setMap(map);\r\n    return () => {\r\n      onUnmount === null || onUnmount === void 0 || onUnmount(overlay);\r\n      overlay === null || overlay === void 0 || overlay.setMap(null);\r\n    };\r\n  }, [map, overlay]);\r\n  // to move the container to the foreground and background\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    container.style.zIndex = \"\".concat(zIndex);\r\n  }, [zIndex, container]);\r\n  return react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal(children, container);\r\n}\r\nvar OverlayViewF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(OverlayViewFunctional);\r\nclass OverlayView extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    _defineProperty(this, \"state\", {\r\n      paneEl: null,\r\n      containerStyle: {\r\n        // set initial position\r\n        position: 'absolute'\r\n      }\r\n    });\r\n    _defineProperty(this, \"updatePane\", () => {\r\n      var mapPaneName = this.props.mapPaneName;\r\n      // https://developers.google.com/maps/documentation/javascript/3.exp/reference#MapPanes\r\n      var mapPanes = this.overlayView.getPanes();\r\n      invariant(!!mapPaneName, \"OverlayView requires props.mapPaneName but got %s\", mapPaneName);\r\n      if (mapPanes) {\r\n        this.setState({\r\n          paneEl: mapPanes[mapPaneName]\r\n        });\r\n      } else {\r\n        this.setState({\r\n          paneEl: null\r\n        });\r\n      }\r\n    });\r\n    _defineProperty(this, \"onAdd\", () => {\r\n      var _this$props$onLoad, _this$props;\r\n      this.updatePane();\r\n      (_this$props$onLoad = (_this$props = this.props).onLoad) === null || _this$props$onLoad === void 0 || _this$props$onLoad.call(_this$props, this.overlayView);\r\n    });\r\n    _defineProperty(this, \"onPositionElement\", () => {\r\n      var mapCanvasProjection = this.overlayView.getProjection();\r\n      var offset = _objectSpread$2({\r\n        x: 0,\r\n        y: 0\r\n      }, this.containerRef.current ? getOffsetOverride(this.containerRef.current, this.props.getPixelPositionOffset) : {});\r\n      var layoutStyles = getLayoutStyles(mapCanvasProjection, offset, this.props.bounds, this.props.position);\r\n      if (!arePositionsEqual(layoutStyles, {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        left: this.state.containerStyle.left,\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        top: this.state.containerStyle.top,\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        width: this.state.containerStyle.width,\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        height: this.state.containerStyle.height\r\n      })) {\r\n        var _layoutStyles$top, _layoutStyles$left, _layoutStyles$width, _layoutStyles$height;\r\n        this.setState({\r\n          containerStyle: {\r\n            top: (_layoutStyles$top = layoutStyles.top) !== null && _layoutStyles$top !== void 0 ? _layoutStyles$top : 0,\r\n            left: (_layoutStyles$left = layoutStyles.left) !== null && _layoutStyles$left !== void 0 ? _layoutStyles$left : 0,\r\n            width: (_layoutStyles$width = layoutStyles.width) !== null && _layoutStyles$width !== void 0 ? _layoutStyles$width : 0,\r\n            height: (_layoutStyles$height = layoutStyles.height) !== null && _layoutStyles$height !== void 0 ? _layoutStyles$height : 0,\r\n            position: 'absolute'\r\n          }\r\n        });\r\n      }\r\n    });\r\n    _defineProperty(this, \"draw\", () => {\r\n      this.onPositionElement();\r\n    });\r\n    _defineProperty(this, \"onRemove\", () => {\r\n      var _this$props$onUnmount, _this$props2;\r\n      this.setState(() => ({\r\n        paneEl: null\r\n      }));\r\n      (_this$props$onUnmount = (_this$props2 = this.props).onUnmount) === null || _this$props$onUnmount === void 0 || _this$props$onUnmount.call(_this$props2, this.overlayView);\r\n    });\r\n    this.containerRef = (0,react__WEBPACK_IMPORTED_MODULE_1__.createRef)();\r\n    // You must implement three methods: onAdd(), draw(), and onRemove().\r\n    var overlayView = new google.maps.OverlayView();\r\n    overlayView.onAdd = this.onAdd;\r\n    overlayView.draw = this.draw;\r\n    overlayView.onRemove = this.onRemove;\r\n    this.overlayView = overlayView;\r\n  }\r\n  componentDidMount() {\r\n    this.overlayView.setMap(this.context);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    var prevPositionString = convertToLatLngString(prevProps.position);\r\n    var positionString = convertToLatLngString(this.props.position);\r\n    var prevBoundsString = convertToLatLngBoundsString(prevProps.bounds);\r\n    var boundsString = convertToLatLngBoundsString(this.props.bounds);\r\n    if (prevPositionString !== positionString || prevBoundsString !== boundsString) {\r\n      this.overlayView.draw();\r\n    }\r\n    if (prevProps.mapPaneName !== this.props.mapPaneName) {\r\n      this.updatePane();\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    this.overlayView.setMap(null);\r\n  }\r\n  render() {\r\n    var paneEl = this.state.paneEl;\r\n    if (paneEl) {\r\n      return react_dom__WEBPACK_IMPORTED_MODULE_2__.createPortal((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n        ref: this.containerRef,\r\n        style: this.state.containerStyle,\r\n        children: react__WEBPACK_IMPORTED_MODULE_1__.Children.only(this.props.children)\r\n      }), paneEl);\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n_defineProperty(OverlayView, \"FLOAT_PANE\", \"floatPane\");\r\n_defineProperty(OverlayView, \"MAP_PANE\", \"mapPane\");\r\n_defineProperty(OverlayView, \"MARKER_LAYER\", \"markerLayer\");\r\n_defineProperty(OverlayView, \"OVERLAY_LAYER\", \"overlayLayer\");\r\n_defineProperty(OverlayView, \"OVERLAY_MOUSE_TARGET\", \"overlayMouseTarget\");\r\n_defineProperty(OverlayView, \"contextType\", MapContext);\r\n\r\nfunction noop() {\r\n  return;\r\n}\r\n\r\nfunction ownKeys$1(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread$1(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$1(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$1(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$5 = {\r\n  onDblClick: 'dblclick',\r\n  onClick: 'click'\r\n};\r\nvar updaterMap$5 = {\r\n  opacity(instance, opacity) {\r\n    instance.setOpacity(opacity);\r\n  }\r\n};\r\nfunction GroundOverlayFunctional(_ref) {\r\n  var {\r\n    url,\r\n    bounds,\r\n    options,\r\n    visible\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var imageBounds = new google.maps.LatLngBounds(new google.maps.LatLng(bounds.south, bounds.west), new google.maps.LatLng(bounds.north, bounds.east));\r\n  var groundOverlay = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(() => {\r\n    return new google.maps.GroundOverlay(url, imageBounds, options);\r\n  }, []);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (groundOverlay !== null) {\r\n      groundOverlay.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof url !== 'undefined' && groundOverlay !== null) {\r\n      groundOverlay.set('url', url);\r\n      groundOverlay.setMap(map);\r\n    }\r\n  }, [groundOverlay, url]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (typeof visible !== 'undefined' && groundOverlay !== null) {\r\n      groundOverlay.setOpacity(visible ? 1 : 0);\r\n    }\r\n  }, [groundOverlay, visible]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var newBounds = new google.maps.LatLngBounds(new google.maps.LatLng(bounds.south, bounds.west), new google.maps.LatLng(bounds.north, bounds.east));\r\n    if (typeof bounds !== 'undefined' && groundOverlay !== null) {\r\n      groundOverlay.set('bounds', newBounds);\r\n      groundOverlay.setMap(map);\r\n    }\r\n  }, [groundOverlay, bounds]);\r\n  return null;\r\n}\r\nvar GroundOverlayF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(GroundOverlayFunctional);\r\nclass GroundOverlay extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      groundOverlay: null\r\n    });\r\n    _defineProperty(this, \"setGroundOverlayCallback\", () => {\r\n      if (this.state.groundOverlay !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.groundOverlay);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    invariant(!!this.props.url || !!this.props.bounds, \"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655\");\r\n    var groundOverlay = new google.maps.GroundOverlay(this.props.url, this.props.bounds, _objectSpread$1(_objectSpread$1({}, this.props.options), {}, {\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$5,\r\n      eventMap: eventMap$5,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: groundOverlay\r\n    });\r\n    this.setState(function setGroundOverlay() {\r\n      return {\r\n        groundOverlay\r\n      };\r\n    }, this.setGroundOverlayCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.groundOverlay !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$5,\r\n        eventMap: eventMap$5,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.groundOverlay\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.groundOverlay) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.groundOverlay);\r\n      }\r\n      this.state.groundOverlay.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(GroundOverlay, \"defaultProps\", {\r\n  onLoad: noop\r\n});\r\n_defineProperty(GroundOverlay, \"contextType\", MapContext);\r\n\r\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\r\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\r\nvar eventMap$4 = {};\r\nvar updaterMap$4 = {\r\n  data(instance, data) {\r\n    instance.setData(data);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  }\r\n};\r\nfunction HeatmapLayerFunctional(_ref) {\r\n  var {\r\n    data,\r\n    onLoad,\r\n    onUnmount,\r\n    options\r\n  } = _ref;\r\n  var map = (0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(MapContext);\r\n  var [instance, setInstance] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (!google.maps.visualization) {\r\n      invariant(!!google.maps.visualization, 'Did you include prop libraries={[\"visualization\"]} in useJsApiScript? %s', google.maps.visualization);\r\n    }\r\n  }, []);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    invariant(!!data, 'data property is required in HeatmapLayer %s', data);\r\n  }, [data]);\r\n  // Order does matter\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (instance !== null) {\r\n      instance.setMap(map);\r\n    }\r\n  }, [map]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    if (options && instance !== null) {\r\n      instance.setOptions(options);\r\n    }\r\n  }, [instance, options]);\r\n  (0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(() => {\r\n    var heatmapLayer = new google.maps.visualization.HeatmapLayer(_objectSpread(_objectSpread({}, options), {}, {\r\n      data,\r\n      map\r\n    }));\r\n    setInstance(heatmapLayer);\r\n    if (onLoad) {\r\n      onLoad(heatmapLayer);\r\n    }\r\n    return () => {\r\n      if (instance !== null) {\r\n        if (onUnmount) {\r\n          onUnmount(instance);\r\n        }\r\n        instance.setMap(null);\r\n      }\r\n    };\r\n  }, []);\r\n  return null;\r\n}\r\nvar HeatmapLayerF = (0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(HeatmapLayerFunctional);\r\nclass HeatmapLayer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      heatmapLayer: null\r\n    });\r\n    _defineProperty(this, \"setHeatmapLayerCallback\", () => {\r\n      if (this.state.heatmapLayer !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.heatmapLayer);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    invariant(!!google.maps.visualization, 'Did you include prop libraries={[\"visualization\"]} to <LoadScript />? %s', google.maps.visualization);\r\n    invariant(!!this.props.data, 'data property is required in HeatmapLayer %s', this.props.data);\r\n    var heatmapLayer = new google.maps.visualization.HeatmapLayer(_objectSpread(_objectSpread({}, this.props.options), {}, {\r\n      data: this.props.data,\r\n      map: this.context\r\n    }));\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$4,\r\n      eventMap: eventMap$4,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: heatmapLayer\r\n    });\r\n    this.setState(function setHeatmapLayer() {\r\n      return {\r\n        heatmapLayer\r\n      };\r\n    }, this.setHeatmapLayerCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    unregisterEvents(this.registeredEvents);\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$4,\r\n      eventMap: eventMap$4,\r\n      prevProps,\r\n      nextProps: this.props,\r\n      instance: this.state.heatmapLayer\r\n    });\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.heatmapLayer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.heatmapLayer);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.heatmapLayer.setMap(null);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(HeatmapLayer, \"contextType\", MapContext);\r\n\r\nvar eventMap$3 = {\r\n  onCloseClick: 'closeclick',\r\n  onPanoChanged: 'pano_changed',\r\n  onPositionChanged: 'position_changed',\r\n  onPovChanged: 'pov_changed',\r\n  onResize: 'resize',\r\n  onStatusChanged: 'status_changed',\r\n  onVisibleChanged: 'visible_changed',\r\n  onZoomChanged: 'zoom_changed'\r\n};\r\nvar updaterMap$3 = {\r\n  register(instance, provider, options) {\r\n    instance.registerPanoProvider(provider, options);\r\n  },\r\n  links(instance, links) {\r\n    instance.setLinks(links);\r\n  },\r\n  motionTracking(instance, motionTracking) {\r\n    instance.setMotionTracking(motionTracking);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  pano(instance, pano) {\r\n    instance.setPano(pano);\r\n  },\r\n  position(instance, position) {\r\n    instance.setPosition(position);\r\n  },\r\n  pov(instance, pov) {\r\n    instance.setPov(pov);\r\n  },\r\n  visible(instance, visible) {\r\n    instance.setVisible(visible);\r\n  },\r\n  zoom(instance, zoom) {\r\n    instance.setZoom(zoom);\r\n  }\r\n};\r\nclass StreetViewPanorama extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      streetViewPanorama: null\r\n    });\r\n    _defineProperty(this, \"setStreetViewPanoramaCallback\", () => {\r\n      if (this.state.streetViewPanorama !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.streetViewPanorama);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var _this$context$getStre, _this$context;\r\n    var streetViewPanorama = (_this$context$getStre = (_this$context = this.context) === null || _this$context === void 0 ? void 0 : _this$context.getStreetView()) !== null && _this$context$getStre !== void 0 ? _this$context$getStre : null;\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$3,\r\n      eventMap: eventMap$3,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: streetViewPanorama\r\n    });\r\n    this.setState(() => {\r\n      return {\r\n        streetViewPanorama\r\n      };\r\n    }, this.setStreetViewPanoramaCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.streetViewPanorama !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$3,\r\n        eventMap: eventMap$3,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.streetViewPanorama\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.streetViewPanorama !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.streetViewPanorama);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      this.state.streetViewPanorama.setVisible(false);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(StreetViewPanorama, \"contextType\", MapContext);\r\n\r\nclass StreetViewService extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      streetViewService: null\r\n    });\r\n    _defineProperty(this, \"setStreetViewServiceCallback\", () => {\r\n      if (this.state.streetViewService !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.streetViewService);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var streetViewService = new google.maps.StreetViewService();\r\n    this.setState(function setStreetViewService() {\r\n      return {\r\n        streetViewService\r\n      };\r\n    }, this.setStreetViewServiceCallback);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.streetViewService !== null && this.props.onUnmount) {\r\n      this.props.onUnmount(this.state.streetViewService);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(StreetViewService, \"contextType\", MapContext);\r\n\r\nclass DirectionsService extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      directionsService: null\r\n    });\r\n    _defineProperty(this, \"setDirectionsServiceCallback\", () => {\r\n      if (this.state.directionsService !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.directionsService);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    invariant(!!this.props.options, 'DirectionsService expected options object as parameter, but got %s', this.props.options);\r\n    var directionsService = new google.maps.DirectionsService();\r\n    this.setState(function setDirectionsService() {\r\n      return {\r\n        directionsService\r\n      };\r\n    }, this.setDirectionsServiceCallback);\r\n  }\r\n  componentDidUpdate() {\r\n    if (this.state.directionsService !== null) {\r\n      this.state.directionsService.route(this.props.options, this.props.callback);\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.directionsService !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.directionsService);\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n\r\nvar eventMap$2 = {\r\n  onDirectionsChanged: 'directions_changed'\r\n};\r\nvar updaterMap$2 = {\r\n  directions(instance, directions) {\r\n    instance.setDirections(directions);\r\n  },\r\n  map(instance, map) {\r\n    instance.setMap(map);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  panel(instance, panel) {\r\n    instance.setPanel(panel);\r\n  },\r\n  routeIndex(instance, routeIndex) {\r\n    instance.setRouteIndex(routeIndex);\r\n  }\r\n};\r\nclass DirectionsRenderer extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"state\", {\r\n      directionsRenderer: null\r\n    });\r\n    _defineProperty(this, \"setDirectionsRendererCallback\", () => {\r\n      if (this.state.directionsRenderer !== null) {\r\n        this.state.directionsRenderer.setMap(this.context);\r\n        if (this.props.onLoad) {\r\n          this.props.onLoad(this.state.directionsRenderer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var directionsRenderer = new google.maps.DirectionsRenderer(this.props.options);\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap: updaterMap$2,\r\n      eventMap: eventMap$2,\r\n      prevProps: {},\r\n      nextProps: this.props,\r\n      instance: directionsRenderer\r\n    });\r\n    this.setState(function setDirectionsRenderer() {\r\n      return {\r\n        directionsRenderer\r\n      };\r\n    }, this.setDirectionsRendererCallback);\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.directionsRenderer !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$2,\r\n        eventMap: eventMap$2,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.directionsRenderer\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.directionsRenderer !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.directionsRenderer);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n      if (this.state.directionsRenderer) {\r\n        this.state.directionsRenderer.setMap(null);\r\n      }\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n_defineProperty(DirectionsRenderer, \"contextType\", MapContext);\r\n\r\nclass DistanceMatrixService extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"state\", {\r\n      distanceMatrixService: null\r\n    });\r\n    _defineProperty(this, \"setDistanceMatrixServiceCallback\", () => {\r\n      if (this.state.distanceMatrixService !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.distanceMatrixService);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    invariant(!!this.props.options, 'DistanceMatrixService expected options object as parameter, but go %s', this.props.options);\r\n    var distanceMatrixService = new google.maps.DistanceMatrixService();\r\n    this.setState(function setDistanceMatrixService() {\r\n      return {\r\n        distanceMatrixService\r\n      };\r\n    }, this.setDistanceMatrixServiceCallback);\r\n  }\r\n  componentDidUpdate() {\r\n    if (this.state.distanceMatrixService !== null) {\r\n      this.state.distanceMatrixService.getDistanceMatrix(this.props.options, this.props.callback);\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.distanceMatrixService !== null && this.props.onUnmount) {\r\n      this.props.onUnmount(this.state.distanceMatrixService);\r\n    }\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n\r\nvar eventMap$1 = {\r\n  onPlacesChanged: 'places_changed'\r\n};\r\nvar updaterMap$1 = {\r\n  bounds(instance, bounds) {\r\n    instance.setBounds(bounds);\r\n  }\r\n};\r\nclass StandaloneSearchBox extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"containerElement\", (0,react__WEBPACK_IMPORTED_MODULE_1__.createRef)());\r\n    _defineProperty(this, \"state\", {\r\n      searchBox: null\r\n    });\r\n    _defineProperty(this, \"setSearchBoxCallback\", () => {\r\n      if (this.state.searchBox !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.searchBox);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    invariant(!!google.maps.places, 'You need to provide libraries={[\"places\"]} prop to <LoadScript /> component %s', google.maps.places);\r\n    if (this.containerElement !== null && this.containerElement.current !== null) {\r\n      var input = this.containerElement.current.querySelector('input');\r\n      if (input !== null) {\r\n        var searchBox = new google.maps.places.SearchBox(input, this.props.options);\r\n        this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n          updaterMap: updaterMap$1,\r\n          eventMap: eventMap$1,\r\n          prevProps: {},\r\n          nextProps: this.props,\r\n          instance: searchBox\r\n        });\r\n        this.setState(function setSearchBox() {\r\n          return {\r\n            searchBox\r\n          };\r\n        }, this.setSearchBoxCallback);\r\n      }\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    if (this.state.searchBox !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap: updaterMap$1,\r\n        eventMap: eventMap$1,\r\n        prevProps,\r\n        nextProps: this.props,\r\n        instance: this.state.searchBox\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.searchBox !== null) {\r\n      if (this.props.onUnmount) {\r\n        this.props.onUnmount(this.state.searchBox);\r\n      }\r\n      unregisterEvents(this.registeredEvents);\r\n    }\r\n  }\r\n  render() {\r\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n      ref: this.containerElement,\r\n      children: react__WEBPACK_IMPORTED_MODULE_1__.Children.only(this.props.children)\r\n    });\r\n  }\r\n}\r\n_defineProperty(StandaloneSearchBox, \"contextType\", MapContext);\r\n\r\nvar eventMap = {\r\n  onPlaceChanged: 'place_changed'\r\n};\r\nvar updaterMap = {\r\n  bounds(instance, bounds) {\r\n    instance.setBounds(bounds);\r\n  },\r\n  restrictions(instance, restrictions) {\r\n    instance.setComponentRestrictions(restrictions);\r\n  },\r\n  fields(instance, fields) {\r\n    instance.setFields(fields);\r\n  },\r\n  options(instance, options) {\r\n    instance.setOptions(options);\r\n  },\r\n  types(instance, types) {\r\n    instance.setTypes(types);\r\n  }\r\n};\r\nclass Autocomplete extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\r\n  constructor() {\r\n    super(...arguments);\r\n    _defineProperty(this, \"registeredEvents\", []);\r\n    _defineProperty(this, \"containerElement\", (0,react__WEBPACK_IMPORTED_MODULE_1__.createRef)());\r\n    _defineProperty(this, \"state\", {\r\n      autocomplete: null\r\n    });\r\n    _defineProperty(this, \"setAutocompleteCallback\", () => {\r\n      if (this.state.autocomplete !== null && this.props.onLoad) {\r\n        this.props.onLoad(this.state.autocomplete);\r\n      }\r\n    });\r\n  }\r\n  componentDidMount() {\r\n    var _this$containerElemen;\r\n    invariant(!!google.maps.places, 'You need to provide libraries={[\"places\"]} prop to <LoadScript /> component %s', google.maps.places);\r\n    // TODO: why current could be equal null?\r\n    var input = (_this$containerElemen = this.containerElement.current) === null || _this$containerElemen === void 0 ? void 0 : _this$containerElemen.querySelector('input');\r\n    if (input) {\r\n      var autocomplete = new google.maps.places.Autocomplete(input, this.props.options);\r\n      this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n        updaterMap,\r\n        eventMap,\r\n        prevProps: {},\r\n        nextProps: this.props,\r\n        instance: autocomplete\r\n      });\r\n      this.setState(() => {\r\n        return {\r\n          autocomplete\r\n        };\r\n      }, this.setAutocompleteCallback);\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n    unregisterEvents(this.registeredEvents);\r\n    this.registeredEvents = applyUpdatersToPropsAndRegisterEvents({\r\n      updaterMap,\r\n      eventMap,\r\n      prevProps,\r\n      nextProps: this.props,\r\n      instance: this.state.autocomplete\r\n    });\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.state.autocomplete !== null) {\r\n      unregisterEvents(this.registeredEvents);\r\n    }\r\n  }\r\n  render() {\r\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\r\n      ref: this.containerElement,\r\n      className: this.props.className,\r\n      children: react__WEBPACK_IMPORTED_MODULE_1__.Children.only(this.props.children)\r\n    });\r\n  }\r\n}\r\n_defineProperty(Autocomplete, \"defaultProps\", {\r\n  className: ''\r\n});\r\n_defineProperty(Autocomplete, \"contextType\", MapContext);\r\n\r\n\r\n//# sourceMappingURL=esm.js.map\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AcmVhY3QtZ29vZ2xlLW1hcHMvYXBpL2Rpc3QvZXNtLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDd0c7QUFDMUg7QUFDRztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsYUFBb0I7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdEO0FBQ3hELFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLG9EQUFhO0FBQzlCO0FBQ0EsY0FBYyw2Q0FBVTtBQUN4QixZQUFZLGlEQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixpREFBaUQ7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBLDhGQUE4RixhQUFhO0FBQzNHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxHQUFHO0FBQ1Y7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLGtCQUFrQiw2Q0FBTTtBQUN4Qiw4QkFBOEIsK0NB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LEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYLDBFQUEwRTtBQUMxRTtBQUNBLEtBQUssS0FBSztBQUNWO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsMENBQTBDLGdCQUFnQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IseUJBQXlCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxnQkFBZ0I7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGdCQUFnQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsNEJBQTRCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsdUJBQXVCO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNO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QTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSx1QkFBdUIsMkNBQUk7QUFDM0IsaUNBQWlDLGdEQUFhO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRDtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLHNCQUFzQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsdURBQXVEO0FBQ3BGO0FBQ0Esa0NBQWtDLEdBQUc7QUFDckMsK0JBQStCO0FBQy9CLG1EQUFtRDtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxnQkFBZ0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsd0JBQXdCLG9DQUFvQyx5Q0FBeUMsa0NBQWtDLDBEQUEwRCwwQkFBMEI7QUFDdFAsOEJBQThCLGdCQUFnQixzQkFBc0IsT0FBTyxrREFBa0Qsd0RBQXdELDhCQUE4QixxSkFBcUoscUVBQXFFLEtBQUs7QUFDbGI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixZQUFZLGlEQUFVO0FBQ3RCLGdDQUFnQywrQ0FBUTtBQUN4QyxvREFBb0QsK0NBQVE7QUFDNUQsMERBQTBELCtDQUFRO0FBQ2xFLHNFQUFzRSwrQ0FBUTtBQUM5RSx3RUFBd0UsK0NBQVE7QUFDaEYsb0VBQW9FLCtDQUFRO0FBQzVFLDRCQUE0Qiw2Q0FBTTtBQUNsQztBQUNBLEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFO0FBQ2xFO0FBQ0EsUUFBUSxJQUFJO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixpQkFBaUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQTtBQUNBLHVDQUF1QztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0Esd0JBQXdCLFlBQVk7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixhQUFhO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGtCQUFrQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRIQUE0SCxjQUFjO0FBQzFJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLGFBQWE7QUFDNUI7QUFDQSw0QkFBNEIsUUFBUTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsNEJBQTRCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtFQUErRSxzQkFBc0I7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELHNCQUFzQjtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsTUFBTTtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxTQUFTLElBQUk7QUFDL0M7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxzREFBc0Q7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiw4QkFBOEI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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LEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdE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QUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYLGdGQUFnRixjQUFjO0FBQzlGO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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REFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1gsMEVBQTBFLGdDQUFnQztBQUMxRztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxFQUFFLGdEQUFTO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUUsZ0RBQVM7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsRUFBRSxnREFBUztBQUNYO0FBQ0Esd0VBQXdFLGNBQWM7QUFDdEY7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnREFBYTtBQUN4QztBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsZ0RBQVM7QUFDdkQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxvRUFBb0UsWUFBWTtBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxzREFBRztBQUNkO0FBQ0E7QUFDQSxnQkFBZ0IsMkNBQVE7QUFDeEIsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDNjJCO0FBQzcyQiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9ub2RlX21vZHVsZXMvQHJlYWN0LWdvb2dsZS1tYXBzL2FwaS9kaXN0L2VzbS5qcz8yN2YwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGpzeCwganN4cywgRnJhZ21lbnQgfSBmcm9tICdyZWFjdC9qc3gtcnVudGltZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUNvbnRleHQsIHVzZUNvbnRleHQsIG1lbW8sIHVzZVN0YXRlLCB1c2VSZWYsIHVzZUVmZmVjdCwgUHVyZUNvbXBvbmVudCwgdXNlTWVtbywgQ2hpbGRyZW4sIGlzVmFsaWRFbGVtZW50LCBjbG9uZUVsZW1lbnQsIGNyZWF0ZVJlZiB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0ICogYXMgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IHsgY3JlYXRlUG9ydGFsIH0gZnJvbSAncmVhY3QtZG9tJztcclxuXHJcbmZ1bmN0aW9uIF90eXBlb2Yobykge1xyXG4gIFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjtcclxuXHJcbiAgcmV0dXJuIF90eXBlb2YgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBcInN5bWJvbFwiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAobykge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBvO1xyXG4gIH0gOiBmdW5jdGlvbiAobykge1xyXG4gICAgcmV0dXJuIG8gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG87XHJcbiAgfSwgX3R5cGVvZihvKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9QcmltaXRpdmUodCwgcikge1xyXG4gIGlmIChcIm9iamVjdFwiICE9IF90eXBlb2YodCkgfHwgIXQpIHJldHVybiB0O1xyXG4gIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdO1xyXG4gIGlmICh2b2lkIDAgIT09IGUpIHtcclxuICAgIHZhciBpID0gZS5jYWxsKHQsIHIgfHwgXCJkZWZhdWx0XCIpO1xyXG4gICAgaWYgKFwib2JqZWN0XCIgIT0gX3R5cGVvZihpKSkgcmV0dXJuIGk7XHJcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS5cIik7XHJcbiAgfVxyXG4gIHJldHVybiAoXCJzdHJpbmdcIiA9PT0gciA/IFN0cmluZyA6IE51bWJlcikodCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvUHJvcGVydHlLZXkodCkge1xyXG4gIHZhciBpID0gdG9QcmltaXRpdmUodCwgXCJzdHJpbmdcIik7XHJcbiAgcmV0dXJuIFwic3ltYm9sXCIgPT0gX3R5cGVvZihpKSA/IGkgOiBpICsgXCJcIjtcclxufVxyXG5cclxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KGUsIHIsIHQpIHtcclxuICByZXR1cm4gKHIgPSB0b1Byb3BlcnR5S2V5KHIpKSBpbiBlID8gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIHtcclxuICAgIHZhbHVlOiB0LFxyXG4gICAgZW51bWVyYWJsZTogITAsXHJcbiAgICBjb25maWd1cmFibGU6ICEwLFxyXG4gICAgd3JpdGFibGU6ICEwXHJcbiAgfSkgOiBlW3JdID0gdCwgZTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMSAoeCkge1xyXG5cdHJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cclxuICovXHJcbnZhciBpbnZhcmlhbnRfMTtcclxudmFyIGhhc1JlcXVpcmVkSW52YXJpYW50O1xyXG5mdW5jdGlvbiByZXF1aXJlSW52YXJpYW50KCkge1xyXG4gIGlmIChoYXNSZXF1aXJlZEludmFyaWFudCkgcmV0dXJuIGludmFyaWFudF8xO1xyXG4gIGhhc1JlcXVpcmVkSW52YXJpYW50ID0gMTtcclxuXHJcbiAgLyoqXHJcbiAgICogVXNlIGludmFyaWFudCgpIHRvIGFzc2VydCBzdGF0ZSB3aGljaCB5b3VyIHByb2dyYW0gYXNzdW1lcyB0byBiZSB0cnVlLlxyXG4gICAqXHJcbiAgICogUHJvdmlkZSBzcHJpbnRmLXN0eWxlIGZvcm1hdCAob25seSAlcyBpcyBzdXBwb3J0ZWQpIGFuZCBhcmd1bWVudHNcclxuICAgKiB0byBwcm92aWRlIGluZm9ybWF0aW9uIGFib3V0IHdoYXQgYnJva2UgYW5kIHdoYXQgeW91IHdlcmVcclxuICAgKiBleHBlY3RpbmcuXHJcbiAgICpcclxuICAgKiBUaGUgaW52YXJpYW50IG1lc3NhZ2Ugd2lsbCBiZSBzdHJpcHBlZCBpbiBwcm9kdWN0aW9uLCBidXQgdGhlIGludmFyaWFudFxyXG4gICAqIHdpbGwgcmVtYWluIHRvIGVuc3VyZSBsb2dpYyBkb2VzIG5vdCBkaWZmZXIgaW4gcHJvZHVjdGlvbi5cclxuICAgKi9cclxuXHJcbiAgdmFyIE5PREVfRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XHJcbiAgdmFyIGludmFyaWFudCA9IGZ1bmN0aW9uIGludmFyaWFudChjb25kaXRpb24sIGZvcm1hdCwgYSwgYiwgYywgZCwgZSwgZikge1xyXG4gICAgaWYgKE5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgaWYgKGZvcm1hdCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhcmlhbnQgcmVxdWlyZXMgYW4gZXJyb3IgbWVzc2FnZSBhcmd1bWVudCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIWNvbmRpdGlvbikge1xyXG4gICAgICB2YXIgZXJyb3I7XHJcbiAgICAgIGlmIChmb3JtYXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGVycm9yID0gbmV3IEVycm9yKCdNaW5pZmllZCBleGNlcHRpb24gb2NjdXJyZWQ7IHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCAnICsgJ2ZvciB0aGUgZnVsbCBlcnJvciBtZXNzYWdlIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSBbYSwgYiwgYywgZCwgZSwgZl07XHJcbiAgICAgICAgdmFyIGFyZ0luZGV4ID0gMDtcclxuICAgICAgICBlcnJvciA9IG5ldyBFcnJvcihmb3JtYXQucmVwbGFjZSgvJXMvZywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIGFyZ3NbYXJnSW5kZXgrK107XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGVycm9yLm5hbWUgPSAnSW52YXJpYW50IFZpb2xhdGlvbic7XHJcbiAgICAgIH1cclxuICAgICAgZXJyb3IuZnJhbWVzVG9Qb3AgPSAxOyAvLyB3ZSBkb24ndCBjYXJlIGFib3V0IGludmFyaWFudCdzIG93biBmcmFtZVxyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9O1xyXG4gIGludmFyaWFudF8xID0gaW52YXJpYW50O1xyXG4gIHJldHVybiBpbnZhcmlhbnRfMTtcclxufVxyXG5cclxudmFyIGludmFyaWFudEV4cG9ydHMgPSByZXF1aXJlSW52YXJpYW50KCk7XHJcbnZhciBpbnZhcmlhbnQgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMShpbnZhcmlhbnRFeHBvcnRzKTtcclxuXHJcbnZhciBNYXBDb250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKTtcclxuZnVuY3Rpb24gdXNlR29vZ2xlTWFwKCkge1xyXG4gIGludmFyaWFudCghIXVzZUNvbnRleHQsICd1c2VHb29nbGVNYXAgaXMgUmVhY3QgaG9vayBhbmQgcmVxdWlyZXMgUmVhY3QgdmVyc2lvbiAxNi44KycpO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIGludmFyaWFudCghIW1hcCwgJ3VzZUdvb2dsZU1hcCBuZWVkcyBhIEdvb2dsZU1hcCBhdmFpbGFibGUgdXAgaW4gdGhlIHRyZWUnKTtcclxuICByZXR1cm4gbWFwO1xyXG59XHJcblxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5mdW5jdGlvbiByZWR1Y2Uob2JqLCBmbiwgYWNjKSB7XHJcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikucmVkdWNlKGZ1bmN0aW9uIHJlZHVjZXIobmV3QWNjLCBrZXkpIHtcclxuICAgIHJldHVybiBmbihuZXdBY2MsIG9ialtrZXldLCBrZXkpO1xyXG4gIH0sIGFjYyk7XHJcbn1cclxuXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmZ1bmN0aW9uIGZvckVhY2gob2JqLCBmbikge1xyXG4gIE9iamVjdC5rZXlzKG9iaikuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgcmV0dXJuIGZuKG9ialtrZXldLCBrZXkpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKiBnbG9iYWwgZ29vZ2xlICovXHJcbi8qIGVzbGludC1kaXNhYmxlIGZpbGVuYW1lcy9tYXRjaC1yZWdleCAqL1xyXG5mdW5jdGlvbiBhcHBseVVwZGF0ZXJUb05leHRQcm9wcyhcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxudXBkYXRlck1hcCxcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxucHJldlByb3BzLFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5uZXh0UHJvcHMsXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmluc3RhbmNlXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbikge1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgdmFyIG1hcCA9IHt9O1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgdmFyIGl0ZXIgPSAoZm4sIGtleSkgPT4ge1xyXG4gICAgdmFyIG5leHRWYWx1ZSA9IG5leHRQcm9wc1trZXldO1xyXG4gICAgaWYgKG5leHRWYWx1ZSAhPT0gcHJldlByb3BzW2tleV0pIHtcclxuICAgICAgbWFwW2tleV0gPSBuZXh0VmFsdWU7XHJcbiAgICAgIGZuKGluc3RhbmNlLCBuZXh0VmFsdWUpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgZm9yRWFjaCh1cGRhdGVyTWFwLCBpdGVyKTtcclxuICByZXR1cm4gbWFwO1xyXG59XHJcbmZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRzKFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5wcm9wcyxcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuaW5zdGFuY2UsIGV2ZW50TWFwKSB7XHJcbiAgdmFyIHJlZ2lzdGVyZWRMaXN0ID0gcmVkdWNlKGV2ZW50TWFwLCBmdW5jdGlvbiByZWR1Y2VyKGFjYywgZ29vZ2xlRXZlbnROYW1lLFxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgb25FdmVudE5hbWUpIHtcclxuICAgIGlmICh0eXBlb2YgcHJvcHNbb25FdmVudE5hbWVdID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGFjYy5wdXNoKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCBnb29nbGVFdmVudE5hbWUsIHByb3BzW29uRXZlbnROYW1lXSkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFjYztcclxuICB9LCBbXSk7XHJcbiAgcmV0dXJuIHJlZ2lzdGVyZWRMaXN0O1xyXG59XHJcbmZ1bmN0aW9uIHVucmVnaXN0ZXJFdmVudChyZWdpc3RlcmVkKSB7XHJcbiAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmVnaXN0ZXJlZCk7XHJcbn1cclxuZnVuY3Rpb24gdW5yZWdpc3RlckV2ZW50cygpIHtcclxuICB2YXIgZXZlbnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTtcclxuICBldmVudHMuZm9yRWFjaCh1bnJlZ2lzdGVyRXZlbnQpO1xyXG59XHJcbmZ1bmN0aW9uIGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICB1cGRhdGVyTWFwLFxyXG4gICAgZXZlbnRNYXAsXHJcbiAgICBwcmV2UHJvcHMsXHJcbiAgICBuZXh0UHJvcHMsXHJcbiAgICBpbnN0YW5jZVxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciByZWdpc3RlcmVkRXZlbnRzID0gcmVnaXN0ZXJFdmVudHMobmV4dFByb3BzLCBpbnN0YW5jZSwgZXZlbnRNYXApO1xyXG4gIGFwcGx5VXBkYXRlclRvTmV4dFByb3BzKHVwZGF0ZXJNYXAsIHByZXZQcm9wcywgbmV4dFByb3BzLCBpbnN0YW5jZSk7XHJcbiAgcmV0dXJuIHJlZ2lzdGVyZWRFdmVudHM7XHJcbn1cclxuXHJcbnZhciBldmVudE1hcCRpID0ge1xyXG4gIG9uRGJsQ2xpY2s6ICdkYmxjbGljaycsXHJcbiAgb25EcmFnRW5kOiAnZHJhZ2VuZCcsXHJcbiAgb25EcmFnU3RhcnQ6ICdkcmFnc3RhcnQnLFxyXG4gIG9uTWFwVHlwZUlkQ2hhbmdlZDogJ21hcHR5cGVpZF9jaGFuZ2VkJyxcclxuICBvbk1vdXNlTW92ZTogJ21vdXNlbW92ZScsXHJcbiAgb25Nb3VzZU91dDogJ21vdXNlb3V0JyxcclxuICBvbk1vdXNlT3ZlcjogJ21vdXNlb3ZlcicsXHJcbiAgb25Nb3VzZURvd246ICdtb3VzZWRvd24nLFxyXG4gIG9uTW91c2VVcDogJ21vdXNldXAnLFxyXG4gIG9uUmlnaHRDbGljazogJ3JpZ2h0Y2xpY2snLFxyXG4gIG9uVGlsZXNMb2FkZWQ6ICd0aWxlc2xvYWRlZCcsXHJcbiAgb25Cb3VuZHNDaGFuZ2VkOiAnYm91bmRzX2NoYW5nZWQnLFxyXG4gIG9uQ2VudGVyQ2hhbmdlZDogJ2NlbnRlcl9jaGFuZ2VkJyxcclxuICBvbkNsaWNrOiAnY2xpY2snLFxyXG4gIG9uRHJhZzogJ2RyYWcnLFxyXG4gIG9uSGVhZGluZ0NoYW5nZWQ6ICdoZWFkaW5nX2NoYW5nZWQnLFxyXG4gIG9uSWRsZTogJ2lkbGUnLFxyXG4gIG9uUHJvamVjdGlvbkNoYW5nZWQ6ICdwcm9qZWN0aW9uX2NoYW5nZWQnLFxyXG4gIG9uUmVzaXplOiAncmVzaXplJyxcclxuICBvblRpbHRDaGFuZ2VkOiAndGlsdF9jaGFuZ2VkJyxcclxuICBvblpvb21DaGFuZ2VkOiAnem9vbV9jaGFuZ2VkJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCRpID0ge1xyXG4gIGV4dHJhTWFwVHlwZXMobWFwLCBleHRyYSkge1xyXG4gICAgZXh0cmEuZm9yRWFjaChmdW5jdGlvbiBmb3JFYWNoRXh0cmEoaXQsIGkpIHtcclxuICAgICAgbWFwLm1hcFR5cGVzLnNldChTdHJpbmcoaSksIGl0KTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgY2VudGVyKG1hcCwgY2VudGVyKSB7XHJcbiAgICBtYXAuc2V0Q2VudGVyKGNlbnRlcik7XHJcbiAgfSxcclxuICBjbGlja2FibGVJY29ucyhtYXAsIGNsaWNrYWJsZSkge1xyXG4gICAgbWFwLnNldENsaWNrYWJsZUljb25zKGNsaWNrYWJsZSk7XHJcbiAgfSxcclxuICBoZWFkaW5nKG1hcCwgaGVhZGluZykge1xyXG4gICAgbWFwLnNldEhlYWRpbmcoaGVhZGluZyk7XHJcbiAgfSxcclxuICBtYXBUeXBlSWQobWFwLCBtYXBUeXBlSWQpIHtcclxuICAgIG1hcC5zZXRNYXBUeXBlSWQobWFwVHlwZUlkKTtcclxuICB9LFxyXG4gIG9wdGlvbnMobWFwLCBvcHRpb25zKSB7XHJcbiAgICBtYXAuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHN0cmVldFZpZXcobWFwLCBzdHJlZXRWaWV3KSB7XHJcbiAgICBtYXAuc2V0U3RyZWV0VmlldyhzdHJlZXRWaWV3KTtcclxuICB9LFxyXG4gIHRpbHQobWFwLCB0aWx0KSB7XHJcbiAgICBtYXAuc2V0VGlsdCh0aWx0KTtcclxuICB9LFxyXG4gIHpvb20obWFwLCB6b29tKSB7XHJcbiAgICBtYXAuc2V0Wm9vbSh6b29tKTtcclxuICB9XHJcbn07XHJcbi8vIFRPRE86IHVuZmluaXNoZWQhXHJcbmZ1bmN0aW9uIEdvb2dsZU1hcEZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBjaGlsZHJlbixcclxuICAgIG9wdGlvbnMsXHJcbiAgICBpZCxcclxuICAgIG1hcENvbnRhaW5lclN0eWxlLFxyXG4gICAgbWFwQ29udGFpbmVyQ2xhc3NOYW1lLFxyXG4gICAgY2VudGVyLFxyXG4gICAgLy8gY2xpY2thYmxlSWNvbnMsXHJcbiAgICAvLyBleHRyYU1hcFR5cGVzLFxyXG4gICAgLy8gaGVhZGluZyxcclxuICAgIC8vIG1hcFR5cGVJZCxcclxuICAgIG9uQ2xpY2ssXHJcbiAgICBvbkRibENsaWNrLFxyXG4gICAgb25EcmFnLFxyXG4gICAgb25EcmFnRW5kLFxyXG4gICAgb25EcmFnU3RhcnQsXHJcbiAgICBvbk1vdXNlTW92ZSxcclxuICAgIG9uTW91c2VPdXQsXHJcbiAgICBvbk1vdXNlT3ZlcixcclxuICAgIG9uTW91c2VEb3duLFxyXG4gICAgb25Nb3VzZVVwLFxyXG4gICAgb25SaWdodENsaWNrLFxyXG4gICAgLy8gb25NYXBUeXBlSWRDaGFuZ2VkLFxyXG4gICAgLy8gb25UaWxlc0xvYWRlZCxcclxuICAgIC8vIG9uQm91bmRzQ2hhbmdlZCxcclxuICAgIG9uQ2VudGVyQ2hhbmdlZCxcclxuICAgIC8vIG9uSGVhZGluZ0NoYW5nZWQsXHJcbiAgICAvLyBvbklkbGUsXHJcbiAgICAvLyBvblByb2plY3Rpb25DaGFuZ2VkLFxyXG4gICAgLy8gb25SZXNpemUsXHJcbiAgICAvLyBvblRpbHRDaGFuZ2VkLFxyXG4gICAgLy8gb25ab29tQ2hhbmdlZCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBbbWFwLCBzZXRNYXBdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIHJlZiA9IHVzZVJlZihudWxsKTtcclxuICAvLyBjb25zdCBbZXh0cmFNYXBUeXBlc0xpc3RlbmVyLCBzZXRFeHRyYU1hcFR5cGVzTGlzdGVuZXJdID0gdXNlU3RhdGU8Z29vZ2xlLm1hcHMuTWFwc0V2ZW50TGlzdGVuZXIgfCBudWxsPihudWxsKVxyXG4gIHZhciBbY2VudGVyQ2hhbmdlZExpc3RlbmVyLCBzZXRDZW50ZXJDaGFuZ2VkTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkYmxjbGlja0xpc3RlbmVyLCBzZXREYmxjbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ2VuZExpc3RlbmVyLCBzZXREcmFnZW5kTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnc3RhcnRMaXN0ZW5lciwgc2V0RHJhZ3N0YXJ0TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZWRvd25MaXN0ZW5lciwgc2V0TW91c2Vkb3duTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW1vdmVMaXN0ZW5lciwgc2V0TW91c2Vtb3ZlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW91dExpc3RlbmVyLCBzZXRNb3VzZW91dExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdmVyTGlzdGVuZXIsIHNldE1vdXNlb3Zlckxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2V1cExpc3RlbmVyLCBzZXRNb3VzZXVwTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyaWdodGNsaWNrTGlzdGVuZXIsIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NsaWNrTGlzdGVuZXIsIHNldENsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnTGlzdGVuZXIsIHNldERyYWdMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucyAmJiBtYXAgIT09IG51bGwpIHtcclxuICAgICAgbWFwLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSwgW21hcCwgb3B0aW9uc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobWFwICE9PSBudWxsICYmIHR5cGVvZiBjZW50ZXIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIG1hcC5zZXRDZW50ZXIoY2VudGVyKTtcclxuICAgIH1cclxuICB9LCBbbWFwLCBjZW50ZXJdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbkRibENsaWNrKSB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25EYmxDbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobWFwICYmIG9uRHJhZ0VuZCkge1xyXG4gICAgICBpZiAoZHJhZ2VuZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ2VuZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnZW5kTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnZHJhZ2VuZCcsIG9uRHJhZ0VuZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWdFbmRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbkRyYWdTdGFydCkge1xyXG4gICAgICBpZiAoZHJhZ3N0YXJ0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnc3RhcnRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ3N0YXJ0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnU3RhcnRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbk1vdXNlRG93bikge1xyXG4gICAgICBpZiAobW91c2Vkb3duTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZWRvd25MaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vkb3duTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnbW91c2Vkb3duJywgb25Nb3VzZURvd24pKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZURvd25dKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbk1vdXNlTW92ZSkge1xyXG4gICAgICBpZiAobW91c2Vtb3ZlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW1vdmVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vtb3ZlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU1vdmVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbk1vdXNlT3V0KSB7XHJcbiAgICAgIGlmIChtb3VzZW91dExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdXRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU91dF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobWFwICYmIG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW92ZXJMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlT3Zlcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobWFwICYmIG9uTW91c2VVcCkge1xyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZXVwTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnbW91c2V1cCcsIG9uTW91c2VVcCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlVXBdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgaWYgKHJpZ2h0Y2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJpZ2h0Y2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UmlnaHRjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25SaWdodENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChtYXAgJiYgb25DbGljaykge1xyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnY2xpY2snLCBvbkNsaWNrKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG1hcCAmJiBvbkRyYWcpIHtcclxuICAgICAgaWYgKGRyYWdMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2RyYWcnLCBvbkRyYWcpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChtYXAgJiYgb25DZW50ZXJDaGFuZ2VkKSB7XHJcbiAgICAgIGlmIChjZW50ZXJDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjZW50ZXJDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENlbnRlckNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdjZW50ZXJfY2hhbmdlZCcsIG9uQ2VudGVyQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHZhciBtYXAgPSByZWYuY3VycmVudCA9PT0gbnVsbCA/IG51bGwgOiBuZXcgZ29vZ2xlLm1hcHMuTWFwKHJlZi5jdXJyZW50LCBvcHRpb25zKTtcclxuICAgIHNldE1hcChtYXApO1xyXG4gICAgaWYgKG1hcCAhPT0gbnVsbCAmJiBvbkxvYWQpIHtcclxuICAgICAgb25Mb2FkKG1hcCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAobWFwICE9PSBudWxsKSB7XHJcbiAgICAgICAgaWYgKG9uVW5tb3VudCkge1xyXG4gICAgICAgICAgb25Vbm1vdW50KG1hcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4ganN4KFwiZGl2XCIsIHtcclxuICAgIGlkOiBpZCxcclxuICAgIHJlZjogcmVmLFxyXG4gICAgc3R5bGU6IG1hcENvbnRhaW5lclN0eWxlLFxyXG4gICAgY2xhc3NOYW1lOiBtYXBDb250YWluZXJDbGFzc05hbWUsXHJcbiAgICBjaGlsZHJlbjoganN4KE1hcENvbnRleHQuUHJvdmlkZXIsIHtcclxuICAgICAgdmFsdWU6IG1hcCxcclxuICAgICAgY2hpbGRyZW46IG1hcCAhPT0gbnVsbCA/IGNoaWxkcmVuIDogbnVsbFxyXG4gICAgfSlcclxuICB9KTtcclxufVxyXG5tZW1vKEdvb2dsZU1hcEZ1bmN0aW9uYWwpO1xyXG5jbGFzcyBHb29nbGVNYXAgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIG1hcDogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZWdpc3RlcmVkRXZlbnRzXCIsIFtdKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1hcFJlZlwiLCBudWxsKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImdldEluc3RhbmNlXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMubWFwUmVmID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5NYXAodGhpcy5tYXBSZWYsIHRoaXMucHJvcHMub3B0aW9ucyk7XHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInBhblRvXCIsIGxhdExuZyA9PiB7XHJcbiAgICAgIHZhciBtYXAgPSB0aGlzLmdldEluc3RhbmNlKCk7XHJcbiAgICAgIGlmIChtYXApIHtcclxuICAgICAgICBtYXAucGFuVG8obGF0TG5nKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRNYXBDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLm1hcCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQodGhpcy5zdGF0ZS5tYXApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJnZXRSZWZcIiwgcmVmID0+IHtcclxuICAgICAgdGhpcy5tYXBSZWYgPSByZWY7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB2YXIgbWFwID0gdGhpcy5nZXRJbnN0YW5jZSgpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkaSxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGksXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IG1hcFxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldE1hcCgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBtYXBcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0TWFwQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5tYXAgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGksXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGksXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5tYXBcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUubWFwICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUubWFwKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBqc3goXCJkaXZcIiwge1xyXG4gICAgICBpZDogdGhpcy5wcm9wcy5pZCxcclxuICAgICAgcmVmOiB0aGlzLmdldFJlZixcclxuICAgICAgc3R5bGU6IHRoaXMucHJvcHMubWFwQ29udGFpbmVyU3R5bGUsXHJcbiAgICAgIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5tYXBDb250YWluZXJDbGFzc05hbWUsXHJcbiAgICAgIGNoaWxkcmVuOiBqc3goTWFwQ29udGV4dC5Qcm92aWRlciwge1xyXG4gICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLm1hcCxcclxuICAgICAgICBjaGlsZHJlbjogdGhpcy5zdGF0ZS5tYXAgIT09IG51bGwgPyB0aGlzLnByb3BzLmNoaWxkcmVuIDogbnVsbFxyXG4gICAgICB9KVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAobiwgdCwgZSwgciwgbywgYSwgYykge1xyXG4gIHRyeSB7XHJcbiAgICB2YXIgaSA9IG5bYV0oYyksXHJcbiAgICAgIHUgPSBpLnZhbHVlO1xyXG4gIH0gY2F0Y2ggKG4pIHtcclxuICAgIHJldHVybiB2b2lkIGUobik7XHJcbiAgfVxyXG4gIGkuZG9uZSA/IHQodSkgOiBQcm9taXNlLnJlc29sdmUodSkudGhlbihyLCBvKTtcclxufVxyXG5mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihuKSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciB0ID0gdGhpcyxcclxuICAgICAgZSA9IGFyZ3VtZW50cztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAociwgbykge1xyXG4gICAgICB2YXIgYSA9IG4uYXBwbHkodCwgZSk7XHJcbiAgICAgIGZ1bmN0aW9uIF9uZXh0KG4pIHtcclxuICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoYSwgciwgbywgX25leHQsIF90aHJvdywgXCJuZXh0XCIsIG4pO1xyXG4gICAgICB9XHJcbiAgICAgIGZ1bmN0aW9uIF90aHJvdyhuKSB7XHJcbiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGEsIHIsIG8sIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgbik7XHJcbiAgICAgIH1cclxuICAgICAgX25leHQodm9pZCAwKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1ha2VMb2FkU2NyaXB0VXJsKF9yZWYpIHtcclxuICB2YXIge1xyXG4gICAgZ29vZ2xlTWFwc0FwaUtleSxcclxuICAgIGdvb2dsZU1hcHNDbGllbnRJZCxcclxuICAgIHZlcnNpb24gPSAnd2Vla2x5JyxcclxuICAgIGxhbmd1YWdlLFxyXG4gICAgcmVnaW9uLFxyXG4gICAgbGlicmFyaWVzLFxyXG4gICAgY2hhbm5lbCxcclxuICAgIG1hcElkcyxcclxuICAgIGF1dGhSZWZlcnJlclBvbGljeSxcclxuICAgIGFwaVVybCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20nXHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIHBhcmFtcyA9IFtdO1xyXG4gIGludmFyaWFudChnb29nbGVNYXBzQXBpS2V5ICYmIGdvb2dsZU1hcHNDbGllbnRJZCB8fCAhKGdvb2dsZU1hcHNBcGlLZXkgJiYgZ29vZ2xlTWFwc0NsaWVudElkKSwgJ1lvdSBuZWVkIHRvIHNwZWNpZnkgZWl0aGVyIGdvb2dsZU1hcHNBcGlLZXkgb3IgZ29vZ2xlTWFwc0NsaWVudElkIGZvciBAcmVhY3QtZ29vZ2xlLW1hcHMvYXBpIGxvYWQgc2NyaXB0IHRvIHdvcmsuIFlvdSBjYW5ub3QgdXNlIGJvdGggYXQgdGhlIHNhbWUgdGltZS4nKTtcclxuICBpZiAoZ29vZ2xlTWFwc0FwaUtleSkge1xyXG4gICAgcGFyYW1zLnB1c2goXCJrZXk9XCIuY29uY2F0KGdvb2dsZU1hcHNBcGlLZXkpKTtcclxuICB9IGVsc2UgaWYgKGdvb2dsZU1hcHNDbGllbnRJZCkge1xyXG4gICAgcGFyYW1zLnB1c2goXCJjbGllbnQ9XCIuY29uY2F0KGdvb2dsZU1hcHNDbGllbnRJZCkpO1xyXG4gIH1cclxuICBpZiAodmVyc2lvbikge1xyXG4gICAgcGFyYW1zLnB1c2goXCJ2PVwiLmNvbmNhdCh2ZXJzaW9uKSk7XHJcbiAgfVxyXG4gIGlmIChsYW5ndWFnZSkge1xyXG4gICAgcGFyYW1zLnB1c2goXCJsYW5ndWFnZT1cIi5jb25jYXQobGFuZ3VhZ2UpKTtcclxuICB9XHJcbiAgaWYgKHJlZ2lvbikge1xyXG4gICAgcGFyYW1zLnB1c2goXCJyZWdpb249XCIuY29uY2F0KHJlZ2lvbikpO1xyXG4gIH1cclxuICBpZiAobGlicmFyaWVzICYmIGxpYnJhcmllcy5sZW5ndGgpIHtcclxuICAgIHBhcmFtcy5wdXNoKFwibGlicmFyaWVzPVwiLmNvbmNhdChsaWJyYXJpZXMuc29ydCgpLmpvaW4oJywnKSkpO1xyXG4gIH1cclxuICBpZiAoY2hhbm5lbCkge1xyXG4gICAgcGFyYW1zLnB1c2goXCJjaGFubmVsPVwiLmNvbmNhdChjaGFubmVsKSk7XHJcbiAgfVxyXG4gIGlmIChtYXBJZHMgJiYgbWFwSWRzLmxlbmd0aCkge1xyXG4gICAgcGFyYW1zLnB1c2goXCJtYXBfaWRzPVwiLmNvbmNhdChtYXBJZHMuam9pbignLCcpKSk7XHJcbiAgfVxyXG4gIGlmIChhdXRoUmVmZXJyZXJQb2xpY3kpIHtcclxuICAgIHBhcmFtcy5wdXNoKFwiYXV0aF9yZWZlcnJlcl9wb2xpY3k9XCIuY29uY2F0KGF1dGhSZWZlcnJlclBvbGljeSkpO1xyXG4gIH1cclxuICBwYXJhbXMucHVzaCgnbG9hZGluZz1hc3luYycpO1xyXG4gIHBhcmFtcy5wdXNoKCdjYWxsYmFjaz1pbml0TWFwJyk7XHJcbiAgcmV0dXJuIFwiXCIuY29uY2F0KGFwaVVybCwgXCIvbWFwcy9hcGkvanM/XCIpLmNvbmNhdChwYXJhbXMuam9pbignJicpKTtcclxufVxyXG5cclxudmFyIGlzQnJvd3NlciA9IHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCc7XHJcblxyXG5mdW5jdGlvbiBpbmplY3RTY3JpcHQoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICB1cmwsXHJcbiAgICBpZCxcclxuICAgIG5vbmNlXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gIH0gPSBfcmVmO1xyXG4gIGlmICghaXNCcm93c2VyKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdkb2N1bWVudCBpcyB1bmRlZmluZWQnKSk7XHJcbiAgfVxyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBpbmplY3RTY3JpcHRDYWxsYmFjayhyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHZhciBleGlzdGluZ1NjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIHZhciB3aW5kb3dXaXRoR29vZ2xlTWFwID0gd2luZG93O1xyXG4gICAgaWYgKGV4aXN0aW5nU2NyaXB0KSB7XHJcbiAgICAgIC8vIFNhbWUgc2NyaXB0IGlkL3VybDoga2VlcCBzYW1lIHNjcmlwdFxyXG4gICAgICB2YXIgZGF0YVN0YXRlQXR0cmlidXRlID0gZXhpc3RpbmdTY3JpcHQuZ2V0QXR0cmlidXRlKCdkYXRhLXN0YXRlJyk7XHJcbiAgICAgIGlmIChleGlzdGluZ1NjcmlwdC5zcmMgPT09IHVybCAmJiBkYXRhU3RhdGVBdHRyaWJ1dGUgIT09ICdlcnJvcicpIHtcclxuICAgICAgICBpZiAoZGF0YVN0YXRlQXR0cmlidXRlID09PSAncmVhZHknKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShpZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHZhciBvcmlnaW5hbEluaXRNYXAgPSB3aW5kb3dXaXRoR29vZ2xlTWFwLmluaXRNYXA7XHJcbiAgICAgICAgICB2YXIgb3JpZ2luYWxFcnJvckNhbGxiYWNrID0gZXhpc3RpbmdTY3JpcHQub25lcnJvcjtcclxuICAgICAgICAgIHdpbmRvd1dpdGhHb29nbGVNYXAuaW5pdE1hcCA9IGZ1bmN0aW9uIGluaXRNYXAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvcmlnaW5hbEluaXRNYXApIHtcclxuICAgICAgICAgICAgICBvcmlnaW5hbEluaXRNYXAoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKGlkKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBleGlzdGluZ1NjcmlwdC5vbmVycm9yID0gZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBpZiAob3JpZ2luYWxFcnJvckNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvckNhbGxiYWNrKGVycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyBTYW1lIHNjcmlwdCBpZCwgYnV0IGVpdGhlclxyXG4gICAgICAvLyAxLiByZXF1ZXN0ZWQgVVJMIGlzIGRpZmZlcmVudFxyXG4gICAgICAvLyAyLiBzY3JpcHQgZmFpbGVkIHRvIGxvYWRcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZXhpc3RpbmdTY3JpcHQucmVtb3ZlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcclxuICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XHJcbiAgICBzY3JpcHQuc3JjID0gdXJsO1xyXG4gICAgc2NyaXB0LmlkID0gaWQ7XHJcbiAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xyXG4gICAgc2NyaXB0Lm5vbmNlID0gbm9uY2UgfHwgJyc7XHJcbiAgICBzY3JpcHQub25lcnJvciA9IGZ1bmN0aW9uIG9uZXJyb3IoZXJyKSB7XHJcbiAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3RhdGUnLCAnZXJyb3InKTtcclxuICAgICAgcmVqZWN0KGVycik7XHJcbiAgICB9O1xyXG4gICAgd2luZG93V2l0aEdvb2dsZU1hcC5pbml0TWFwID0gZnVuY3Rpb24gb25sb2FkKCkge1xyXG4gICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCdkYXRhLXN0YXRlJywgJ3JlYWR5Jyk7XHJcbiAgICAgIHJlc29sdmUoaWQpO1xyXG4gICAgfTtcclxuICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcclxuICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcignaW5qZWN0U2NyaXB0IGVycm9yOiAnLCBlcnIpO1xyXG4gICAgdGhyb3cgZXJyO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0dvb2dsZUZvbnRTdHlsZShlbGVtZW50KSB7XHJcbiAgLy8gJ1JvYm90bycgb3IgJ0dvb2dsZSBTYW5zIFRleHQnIGZvbnQgZG93bmxvYWRcclxuICB2YXIgaHJlZiA9IGVsZW1lbnQuaHJlZjtcclxuICBpZiAoaHJlZiAmJiAoaHJlZi5pbmRleE9mKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzcz9mYW1pbHk9Um9ib3RvJykgPT09IDAgfHwgaHJlZi5pbmRleE9mKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzcz9mYW1pbHk9R29vZ2xlK1NhbnMrVGV4dCcpID09PSAwKSkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8vIGZvbnQgc3R5bGUgZWxlbWVudHNcclxuICBpZiAoXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gIC8vIEB0cy1pZ25vcmVcclxuICBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3N0eWxlJyAmJlxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAvLyBAdHMtaWdub3JlXHJcbiAgZWxlbWVudC5zdHlsZVNoZWV0ICYmXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gIC8vIEB0cy1pZ25vcmVcclxuICBlbGVtZW50LnN0eWxlU2hlZXQuY3NzVGV4dCAmJlxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAvLyBAdHMtaWdub3JlXHJcbiAgZWxlbWVudC5zdHlsZVNoZWV0LmNzc1RleHQucmVwbGFjZSgnXFxyXFxuJywgJycpLmluZGV4T2YoJy5nbS1zdHlsZScpID09PSAwKSB7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBlbGVtZW50LnN0eWxlU2hlZXQuY3NzVGV4dCA9ICcnO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8vIGZvbnQgc3R5bGUgZWxlbWVudHMgZm9yIG90aGVyIGJyb3dzZXJzXHJcbiAgaWYgKFxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAvLyBAdHMtaWdub3JlXHJcbiAgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzdHlsZScgJiZcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgLy8gQHRzLWlnbm9yZVxyXG4gIGVsZW1lbnQuaW5uZXJIVE1MICYmXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gIC8vIEB0cy1pZ25vcmVcclxuICBlbGVtZW50LmlubmVySFRNTC5yZXBsYWNlKCdcXHJcXG4nLCAnJykuaW5kZXhPZignLmdtLXN0eWxlJykgPT09IDApIHtcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgLy8gd2hlbiBnb29nbGUgdHJpZXMgdG8gYWRkIGVtcHR5IHN0eWxlXHJcbiAgaWYgKFxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAvLyBAdHMtaWdub3JlXHJcbiAgZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzdHlsZScgJiZcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgLy8gQHRzLWlnbm9yZVxyXG4gICFlbGVtZW50LnN0eWxlU2hlZXQgJiZcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgLy8gQHRzLWlnbm9yZVxyXG4gICFlbGVtZW50LmlubmVySFRNTCkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufVxyXG4vLyBQcmV2ZW50aW5nIHRoZSBHb29nbGUgTWFwcyBsaWJyYXJ5IGZyb20gZG93bmxvYWRpbmcgYW4gZXh0cmEgZm9udFxyXG5mdW5jdGlvbiBwcmV2ZW50R29vZ2xlRm9udHMoKSB7XHJcbiAgLy8gd2Ugb3ZlcnJpZGUgdGhlc2UgbWV0aG9kcyBvbmx5IGZvciBvbmUgcGFydGljdWxhciBoZWFkIGVsZW1lbnRcclxuICAvLyBkZWZhdWx0IG1ldGhvZHMgZm9yIG90aGVyIGVsZW1lbnRzIGFyZSBub3QgYWZmZWN0ZWRcclxuICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XHJcbiAgaWYgKGhlYWQpIHtcclxuICAgIHZhciB0cnVlSW5zZXJ0QmVmb3JlID0gaGVhZC5pbnNlcnRCZWZvcmUuYmluZChoZWFkKTtcclxuICAgIC8vIFRPRE86IGFkZGluZyByZXR1cm4gYmVmb3JlIHJlZmxlY3Qgc29sdmVzIHRoZSBUUyBpc3N1ZVxyXG4gICAgaGVhZC5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbiBpbnNlcnRCZWZvcmUobmV3RWxlbWVudCwgcmVmZXJlbmNlRWxlbWVudCkge1xyXG4gICAgICBpZiAoIWlzR29vZ2xlRm9udFN0eWxlKG5ld0VsZW1lbnQpKSB7XHJcbiAgICAgICAgUmVmbGVjdC5hcHBseSh0cnVlSW5zZXJ0QmVmb3JlLCBoZWFkLCBbbmV3RWxlbWVudCwgcmVmZXJlbmNlRWxlbWVudF0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBuZXdFbGVtZW50O1xyXG4gICAgfTtcclxuICAgIHZhciB0cnVlQXBwZW5kID0gaGVhZC5hcHBlbmRDaGlsZC5iaW5kKGhlYWQpO1xyXG4gICAgLy8gVE9ETzogYWRkaW5nIHJldHVybiBiZWZvcmUgcmVmbGVjdCBzb2x2ZXMgdGhlIFRTIGlzc3VlXHJcbiAgICBoZWFkLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gYXBwZW5kQ2hpbGQodGV4dE5vZGUpIHtcclxuICAgICAgaWYgKCFpc0dvb2dsZUZvbnRTdHlsZSh0ZXh0Tm9kZSkpIHtcclxuICAgICAgICBSZWZsZWN0LmFwcGx5KHRydWVBcHBlbmQsIGhlYWQsIFt0ZXh0Tm9kZV0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0ZXh0Tm9kZTtcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG52YXIgY2xlYW5pbmdVcCA9IGZhbHNlO1xyXG5mdW5jdGlvbiBEZWZhdWx0TG9hZGluZ0VsZW1lbnQoKSB7XHJcbiAgcmV0dXJuIGpzeChcImRpdlwiLCB7XHJcbiAgICBjaGlsZHJlbjogXCJMb2FkaW5nLi4uXCJcclxuICB9KTtcclxufVxyXG52YXIgZGVmYXVsdExvYWRTY3JpcHRQcm9wcyA9IHtcclxuICBpZDogJ3NjcmlwdC1sb2FkZXInLFxyXG4gIHZlcnNpb246ICd3ZWVrbHknXHJcbn07XHJcbmNsYXNzIExvYWRTY3JpcHQgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjaGVja1wiLCBudWxsKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgbG9hZGVkOiBmYWxzZVxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjbGVhbnVwQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgZGVsZXRlIHdpbmRvdy5nb29nbGUubWFwcztcclxuICAgICAgdGhpcy5pbmplY3RTY3JpcHQoKTtcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiaXNDbGVhbmluZ1VwXCIsIC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvcihmdW5jdGlvbiogKCkge1xyXG4gICAgICBmdW5jdGlvbiBwcm9taXNlQ2FsbGJhY2socmVzb2x2ZSkge1xyXG4gICAgICAgIGlmICghY2xlYW5pbmdVcCkge1xyXG4gICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoaXNCcm93c2VyKSB7XHJcbiAgICAgICAgICAgIHZhciB0aW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiBpbnRlcnZhbCgpIHtcclxuICAgICAgICAgICAgICBpZiAoIWNsZWFuaW5nVXApIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRpbWVyKTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHByb21pc2VDYWxsYmFjayk7XHJcbiAgICB9KSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjbGVhbnVwXCIsICgpID0+IHtcclxuICAgICAgY2xlYW5pbmdVcCA9IHRydWU7XHJcbiAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnByb3BzLmlkKTtcclxuICAgICAgaWYgKHNjcmlwdCAmJiBzY3JpcHQucGFyZW50Tm9kZSkge1xyXG4gICAgICAgIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7XHJcbiAgICAgIH1cclxuICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpKS5maWx0ZXIoZnVuY3Rpb24gZmlsdGVyKHNjcmlwdCkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2Ygc2NyaXB0LnNyYyA9PT0gJ3N0cmluZycgJiYgc2NyaXB0LnNyYy5pbmNsdWRlcygnbWFwcy5nb29nbGVhcGlzJyk7XHJcbiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gZm9yRWFjaChzY3JpcHQpIHtcclxuICAgICAgICBpZiAoc2NyaXB0LnBhcmVudE5vZGUpIHtcclxuICAgICAgICAgIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xpbmsnKSkuZmlsdGVyKGZ1bmN0aW9uIGZpbHRlcihsaW5rKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpbmsuaHJlZiA9PT0gJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzP2ZhbWlseT1Sb2JvdG86MzAwLDQwMCw1MDAsNzAwfEdvb2dsZStTYW5zJztcclxuICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiBmb3JFYWNoKGxpbmspIHtcclxuICAgICAgICBpZiAobGluay5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICBsaW5rLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGluayk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0eWxlJykpLmZpbHRlcihmdW5jdGlvbiBmaWx0ZXIoc3R5bGUpIHtcclxuICAgICAgICByZXR1cm4gc3R5bGUuaW5uZXJUZXh0ICE9PSB1bmRlZmluZWQgJiYgc3R5bGUuaW5uZXJUZXh0Lmxlbmd0aCA+IDAgJiYgc3R5bGUuaW5uZXJUZXh0LmluY2x1ZGVzKCcuZ20tJyk7XHJcbiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gZm9yRWFjaChzdHlsZSkge1xyXG4gICAgICAgIGlmIChzdHlsZS5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICBzdHlsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJpbmplY3RTY3JpcHRcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5wcmV2ZW50R29vZ2xlRm9udHNMb2FkaW5nKSB7XHJcbiAgICAgICAgcHJldmVudEdvb2dsZUZvbnRzKCk7XHJcbiAgICAgIH1cclxuICAgICAgaW52YXJpYW50KCEhdGhpcy5wcm9wcy5pZCwgJ0xvYWRTY3JpcHQgcmVxdWlyZXMgXCJpZFwiIHByb3AgdG8gYmUgYSBzdHJpbmc6ICVzJywgdGhpcy5wcm9wcy5pZCk7XHJcbiAgICAgIHZhciBpbmplY3RTY3JpcHRPcHRpb25zID0ge1xyXG4gICAgICAgIGlkOiB0aGlzLnByb3BzLmlkLFxyXG4gICAgICAgIG5vbmNlOiB0aGlzLnByb3BzLm5vbmNlLFxyXG4gICAgICAgIHVybDogbWFrZUxvYWRTY3JpcHRVcmwodGhpcy5wcm9wcylcclxuICAgICAgfTtcclxuICAgICAgaW5qZWN0U2NyaXB0KGluamVjdFNjcmlwdE9wdGlvbnMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRMb2FkZWQoKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBsb2FkZWQ6IHRydWVcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uRXJyb3IpIHtcclxuICAgICAgICAgIHRoaXMucHJvcHMub25FcnJvcihlcnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiXFxuICAgICAgICAgIFRoZXJlIGhhcyBiZWVuIGFuIEVycm9yIHdpdGggbG9hZGluZyBHb29nbGUgTWFwcyBBUEkgc2NyaXB0LCBwbGVhc2UgY2hlY2sgdGhhdCB5b3UgcHJvdmlkZWQgY29ycmVjdCBnb29nbGUgQVBJIGtleSAoXCIuY29uY2F0KHRoaXMucHJvcHMuZ29vZ2xlTWFwc0FwaUtleSB8fCAnLScsIFwiKSBvciBDbGllbnQgSUQgKFwiKS5jb25jYXQodGhpcy5wcm9wcy5nb29nbGVNYXBzQ2xpZW50SWQgfHwgJy0nLCBcIikgdG8gPExvYWRTY3JpcHQgLz5cXG4gICAgICAgICAgT3RoZXJ3aXNlIGl0IGlzIGEgTmV0d29yayBpc3N1ZS5cXG4gICAgICAgIFwiKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJnZXRSZWZcIiwgZWwgPT4ge1xyXG4gICAgICB0aGlzLmNoZWNrID0gZWw7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICBpZiAoaXNCcm93c2VyKSB7XHJcbiAgICAgIGlmICh3aW5kb3cuZ29vZ2xlICYmIHdpbmRvdy5nb29nbGUubWFwcyAmJiAhY2xlYW5pbmdVcCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dvb2dsZSBhcGkgaXMgYWxyZWFkeSBwcmVzZW50ZWQnKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pc0NsZWFuaW5nVXAoKS50aGVuKHRoaXMuaW5qZWN0U2NyaXB0KS5jYXRjaChmdW5jdGlvbiBlcnJvcihlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhdCBpbmplY3Rpbmcgc2NyaXB0IGFmdGVyIGNsZWFuaW5nIHVwOiAnLCBlcnIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMucHJvcHMubGlicmFyaWVzICE9PSBwcmV2UHJvcHMubGlicmFyaWVzKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignUGVyZm9ybWFuY2Ugd2FybmluZyEgTG9hZFNjcmlwdCBoYXMgYmVlbiByZWxvYWRlZCB1bmludGVudGlvbmFsbHkhIFlvdSBzaG91bGQgbm90IHBhc3MgYGxpYnJhcmllc2AgcHJvcCBhcyBuZXcgYXJyYXkuIFBsZWFzZSBrZWVwIGFuIGFycmF5IG9mIGxpYnJhcmllcyBhcyBzdGF0aWMgY2xhc3MgcHJvcGVydHkgZm9yIENvbXBvbmVudHMgYW5kIFB1cmVDb21wb25lbnRzLCBvciBqdXN0IGEgY29uc3QgdmFyaWFibGUgb3V0c2lkZSBvZiBjb21wb25lbnQsIG9yIHNvbWV3aGVyZSBpbiBjb25maWcgZmlsZXMgb3IgRU5WIHZhcmlhYmxlcycpO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzQnJvd3NlciAmJiBwcmV2UHJvcHMubGFuZ3VhZ2UgIT09IHRoaXMucHJvcHMubGFuZ3VhZ2UpIHtcclxuICAgICAgdGhpcy5jbGVhbnVwKCk7XHJcbiAgICAgIC8vIFRPRE86IHJlZmFjdG9yIHRvIHVzZSBnRFNGUCBtYXliZS4uLiB3YWl0IGZvciBob29rcyByZWZhY3RvcmluZy5cclxuICAgICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRMb2FkZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGxvYWRlZDogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICB9LCB0aGlzLmNsZWFudXBDYWxsYmFjayk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKGlzQnJvd3Nlcikge1xyXG4gICAgICB0aGlzLmNsZWFudXAoKTtcclxuICAgICAgdmFyIHRpbWVvdXRDYWxsYmFjayA9ICgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMuY2hlY2spIHtcclxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgIGRlbGV0ZSB3aW5kb3cuZ29vZ2xlO1xyXG4gICAgICAgICAgY2xlYW5pbmdVcCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgd2luZG93LnNldFRpbWVvdXQodGltZW91dENhbGxiYWNrLCAxKTtcclxuICAgICAgaWYgKHRoaXMucHJvcHMub25Vbm1vdW50KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4ganN4cyhGcmFnbWVudCwge1xyXG4gICAgICBjaGlsZHJlbjogW2pzeChcImRpdlwiLCB7XHJcbiAgICAgICAgcmVmOiB0aGlzLmdldFJlZlxyXG4gICAgICB9KSwgdGhpcy5zdGF0ZS5sb2FkZWQgPyB0aGlzLnByb3BzLmNoaWxkcmVuIDogdGhpcy5wcm9wcy5sb2FkaW5nRWxlbWVudCB8fCBqc3goRGVmYXVsdExvYWRpbmdFbGVtZW50LCB7fSldXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KExvYWRTY3JpcHQsIFwiZGVmYXVsdFByb3BzXCIsIGRlZmF1bHRMb2FkU2NyaXB0UHJvcHMpO1xyXG5cclxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UociwgZSkge1xyXG4gIGlmIChudWxsID09IHIpIHJldHVybiB7fTtcclxuICB2YXIgdCA9IHt9O1xyXG4gIGZvciAodmFyIG4gaW4gcikgaWYgKHt9Lmhhc093blByb3BlcnR5LmNhbGwociwgbikpIHtcclxuICAgIGlmIChlLmluY2x1ZGVzKG4pKSBjb250aW51ZTtcclxuICAgIHRbbl0gPSByW25dO1xyXG4gIH1cclxuICByZXR1cm4gdDtcclxufVxyXG5cclxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKGUsIHQpIHtcclxuICBpZiAobnVsbCA9PSBlKSByZXR1cm4ge307XHJcbiAgdmFyIG8sXHJcbiAgICByLFxyXG4gICAgaSA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKGUsIHQpO1xyXG4gIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7XHJcbiAgICB2YXIgcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7XHJcbiAgICBmb3IgKHIgPSAwOyByIDwgcy5sZW5ndGg7IHIrKykgbyA9IHNbcl0sIHQuaW5jbHVkZXMobykgfHwge30ucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLCBvKSAmJiAoaVtvXSA9IGVbb10pO1xyXG4gIH1cclxuICByZXR1cm4gaTtcclxufVxyXG5cclxuLyogZXNsaW50LWRpc2FibGUgZmlsZW5hbWVzL21hdGNoLXJlZ2V4ICovXHJcbnZhciBwcmV2aW91c2x5TG9hZGVkVXJsO1xyXG5mdW5jdGlvbiB1c2VMb2FkU2NyaXB0KF9yZWYpIHtcclxuICB2YXIge1xyXG4gICAgaWQgPSBkZWZhdWx0TG9hZFNjcmlwdFByb3BzLmlkLFxyXG4gICAgdmVyc2lvbiA9IGRlZmF1bHRMb2FkU2NyaXB0UHJvcHMudmVyc2lvbixcclxuICAgIG5vbmNlLFxyXG4gICAgZ29vZ2xlTWFwc0FwaUtleSxcclxuICAgIGdvb2dsZU1hcHNDbGllbnRJZCxcclxuICAgIGxhbmd1YWdlLFxyXG4gICAgcmVnaW9uLFxyXG4gICAgbGlicmFyaWVzLFxyXG4gICAgcHJldmVudEdvb2dsZUZvbnRzTG9hZGluZyxcclxuICAgIGNoYW5uZWwsXHJcbiAgICBtYXBJZHMsXHJcbiAgICBhdXRoUmVmZXJyZXJQb2xpY3ksXHJcbiAgICBhcGlVcmwgPSBcImh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbVwiXHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIGlzTW91bnRlZCA9IHVzZVJlZihmYWxzZSk7XHJcbiAgdmFyIFtpc0xvYWRlZCwgc2V0TG9hZGVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICB2YXIgW2xvYWRFcnJvciwgc2V0TG9hZEVycm9yXSA9IHVzZVN0YXRlKHVuZGVmaW5lZCk7XHJcbiAgdXNlRWZmZWN0KGZ1bmN0aW9uIHRyYWNrTW91bnRlZFN0YXRlKCkge1xyXG4gICAgaXNNb3VudGVkLmN1cnJlbnQgPSB0cnVlO1xyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaXNNb3VudGVkLmN1cnJlbnQgPSBmYWxzZTtcclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG4gIHVzZUVmZmVjdChmdW5jdGlvbiBhcHBseVByZXZlbnRHb29nbGVGb250cygpIHtcclxuICAgIGlmIChpc0Jyb3dzZXIgJiYgcHJldmVudEdvb2dsZUZvbnRzTG9hZGluZykge1xyXG4gICAgICBwcmV2ZW50R29vZ2xlRm9udHMoKTtcclxuICAgIH1cclxuICB9LCBbcHJldmVudEdvb2dsZUZvbnRzTG9hZGluZ10pO1xyXG4gIHVzZUVmZmVjdChmdW5jdGlvbiB2YWxpZGF0ZUxvYWRlZFN0YXRlKCkge1xyXG4gICAgaWYgKGlzTG9hZGVkKSB7XHJcbiAgICAgIGludmFyaWFudCghIXdpbmRvdy5nb29nbGUsICd1c2VMb2FkU2NyaXB0IHdhcyBtYXJrZWQgYXMgbG9hZGVkLCBidXQgd2luZG93Lmdvb2dsZSBpcyBub3QgcHJlc2VudC4gU29tZXRoaW5nIHdlbnQgd3JvbmcuJyk7XHJcbiAgICB9XHJcbiAgfSwgW2lzTG9hZGVkXSk7XHJcbiAgdmFyIHVybCA9IG1ha2VMb2FkU2NyaXB0VXJsKHtcclxuICAgIHZlcnNpb24sXHJcbiAgICBnb29nbGVNYXBzQXBpS2V5LFxyXG4gICAgZ29vZ2xlTWFwc0NsaWVudElkLFxyXG4gICAgbGFuZ3VhZ2UsXHJcbiAgICByZWdpb24sXHJcbiAgICBsaWJyYXJpZXMsXHJcbiAgICBjaGFubmVsLFxyXG4gICAgbWFwSWRzLFxyXG4gICAgYXV0aFJlZmVycmVyUG9saWN5LFxyXG4gICAgYXBpVXJsXHJcbiAgfSk7XHJcbiAgdXNlRWZmZWN0KGZ1bmN0aW9uIGxvYWRTY3JpcHRBbmRNb2RpZnlMb2FkZWRTdGF0ZSgpIHtcclxuICAgIGlmICghaXNCcm93c2VyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHNldExvYWRlZElmTW91bnRlZCgpIHtcclxuICAgICAgaWYgKGlzTW91bnRlZC5jdXJyZW50KSB7XHJcbiAgICAgICAgc2V0TG9hZGVkKHRydWUpO1xyXG4gICAgICAgIHByZXZpb3VzbHlMb2FkZWRVcmwgPSB1cmw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh3aW5kb3cuZ29vZ2xlICYmIHdpbmRvdy5nb29nbGUubWFwcyAmJiBwcmV2aW91c2x5TG9hZGVkVXJsID09PSB1cmwpIHtcclxuICAgICAgc2V0TG9hZGVkSWZNb3VudGVkKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGluamVjdFNjcmlwdCh7XHJcbiAgICAgIGlkLFxyXG4gICAgICB1cmwsXHJcbiAgICAgIG5vbmNlXHJcbiAgICB9KS50aGVuKHNldExvYWRlZElmTW91bnRlZCkuY2F0Y2goZnVuY3Rpb24gaGFuZGxlSW5qZWN0RXJyb3IoZXJyKSB7XHJcbiAgICAgIGlmIChpc01vdW50ZWQuY3VycmVudCkge1xyXG4gICAgICAgIHNldExvYWRFcnJvcihlcnIpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnNvbGUud2FybihcIlxcbiAgICAgICAgVGhlcmUgaGFzIGJlZW4gYW4gRXJyb3Igd2l0aCBsb2FkaW5nIEdvb2dsZSBNYXBzIEFQSSBzY3JpcHQsIHBsZWFzZSBjaGVjayB0aGF0IHlvdSBwcm92aWRlZCBjb3JyZWN0IGdvb2dsZSBBUEkga2V5IChcIi5jb25jYXQoZ29vZ2xlTWFwc0FwaUtleSB8fCAnLScsIFwiKSBvciBDbGllbnQgSUQgKFwiKS5jb25jYXQoZ29vZ2xlTWFwc0NsaWVudElkIHx8ICctJywgXCIpXFxuICAgICAgICBPdGhlcndpc2UgaXQgaXMgYSBOZXR3b3JrIGlzc3VlLlxcbiAgICAgIFwiKSk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgIH0pO1xyXG4gIH0sIFtpZCwgdXJsLCBub25jZV0pO1xyXG4gIHZhciBwcmV2TGlicmFyaWVzID0gdXNlUmVmKHVuZGVmaW5lZCk7XHJcbiAgdXNlRWZmZWN0KGZ1bmN0aW9uIGNoZWNrUGVyZm9ybWFuY2UoKSB7XHJcbiAgICBpZiAocHJldkxpYnJhcmllcy5jdXJyZW50ICYmIGxpYnJhcmllcyAhPT0gcHJldkxpYnJhcmllcy5jdXJyZW50KSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignUGVyZm9ybWFuY2Ugd2FybmluZyEgTG9hZFNjcmlwdCBoYXMgYmVlbiByZWxvYWRlZCB1bmludGVudGlvbmFsbHkhIFlvdSBzaG91bGQgbm90IHBhc3MgYGxpYnJhcmllc2AgcHJvcCBhcyBuZXcgYXJyYXkuIFBsZWFzZSBrZWVwIGFuIGFycmF5IG9mIGxpYnJhcmllcyBhcyBzdGF0aWMgY2xhc3MgcHJvcGVydHkgZm9yIENvbXBvbmVudHMgYW5kIFB1cmVDb21wb25lbnRzLCBvciBqdXN0IGEgY29uc3QgdmFyaWFibGUgb3V0c2lkZSBvZiBjb21wb25lbnQsIG9yIHNvbWV3aGVyZSBpbiBjb25maWcgZmlsZXMgb3IgRU5WIHZhcmlhYmxlcycpO1xyXG4gICAgfVxyXG4gICAgcHJldkxpYnJhcmllcy5jdXJyZW50ID0gbGlicmFyaWVzO1xyXG4gIH0sIFtsaWJyYXJpZXNdKTtcclxuICByZXR1cm4ge1xyXG4gICAgaXNMb2FkZWQsXHJcbiAgICBsb2FkRXJyb3IsXHJcbiAgICB1cmxcclxuICB9O1xyXG59XHJcblxyXG52YXIgX2V4Y2x1ZGVkJDEgPSBbXCJsb2FkaW5nRWxlbWVudFwiLCBcIm9uTG9hZFwiLCBcIm9uRXJyb3JcIiwgXCJvblVubW91bnRcIiwgXCJjaGlsZHJlblwiXTtcclxudmFyIGRlZmF1bHRMb2FkaW5nRWxlbWVudCA9IGpzeChEZWZhdWx0TG9hZGluZ0VsZW1lbnQsIHt9KTtcclxuZnVuY3Rpb24gTG9hZFNjcmlwdE5leHQoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICAgIGxvYWRpbmdFbGVtZW50LFxyXG4gICAgICBvbkxvYWQsXHJcbiAgICAgIG9uRXJyb3IsXHJcbiAgICAgIG9uVW5tb3VudCxcclxuICAgICAgY2hpbGRyZW5cclxuICAgIH0gPSBfcmVmLFxyXG4gICAgaG9va09wdGlvbnMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX3JlZiwgX2V4Y2x1ZGVkJDEpO1xyXG4gIHZhciB7XHJcbiAgICBpc0xvYWRlZCxcclxuICAgIGxvYWRFcnJvclxyXG4gIH0gPSB1c2VMb2FkU2NyaXB0KGhvb2tPcHRpb25zKTtcclxuICB1c2VFZmZlY3QoZnVuY3Rpb24gaGFuZGxlT25Mb2FkKCkge1xyXG4gICAgaWYgKGlzTG9hZGVkICYmIHR5cGVvZiBvbkxvYWQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgb25Mb2FkKCk7XHJcbiAgICB9XHJcbiAgfSwgW2lzTG9hZGVkLCBvbkxvYWRdKTtcclxuICB1c2VFZmZlY3QoZnVuY3Rpb24gaGFuZGxlT25FcnJvcigpIHtcclxuICAgIGlmIChsb2FkRXJyb3IgJiYgdHlwZW9mIG9uRXJyb3IgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgb25FcnJvcihsb2FkRXJyb3IpO1xyXG4gICAgfVxyXG4gIH0sIFtsb2FkRXJyb3IsIG9uRXJyb3JdKTtcclxuICB1c2VFZmZlY3QoZnVuY3Rpb24gaGFuZGxlT25Vbm1vdW50KCkge1xyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKG9uVW5tb3VudCkge1xyXG4gICAgICAgIG9uVW5tb3VudCgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtvblVubW91bnRdKTtcclxuICByZXR1cm4gaXNMb2FkZWQgPyBjaGlsZHJlbiA6IGxvYWRpbmdFbGVtZW50IHx8IGRlZmF1bHRMb2FkaW5nRWxlbWVudDtcclxufVxyXG52YXIgTG9hZFNjcmlwdE5leHQkMSA9IG1lbW8oTG9hZFNjcmlwdE5leHQpO1xyXG5cclxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCAqL1xyXG5cclxuZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7XHJcbiAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICByZXNvbHZlKHZhbHVlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJlamVjdChlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7XHJcbiAgICAgIHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpO1xyXG4gICAgfVxyXG4gICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIFtdKSkubmV4dCgpKTtcclxuICB9KTtcclxufVxyXG50eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcclxuICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTtcclxuICByZXR1cm4gZS5uYW1lID0gXCJTdXBwcmVzc2VkRXJyb3JcIiwgZS5lcnJvciA9IGVycm9yLCBlLnN1cHByZXNzZWQgPSBzdXBwcmVzc2VkLCBlO1xyXG59O1xyXG5mdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyh4KSB7XHJcbiAgcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDtcclxufVxyXG5cclxuLy8gZG8gbm90IGVkaXQgLmpzIGZpbGVzIGRpcmVjdGx5IC0gZWRpdCBzcmMvaW5kZXguanN0XHJcblxyXG52YXIgZmFzdERlZXBFcXVhbCQxID0gZnVuY3Rpb24gZXF1YWwoYSwgYikge1xyXG4gIGlmIChhID09PSBiKSByZXR1cm4gdHJ1ZTtcclxuICBpZiAoYSAmJiBiICYmIHR5cGVvZiBhID09ICdvYmplY3QnICYmIHR5cGVvZiBiID09ICdvYmplY3QnKSB7XHJcbiAgICBpZiAoYS5jb25zdHJ1Y3RvciAhPT0gYi5jb25zdHJ1Y3RvcikgcmV0dXJuIGZhbHNlO1xyXG4gICAgdmFyIGxlbmd0aCwgaSwga2V5cztcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGEpKSB7XHJcbiAgICAgIGxlbmd0aCA9IGEubGVuZ3RoO1xyXG4gICAgICBpZiAobGVuZ3RoICE9IGIubGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgIGZvciAoaSA9IGxlbmd0aDsgaS0tICE9PSAwOykgaWYgKCFlcXVhbChhW2ldLCBiW2ldKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmIChhLmNvbnN0cnVjdG9yID09PSBSZWdFeHApIHJldHVybiBhLnNvdXJjZSA9PT0gYi5zb3VyY2UgJiYgYS5mbGFncyA9PT0gYi5mbGFncztcclxuICAgIGlmIChhLnZhbHVlT2YgIT09IE9iamVjdC5wcm90b3R5cGUudmFsdWVPZikgcmV0dXJuIGEudmFsdWVPZigpID09PSBiLnZhbHVlT2YoKTtcclxuICAgIGlmIChhLnRvU3RyaW5nICE9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKSByZXR1cm4gYS50b1N0cmluZygpID09PSBiLnRvU3RyaW5nKCk7XHJcbiAgICBrZXlzID0gT2JqZWN0LmtleXMoYSk7XHJcbiAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDtcclxuICAgIGlmIChsZW5ndGggIT09IE9iamVjdC5rZXlzKGIpLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgZm9yIChpID0gbGVuZ3RoOyBpLS0gIT09IDA7KSBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBrZXlzW2ldKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgZm9yIChpID0gbGVuZ3RoOyBpLS0gIT09IDA7KSB7XHJcbiAgICAgIHZhciBrZXkgPSBrZXlzW2ldO1xyXG4gICAgICBpZiAoIWVxdWFsKGFba2V5XSwgYltrZXldKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICAvLyB0cnVlIGlmIGJvdGggTmFOLCBmYWxzZSBvdGhlcndpc2VcclxuICByZXR1cm4gYSAhPT0gYSAmJiBiICE9PSBiO1xyXG59O1xyXG52YXIgaXNFcXVhbCA9IC8qQF9fUFVSRV9fKi9nZXREZWZhdWx0RXhwb3J0RnJvbUNqcyhmYXN0RGVlcEVxdWFsJDEpO1xyXG5cclxuLyoqXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0LlxyXG4gKlxyXG4gKiAgICAgIEh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMC5cclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxudmFyIERFRkFVTFRfSUQgPSBcIl9fZ29vZ2xlTWFwc1NjcmlwdElkXCI7XHJcbi8qKlxyXG4gKiBUaGUgc3RhdHVzIG9mIHRoZSBbW0xvYWRlcl1dLlxyXG4gKi9cclxudmFyIExvYWRlclN0YXR1cztcclxuKGZ1bmN0aW9uIChMb2FkZXJTdGF0dXMpIHtcclxuICBMb2FkZXJTdGF0dXNbTG9hZGVyU3RhdHVzW1wiSU5JVElBTElaRURcIl0gPSAwXSA9IFwiSU5JVElBTElaRURcIjtcclxuICBMb2FkZXJTdGF0dXNbTG9hZGVyU3RhdHVzW1wiTE9BRElOR1wiXSA9IDFdID0gXCJMT0FESU5HXCI7XHJcbiAgTG9hZGVyU3RhdHVzW0xvYWRlclN0YXR1c1tcIlNVQ0NFU1NcIl0gPSAyXSA9IFwiU1VDQ0VTU1wiO1xyXG4gIExvYWRlclN0YXR1c1tMb2FkZXJTdGF0dXNbXCJGQUlMVVJFXCJdID0gM10gPSBcIkZBSUxVUkVcIjtcclxufSkoTG9hZGVyU3RhdHVzIHx8IChMb2FkZXJTdGF0dXMgPSB7fSkpO1xyXG4vKipcclxuICogW1tMb2FkZXJdXSBtYWtlcyBpdCBlYXNpZXIgdG8gYWRkIEdvb2dsZSBNYXBzIEphdmFTY3JpcHQgQVBJIHRvIHlvdXIgYXBwbGljYXRpb25cclxuICogZHluYW1pY2FsbHkgdXNpbmdcclxuICogW1Byb21pc2VzXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9Qcm9taXNlKS5cclxuICogSXQgd29ya3MgYnkgZHluYW1pY2FsbHkgY3JlYXRpbmcgYW5kIGFwcGVuZGluZyBhIHNjcmlwdCBub2RlIHRvIHRoZSB0aGVcclxuICogZG9jdW1lbnQgaGVhZCBhbmQgd3JhcHBpbmcgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHNvIGFzIHRvIHJldHVybiBhIHByb21pc2UuXHJcbiAqXHJcbiAqIGBgYFxyXG4gKiBjb25zdCBsb2FkZXIgPSBuZXcgTG9hZGVyKHtcclxuICogICBhcGlLZXk6IFwiXCIsXHJcbiAqICAgdmVyc2lvbjogXCJ3ZWVrbHlcIixcclxuICogICBsaWJyYXJpZXM6IFtcInBsYWNlc1wiXVxyXG4gKiB9KTtcclxuICpcclxuICogbG9hZGVyLmxvYWQoKS50aGVuKChnb29nbGUpID0+IHtcclxuICogICBjb25zdCBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKC4uLilcclxuICogfSlcclxuICogYGBgXHJcbiAqL1xyXG5jbGFzcyBMb2FkZXIge1xyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgTG9hZGVyIHVzaW5nIFtbTG9hZGVyT3B0aW9uc11dLiBObyBkZWZhdWx0cyBhcmUgc2V0XHJcbiAgICogdXNpbmcgdGhpcyBsaWJyYXJ5LCBpbnN0ZWFkIHRoZSBkZWZhdWx0cyBhcmUgc2V0IGJ5IHRoZSBHb29nbGUgTWFwc1xyXG4gICAqIEphdmFTY3JpcHQgQVBJIHNlcnZlci5cclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqIGNvbnN0IGxvYWRlciA9IExvYWRlcih7YXBpS2V5LCB2ZXJzaW9uOiAnd2Vla2x5JywgbGlicmFyaWVzOiBbJ3BsYWNlcyddfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoX3JlZikge1xyXG4gICAgdmFyIHtcclxuICAgICAgYXBpS2V5LFxyXG4gICAgICBhdXRoUmVmZXJyZXJQb2xpY3ksXHJcbiAgICAgIGNoYW5uZWwsXHJcbiAgICAgIGNsaWVudCxcclxuICAgICAgaWQgPSBERUZBVUxUX0lELFxyXG4gICAgICBsYW5ndWFnZSxcclxuICAgICAgbGlicmFyaWVzID0gW10sXHJcbiAgICAgIG1hcElkcyxcclxuICAgICAgbm9uY2UsXHJcbiAgICAgIHJlZ2lvbixcclxuICAgICAgcmV0cmllcyA9IDMsXHJcbiAgICAgIHVybCA9IFwiaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2pzXCIsXHJcbiAgICAgIHZlcnNpb25cclxuICAgIH0gPSBfcmVmO1xyXG4gICAgdGhpcy5jYWxsYmFja3MgPSBbXTtcclxuICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLmVycm9ycyA9IFtdO1xyXG4gICAgdGhpcy5hcGlLZXkgPSBhcGlLZXk7XHJcbiAgICB0aGlzLmF1dGhSZWZlcnJlclBvbGljeSA9IGF1dGhSZWZlcnJlclBvbGljeTtcclxuICAgIHRoaXMuY2hhbm5lbCA9IGNoYW5uZWw7XHJcbiAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcclxuICAgIHRoaXMuaWQgPSBpZCB8fCBERUZBVUxUX0lEOyAvLyBEbyBub3QgYWxsb3cgZW1wdHkgc3RyaW5nXHJcbiAgICB0aGlzLmxhbmd1YWdlID0gbGFuZ3VhZ2U7XHJcbiAgICB0aGlzLmxpYnJhcmllcyA9IGxpYnJhcmllcztcclxuICAgIHRoaXMubWFwSWRzID0gbWFwSWRzO1xyXG4gICAgdGhpcy5ub25jZSA9IG5vbmNlO1xyXG4gICAgdGhpcy5yZWdpb24gPSByZWdpb247XHJcbiAgICB0aGlzLnJldHJpZXMgPSByZXRyaWVzO1xyXG4gICAgdGhpcy51cmwgPSB1cmw7XHJcbiAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xyXG4gICAgaWYgKExvYWRlci5pbnN0YW5jZSkge1xyXG4gICAgICBpZiAoIWlzRXF1YWwodGhpcy5vcHRpb25zLCBMb2FkZXIuaW5zdGFuY2Uub3B0aW9ucykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMb2FkZXIgbXVzdCBub3QgYmUgY2FsbGVkIGFnYWluIHdpdGggZGlmZmVyZW50IG9wdGlvbnMuIFwiLmNvbmNhdChKU09OLnN0cmluZ2lmeSh0aGlzLm9wdGlvbnMpLCBcIiAhPT0gXCIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShMb2FkZXIuaW5zdGFuY2Uub3B0aW9ucykpKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gTG9hZGVyLmluc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgTG9hZGVyLmluc3RhbmNlID0gdGhpcztcclxuICB9XHJcbiAgZ2V0IG9wdGlvbnMoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb24sXHJcbiAgICAgIGFwaUtleTogdGhpcy5hcGlLZXksXHJcbiAgICAgIGNoYW5uZWw6IHRoaXMuY2hhbm5lbCxcclxuICAgICAgY2xpZW50OiB0aGlzLmNsaWVudCxcclxuICAgICAgaWQ6IHRoaXMuaWQsXHJcbiAgICAgIGxpYnJhcmllczogdGhpcy5saWJyYXJpZXMsXHJcbiAgICAgIGxhbmd1YWdlOiB0aGlzLmxhbmd1YWdlLFxyXG4gICAgICByZWdpb246IHRoaXMucmVnaW9uLFxyXG4gICAgICBtYXBJZHM6IHRoaXMubWFwSWRzLFxyXG4gICAgICBub25jZTogdGhpcy5ub25jZSxcclxuICAgICAgdXJsOiB0aGlzLnVybCxcclxuICAgICAgYXV0aFJlZmVycmVyUG9saWN5OiB0aGlzLmF1dGhSZWZlcnJlclBvbGljeVxyXG4gICAgfTtcclxuICB9XHJcbiAgZ2V0IHN0YXR1cygpIHtcclxuICAgIGlmICh0aGlzLmVycm9ycy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIExvYWRlclN0YXR1cy5GQUlMVVJFO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZG9uZSkge1xyXG4gICAgICByZXR1cm4gTG9hZGVyU3RhdHVzLlNVQ0NFU1M7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5sb2FkaW5nKSB7XHJcbiAgICAgIHJldHVybiBMb2FkZXJTdGF0dXMuTE9BRElORztcclxuICAgIH1cclxuICAgIHJldHVybiBMb2FkZXJTdGF0dXMuSU5JVElBTElaRUQ7XHJcbiAgfVxyXG4gIGdldCBmYWlsZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kb25lICYmICF0aGlzLmxvYWRpbmcgJiYgdGhpcy5lcnJvcnMubGVuZ3RoID49IHRoaXMucmV0cmllcyArIDE7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZVVybCByZXR1cm5zIHRoZSBHb29nbGUgTWFwcyBKYXZhU2NyaXB0IEFQSSBzY3JpcHQgdXJsIGdpdmVuIHRoZSBbW0xvYWRlck9wdGlvbnNdXS5cclxuICAgKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIGNyZWF0ZVVybCgpIHtcclxuICAgIHZhciB1cmwgPSB0aGlzLnVybDtcclxuICAgIHVybCArPSBcIj9jYWxsYmFjaz1fX2dvb2dsZU1hcHNDYWxsYmFjayZsb2FkaW5nPWFzeW5jXCI7XHJcbiAgICBpZiAodGhpcy5hcGlLZXkpIHtcclxuICAgICAgdXJsICs9IFwiJmtleT1cIi5jb25jYXQodGhpcy5hcGlLZXkpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY2hhbm5lbCkge1xyXG4gICAgICB1cmwgKz0gXCImY2hhbm5lbD1cIi5jb25jYXQodGhpcy5jaGFubmVsKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmNsaWVudCkge1xyXG4gICAgICB1cmwgKz0gXCImY2xpZW50PVwiLmNvbmNhdCh0aGlzLmNsaWVudCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5saWJyYXJpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB1cmwgKz0gXCImbGlicmFyaWVzPVwiLmNvbmNhdCh0aGlzLmxpYnJhcmllcy5qb2luKFwiLFwiKSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5sYW5ndWFnZSkge1xyXG4gICAgICB1cmwgKz0gXCImbGFuZ3VhZ2U9XCIuY29uY2F0KHRoaXMubGFuZ3VhZ2UpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMucmVnaW9uKSB7XHJcbiAgICAgIHVybCArPSBcIiZyZWdpb249XCIuY29uY2F0KHRoaXMucmVnaW9uKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnZlcnNpb24pIHtcclxuICAgICAgdXJsICs9IFwiJnY9XCIuY29uY2F0KHRoaXMudmVyc2lvbik7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5tYXBJZHMpIHtcclxuICAgICAgdXJsICs9IFwiJm1hcF9pZHM9XCIuY29uY2F0KHRoaXMubWFwSWRzLmpvaW4oXCIsXCIpKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmF1dGhSZWZlcnJlclBvbGljeSkge1xyXG4gICAgICB1cmwgKz0gXCImYXV0aF9yZWZlcnJlcl9wb2xpY3k9XCIuY29uY2F0KHRoaXMuYXV0aFJlZmVycmVyUG9saWN5KTtcclxuICAgIH1cclxuICAgIHJldHVybiB1cmw7XHJcbiAgfVxyXG4gIGRlbGV0ZVNjcmlwdCgpIHtcclxuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlkKTtcclxuICAgIGlmIChzY3JpcHQpIHtcclxuICAgICAgc2NyaXB0LnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiBMb2FkIHRoZSBHb29nbGUgTWFwcyBKYXZhU2NyaXB0IEFQSSBzY3JpcHQgYW5kIHJldHVybiBhIFByb21pc2UuXHJcbiAgICogQGRlcHJlY2F0ZWQsIHVzZSBpbXBvcnRMaWJyYXJ5KCkgaW5zdGVhZC5cclxuICAgKi9cclxuICBsb2FkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubG9hZFByb21pc2UoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogTG9hZCB0aGUgR29vZ2xlIE1hcHMgSmF2YVNjcmlwdCBBUEkgc2NyaXB0IGFuZCByZXR1cm4gYSBQcm9taXNlLlxyXG4gICAqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqIEBkZXByZWNhdGVkLCB1c2UgaW1wb3J0TGlicmFyeSgpIGluc3RlYWQuXHJcbiAgICovXHJcbiAgbG9hZFByb21pc2UoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmxvYWRDYWxsYmFjayhlcnIgPT4ge1xyXG4gICAgICAgIGlmICghZXJyKSB7XHJcbiAgICAgICAgICByZXNvbHZlKHdpbmRvdy5nb29nbGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoZXJyLmVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGltcG9ydExpYnJhcnkobmFtZSkge1xyXG4gICAgdGhpcy5leGVjdXRlKCk7XHJcbiAgICByZXR1cm4gZ29vZ2xlLm1hcHMuaW1wb3J0TGlicmFyeShuYW1lKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogTG9hZCB0aGUgR29vZ2xlIE1hcHMgSmF2YVNjcmlwdCBBUEkgc2NyaXB0IHdpdGggYSBjYWxsYmFjay5cclxuICAgKiBAZGVwcmVjYXRlZCwgdXNlIGltcG9ydExpYnJhcnkoKSBpbnN0ZWFkLlxyXG4gICAqL1xyXG4gIGxvYWRDYWxsYmFjayhmbikge1xyXG4gICAgdGhpcy5jYWxsYmFja3MucHVzaChmbik7XHJcbiAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBzY3JpcHQgb24gZG9jdW1lbnQuXHJcbiAgICovXHJcbiAgc2V0U2NyaXB0KCkge1xyXG4gICAgdmFyIF9hLCBfYjtcclxuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlkKSkge1xyXG4gICAgICAvLyBUT0RPIHdyYXAgb25lcnJvciBjYWxsYmFjayBmb3IgY2FzZXMgd2hlcmUgdGhlIHNjcmlwdCB3YXMgbG9hZGVkIGVsc2V3aGVyZVxyXG4gICAgICB0aGlzLmNhbGxiYWNrKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBwYXJhbXMgPSB7XHJcbiAgICAgIGtleTogdGhpcy5hcGlLZXksXHJcbiAgICAgIGNoYW5uZWw6IHRoaXMuY2hhbm5lbCxcclxuICAgICAgY2xpZW50OiB0aGlzLmNsaWVudCxcclxuICAgICAgbGlicmFyaWVzOiB0aGlzLmxpYnJhcmllcy5sZW5ndGggJiYgdGhpcy5saWJyYXJpZXMsXHJcbiAgICAgIHY6IHRoaXMudmVyc2lvbixcclxuICAgICAgbWFwSWRzOiB0aGlzLm1hcElkcyxcclxuICAgICAgbGFuZ3VhZ2U6IHRoaXMubGFuZ3VhZ2UsXHJcbiAgICAgIHJlZ2lvbjogdGhpcy5yZWdpb24sXHJcbiAgICAgIGF1dGhSZWZlcnJlclBvbGljeTogdGhpcy5hdXRoUmVmZXJyZXJQb2xpY3lcclxuICAgIH07XHJcbiAgICAvLyBrZWVwIHRoZSBVUkwgbWluaW1hbDpcclxuICAgIE9iamVjdC5rZXlzKHBhcmFtcykuZm9yRWFjaChcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgICBrZXkgPT4gIXBhcmFtc1trZXldICYmIGRlbGV0ZSBwYXJhbXNba2V5XSk7XHJcbiAgICBpZiAoISgoX2IgPSAoX2EgPSB3aW5kb3cgPT09IG51bGwgfHwgd2luZG93ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aW5kb3cuZ29vZ2xlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFwcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmltcG9ydExpYnJhcnkpKSB7XHJcbiAgICAgIC8vIHR3ZWFrZWQgY29weSBvZiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9tYXBzL2RvY3VtZW50YXRpb24vamF2YXNjcmlwdC9sb2FkLW1hcHMtanMtYXBpI2R5bmFtaWMtbGlicmFyeS1pbXBvcnRcclxuICAgICAgLy8gd2hpY2ggYWxzbyBzZXRzIHRoZSBiYXNlIHVybCwgdGhlIGlkLCBhbmQgdGhlIG5vbmNlXHJcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlICovXHJcbiAgICAgIChnID0+IHtcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgdmFyIGgsXHJcbiAgICAgICAgICBhLFxyXG4gICAgICAgICAgayxcclxuICAgICAgICAgIHAgPSBcIlRoZSBHb29nbGUgTWFwcyBKYXZhU2NyaXB0IEFQSVwiLFxyXG4gICAgICAgICAgYyA9IFwiZ29vZ2xlXCIsXHJcbiAgICAgICAgICBsID0gXCJpbXBvcnRMaWJyYXJ5XCIsXHJcbiAgICAgICAgICBxID0gXCJfX2liX19cIixcclxuICAgICAgICAgIG0gPSBkb2N1bWVudCxcclxuICAgICAgICAgIGIgPSB3aW5kb3c7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGIgPSBiW2NdIHx8IChiW2NdID0ge30pO1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB2YXIgZCA9IGIubWFwcyB8fCAoYi5tYXBzID0ge30pLFxyXG4gICAgICAgICAgciA9IG5ldyBTZXQoKSxcclxuICAgICAgICAgIGUgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCksXHJcbiAgICAgICAgICB1ID0gKCkgPT5cclxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgIGggfHwgKGggPSBuZXcgUHJvbWlzZSgoZiwgbikgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgIHlpZWxkIGEgPSBtLmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XHJcbiAgICAgICAgICAgIGEuaWQgPSB0aGlzLmlkO1xyXG4gICAgICAgICAgICBlLnNldChcImxpYnJhcmllc1wiLCBbLi4ucl0gKyBcIlwiKTtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBmb3IgKGsgaW4gZykgZS5zZXQoay5yZXBsYWNlKC9bQS1aXS9nLCB0ID0+IFwiX1wiICsgdFswXS50b0xvd2VyQ2FzZSgpKSwgZ1trXSk7XHJcbiAgICAgICAgICAgIGUuc2V0KFwiY2FsbGJhY2tcIiwgYyArIFwiLm1hcHMuXCIgKyBxKTtcclxuICAgICAgICAgICAgYS5zcmMgPSB0aGlzLnVybCArIFwiP1wiICsgZTtcclxuICAgICAgICAgICAgZFtxXSA9IGY7XHJcbiAgICAgICAgICAgIGEub25lcnJvciA9ICgpID0+IGggPSBuKEVycm9yKHAgKyBcIiBjb3VsZCBub3QgbG9hZC5cIikpO1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIGEubm9uY2UgPSB0aGlzLm5vbmNlIHx8ICgoX2EgPSBtLnF1ZXJ5U2VsZWN0b3IoXCJzY3JpcHRbbm9uY2VdXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eubm9uY2UpIHx8IFwiXCI7XHJcbiAgICAgICAgICAgIG0uaGVhZC5hcHBlbmQoYSk7XHJcbiAgICAgICAgICB9KSkpO1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBkW2xdID8gY29uc29sZS53YXJuKHAgKyBcIiBvbmx5IGxvYWRzIG9uY2UuIElnbm9yaW5nOlwiLCBnKSA6IGRbbF0gPSBmdW5jdGlvbiAoZikge1xyXG4gICAgICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIG4gPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykge1xyXG4gICAgICAgICAgICBuW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiByLmFkZChmKSAmJiB1KCkudGhlbigoKSA9PiBkW2xdKGYsIC4uLm4pKTtcclxuICAgICAgICB9O1xyXG4gICAgICB9KShwYXJhbXMpO1xyXG4gICAgICAvKiBlc2xpbnQtZW5hYmxlICovXHJcbiAgICB9XHJcbiAgICAvLyBXaGlsZSBtb3N0IGxpYnJhcmllcyBwb3B1bGF0ZSB0aGUgZ2xvYmFsIG5hbWVzcGFjZSB3aGVuIGxvYWRlZCB2aWEgYm9vdHN0cmFwIHBhcmFtcyxcclxuICAgIC8vIHRoaXMgaXMgbm90IHRoZSBjYXNlIGZvciBcIm1hcmtlclwiIHdoZW4gdXNlZCB3aXRoIHRoZSBpbmxpbmUgYm9vdHN0cmFwIGxvYWRlclxyXG4gICAgLy8gKGFuZCBtYXliZSBvdGhlcnMgaW4gdGhlIGZ1dHVyZSkuIFNvIGVuc3VyZSB0aGVyZSBpcyBhbiBpbXBvcnRMaWJyYXJ5IGZvciBlYWNoOlxyXG4gICAgdmFyIGxpYnJhcnlQcm9taXNlcyA9IHRoaXMubGlicmFyaWVzLm1hcChsaWJyYXJ5ID0+IHRoaXMuaW1wb3J0TGlicmFyeShsaWJyYXJ5KSk7XHJcbiAgICAvLyBlbnN1cmUgYXQgbGVhc3Qgb25lIGxpYnJhcnksIHRvIGtpY2sgb2ZmIGxvYWRpbmcuLi5cclxuICAgIGlmICghbGlicmFyeVByb21pc2VzLmxlbmd0aCkge1xyXG4gICAgICBsaWJyYXJ5UHJvbWlzZXMucHVzaCh0aGlzLmltcG9ydExpYnJhcnkoXCJjb3JlXCIpKTtcclxuICAgIH1cclxuICAgIFByb21pc2UuYWxsKGxpYnJhcnlQcm9taXNlcykudGhlbigoKSA9PiB0aGlzLmNhbGxiYWNrKCksIGVycm9yID0+IHtcclxuICAgICAgdmFyIGV2ZW50ID0gbmV3IEVycm9yRXZlbnQoXCJlcnJvclwiLCB7XHJcbiAgICAgICAgZXJyb3JcclxuICAgICAgfSk7IC8vIGZvciBiYWNrd2FyZHMgY29tcGF0XHJcbiAgICAgIHRoaXMubG9hZEVycm9yQ2FsbGJhY2soZXZlbnQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IHRoZSBsb2FkZXIgc3RhdGUuXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLmRlbGV0ZVNjcmlwdCgpO1xyXG4gICAgdGhpcy5kb25lID0gZmFsc2U7XHJcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgIHRoaXMuZXJyb3JzID0gW107XHJcbiAgICB0aGlzLm9uZXJyb3JFdmVudCA9IG51bGw7XHJcbiAgfVxyXG4gIHJlc2V0SWZSZXRyeWluZ0ZhaWxlZCgpIHtcclxuICAgIGlmICh0aGlzLmZhaWxlZCkge1xyXG4gICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGxvYWRFcnJvckNhbGxiYWNrKGUpIHtcclxuICAgIHRoaXMuZXJyb3JzLnB1c2goZSk7XHJcbiAgICBpZiAodGhpcy5lcnJvcnMubGVuZ3RoIDw9IHRoaXMucmV0cmllcykge1xyXG4gICAgICB2YXIgZGVsYXkgPSB0aGlzLmVycm9ycy5sZW5ndGggKiBNYXRoLnBvdygyLCB0aGlzLmVycm9ycy5sZW5ndGgpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgR29vZ2xlIE1hcHMgc2NyaXB0LCByZXRyeWluZyBpbiBcIi5jb25jYXQoZGVsYXksIFwiIG1zLlwiKSk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZGVsZXRlU2NyaXB0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRTY3JpcHQoKTtcclxuICAgICAgfSwgZGVsYXkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5vbmVycm9yRXZlbnQgPSBlO1xyXG4gICAgICB0aGlzLmNhbGxiYWNrKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNhbGxiYWNrKCkge1xyXG4gICAgdGhpcy5kb25lID0gdHJ1ZTtcclxuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5jYWxsYmFja3MuZm9yRWFjaChjYiA9PiB7XHJcbiAgICAgIGNiKHRoaXMub25lcnJvckV2ZW50KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5jYWxsYmFja3MgPSBbXTtcclxuICB9XHJcbiAgZXhlY3V0ZSgpIHtcclxuICAgIHRoaXMucmVzZXRJZlJldHJ5aW5nRmFpbGVkKCk7XHJcbiAgICBpZiAodGhpcy5sb2FkaW5nKSB7XHJcbiAgICAgIC8vIGRvIG5vdGhpbmcgYnV0IHdhaXRcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZG9uZSkge1xyXG4gICAgICB0aGlzLmNhbGxiYWNrKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBzaG9ydCBjaXJjdWl0IGFuZCB3YXJuIGlmIGdvb2dsZS5tYXBzIGlzIGFscmVhZHkgbG9hZGVkXHJcbiAgICAgIGlmICh3aW5kb3cuZ29vZ2xlICYmIHdpbmRvdy5nb29nbGUubWFwcyAmJiB3aW5kb3cuZ29vZ2xlLm1hcHMudmVyc2lvbikge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcIkdvb2dsZSBNYXBzIGFscmVhZHkgbG9hZGVkIG91dHNpZGUgQGdvb2dsZW1hcHMvanMtYXBpLWxvYWRlci4gXCIgKyBcIlRoaXMgbWF5IHJlc3VsdCBpbiB1bmRlc2lyYWJsZSBiZWhhdmlvciBhcyBvcHRpb25zIGFuZCBzY3JpcHQgcGFyYW1ldGVycyBtYXkgbm90IG1hdGNoLlwiKTtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XHJcbiAgICAgIHRoaXMuc2V0U2NyaXB0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG52YXIgZGVmYXVsdExpYnJhcmllcyA9IFsnbWFwcyddO1xyXG5mdW5jdGlvbiB1c2VKc0FwaUxvYWRlcihfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIGlkID0gZGVmYXVsdExvYWRTY3JpcHRQcm9wcy5pZCxcclxuICAgIHZlcnNpb24gPSBkZWZhdWx0TG9hZFNjcmlwdFByb3BzLnZlcnNpb24sXHJcbiAgICBub25jZSxcclxuICAgIGdvb2dsZU1hcHNBcGlLZXksXHJcbiAgICAvLyBnb29nbGVNYXBzQ2xpZW50SWQsXHJcbiAgICBsYW5ndWFnZSxcclxuICAgIHJlZ2lvbixcclxuICAgIGxpYnJhcmllcyA9IGRlZmF1bHRMaWJyYXJpZXMsXHJcbiAgICBwcmV2ZW50R29vZ2xlRm9udHNMb2FkaW5nLFxyXG4gICAgLy8gY2hhbm5lbCxcclxuICAgIG1hcElkcyxcclxuICAgIGF1dGhSZWZlcnJlclBvbGljeVxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBpc01vdW50ZWQgPSB1c2VSZWYoZmFsc2UpO1xyXG4gIHZhciBbaXNMb2FkZWQsIHNldExvYWRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgdmFyIFtsb2FkRXJyb3IsIHNldExvYWRFcnJvcl0gPSB1c2VTdGF0ZSh1bmRlZmluZWQpO1xyXG4gIHVzZUVmZmVjdChmdW5jdGlvbiB0cmFja01vdW50ZWRTdGF0ZSgpIHtcclxuICAgIGlzTW91bnRlZC5jdXJyZW50ID0gdHJ1ZTtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlzTW91bnRlZC5jdXJyZW50ID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICB2YXIgbG9hZGVyID0gdXNlTWVtbygoKSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IExvYWRlcih7XHJcbiAgICAgIGlkLFxyXG4gICAgICBhcGlLZXk6IGdvb2dsZU1hcHNBcGlLZXksXHJcbiAgICAgIHZlcnNpb24sXHJcbiAgICAgIGxpYnJhcmllcyxcclxuICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlIHx8ICdlbicsXHJcbiAgICAgIHJlZ2lvbjogcmVnaW9uIHx8ICdVUycsXHJcbiAgICAgIG1hcElkczogbWFwSWRzIHx8IFtdLFxyXG4gICAgICBub25jZTogbm9uY2UgfHwgJycsXHJcbiAgICAgIGF1dGhSZWZlcnJlclBvbGljeTogYXV0aFJlZmVycmVyUG9saWN5IHx8ICdvcmlnaW4nXHJcbiAgICB9KTtcclxuICB9LCBbaWQsIGdvb2dsZU1hcHNBcGlLZXksIHZlcnNpb24sIGxpYnJhcmllcywgbGFuZ3VhZ2UsIHJlZ2lvbiwgbWFwSWRzLCBub25jZSwgYXV0aFJlZmVycmVyUG9saWN5XSk7XHJcbiAgdXNlRWZmZWN0KGZ1bmN0aW9uIGVmZmVjdCgpIHtcclxuICAgIGlmIChpc0xvYWRlZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsb2FkZXIubG9hZCgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGlmIChpc01vdW50ZWQuY3VycmVudCkge1xyXG4gICAgICAgICAgc2V0TG9hZGVkKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICBzZXRMb2FkRXJyb3IoZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9LCBbXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpc0Jyb3dzZXIgJiYgcHJldmVudEdvb2dsZUZvbnRzTG9hZGluZykge1xyXG4gICAgICBwcmV2ZW50R29vZ2xlRm9udHMoKTtcclxuICAgIH1cclxuICB9LCBbcHJldmVudEdvb2dsZUZvbnRzTG9hZGluZ10pO1xyXG4gIHZhciBwcmV2TGlicmFyaWVzID0gdXNlUmVmKCk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChwcmV2TGlicmFyaWVzLmN1cnJlbnQgJiYgbGlicmFyaWVzICE9PSBwcmV2TGlicmFyaWVzLmN1cnJlbnQpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdQZXJmb3JtYW5jZSB3YXJuaW5nISBMb2FkU2NyaXB0IGhhcyBiZWVuIHJlbG9hZGVkIHVuaW50ZW50aW9uYWxseSEgWW91IHNob3VsZCBub3QgcGFzcyBgbGlicmFyaWVzYCBwcm9wIGFzIG5ldyBhcnJheS4gUGxlYXNlIGtlZXAgYW4gYXJyYXkgb2YgbGlicmFyaWVzIGFzIHN0YXRpYyBjbGFzcyBwcm9wZXJ0eSBmb3IgQ29tcG9uZW50cyBhbmQgUHVyZUNvbXBvbmVudHMsIG9yIGp1c3QgYSBjb25zdCB2YXJpYWJsZSBvdXRzaWRlIG9mIGNvbXBvbmVudCwgb3Igc29tZXdoZXJlIGluIGNvbmZpZyBmaWxlcyBvciBFTlYgdmFyaWFibGVzJyk7XHJcbiAgICB9XHJcbiAgICBwcmV2TGlicmFyaWVzLmN1cnJlbnQgPSBsaWJyYXJpZXM7XHJcbiAgfSwgW2xpYnJhcmllc10pO1xyXG4gIHJldHVybiB7XHJcbiAgICBpc0xvYWRlZCxcclxuICAgIGxvYWRFcnJvclxyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG93bktleXMkZihlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkZihlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJGYoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJGYoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxudmFyIGV2ZW50TWFwJGggPSB7fTtcclxudmFyIHVwZGF0ZXJNYXAkaCA9IHtcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH1cclxufTtcclxuZnVuY3Rpb24gVHJhZmZpY0xheWVyRnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIG9wdGlvbnMsXHJcbiAgICBvbkxvYWQsXHJcbiAgICBvblVubW91bnRcclxuICB9ID0gX3JlZjtcclxuICB2YXIgbWFwID0gdXNlQ29udGV4dChNYXBDb250ZXh0KTtcclxuICB2YXIgW2luc3RhbmNlLCBzZXRJbnN0YW5jZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgb3B0aW9uc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2YXIgdHJhZmZpY0xheWVyID0gbmV3IGdvb2dsZS5tYXBzLlRyYWZmaWNMYXllcihfb2JqZWN0U3ByZWFkJGYoX29iamVjdFNwcmVhZCRmKHt9LCBvcHRpb25zKSwge30sIHtcclxuICAgICAgbWFwXHJcbiAgICB9KSk7XHJcbiAgICBzZXRJbnN0YW5jZSh0cmFmZmljTGF5ZXIpO1xyXG4gICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICBvbkxvYWQodHJhZmZpY0xheWVyKTtcclxuICAgIH1cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICAgIG9uVW5tb3VudChpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlLnNldE1hcChudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxudmFyIFRyYWZmaWNMYXllckYgPSBtZW1vKFRyYWZmaWNMYXllckZ1bmN0aW9uYWwpO1xyXG5jbGFzcyBUcmFmZmljTGF5ZXIgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIHRyYWZmaWNMYXllcjogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRUcmFmZmljTGF5ZXJDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLnRyYWZmaWNMYXllciAhPT0gbnVsbCAmJiB0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUudHJhZmZpY0xheWVyKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZWdpc3RlcmVkRXZlbnRzXCIsIFtdKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB2YXIgdHJhZmZpY0xheWVyID0gbmV3IGdvb2dsZS5tYXBzLlRyYWZmaWNMYXllcihfb2JqZWN0U3ByZWFkJGYoX29iamVjdFNwcmVhZCRmKHt9LCB0aGlzLnByb3BzLm9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBtYXA6IHRoaXMuY29udGV4dFxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkaCxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGgsXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IHRyYWZmaWNMYXllclxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldFRyYWZmaWNMYXllcigpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0cmFmZmljTGF5ZXJcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0VHJhZmZpY0xheWVyQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS50cmFmZmljTGF5ZXIgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGgsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGgsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS50cmFmZmljTGF5ZXJcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUudHJhZmZpY0xheWVyICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUudHJhZmZpY0xheWVyKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMuc3RhdGUudHJhZmZpY0xheWVyLnNldE1hcChudWxsKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShUcmFmZmljTGF5ZXIsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBCaWN5Y2xpbmdMYXllckZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBvbkxvYWQsXHJcbiAgICBvblVubW91bnRcclxuICB9ID0gX3JlZjtcclxuICB2YXIgbWFwID0gdXNlQ29udGV4dChNYXBDb250ZXh0KTtcclxuICB2YXIgW2luc3RhbmNlLCBzZXRJbnN0YW5jZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2YXIgYmljeWNsaW5nTGF5ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuQmljeWNsaW5nTGF5ZXIoKTtcclxuICAgIHNldEluc3RhbmNlKGJpY3ljbGluZ0xheWVyKTtcclxuICAgIGJpY3ljbGluZ0xheWVyLnNldE1hcChtYXApO1xyXG4gICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICBvbkxvYWQoYmljeWNsaW5nTGF5ZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKGJpY3ljbGluZ0xheWVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgaWYgKG9uVW5tb3VudCkge1xyXG4gICAgICAgICAgb25Vbm1vdW50KGJpY3ljbGluZ0xheWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYmljeWNsaW5nTGF5ZXIuc2V0TWFwKG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgQmljeWNsaW5nTGF5ZXJGID0gbWVtbyhCaWN5Y2xpbmdMYXllckZ1bmN0aW9uYWwpO1xyXG5jbGFzcyBCaWN5Y2xpbmdMYXllciBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgYmljeWNsaW5nTGF5ZXI6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0QmljeWNsaW5nTGF5ZXJDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLmJpY3ljbGluZ0xheWVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0ZS5iaWN5Y2xpbmdMYXllci5zZXRNYXAodGhpcy5jb250ZXh0KTtcclxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUuYmljeWNsaW5nTGF5ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIGJpY3ljbGluZ0xheWVyID0gbmV3IGdvb2dsZS5tYXBzLkJpY3ljbGluZ0xheWVyKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+IHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBiaWN5Y2xpbmdMYXllclxyXG4gICAgICB9O1xyXG4gICAgfSwgdGhpcy5zZXRCaWN5Y2xpbmdMYXllckNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5iaWN5Y2xpbmdMYXllciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmJpY3ljbGluZ0xheWVyKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN0YXRlLmJpY3ljbGluZ0xheWVyLnNldE1hcChudWxsKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShCaWN5Y2xpbmdMYXllciwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIFRyYW5zaXRMYXllckZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBvbkxvYWQsXHJcbiAgICBvblVubW91bnRcclxuICB9ID0gX3JlZjtcclxuICB2YXIgbWFwID0gdXNlQ29udGV4dChNYXBDb250ZXh0KTtcclxuICB2YXIgW2luc3RhbmNlLCBzZXRJbnN0YW5jZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2YXIgdHJhbnNpdExheWVyID0gbmV3IGdvb2dsZS5tYXBzLlRyYW5zaXRMYXllcigpO1xyXG4gICAgc2V0SW5zdGFuY2UodHJhbnNpdExheWVyKTtcclxuICAgIHRyYW5zaXRMYXllci5zZXRNYXAobWFwKTtcclxuICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgb25Mb2FkKHRyYW5zaXRMYXllcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgICBvblVubW91bnQoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0YW5jZS5zZXRNYXAobnVsbCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG4gIHJldHVybiBudWxsO1xyXG59XHJcbnZhciBUcmFuc2l0TGF5ZXJGID0gbWVtbyhUcmFuc2l0TGF5ZXJGdW5jdGlvbmFsKTtcclxuY2xhc3MgVHJhbnNpdExheWVyIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICB0cmFuc2l0TGF5ZXI6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0VHJhbnNpdExheWVyQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS50cmFuc2l0TGF5ZXIgIT09IG51bGwpIHtcclxuICAgICAgICB0aGlzLnN0YXRlLnRyYW5zaXRMYXllci5zZXRNYXAodGhpcy5jb250ZXh0KTtcclxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUudHJhbnNpdExheWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIHZhciB0cmFuc2l0TGF5ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuVHJhbnNpdExheWVyKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldFRyYW5zaXRMYXllcigpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB0cmFuc2l0TGF5ZXJcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0VHJhbnNpdExheWVyQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLnRyYW5zaXRMYXllciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLnRyYW5zaXRMYXllcik7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zdGF0ZS50cmFuc2l0TGF5ZXIuc2V0TWFwKG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KFRyYW5zaXRMYXllciwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIG93bktleXMkZShlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkZShlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJGUoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJGUoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxudmFyIGV2ZW50TWFwJGcgPSB7XHJcbiAgb25DaXJjbGVDb21wbGV0ZTogJ2NpcmNsZWNvbXBsZXRlJyxcclxuICBvbk1hcmtlckNvbXBsZXRlOiAnbWFya2VyY29tcGxldGUnLFxyXG4gIG9uT3ZlcmxheUNvbXBsZXRlOiAnb3ZlcmxheWNvbXBsZXRlJyxcclxuICBvblBvbHlnb25Db21wbGV0ZTogJ3BvbHlnb25jb21wbGV0ZScsXHJcbiAgb25Qb2x5bGluZUNvbXBsZXRlOiAncG9seWxpbmVjb21wbGV0ZScsXHJcbiAgb25SZWN0YW5nbGVDb21wbGV0ZTogJ3JlY3RhbmdsZWNvbXBsZXRlJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCRnID0ge1xyXG4gIGRyYXdpbmdNb2RlKGluc3RhbmNlLCBkcmF3aW5nTW9kZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0RHJhd2luZ01vZGUoZHJhd2luZ01vZGUpO1xyXG4gIH0sXHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9XHJcbn07XHJcbmZ1bmN0aW9uIERyYXdpbmdNYW5hZ2VyRnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIG9wdGlvbnMsXHJcbiAgICBkcmF3aW5nTW9kZSxcclxuICAgIG9uQ2lyY2xlQ29tcGxldGUsXHJcbiAgICBvbk1hcmtlckNvbXBsZXRlLFxyXG4gICAgb25PdmVybGF5Q29tcGxldGUsXHJcbiAgICBvblBvbHlnb25Db21wbGV0ZSxcclxuICAgIG9uUG9seWxpbmVDb21wbGV0ZSxcclxuICAgIG9uUmVjdGFuZ2xlQ29tcGxldGUsXHJcbiAgICBvbkxvYWQsXHJcbiAgICBvblVubW91bnRcclxuICB9ID0gX3JlZjtcclxuICB2YXIgbWFwID0gdXNlQ29udGV4dChNYXBDb250ZXh0KTtcclxuICB2YXIgW2luc3RhbmNlLCBzZXRJbnN0YW5jZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NpcmNsZWNvbXBsZXRlTGlzdGVuZXIsIHNldENpcmNsZUNvbXBsZXRlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttYXJrZXJjb21wbGV0ZUxpc3RlbmVyLCBzZXRNYXJrZXJDb21wbGV0ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbb3ZlcmxheWNvbXBsZXRlTGlzdGVuZXIsIHNldE92ZXJsYXlDb21wbGV0ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcG9seWdvbmNvbXBsZXRlTGlzdGVuZXIsIHNldFBvbHlnb25Db21wbGV0ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcG9seWxpbmVjb21wbGV0ZUxpc3RlbmVyLCBzZXRQb2x5bGluZUNvbXBsZXRlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyZWN0YW5nbGVjb21wbGV0ZUxpc3RlbmVyLCBzZXRSZWN0YW5nbGVDb21wbGV0ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIC8vIE9yZGVyIGRvZXMgbWF0dGVyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9LCBbbWFwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChvcHRpb25zICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBvcHRpb25zXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXREcmF3aW5nTW9kZShkcmF3aW5nTW9kZSAhPT0gbnVsbCAmJiBkcmF3aW5nTW9kZSAhPT0gdm9pZCAwID8gZHJhd2luZ01vZGUgOiBudWxsKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGRyYXdpbmdNb2RlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkNpcmNsZUNvbXBsZXRlKSB7XHJcbiAgICAgIGlmIChjaXJjbGVjb21wbGV0ZUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2lyY2xlY29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Q2lyY2xlQ29tcGxldGVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2NpcmNsZWNvbXBsZXRlJywgb25DaXJjbGVDb21wbGV0ZSkpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgb25DaXJjbGVDb21wbGV0ZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25NYXJrZXJDb21wbGV0ZSkge1xyXG4gICAgICBpZiAobWFya2VyY29tcGxldGVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1hcmtlcmNvbXBsZXRlTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1hcmtlckNvbXBsZXRlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtYXJrZXJjb21wbGV0ZScsIG9uTWFya2VyQ29tcGxldGUpKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9uTWFya2VyQ29tcGxldGVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uT3ZlcmxheUNvbXBsZXRlKSB7XHJcbiAgICAgIGlmIChvdmVybGF5Y29tcGxldGVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG92ZXJsYXljb21wbGV0ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRPdmVybGF5Q29tcGxldGVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ292ZXJsYXljb21wbGV0ZScsIG9uT3ZlcmxheUNvbXBsZXRlKSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBvbk92ZXJsYXlDb21wbGV0ZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Qb2x5Z29uQ29tcGxldGUpIHtcclxuICAgICAgaWYgKHBvbHlnb25jb21wbGV0ZUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocG9seWdvbmNvbXBsZXRlTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFBvbHlnb25Db21wbGV0ZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncG9seWdvbmNvbXBsZXRlJywgb25Qb2x5Z29uQ29tcGxldGUpKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9uUG9seWdvbkNvbXBsZXRlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblBvbHlsaW5lQ29tcGxldGUpIHtcclxuICAgICAgaWYgKHBvbHlsaW5lY29tcGxldGVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHBvbHlsaW5lY29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UG9seWxpbmVDb21wbGV0ZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncG9seWxpbmVjb21wbGV0ZScsIG9uUG9seWxpbmVDb21wbGV0ZSkpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgb25Qb2x5bGluZUNvbXBsZXRlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblJlY3RhbmdsZUNvbXBsZXRlKSB7XHJcbiAgICAgIGlmIChyZWN0YW5nbGVjb21wbGV0ZUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmVjdGFuZ2xlY29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UmVjdGFuZ2xlQ29tcGxldGVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JlY3RhbmdsZWNvbXBsZXRlJywgb25SZWN0YW5nbGVDb21wbGV0ZSkpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgb25SZWN0YW5nbGVDb21wbGV0ZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpbnZhcmlhbnQoISFnb29nbGUubWFwcy5kcmF3aW5nLCBcIkRpZCB5b3UgaW5jbHVkZSBwcm9wIGxpYnJhcmllcz17WydkcmF3aW5nJ119IGluIHRoZSBVUkw/ICVzXCIsIGdvb2dsZS5tYXBzLmRyYXdpbmcpO1xyXG4gICAgdmFyIGRyYXdpbmdNYW5hZ2VyID0gbmV3IGdvb2dsZS5tYXBzLmRyYXdpbmcuRHJhd2luZ01hbmFnZXIoX29iamVjdFNwcmVhZCRlKF9vYmplY3RTcHJlYWQkZSh7fSwgb3B0aW9ucyksIHt9LCB7XHJcbiAgICAgIG1hcFxyXG4gICAgfSkpO1xyXG4gICAgaWYgKGRyYXdpbmdNb2RlKSB7XHJcbiAgICAgIGRyYXdpbmdNYW5hZ2VyLnNldERyYXdpbmdNb2RlKGRyYXdpbmdNb2RlKTtcclxuICAgIH1cclxuICAgIGlmIChvbkNpcmNsZUNvbXBsZXRlKSB7XHJcbiAgICAgIHNldENpcmNsZUNvbXBsZXRlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZHJhd2luZ01hbmFnZXIsICdjaXJjbGVjb21wbGV0ZScsIG9uQ2lyY2xlQ29tcGxldGUpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1hcmtlckNvbXBsZXRlKSB7XHJcbiAgICAgIHNldE1hcmtlckNvbXBsZXRlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZHJhd2luZ01hbmFnZXIsICdtYXJrZXJjb21wbGV0ZScsIG9uTWFya2VyQ29tcGxldGUpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk92ZXJsYXlDb21wbGV0ZSkge1xyXG4gICAgICBzZXRPdmVybGF5Q29tcGxldGVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihkcmF3aW5nTWFuYWdlciwgJ292ZXJsYXljb21wbGV0ZScsIG9uT3ZlcmxheUNvbXBsZXRlKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Qb2x5Z29uQ29tcGxldGUpIHtcclxuICAgICAgc2V0UG9seWdvbkNvbXBsZXRlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZHJhd2luZ01hbmFnZXIsICdwb2x5Z29uY29tcGxldGUnLCBvblBvbHlnb25Db21wbGV0ZSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uUG9seWxpbmVDb21wbGV0ZSkge1xyXG4gICAgICBzZXRQb2x5bGluZUNvbXBsZXRlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZHJhd2luZ01hbmFnZXIsICdwb2x5bGluZWNvbXBsZXRlJywgb25Qb2x5bGluZUNvbXBsZXRlKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25SZWN0YW5nbGVDb21wbGV0ZSkge1xyXG4gICAgICBzZXRSZWN0YW5nbGVDb21wbGV0ZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGRyYXdpbmdNYW5hZ2VyLCAncmVjdGFuZ2xlY29tcGxldGUnLCBvblJlY3RhbmdsZUNvbXBsZXRlKSk7XHJcbiAgICB9XHJcbiAgICBzZXRJbnN0YW5jZShkcmF3aW5nTWFuYWdlcik7XHJcbiAgICBpZiAob25Mb2FkKSB7XHJcbiAgICAgIG9uTG9hZChkcmF3aW5nTWFuYWdlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgICBpZiAoY2lyY2xlY29tcGxldGVMaXN0ZW5lcikge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2lyY2xlY29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXJrZXJjb21wbGV0ZUxpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtYXJrZXJjb21wbGV0ZUxpc3RlbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG92ZXJsYXljb21wbGV0ZUxpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihvdmVybGF5Y29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwb2x5Z29uY29tcGxldGVMaXN0ZW5lcikge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocG9seWdvbmNvbXBsZXRlTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocG9seWxpbmVjb21wbGV0ZUxpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihwb2x5bGluZWNvbXBsZXRlTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVjdGFuZ2xlY29tcGxldGVMaXN0ZW5lcikge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmVjdGFuZ2xlY29tcGxldGVMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICAgIG9uVW5tb3VudChpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlLnNldE1hcChudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxudmFyIERyYXdpbmdNYW5hZ2VyRiA9IG1lbW8oRHJhd2luZ01hbmFnZXJGdW5jdGlvbmFsKTtcclxuY2xhc3MgRHJhd2luZ01hbmFnZXIgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVnaXN0ZXJlZEV2ZW50c1wiLCBbXSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIGRyYXdpbmdNYW5hZ2VyOiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldERyYXdpbmdNYW5hZ2VyQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5kcmF3aW5nTWFuYWdlciAhPT0gbnVsbCAmJiB0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUuZHJhd2luZ01hbmFnZXIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGludmFyaWFudCghIWdvb2dsZS5tYXBzLmRyYXdpbmcsIFwiRGlkIHlvdSBpbmNsdWRlIHByb3AgbGlicmFyaWVzPXtbJ2RyYXdpbmcnXX0gaW4gdGhlIFVSTD8gJXNcIiwgZ29vZ2xlLm1hcHMuZHJhd2luZyk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIGRyYXdpbmdNYW5hZ2VyID0gbmV3IGdvb2dsZS5tYXBzLmRyYXdpbmcuRHJhd2luZ01hbmFnZXIoX29iamVjdFNwcmVhZCRlKF9vYmplY3RTcHJlYWQkZSh7fSwgdGhpcy5wcm9wcy5vcHRpb25zKSwge30sIHtcclxuICAgICAgbWFwOiB0aGlzLmNvbnRleHRcclxuICAgIH0pKTtcclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGcsXHJcbiAgICAgIGV2ZW50TWFwOiBldmVudE1hcCRnLFxyXG4gICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIGluc3RhbmNlOiBkcmF3aW5nTWFuYWdlclxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldERyYXdpbmdNYW5hZ2VyKCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGRyYXdpbmdNYW5hZ2VyXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldERyYXdpbmdNYW5hZ2VyQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kcmF3aW5nTWFuYWdlciAhPT0gbnVsbCkge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkZyxcclxuICAgICAgICBldmVudE1hcDogZXZlbnRNYXAkZyxcclxuICAgICAgICBwcmV2UHJvcHMsXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiB0aGlzLnN0YXRlLmRyYXdpbmdNYW5hZ2VyXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmRyYXdpbmdNYW5hZ2VyICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUuZHJhd2luZ01hbmFnZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgICAgdGhpcy5zdGF0ZS5kcmF3aW5nTWFuYWdlci5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoRHJhd2luZ01hbmFnZXIsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzJGQoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfVxyXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkJGQoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyRkKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyRkKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9XHJcbnZhciBldmVudE1hcCRmID0ge1xyXG4gIG9uQW5pbWF0aW9uQ2hhbmdlZDogJ2FuaW1hdGlvbl9jaGFuZ2VkJyxcclxuICBvbkNsaWNrOiAnY2xpY2snLFxyXG4gIG9uQ2xpY2thYmxlQ2hhbmdlZDogJ2NsaWNrYWJsZV9jaGFuZ2VkJyxcclxuICBvbkN1cnNvckNoYW5nZWQ6ICdjdXJzb3JfY2hhbmdlZCcsXHJcbiAgb25EYmxDbGljazogJ2RibGNsaWNrJyxcclxuICBvbkRyYWc6ICdkcmFnJyxcclxuICBvbkRyYWdFbmQ6ICdkcmFnZW5kJyxcclxuICBvbkRyYWdnYWJsZUNoYW5nZWQ6ICdkcmFnZ2FibGVfY2hhbmdlZCcsXHJcbiAgb25EcmFnU3RhcnQ6ICdkcmFnc3RhcnQnLFxyXG4gIG9uRmxhdENoYW5nZWQ6ICdmbGF0X2NoYW5nZWQnLFxyXG4gIG9uSWNvbkNoYW5nZWQ6ICdpY29uX2NoYW5nZWQnLFxyXG4gIG9uTW91c2VEb3duOiAnbW91c2Vkb3duJyxcclxuICBvbk1vdXNlT3V0OiAnbW91c2VvdXQnLFxyXG4gIG9uTW91c2VPdmVyOiAnbW91c2VvdmVyJyxcclxuICBvbk1vdXNlVXA6ICdtb3VzZXVwJyxcclxuICBvblBvc2l0aW9uQ2hhbmdlZDogJ3Bvc2l0aW9uX2NoYW5nZWQnLFxyXG4gIG9uUmlnaHRDbGljazogJ3JpZ2h0Y2xpY2snLFxyXG4gIG9uU2hhcGVDaGFuZ2VkOiAnc2hhcGVfY2hhbmdlZCcsXHJcbiAgb25UaXRsZUNoYW5nZWQ6ICd0aXRsZV9jaGFuZ2VkJyxcclxuICBvblZpc2libGVDaGFuZ2VkOiAndmlzaWJsZV9jaGFuZ2VkJyxcclxuICBvblppbmRleENoYW5nZWQ6ICd6aW5kZXhfY2hhbmdlZCdcclxufTtcclxudmFyIHVwZGF0ZXJNYXAkZiA9IHtcclxuICBhbmltYXRpb24oaW5zdGFuY2UsIGFuaW1hdGlvbikge1xyXG4gICAgaW5zdGFuY2Uuc2V0QW5pbWF0aW9uKGFuaW1hdGlvbik7XHJcbiAgfSxcclxuICBjbGlja2FibGUoaW5zdGFuY2UsIGNsaWNrYWJsZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0Q2xpY2thYmxlKGNsaWNrYWJsZSk7XHJcbiAgfSxcclxuICBjdXJzb3IoaW5zdGFuY2UsIGN1cnNvcikge1xyXG4gICAgaW5zdGFuY2Uuc2V0Q3Vyc29yKGN1cnNvcik7XHJcbiAgfSxcclxuICBkcmFnZ2FibGUoaW5zdGFuY2UsIGRyYWdnYWJsZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0RHJhZ2dhYmxlKGRyYWdnYWJsZSk7XHJcbiAgfSxcclxuICBpY29uKGluc3RhbmNlLCBpY29uKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRJY29uKGljb24pO1xyXG4gIH0sXHJcbiAgbGFiZWwoaW5zdGFuY2UsIGxhYmVsKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRMYWJlbChsYWJlbCk7XHJcbiAgfSxcclxuICBtYXAoaW5zdGFuY2UsIG1hcCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgfSxcclxuICBvcGFjaXR5KGluc3RhbmNlLCBvcGFjaXR5KSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcGFjaXR5KG9wYWNpdHkpO1xyXG4gIH0sXHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHBvc2l0aW9uKGluc3RhbmNlLCBwb3NpdGlvbikge1xyXG4gICAgaW5zdGFuY2Uuc2V0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gIH0sXHJcbiAgc2hhcGUoaW5zdGFuY2UsIHNoYXBlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRTaGFwZShzaGFwZSk7XHJcbiAgfSxcclxuICB0aXRsZShpbnN0YW5jZSwgdGl0bGUpIHtcclxuICAgIGluc3RhbmNlLnNldFRpdGxlKHRpdGxlKTtcclxuICB9LFxyXG4gIHZpc2libGUoaW5zdGFuY2UsIHZpc2libGUpIHtcclxuICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgfSxcclxuICB6SW5kZXgoaW5zdGFuY2UsIHpJbmRleCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgfVxyXG59O1xyXG52YXIgZGVmYXVsdE9wdGlvbnMkNSA9IHt9O1xyXG5mdW5jdGlvbiBNYXJrZXJGdW5jdGlvbmFsKF9yZWYpIHtcclxuICB2YXIge1xyXG4gICAgcG9zaXRpb24sXHJcbiAgICBvcHRpb25zLFxyXG4gICAgY2x1c3RlcmVyLFxyXG4gICAgbm9DbHVzdGVyZXJSZWRyYXcsXHJcbiAgICBjaGlsZHJlbixcclxuICAgIGRyYWdnYWJsZSxcclxuICAgIHZpc2libGUsXHJcbiAgICBhbmltYXRpb24sXHJcbiAgICBjbGlja2FibGUsXHJcbiAgICBjdXJzb3IsXHJcbiAgICBpY29uLFxyXG4gICAgbGFiZWwsXHJcbiAgICBvcGFjaXR5LFxyXG4gICAgc2hhcGUsXHJcbiAgICB0aXRsZSxcclxuICAgIHpJbmRleCxcclxuICAgIG9uQ2xpY2ssXHJcbiAgICBvbkRibENsaWNrLFxyXG4gICAgb25EcmFnLFxyXG4gICAgb25EcmFnRW5kLFxyXG4gICAgb25EcmFnU3RhcnQsXHJcbiAgICBvbk1vdXNlT3V0LFxyXG4gICAgb25Nb3VzZU92ZXIsXHJcbiAgICBvbk1vdXNlVXAsXHJcbiAgICBvbk1vdXNlRG93bixcclxuICAgIG9uUmlnaHRDbGljayxcclxuICAgIG9uQ2xpY2thYmxlQ2hhbmdlZCxcclxuICAgIG9uQ3Vyc29yQ2hhbmdlZCxcclxuICAgIG9uQW5pbWF0aW9uQ2hhbmdlZCxcclxuICAgIG9uRHJhZ2dhYmxlQ2hhbmdlZCxcclxuICAgIG9uRmxhdENoYW5nZWQsXHJcbiAgICBvbkljb25DaGFuZ2VkLFxyXG4gICAgb25Qb3NpdGlvbkNoYW5nZWQsXHJcbiAgICBvblNoYXBlQ2hhbmdlZCxcclxuICAgIG9uVGl0bGVDaGFuZ2VkLFxyXG4gICAgb25WaXNpYmxlQ2hhbmdlZCxcclxuICAgIG9uWmluZGV4Q2hhbmdlZCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIHZhciBbaW5zdGFuY2UsIHNldEluc3RhbmNlXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZGJsY2xpY2tMaXN0ZW5lciwgc2V0RGJsY2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2RyYWdlbmRMaXN0ZW5lciwgc2V0RHJhZ2VuZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ3N0YXJ0TGlzdGVuZXIsIHNldERyYWdzdGFydExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2Vkb3duTGlzdGVuZXIsIHNldE1vdXNlZG93bkxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdXRMaXN0ZW5lciwgc2V0TW91c2VvdXRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNlb3Zlckxpc3RlbmVyLCBzZXRNb3VzZW92ZXJMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNldXBMaXN0ZW5lciwgc2V0TW91c2V1cExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcmlnaHRjbGlja0xpc3RlbmVyLCBzZXRSaWdodGNsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbGlja0xpc3RlbmVyLCBzZXRDbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ0xpc3RlbmVyLCBzZXREcmFnTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbGlja2FibGVDaGFuZ2VkTGlzdGVuZXIsIHNldENsaWNrYWJsZUNoYW5nZWRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2N1cnNvckNoYW5nZWRMaXN0ZW5lciwgc2V0Q3Vyc29yQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbYW5pbWF0aW9uQ2hhbmdlZExpc3RlbmVyLCBzZXRBbmltYXRpb25DaGFuZ2VkTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnZ2FibGVDaGFuZ2VkTGlzdGVuZXIsIHNldERyYWdnYWJsZUNoYW5nZWRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2ZsYXRDaGFuZ2VkTGlzdGVuZXIsIHNldEZsYXRDaGFuZ2VkTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtpY29uQ2hhbmdlZExpc3RlbmVyLCBzZXRJY29uQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcG9zaXRpb25DaGFuZ2VkTGlzdGVuZXIsIHNldFBvc2l0aW9uQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbc2hhcGVDaGFuZ2VkTGlzdGVuZXIsIHNldFNoYXBlQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbdGl0bGVDaGFuZ2VkTGlzdGVuZXIsIHNldFRpdGxlQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbdmlzaWJsZUNoYW5nZWRMaXN0ZW5lciwgc2V0VmlzaWJsZUNoYW5nZWRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW3pJbmRleENoYW5nZWRMaXN0ZW5lciwgc2V0WmluZGV4Q2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIC8vIE9yZGVyIGRvZXMgbWF0dGVyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9LCBbbWFwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9wdGlvbnNdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBkcmFnZ2FibGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgZHJhZ2dhYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChwb3NpdGlvbiAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBwb3NpdGlvbl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHZpc2libGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCB2aXNpYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGluc3RhbmNlID09PSBudWxsIHx8IGluc3RhbmNlID09PSB2b2lkIDAgfHwgaW5zdGFuY2Uuc2V0QW5pbWF0aW9uKGFuaW1hdGlvbik7XHJcbiAgfSwgW2luc3RhbmNlLCBhbmltYXRpb25dKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIGNsaWNrYWJsZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldENsaWNrYWJsZShjbGlja2FibGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgY2xpY2thYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBjdXJzb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRDdXJzb3IoY3Vyc29yKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGN1cnNvcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgaWNvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldEljb24oaWNvbik7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBpY29uXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBsYWJlbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldExhYmVsKGxhYmVsKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGxhYmVsXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvcGFjaXR5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0T3BhY2l0eShvcGFjaXR5KTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9wYWNpdHldKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIHNoYXBlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0U2hhcGUoc2hhcGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgc2hhcGVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIHRpdGxlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0VGl0bGUodGl0bGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgdGl0bGVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIHpJbmRleCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFpJbmRleCh6SW5kZXgpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgekluZGV4XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRibENsaWNrKSB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRibENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRyYWdFbmQpIHtcclxuICAgICAgaWYgKGRyYWdlbmRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdlbmRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ2VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZ2VuZCcsIG9uRHJhZ0VuZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWdFbmRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRHJhZ1N0YXJ0KSB7XHJcbiAgICAgIGlmIChkcmFnc3RhcnRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdzdGFydExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnc3RhcnRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RyYWdzdGFydCcsIG9uRHJhZ1N0YXJ0KSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRHJhZ1N0YXJ0XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlRG93bikge1xyXG4gICAgICBpZiAobW91c2Vkb3duTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZWRvd25MaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vkb3duTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZWRvd24nLCBvbk1vdXNlRG93bikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlRG93bl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZU91dCkge1xyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlb3V0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU91dF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZU92ZXIpIHtcclxuICAgICAgaWYgKG1vdXNlb3Zlckxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdmVyTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlb3Zlckxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2VvdmVyJywgb25Nb3VzZU92ZXIpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU92ZXJdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VVcCkge1xyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZXVwTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZXVwJywgb25Nb3VzZVVwKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VVcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25SaWdodENsaWNrKSB7XHJcbiAgICAgIGlmIChyaWdodGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyaWdodGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25SaWdodENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkNsaWNrKSB7XHJcbiAgICAgIGlmIChjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2NsaWNrJywgb25DbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRyYWcpIHtcclxuICAgICAgaWYgKGRyYWdMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZycsIG9uRHJhZykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWddKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ2xpY2thYmxlQ2hhbmdlZCkge1xyXG4gICAgICBpZiAoY2xpY2thYmxlQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2xpY2thYmxlQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRDbGlja2FibGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdjbGlja2FibGVfY2hhbmdlZCcsIG9uQ2xpY2thYmxlQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsaWNrYWJsZUNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ3Vyc29yQ2hhbmdlZCkge1xyXG4gICAgICBpZiAoY3Vyc29yQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY3Vyc29yQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRDdXJzb3JDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdjdXJzb3JfY2hhbmdlZCcsIG9uQ3Vyc29yQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkN1cnNvckNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQW5pbWF0aW9uQ2hhbmdlZCkge1xyXG4gICAgICBpZiAoYW5pbWF0aW9uQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoYW5pbWF0aW9uQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRBbmltYXRpb25DaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdhbmltYXRpb25fY2hhbmdlZCcsIG9uQW5pbWF0aW9uQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkFuaW1hdGlvbkNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRHJhZ2dhYmxlQ2hhbmdlZCkge1xyXG4gICAgICBpZiAoZHJhZ2dhYmxlQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ2dhYmxlQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnZ2FibGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkcmFnZ2FibGVfY2hhbmdlZCcsIG9uRHJhZ2dhYmxlQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWdnYWJsZUNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRmxhdENoYW5nZWQpIHtcclxuICAgICAgaWYgKGZsYXRDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihmbGF0Q2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRGbGF0Q2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZmxhdF9jaGFuZ2VkJywgb25GbGF0Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkZsYXRDaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkljb25DaGFuZ2VkKSB7XHJcbiAgICAgIGlmIChpY29uQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoaWNvbkNoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0SWNvbkNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2ljb25fY2hhbmdlZCcsIG9uSWNvbkNoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25JY29uQ2hhbmdlZF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Qb3NpdGlvbkNoYW5nZWQpIHtcclxuICAgICAgaWYgKHBvc2l0aW9uQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocG9zaXRpb25DaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFBvc2l0aW9uQ2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncG9zaXRpb25fY2hhbmdlZCcsIG9uUG9zaXRpb25DaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uUG9zaXRpb25DaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblNoYXBlQ2hhbmdlZCkge1xyXG4gICAgICBpZiAoc2hhcGVDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihzaGFwZUNoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0U2hhcGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdzaGFwZV9jaGFuZ2VkJywgb25TaGFwZUNoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25TaGFwZUNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uVGl0bGVDaGFuZ2VkKSB7XHJcbiAgICAgIGlmICh0aXRsZUNoYW5nZWRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHRpdGxlQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRUaXRsZUNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3RpdGxlX2NoYW5nZWQnLCBvblRpdGxlQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblRpdGxlQ2hhbmdlZF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25WaXNpYmxlQ2hhbmdlZCkge1xyXG4gICAgICBpZiAodmlzaWJsZUNoYW5nZWRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHZpc2libGVDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFZpc2libGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICd2aXNpYmxlX2NoYW5nZWQnLCBvblZpc2libGVDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uVmlzaWJsZUNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uWmluZGV4Q2hhbmdlZCkge1xyXG4gICAgICBpZiAoekluZGV4Q2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoekluZGV4Q2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRaaW5kZXhDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICd6aW5kZXhfY2hhbmdlZCcsIG9uWmluZGV4Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblppbmRleENoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdmFyIG1hcmtlck9wdGlvbnMgPSBfb2JqZWN0U3ByZWFkJGQoX29iamVjdFNwcmVhZCRkKF9vYmplY3RTcHJlYWQkZCh7fSwgb3B0aW9ucyB8fCBkZWZhdWx0T3B0aW9ucyQ1KSwgY2x1c3RlcmVyID8gZGVmYXVsdE9wdGlvbnMkNSA6IHtcclxuICAgICAgbWFwXHJcbiAgICB9KSwge30sIHtcclxuICAgICAgcG9zaXRpb25cclxuICAgIH0pO1xyXG4gICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIobWFya2VyT3B0aW9ucyk7XHJcbiAgICBpZiAoY2x1c3RlcmVyKSB7XHJcbiAgICAgIGNsdXN0ZXJlci5hZGRNYXJrZXIobWFya2VyLCAhIW5vQ2x1c3RlcmVyUmVkcmF3KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcmtlci5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICAgIGlmIChwb3NpdGlvbikge1xyXG4gICAgICBtYXJrZXIuc2V0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB2aXNpYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBtYXJrZXIuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZHJhZ2dhYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBtYXJrZXIuc2V0RHJhZ2dhYmxlKGRyYWdnYWJsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGNsaWNrYWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgbWFya2VyLnNldENsaWNrYWJsZShjbGlja2FibGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBjdXJzb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIG1hcmtlci5zZXRDdXJzb3IoY3Vyc29yKTtcclxuICAgIH1cclxuICAgIGlmIChpY29uKSB7XHJcbiAgICAgIG1hcmtlci5zZXRJY29uKGljb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBsYWJlbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgbWFya2VyLnNldExhYmVsKGxhYmVsKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3BhY2l0eSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgbWFya2VyLnNldE9wYWNpdHkob3BhY2l0eSk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2hhcGUpIHtcclxuICAgICAgbWFya2VyLnNldFNoYXBlKHNoYXBlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdGl0bGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIG1hcmtlci5zZXRUaXRsZSh0aXRsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHpJbmRleCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgbWFya2VyLnNldFpJbmRleCh6SW5kZXgpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRGJsQ2xpY2spIHtcclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdFbmQpIHtcclxuICAgICAgc2V0RHJhZ2VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2RyYWdlbmQnLCBvbkRyYWdFbmQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdTdGFydCkge1xyXG4gICAgICBzZXREcmFnc3RhcnRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdkcmFnc3RhcnQnLCBvbkRyYWdTdGFydCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VEb3duKSB7XHJcbiAgICAgIHNldE1vdXNlZG93bkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU91dCkge1xyXG4gICAgICBzZXRNb3VzZW91dExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIHNldE1vdXNlb3Zlckxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ21vdXNlb3ZlcicsIG9uTW91c2VPdmVyKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZVVwKSB7XHJcbiAgICAgIHNldE1vdXNldXBMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdtb3VzZXVwJywgb25Nb3VzZVVwKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25SaWdodENsaWNrKSB7XHJcbiAgICAgIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdyaWdodGNsaWNrJywgb25SaWdodENsaWNrKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25DbGljaykge1xyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgb25DbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZykge1xyXG4gICAgICBzZXREcmFnTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnZHJhZycsIG9uRHJhZykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uQ2xpY2thYmxlQ2hhbmdlZCkge1xyXG4gICAgICBzZXRDbGlja2FibGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2thYmxlX2NoYW5nZWQnLCBvbkNsaWNrYWJsZUNoYW5nZWQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkN1cnNvckNoYW5nZWQpIHtcclxuICAgICAgc2V0Q3Vyc29yQ2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2N1cnNvcl9jaGFuZ2VkJywgb25DdXJzb3JDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25BbmltYXRpb25DaGFuZ2VkKSB7XHJcbiAgICAgIHNldEFuaW1hdGlvbkNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdhbmltYXRpb25fY2hhbmdlZCcsIG9uQW5pbWF0aW9uQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZ2dhYmxlQ2hhbmdlZCkge1xyXG4gICAgICBzZXREcmFnZ2FibGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnZHJhZ2dhYmxlX2NoYW5nZWQnLCBvbkRyYWdnYWJsZUNoYW5nZWQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkZsYXRDaGFuZ2VkKSB7XHJcbiAgICAgIHNldEZsYXRDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnZmxhdF9jaGFuZ2VkJywgb25GbGF0Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uSWNvbkNoYW5nZWQpIHtcclxuICAgICAgc2V0SWNvbkNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdpY29uX2NoYW5nZWQnLCBvbkljb25DaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Qb3NpdGlvbkNoYW5nZWQpIHtcclxuICAgICAgc2V0UG9zaXRpb25DaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAncG9zaXRpb25fY2hhbmdlZCcsIG9uUG9zaXRpb25DaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25TaGFwZUNoYW5nZWQpIHtcclxuICAgICAgc2V0U2hhcGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnc2hhcGVfY2hhbmdlZCcsIG9uU2hhcGVDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25UaXRsZUNoYW5nZWQpIHtcclxuICAgICAgc2V0VGl0bGVDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAndGl0bGVfY2hhbmdlZCcsIG9uVGl0bGVDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25WaXNpYmxlQ2hhbmdlZCkge1xyXG4gICAgICBzZXRWaXNpYmxlQ2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ3Zpc2libGVfY2hhbmdlZCcsIG9uVmlzaWJsZUNoYW5nZWQpKTtcclxuICAgIH1cclxuICAgIGlmIChvblppbmRleENoYW5nZWQpIHtcclxuICAgICAgc2V0WmluZGV4Q2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ3ppbmRleF9jaGFuZ2VkJywgb25aaW5kZXhDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBzZXRJbnN0YW5jZShtYXJrZXIpO1xyXG4gICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICBvbkxvYWQobWFya2VyKTtcclxuICAgIH1cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdlbmRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdlbmRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdzdGFydExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ3N0YXJ0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZWRvd25MaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlZG93bkxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocmlnaHRjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmlnaHRjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjbGlja2FibGVDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja2FibGVDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjdXJzb3JDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjdXJzb3JDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChhbmltYXRpb25DaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihhbmltYXRpb25DaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChkcmFnZ2FibGVDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnZ2FibGVDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChmbGF0Q2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZmxhdENoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGljb25DaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihpY29uQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocG9zaXRpb25DaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihwb3NpdGlvbkNoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRpdGxlQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIodGl0bGVDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2aXNpYmxlQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIodmlzaWJsZUNoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHpJbmRleENoYW5nZWRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHpJbmRleENoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9uVW5tb3VudCkge1xyXG4gICAgICAgIG9uVW5tb3VudChtYXJrZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjbHVzdGVyZXIpIHtcclxuICAgICAgICBjbHVzdGVyZXIucmVtb3ZlTWFya2VyKG1hcmtlciwgISFub0NsdXN0ZXJlclJlZHJhdyk7XHJcbiAgICAgIH0gZWxzZSBpZiAobWFya2VyKSB7XHJcbiAgICAgICAgbWFya2VyLnNldE1hcChudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcbiAgdmFyIGNoeCA9IHVzZU1lbW8oKCkgPT4ge1xyXG4gICAgcmV0dXJuIGNoaWxkcmVuID8gQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCBjaGlsZCA9PiB7XHJcbiAgICAgIGlmICghaXNWYWxpZEVsZW1lbnQoY2hpbGQpKSB7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBlbGVtZW50Q2hpbGQgPSBjaGlsZDtcclxuICAgICAgcmV0dXJuIGNsb25lRWxlbWVudChlbGVtZW50Q2hpbGQsIHtcclxuICAgICAgICBhbmNob3I6IGluc3RhbmNlXHJcbiAgICAgIH0pO1xyXG4gICAgfSkgOiBudWxsO1xyXG4gIH0sIFtjaGlsZHJlbiwgaW5zdGFuY2VdKTtcclxuICByZXR1cm4ganN4KEZyYWdtZW50LCB7XHJcbiAgICBjaGlsZHJlbjogY2h4XHJcbiAgfSkgfHwgbnVsbDtcclxufVxyXG52YXIgTWFya2VyRiA9IG1lbW8oTWFya2VyRnVuY3Rpb25hbCk7XHJcbmNsYXNzIE1hcmtlciBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoZnVuY3Rpb24qICgpIHtcclxuICAgICAgdmFyIG1hcmtlck9wdGlvbnMgPSBfb2JqZWN0U3ByZWFkJGQoX29iamVjdFNwcmVhZCRkKF9vYmplY3RTcHJlYWQkZCh7fSwgX3RoaXMucHJvcHMub3B0aW9ucyB8fCBkZWZhdWx0T3B0aW9ucyQ1KSwgX3RoaXMucHJvcHMuY2x1c3RlcmVyID8gZGVmYXVsdE9wdGlvbnMkNSA6IHtcclxuICAgICAgICBtYXA6IF90aGlzLmNvbnRleHRcclxuICAgICAgfSksIHt9LCB7XHJcbiAgICAgICAgcG9zaXRpb246IF90aGlzLnByb3BzLnBvc2l0aW9uXHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyBVbmZvcnR1bmF0ZWx5IHdlIGNhbid0IGp1c3QgZG8gdGhpcyBpbiB0aGUgY29udHN0cnVjdG9yLCBiZWNhdXNlIHRoZVxyXG4gICAgICAvLyBgTWFwQ29udGV4dGAgbWlnaHQgbm90IGJlIGZpbGxlZCBpbiB5ZXQuXHJcbiAgICAgIF90aGlzLm1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIobWFya2VyT3B0aW9ucyk7XHJcbiAgICAgIGlmIChfdGhpcy5wcm9wcy5jbHVzdGVyZXIpIHtcclxuICAgICAgICBfdGhpcy5wcm9wcy5jbHVzdGVyZXIuYWRkTWFya2VyKF90aGlzLm1hcmtlciwgISFfdGhpcy5wcm9wcy5ub0NsdXN0ZXJlclJlZHJhdyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgX3RoaXMubWFya2VyLnNldE1hcChfdGhpcy5jb250ZXh0KTtcclxuICAgICAgfVxyXG4gICAgICBfdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCRmLFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCRmLFxyXG4gICAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgICAgbmV4dFByb3BzOiBfdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogX3RoaXMubWFya2VyXHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoX3RoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgICAgX3RoaXMucHJvcHMub25Mb2FkKF90aGlzLm1hcmtlcik7XHJcbiAgICAgIH1cclxuICAgIH0pKCk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcclxuICAgIGlmICh0aGlzLm1hcmtlcikge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkZixcclxuICAgICAgICBldmVudE1hcDogZXZlbnRNYXAkZixcclxuICAgICAgICBwcmV2UHJvcHMsXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiB0aGlzLm1hcmtlclxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAoIXRoaXMubWFya2VyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLm1hcmtlcik7XHJcbiAgICB9XHJcbiAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICBpZiAodGhpcy5wcm9wcy5jbHVzdGVyZXIpIHtcclxuICAgICAgdGhpcy5wcm9wcy5jbHVzdGVyZXIucmVtb3ZlTWFya2VyKHRoaXMubWFya2VyLCAhIXRoaXMucHJvcHMubm9DbHVzdGVyZXJSZWRyYXcpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLm1hcmtlcikge1xyXG4gICAgICB0aGlzLm1hcmtlci5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMucHJvcHMuY2hpbGRyZW4gPyBDaGlsZHJlbi5tYXAodGhpcy5wcm9wcy5jaGlsZHJlbiwgY2hpbGQgPT4ge1xyXG4gICAgICBpZiAoIWlzVmFsaWRFbGVtZW50KGNoaWxkKSkge1xyXG4gICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgICAgfVxyXG4gICAgICB2YXIgZWxlbWVudENoaWxkID0gY2hpbGQ7XHJcbiAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoZWxlbWVudENoaWxkLCB7XHJcbiAgICAgICAgYW5jaG9yOiB0aGlzLm1hcmtlclxyXG4gICAgICB9KTtcclxuICAgIH0pIDogbnVsbDtcclxuICAgIHJldHVybiBjaGlsZHJlbiB8fCBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoTWFya2VyLCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxudmFyIENsdXN0ZXJJY29uID0gLyoqIEBjbGFzcyAqL2Z1bmN0aW9uICgpIHtcclxuICBmdW5jdGlvbiBDbHVzdGVySWNvbihjbHVzdGVyLCBzdHlsZXMpIHtcclxuICAgIGNsdXN0ZXIuZ2V0Q2x1c3RlcmVyKCkuZXh0ZW5kKENsdXN0ZXJJY29uLCBnb29nbGUubWFwcy5PdmVybGF5Vmlldyk7XHJcbiAgICB0aGlzLmNsdXN0ZXIgPSBjbHVzdGVyO1xyXG4gICAgdGhpcy5jbHVzdGVyQ2xhc3NOYW1lID0gdGhpcy5jbHVzdGVyLmdldENsdXN0ZXJlcigpLmdldENsdXN0ZXJDbGFzcygpO1xyXG4gICAgdGhpcy5jbGFzc05hbWUgPSB0aGlzLmNsdXN0ZXJDbGFzc05hbWU7XHJcbiAgICB0aGlzLnN0eWxlcyA9IHN0eWxlcztcclxuICAgIHRoaXMuY2VudGVyID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5kaXYgPSBudWxsO1xyXG4gICAgdGhpcy5zdW1zID0gbnVsbDtcclxuICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5ib3VuZHNDaGFuZ2VkTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgdGhpcy51cmwgPSAnJztcclxuICAgIHRoaXMuaGVpZ2h0ID0gMDtcclxuICAgIHRoaXMud2lkdGggPSAwO1xyXG4gICAgdGhpcy5hbmNob3JUZXh0ID0gWzAsIDBdO1xyXG4gICAgdGhpcy5hbmNob3JJY29uID0gWzAsIDBdO1xyXG4gICAgdGhpcy50ZXh0Q29sb3IgPSAnYmxhY2snO1xyXG4gICAgdGhpcy50ZXh0U2l6ZSA9IDExO1xyXG4gICAgdGhpcy50ZXh0RGVjb3JhdGlvbiA9ICdub25lJztcclxuICAgIHRoaXMuZm9udFdlaWdodCA9ICdib2xkJztcclxuICAgIHRoaXMuZm9udFN0eWxlID0gJ25vcm1hbCc7XHJcbiAgICB0aGlzLmZvbnRGYW1pbHkgPSAnQXJpYWwsc2Fucy1zZXJpZic7XHJcbiAgICB0aGlzLmJhY2tncm91bmRQb3NpdGlvbiA9ICcwIDAnO1xyXG4gICAgdGhpcy5jTW91c2VEb3duSW5DbHVzdGVyID0gbnVsbDtcclxuICAgIHRoaXMuY0RyYWdnaW5nTWFwQnlDbHVzdGVyID0gbnVsbDtcclxuICAgIHRoaXMudGltZU91dCA9IG51bGw7XHJcbiAgICB0aGlzLnNldE1hcChjbHVzdGVyLmdldE1hcCgpKTsgLy8gTm90ZTogdGhpcyBjYXVzZXMgb25BZGQgdG8gYmUgY2FsbGVkXHJcbiAgICB0aGlzLm9uQm91bmRzQ2hhbmdlZCA9IHRoaXMub25Cb3VuZHNDaGFuZ2VkLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9uTW91c2VEb3duID0gdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkNsaWNrID0gdGhpcy5vbkNsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9uTW91c2VPdmVyID0gdGhpcy5vbk1vdXNlT3Zlci5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbk1vdXNlT3V0ID0gdGhpcy5vbk1vdXNlT3V0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9uQWRkID0gdGhpcy5vbkFkZC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblJlbW92ZSA9IHRoaXMub25SZW1vdmUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZHJhdyA9IHRoaXMuZHJhdy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5oaWRlID0gdGhpcy5oaWRlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNob3cgPSB0aGlzLnNob3cuYmluZCh0aGlzKTtcclxuICAgIHRoaXMudXNlU3R5bGUgPSB0aGlzLnVzZVN0eWxlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNldENlbnRlciA9IHRoaXMuc2V0Q2VudGVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldFBvc0Zyb21MYXRMbmcgPSB0aGlzLmdldFBvc0Zyb21MYXRMbmcuYmluZCh0aGlzKTtcclxuICB9XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLm9uQm91bmRzQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuY0RyYWdnaW5nTWFwQnlDbHVzdGVyID0gdGhpcy5jTW91c2VEb3duSW5DbHVzdGVyO1xyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLm9uTW91c2VEb3duID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5jTW91c2VEb3duSW5DbHVzdGVyID0gdHJ1ZTtcclxuICAgIHRoaXMuY0RyYWdnaW5nTWFwQnlDbHVzdGVyID0gZmFsc2U7XHJcbiAgfTtcclxuICBDbHVzdGVySWNvbi5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgdGhpcy5jTW91c2VEb3duSW5DbHVzdGVyID0gZmFsc2U7XHJcbiAgICBpZiAoIXRoaXMuY0RyYWdnaW5nTWFwQnlDbHVzdGVyKSB7XHJcbiAgICAgIHZhciBtYXJrZXJDbHVzdGVyZXJfMSA9IHRoaXMuY2x1c3Rlci5nZXRDbHVzdGVyZXIoKTtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBhIGNsdXN0ZXIgbWFya2VyIGlzIGNsaWNrZWQuXHJcbiAgICAgICAqIEBuYW1lIE1hcmtlckNsdXN0ZXJlciNjbGlja1xyXG4gICAgICAgKiBAcGFyYW0ge0NsdXN0ZXJ9IGMgVGhlIGNsdXN0ZXIgdGhhdCB3YXMgY2xpY2tlZC5cclxuICAgICAgICogQGV2ZW50XHJcbiAgICAgICAqL1xyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKG1hcmtlckNsdXN0ZXJlcl8xLCAnY2xpY2snLCB0aGlzLmNsdXN0ZXIpO1xyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKG1hcmtlckNsdXN0ZXJlcl8xLCAnY2x1c3RlcmNsaWNrJywgdGhpcy5jbHVzdGVyKTsgLy8gZGVwcmVjYXRlZCBuYW1lXHJcbiAgICAgIC8vIFRoZSBkZWZhdWx0IGNsaWNrIGhhbmRsZXIgZm9sbG93cy4gRGlzYWJsZSBpdCBieSBzZXR0aW5nXHJcbiAgICAgIC8vIHRoZSB6b29tT25DbGljayBwcm9wZXJ0eSB0byBmYWxzZS5cclxuICAgICAgaWYgKG1hcmtlckNsdXN0ZXJlcl8xLmdldFpvb21PbkNsaWNrKCkpIHtcclxuICAgICAgICAvLyBab29tIGludG8gdGhlIGNsdXN0ZXIuXHJcbiAgICAgICAgdmFyIG1heFpvb21fMSA9IG1hcmtlckNsdXN0ZXJlcl8xLmdldE1heFpvb20oKTtcclxuICAgICAgICB2YXIgYm91bmRzXzEgPSB0aGlzLmNsdXN0ZXIuZ2V0Qm91bmRzKCk7XHJcbiAgICAgICAgdmFyIG1hcCA9IG1hcmtlckNsdXN0ZXJlcl8xLmdldE1hcCgpO1xyXG4gICAgICAgIGlmIChtYXAgIT09IG51bGwgJiYgJ2ZpdEJvdW5kcycgaW4gbWFwKSB7XHJcbiAgICAgICAgICBtYXAuZml0Qm91bmRzKGJvdW5kc18xKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBmaXggZm9yIElzc3VlIDE3MCBoZXJlOlxyXG4gICAgICAgIHRoaXMudGltZU91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIHZhciBtYXAgPSBtYXJrZXJDbHVzdGVyZXJfMS5nZXRNYXAoKTtcclxuICAgICAgICAgIGlmIChtYXAgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKCdmaXRCb3VuZHMnIGluIG1hcCkge1xyXG4gICAgICAgICAgICAgIG1hcC5maXRCb3VuZHMoYm91bmRzXzEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB6b29tID0gbWFwLmdldFpvb20oKSB8fCAwO1xyXG4gICAgICAgICAgICAvLyBEb24ndCB6b29tIGJleW9uZCB0aGUgbWF4IHpvb20gbGV2ZWxcclxuICAgICAgICAgICAgaWYgKG1heFpvb21fMSAhPT0gbnVsbCAmJiB6b29tID4gbWF4Wm9vbV8xKSB7XHJcbiAgICAgICAgICAgICAgbWFwLnNldFpvb20obWF4Wm9vbV8xICsgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIFByZXZlbnQgZXZlbnQgcHJvcGFnYXRpb24gdG8gdGhlIG1hcDpcclxuICAgICAgZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVySWNvbi5wcm90b3R5cGUub25Nb3VzZU92ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgbW91c2UgbW92ZXMgb3ZlciBhIGNsdXN0ZXIgbWFya2VyLlxyXG4gICAgICogQG5hbWUgTWFya2VyQ2x1c3RlcmVyI21vdXNlb3ZlclxyXG4gICAgICogQHBhcmFtIHtDbHVzdGVyfSBjIFRoZSBjbHVzdGVyIHRoYXQgdGhlIG1vdXNlIG1vdmVkIG92ZXIuXHJcbiAgICAgKiBAZXZlbnRcclxuICAgICAqL1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLmNsdXN0ZXIuZ2V0Q2x1c3RlcmVyKCksICdtb3VzZW92ZXInLCB0aGlzLmNsdXN0ZXIpO1xyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLm9uTW91c2VPdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgbW91c2UgbW92ZXMgb3V0IG9mIGEgY2x1c3RlciBtYXJrZXIuXHJcbiAgICAgKiBAbmFtZSBNYXJrZXJDbHVzdGVyZXIjbW91c2VvdXRcclxuICAgICAqIEBwYXJhbSB7Q2x1c3Rlcn0gYyBUaGUgY2x1c3RlciB0aGF0IHRoZSBtb3VzZSBtb3ZlZCBvdXQgb2YuXHJcbiAgICAgKiBAZXZlbnRcclxuICAgICAqL1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLmNsdXN0ZXIuZ2V0Q2x1c3RlcmVyKCksICdtb3VzZW91dCcsIHRoaXMuY2x1c3Rlcik7XHJcbiAgfTtcclxuICBDbHVzdGVySWNvbi5wcm90b3R5cGUub25BZGQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICB0aGlzLmRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy5kaXYuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7XHJcbiAgICBpZiAodGhpcy52aXNpYmxlKSB7XHJcbiAgICAgIHRoaXMuc2hvdygpO1xyXG4gICAgfVxyXG4gICAgKF9hID0gdGhpcy5nZXRQYW5lcygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub3ZlcmxheU1vdXNlVGFyZ2V0LmFwcGVuZENoaWxkKHRoaXMuZGl2KTtcclxuICAgIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xyXG4gICAgaWYgKG1hcCAhPT0gbnVsbCkge1xyXG4gICAgICAvLyBGaXggZm9yIElzc3VlIDE1N1xyXG4gICAgICB0aGlzLmJvdW5kc0NoYW5nZWRMaXN0ZW5lciA9IGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2JvdW5kc19jaGFuZ2VkJywgdGhpcy5vbkJvdW5kc0NoYW5nZWQpO1xyXG4gICAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2VEb3duKTtcclxuICAgICAgdGhpcy5kaXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2spO1xyXG4gICAgICB0aGlzLmRpdi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLm9uTW91c2VPdmVyKTtcclxuICAgICAgdGhpcy5kaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCB0aGlzLm9uTW91c2VPdXQpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuZGl2ICYmIHRoaXMuZGl2LnBhcmVudE5vZGUpIHtcclxuICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgIGlmICh0aGlzLmJvdW5kc0NoYW5nZWRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHRoaXMuYm91bmRzQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRpdi5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2VEb3duKTtcclxuICAgICAgdGhpcy5kaXYucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2spO1xyXG4gICAgICB0aGlzLmRpdi5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLm9uTW91c2VPdmVyKTtcclxuICAgICAgdGhpcy5kaXYucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCB0aGlzLm9uTW91c2VPdXQpO1xyXG4gICAgICB0aGlzLmRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZGl2KTtcclxuICAgICAgaWYgKHRoaXMudGltZU91dCAhPT0gbnVsbCkge1xyXG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lT3V0KTtcclxuICAgICAgICB0aGlzLnRpbWVPdXQgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGl2ID0gbnVsbDtcclxuICAgIH1cclxuICB9O1xyXG4gIENsdXN0ZXJJY29uLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMudmlzaWJsZSAmJiB0aGlzLmRpdiAhPT0gbnVsbCAmJiB0aGlzLmNlbnRlcikge1xyXG4gICAgICB2YXIgcG9zID0gdGhpcy5nZXRQb3NGcm9tTGF0TG5nKHRoaXMuY2VudGVyKTtcclxuICAgICAgdGhpcy5kaXYuc3R5bGUudG9wID0gcG9zICE9PSBudWxsID8gXCJcIi5jb25jYXQocG9zLnksIFwicHhcIikgOiAnMCc7XHJcbiAgICAgIHRoaXMuZGl2LnN0eWxlLmxlZnQgPSBwb3MgIT09IG51bGwgPyBcIlwiLmNvbmNhdChwb3MueCwgXCJweFwiKSA6ICcwJztcclxuICAgIH1cclxuICB9O1xyXG4gIENsdXN0ZXJJY29uLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMuZGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcclxuICB9O1xyXG4gIENsdXN0ZXJJY29uLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XHJcbiAgICBpZiAodGhpcy5kaXYgJiYgdGhpcy5jZW50ZXIpIHtcclxuICAgICAgdmFyIGRpdlRpdGxlID0gdGhpcy5zdW1zID09PSBudWxsIHx8IHR5cGVvZiB0aGlzLnN1bXMudGl0bGUgPT09ICd1bmRlZmluZWQnIHx8IHRoaXMuc3Vtcy50aXRsZSA9PT0gJycgPyB0aGlzLmNsdXN0ZXIuZ2V0Q2x1c3RlcmVyKCkuZ2V0VGl0bGUoKSA6IHRoaXMuc3Vtcy50aXRsZTtcclxuICAgICAgLy8gTk9URTogdmFsdWVzIG11c3QgYmUgc3BlY2lmaWVkIGluIHB4IHVuaXRzXHJcbiAgICAgIHZhciBicCA9IHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uLnNwbGl0KCcgJyk7XHJcbiAgICAgIHZhciBzcHJpdGVIID0gcGFyc2VJbnQoKChfYSA9IGJwWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpKSB8fCAnMCcsIDEwKTtcclxuICAgICAgdmFyIHNwcml0ZVYgPSBwYXJzZUludCgoKF9iID0gYnBbMV0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJykpIHx8ICcwJywgMTApO1xyXG4gICAgICB2YXIgcG9zID0gdGhpcy5nZXRQb3NGcm9tTGF0TG5nKHRoaXMuY2VudGVyKTtcclxuICAgICAgdGhpcy5kaXYuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7XHJcbiAgICAgIHRoaXMuZGl2LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBcImN1cnNvcjogcG9pbnRlcjsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IFwiLmNvbmNhdChwb3MgIT09IG51bGwgPyBcIlwiLmNvbmNhdChwb3MueSwgXCJweFwiKSA6ICcwJywgXCI7IGxlZnQ6IFwiKS5jb25jYXQocG9zICE9PSBudWxsID8gXCJcIi5jb25jYXQocG9zLngsIFwicHhcIikgOiAnMCcsIFwiOyB3aWR0aDogXCIpLmNvbmNhdCh0aGlzLndpZHRoLCBcInB4OyBoZWlnaHQ6IFwiKS5jb25jYXQodGhpcy5oZWlnaHQsIFwicHg7IFwiKSk7XHJcbiAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgaW1nLmFsdCA9IGRpdlRpdGxlO1xyXG4gICAgICBpbWcuc3JjID0gdGhpcy51cmw7XHJcbiAgICAgIGltZy53aWR0aCA9IHRoaXMud2lkdGg7XHJcbiAgICAgIGltZy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcclxuICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiBcIi5jb25jYXQoc3ByaXRlViwgXCJweDsgbGVmdDogXCIpLmNvbmNhdChzcHJpdGVILCBcInB4XCIpKTtcclxuICAgICAgaWYgKCF0aGlzLmNsdXN0ZXIuZ2V0Q2x1c3RlcmVyKCkuZW5hYmxlUmV0aW5hSWNvbnMpIHtcclxuICAgICAgICBpbWcuc3R5bGUuY2xpcCA9IFwicmVjdCgtXCIuY29uY2F0KHNwcml0ZVYsIFwicHgsIC1cIikuY29uY2F0KHNwcml0ZUggKyB0aGlzLndpZHRoLCBcInB4LCAtXCIpLmNvbmNhdChzcHJpdGVWICsgdGhpcy5oZWlnaHQsIFwiLCAtXCIpLmNvbmNhdChzcHJpdGVILCBcIilcIik7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIHRleHRFbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgdGV4dEVsbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgXCJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogXCIuY29uY2F0KHRoaXMuYW5jaG9yVGV4dFswXSwgXCJweDsgbGVmdDogXCIpLmNvbmNhdCh0aGlzLmFuY2hvclRleHRbMV0sIFwicHg7IGNvbG9yOiBcIikuY29uY2F0KHRoaXMudGV4dENvbG9yLCBcIjsgZm9udC1zaXplOiBcIikuY29uY2F0KHRoaXMudGV4dFNpemUsIFwicHg7IGZvbnQtZmFtaWx5OiBcIikuY29uY2F0KHRoaXMuZm9udEZhbWlseSwgXCI7IGZvbnQtd2VpZ2h0OiBcIikuY29uY2F0KHRoaXMuZm9udFdlaWdodCwgXCI7IGZvbnRTdHlsZTogXCIpLmNvbmNhdCh0aGlzLmZvbnRTdHlsZSwgXCI7IHRleHQtZGVjb3JhdGlvbjogXCIpLmNvbmNhdCh0aGlzLnRleHREZWNvcmF0aW9uLCBcIjsgdGV4dC1hbGlnbjogY2VudGVyOyB3aWR0aDogXCIpLmNvbmNhdCh0aGlzLndpZHRoLCBcInB4OyBsaW5lLWhlaWdodDogXCIpLmNvbmNhdCh0aGlzLmhlaWdodCwgXCJweFwiKSk7XHJcbiAgICAgIGlmICgoX2MgPSB0aGlzLnN1bXMpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy50ZXh0KSB0ZXh0RWxtLmlubmVyVGV4dCA9IFwiXCIuY29uY2F0KChfZCA9IHRoaXMuc3VtcykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnRleHQpO1xyXG4gICAgICBpZiAoKF9lID0gdGhpcy5zdW1zKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuaHRtbCkgdGV4dEVsbS5pbm5lckhUTUwgPSBcIlwiLmNvbmNhdCgoX2YgPSB0aGlzLnN1bXMpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5odG1sKTtcclxuICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgIHRoaXMuZGl2LmFwcGVuZENoaWxkKGltZyk7XHJcbiAgICAgIHRoaXMuZGl2LmFwcGVuZENoaWxkKHRleHRFbG0pO1xyXG4gICAgICB0aGlzLmRpdi50aXRsZSA9IGRpdlRpdGxlO1xyXG4gICAgICB0aGlzLmRpdi5zdHlsZS5kaXNwbGF5ID0gJyc7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLnVzZVN0eWxlID0gZnVuY3Rpb24gKHN1bXMpIHtcclxuICAgIHRoaXMuc3VtcyA9IHN1bXM7XHJcbiAgICB2YXIgc3R5bGVzID0gdGhpcy5jbHVzdGVyLmdldENsdXN0ZXJlcigpLmdldFN0eWxlcygpO1xyXG4gICAgdmFyIHN0eWxlID0gc3R5bGVzW01hdGgubWluKHN0eWxlcy5sZW5ndGggLSAxLCBNYXRoLm1heCgwLCBzdW1zLmluZGV4IC0gMSkpXTtcclxuICAgIGlmIChzdHlsZSkge1xyXG4gICAgICB0aGlzLnVybCA9IHN0eWxlLnVybDtcclxuICAgICAgdGhpcy5oZWlnaHQgPSBzdHlsZS5oZWlnaHQ7XHJcbiAgICAgIHRoaXMud2lkdGggPSBzdHlsZS53aWR0aDtcclxuICAgICAgaWYgKHN0eWxlLmNsYXNzTmFtZSkge1xyXG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gXCJcIi5jb25jYXQodGhpcy5jbHVzdGVyQ2xhc3NOYW1lLCBcIiBcIikuY29uY2F0KHN0eWxlLmNsYXNzTmFtZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5hbmNob3JUZXh0ID0gc3R5bGUuYW5jaG9yVGV4dCB8fCBbMCwgMF07XHJcbiAgICAgIHRoaXMuYW5jaG9ySWNvbiA9IHN0eWxlLmFuY2hvckljb24gfHwgW3RoaXMuaGVpZ2h0IC8gMiwgdGhpcy53aWR0aCAvIDJdO1xyXG4gICAgICB0aGlzLnRleHRDb2xvciA9IHN0eWxlLnRleHRDb2xvciB8fCAnYmxhY2snO1xyXG4gICAgICB0aGlzLnRleHRTaXplID0gc3R5bGUudGV4dFNpemUgfHwgMTE7XHJcbiAgICAgIHRoaXMudGV4dERlY29yYXRpb24gPSBzdHlsZS50ZXh0RGVjb3JhdGlvbiB8fCAnbm9uZSc7XHJcbiAgICAgIHRoaXMuZm9udFdlaWdodCA9IHN0eWxlLmZvbnRXZWlnaHQgfHwgJ2JvbGQnO1xyXG4gICAgICB0aGlzLmZvbnRTdHlsZSA9IHN0eWxlLmZvbnRTdHlsZSB8fCAnbm9ybWFsJztcclxuICAgICAgdGhpcy5mb250RmFtaWx5ID0gc3R5bGUuZm9udEZhbWlseSB8fCAnQXJpYWwsc2Fucy1zZXJpZic7XHJcbiAgICAgIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID0gc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uIHx8ICcwIDAnO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLnNldENlbnRlciA9IGZ1bmN0aW9uIChjZW50ZXIpIHtcclxuICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xyXG4gIH07XHJcbiAgQ2x1c3Rlckljb24ucHJvdG90eXBlLmdldFBvc0Zyb21MYXRMbmcgPSBmdW5jdGlvbiAobGF0bG5nKSB7XHJcbiAgICB2YXIgcG9zID0gdGhpcy5nZXRQcm9qZWN0aW9uKCkuZnJvbUxhdExuZ1RvRGl2UGl4ZWwobGF0bG5nKTtcclxuICAgIGlmIChwb3MgIT09IG51bGwpIHtcclxuICAgICAgcG9zLnggLT0gdGhpcy5hbmNob3JJY29uWzFdO1xyXG4gICAgICBwb3MueSAtPSB0aGlzLmFuY2hvckljb25bMF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcG9zO1xyXG4gIH07XHJcbiAgcmV0dXJuIENsdXN0ZXJJY29uO1xyXG59KCk7XHJcblxyXG4vKiBnbG9iYWwgZ29vZ2xlICovXHJcbnZhciBDbHVzdGVyJDEgPSAvKiogQGNsYXNzICovZnVuY3Rpb24gKCkge1xyXG4gIGZ1bmN0aW9uIENsdXN0ZXIobWFya2VyQ2x1c3RlcmVyKSB7XHJcbiAgICB0aGlzLm1hcmtlckNsdXN0ZXJlciA9IG1hcmtlckNsdXN0ZXJlcjtcclxuICAgIHRoaXMubWFwID0gdGhpcy5tYXJrZXJDbHVzdGVyZXIuZ2V0TWFwKCk7XHJcbiAgICB0aGlzLmdyaWRTaXplID0gdGhpcy5tYXJrZXJDbHVzdGVyZXIuZ2V0R3JpZFNpemUoKTtcclxuICAgIHRoaXMubWluQ2x1c3RlclNpemUgPSB0aGlzLm1hcmtlckNsdXN0ZXJlci5nZXRNaW5pbXVtQ2x1c3RlclNpemUoKTtcclxuICAgIHRoaXMuYXZlcmFnZUNlbnRlciA9IHRoaXMubWFya2VyQ2x1c3RlcmVyLmdldEF2ZXJhZ2VDZW50ZXIoKTtcclxuICAgIHRoaXMubWFya2VycyA9IFtdO1xyXG4gICAgdGhpcy5jZW50ZXIgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLmJvdW5kcyA9IG51bGw7XHJcbiAgICB0aGlzLmNsdXN0ZXJJY29uID0gbmV3IENsdXN0ZXJJY29uKHRoaXMsIHRoaXMubWFya2VyQ2x1c3RlcmVyLmdldFN0eWxlcygpKTtcclxuICAgIHRoaXMuZ2V0U2l6ZSA9IHRoaXMuZ2V0U2l6ZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRNYXJrZXJzID0gdGhpcy5nZXRNYXJrZXJzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldENlbnRlciA9IHRoaXMuZ2V0Q2VudGVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldE1hcCA9IHRoaXMuZ2V0TWFwLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldENsdXN0ZXJlciA9IHRoaXMuZ2V0Q2x1c3RlcmVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnJlbW92ZSA9IHRoaXMucmVtb3ZlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmFkZE1hcmtlciA9IHRoaXMuYWRkTWFya2VyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmlzTWFya2VySW5DbHVzdGVyQm91bmRzID0gdGhpcy5pc01hcmtlckluQ2x1c3RlckJvdW5kcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5jYWxjdWxhdGVCb3VuZHMgPSB0aGlzLmNhbGN1bGF0ZUJvdW5kcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy51cGRhdGVJY29uID0gdGhpcy51cGRhdGVJY29uLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmlzTWFya2VyQWxyZWFkeUFkZGVkID0gdGhpcy5pc01hcmtlckFscmVhZHlBZGRlZC5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICBDbHVzdGVyLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFya2Vycy5sZW5ndGg7XHJcbiAgfTtcclxuICBDbHVzdGVyLnByb3RvdHlwZS5nZXRNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFya2VycztcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmdldENlbnRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLmNlbnRlcjtcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmdldE1hcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLm1hcDtcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmdldENsdXN0ZXJlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLm1hcmtlckNsdXN0ZXJlcjtcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmdldEJvdW5kcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKHRoaXMuY2VudGVyLCB0aGlzLmNlbnRlcik7XHJcbiAgICB2YXIgbWFya2VycyA9IHRoaXMuZ2V0TWFya2VycygpO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwLCBtYXJrZXJzXzEgPSBtYXJrZXJzOyBfaSA8IG1hcmtlcnNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNfMVtfaV07XHJcbiAgICAgIHZhciBwb3NpdGlvbiA9IG1hcmtlci5nZXRQb3NpdGlvbigpO1xyXG4gICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICBib3VuZHMuZXh0ZW5kKHBvc2l0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGJvdW5kcztcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuY2x1c3Rlckljb24uc2V0TWFwKG51bGwpO1xyXG4gICAgdGhpcy5tYXJrZXJzID0gW107XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBkZWxldGUgdGhpcy5tYXJrZXJzO1xyXG4gIH07XHJcbiAgQ2x1c3Rlci5wcm90b3R5cGUuYWRkTWFya2VyID0gZnVuY3Rpb24gKG1hcmtlcikge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgaWYgKHRoaXMuaXNNYXJrZXJBbHJlYWR5QWRkZWQobWFya2VyKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMuY2VudGVyKSB7XHJcbiAgICAgIHZhciBwb3NpdGlvbiA9IG1hcmtlci5nZXRQb3NpdGlvbigpO1xyXG4gICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICB0aGlzLmNlbnRlciA9IHBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQm91bmRzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLmF2ZXJhZ2VDZW50ZXIpIHtcclxuICAgICAgICB2YXIgcG9zaXRpb24gPSBtYXJrZXIuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICAgIHZhciBsZW5ndGhfMSA9IHRoaXMubWFya2Vycy5sZW5ndGggKyAxO1xyXG4gICAgICAgICAgdGhpcy5jZW50ZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKCh0aGlzLmNlbnRlci5sYXQoKSAqIChsZW5ndGhfMSAtIDEpICsgcG9zaXRpb24ubGF0KCkpIC8gbGVuZ3RoXzEsICh0aGlzLmNlbnRlci5sbmcoKSAqIChsZW5ndGhfMSAtIDEpICsgcG9zaXRpb24ubG5nKCkpIC8gbGVuZ3RoXzEpO1xyXG4gICAgICAgICAgdGhpcy5jYWxjdWxhdGVCb3VuZHMoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIG1hcmtlci5pc0FkZGVkID0gdHJ1ZTtcclxuICAgIHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgICB2YXIgbUNvdW50ID0gdGhpcy5tYXJrZXJzLmxlbmd0aDtcclxuICAgIHZhciBtYXhab29tID0gdGhpcy5tYXJrZXJDbHVzdGVyZXIuZ2V0TWF4Wm9vbSgpO1xyXG4gICAgdmFyIHpvb20gPSAoX2EgPSB0aGlzLm1hcCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFpvb20oKTtcclxuICAgIGlmIChtYXhab29tICE9PSBudWxsICYmIHR5cGVvZiB6b29tICE9PSAndW5kZWZpbmVkJyAmJiB6b29tID4gbWF4Wm9vbSkge1xyXG4gICAgICAvLyBab29tZWQgaW4gcGFzdCBtYXggem9vbSwgc28gc2hvdyB0aGUgbWFya2VyLlxyXG4gICAgICBpZiAobWFya2VyLmdldE1hcCgpICE9PSB0aGlzLm1hcCkge1xyXG4gICAgICAgIG1hcmtlci5zZXRNYXAodGhpcy5tYXApO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKG1Db3VudCA8IHRoaXMubWluQ2x1c3RlclNpemUpIHtcclxuICAgICAgLy8gTWluIGNsdXN0ZXIgc2l6ZSBub3QgcmVhY2hlZCBzbyBzaG93IHRoZSBtYXJrZXIuXHJcbiAgICAgIGlmIChtYXJrZXIuZ2V0TWFwKCkgIT09IHRoaXMubWFwKSB7XHJcbiAgICAgICAgbWFya2VyLnNldE1hcCh0aGlzLm1hcCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAobUNvdW50ID09PSB0aGlzLm1pbkNsdXN0ZXJTaXplKSB7XHJcbiAgICAgIC8vIEhpZGUgdGhlIG1hcmtlcnMgdGhhdCB3ZXJlIHNob3dpbmcuXHJcbiAgICAgIGZvciAodmFyIF9pID0gMCwgX2IgPSB0aGlzLm1hcmtlcnM7IF9pIDwgX2IubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgdmFyIG1hcmtlckVsZW1lbnQgPSBfYltfaV07XHJcbiAgICAgICAgbWFya2VyRWxlbWVudC5zZXRNYXAobnVsbCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmlzTWFya2VySW5DbHVzdGVyQm91bmRzID0gZnVuY3Rpb24gKG1hcmtlcikge1xyXG4gICAgaWYgKHRoaXMuYm91bmRzICE9PSBudWxsKSB7XHJcbiAgICAgIHZhciBwb3NpdGlvbiA9IG1hcmtlci5nZXRQb3NpdGlvbigpO1xyXG4gICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ib3VuZHMuY29udGFpbnMocG9zaXRpb24pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfTtcclxuICBDbHVzdGVyLnByb3RvdHlwZS5jYWxjdWxhdGVCb3VuZHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmJvdW5kcyA9IHRoaXMubWFya2VyQ2x1c3RlcmVyLmdldEV4dGVuZGVkQm91bmRzKG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHModGhpcy5jZW50ZXIsIHRoaXMuY2VudGVyKSk7XHJcbiAgfTtcclxuICBDbHVzdGVyLnByb3RvdHlwZS51cGRhdGVJY29uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgdmFyIG1Db3VudCA9IHRoaXMubWFya2Vycy5sZW5ndGg7XHJcbiAgICB2YXIgbWF4Wm9vbSA9IHRoaXMubWFya2VyQ2x1c3RlcmVyLmdldE1heFpvb20oKTtcclxuICAgIHZhciB6b29tID0gKF9hID0gdGhpcy5tYXApID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRab29tKCk7XHJcbiAgICBpZiAobWF4Wm9vbSAhPT0gbnVsbCAmJiB0eXBlb2Ygem9vbSAhPT0gJ3VuZGVmaW5lZCcgJiYgem9vbSA+IG1heFpvb20pIHtcclxuICAgICAgdGhpcy5jbHVzdGVySWNvbi5oaWRlKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChtQ291bnQgPCB0aGlzLm1pbkNsdXN0ZXJTaXplKSB7XHJcbiAgICAgIC8vIE1pbiBjbHVzdGVyIHNpemUgbm90IHlldCByZWFjaGVkLlxyXG4gICAgICB0aGlzLmNsdXN0ZXJJY29uLmhpZGUoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY2VudGVyKSB7XHJcbiAgICAgIHRoaXMuY2x1c3Rlckljb24uc2V0Q2VudGVyKHRoaXMuY2VudGVyKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2x1c3Rlckljb24udXNlU3R5bGUodGhpcy5tYXJrZXJDbHVzdGVyZXIuZ2V0Q2FsY3VsYXRvcigpKHRoaXMubWFya2VycywgdGhpcy5tYXJrZXJDbHVzdGVyZXIuZ2V0U3R5bGVzKCkubGVuZ3RoKSk7XHJcbiAgICB0aGlzLmNsdXN0ZXJJY29uLnNob3coKTtcclxuICB9O1xyXG4gIENsdXN0ZXIucHJvdG90eXBlLmlzTWFya2VyQWxyZWFkeUFkZGVkID0gZnVuY3Rpb24gKG1hcmtlcikge1xyXG4gICAgaWYgKHRoaXMubWFya2Vycy5pbmNsdWRlcykge1xyXG4gICAgICByZXR1cm4gdGhpcy5tYXJrZXJzLmluY2x1ZGVzKG1hcmtlcik7XHJcbiAgICB9XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWFya2Vycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAobWFya2VyID09PSB0aGlzLm1hcmtlcnNbaV0pIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcbiAgcmV0dXJuIENsdXN0ZXI7XHJcbn0oKTtcclxuXHJcbi8qIGdsb2JhbCBnb29nbGUgKi9cclxuLyogZXNsaW50LWRpc2FibGUgZmlsZW5hbWVzL21hdGNoLXJlZ2V4ICovXHJcbi8qKlxyXG4gKiBTdXBwb3J0cyB1cCB0byA5MDA3MTk5MjU0NzQwOTkxIChOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgbWFya2Vyc1xyXG4gKiB3aGljaCBpcyBub3QgYSBwcm9ibGVtIGFzIG1heCBhcnJheSBsZW5ndGggaXMgNDI5NDk2NzI5NiAoMioqMzIpXHJcbiAqL1xyXG5mdW5jdGlvbiBDQUxDVUxBVE9SKG1hcmtlcnMsIG51bVN0eWxlcykge1xyXG4gIHZhciBjb3VudCA9IG1hcmtlcnMubGVuZ3RoO1xyXG4gIHZhciBudW1iZXJPZkRpZ2l0cyA9IGNvdW50LnRvU3RyaW5nKCkubGVuZ3RoO1xyXG4gIHZhciBpbmRleCA9IE1hdGgubWluKG51bWJlck9mRGlnaXRzLCBudW1TdHlsZXMpO1xyXG4gIHJldHVybiB7XHJcbiAgICB0ZXh0OiBjb3VudC50b1N0cmluZygpLFxyXG4gICAgaW5kZXg6IGluZGV4LFxyXG4gICAgdGl0bGU6ICcnXHJcbiAgfTtcclxufVxyXG52YXIgQkFUQ0hfU0laRSA9IDIwMDA7XHJcbnZhciBCQVRDSF9TSVpFX0lFID0gNTAwO1xyXG52YXIgSU1BR0VfUEFUSCA9ICdodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9tYXBzL2RvY3VtZW50YXRpb24vamF2YXNjcmlwdC9leGFtcGxlcy9tYXJrZXJjbHVzdGVyZXIvbSc7XHJcbnZhciBJTUFHRV9FWFRFTlNJT04gPSAncG5nJztcclxudmFyIElNQUdFX1NJWkVTID0gWzUzLCA1NiwgNjYsIDc4LCA5MF07XHJcbnZhciBDTFVTVEVSRVJfQ0xBU1MgPSAnY2x1c3Rlcic7XHJcbnZhciBDbHVzdGVyZXIgPSAvKiogQGNsYXNzICovZnVuY3Rpb24gKCkge1xyXG4gIGZ1bmN0aW9uIENsdXN0ZXJlcihtYXAsIG9wdE1hcmtlcnMsIG9wdE9wdGlvbnMpIHtcclxuICAgIGlmIChvcHRNYXJrZXJzID09PSB2b2lkIDApIHtcclxuICAgICAgb3B0TWFya2VycyA9IFtdO1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdE9wdGlvbnMgPT09IHZvaWQgMCkge1xyXG4gICAgICBvcHRPcHRpb25zID0ge307XHJcbiAgICB9XHJcbiAgICB0aGlzLmdldE1pbmltdW1DbHVzdGVyU2l6ZSA9IHRoaXMuZ2V0TWluaW11bUNsdXN0ZXJTaXplLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNldE1pbmltdW1DbHVzdGVyU2l6ZSA9IHRoaXMuc2V0TWluaW11bUNsdXN0ZXJTaXplLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEVuYWJsZVJldGluYUljb25zID0gdGhpcy5nZXRFbmFibGVSZXRpbmFJY29ucy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRFbmFibGVSZXRpbmFJY29ucyA9IHRoaXMuc2V0RW5hYmxlUmV0aW5hSWNvbnMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkVG9DbG9zZXN0Q2x1c3RlciA9IHRoaXMuYWRkVG9DbG9zZXN0Q2x1c3Rlci5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRJbWFnZUV4dGVuc2lvbiA9IHRoaXMuZ2V0SW1hZ2VFeHRlbnNpb24uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0SW1hZ2VFeHRlbnNpb24gPSB0aGlzLnNldEltYWdlRXh0ZW5zaW9uLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEV4dGVuZGVkQm91bmRzID0gdGhpcy5nZXRFeHRlbmRlZEJvdW5kcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRBdmVyYWdlQ2VudGVyID0gdGhpcy5nZXRBdmVyYWdlQ2VudGVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNldEF2ZXJhZ2VDZW50ZXIgPSB0aGlzLnNldEF2ZXJhZ2VDZW50ZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0VG90YWxDbHVzdGVycyA9IHRoaXMuZ2V0VG90YWxDbHVzdGVycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5maXRNYXBUb01hcmtlcnMgPSB0aGlzLmZpdE1hcFRvTWFya2Vycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRJZ25vcmVIaWRkZW4gPSB0aGlzLmdldElnbm9yZUhpZGRlbi5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRJZ25vcmVIaWRkZW4gPSB0aGlzLnNldElnbm9yZUhpZGRlbi5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRDbHVzdGVyQ2xhc3MgPSB0aGlzLmdldENsdXN0ZXJDbGFzcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRDbHVzdGVyQ2xhc3MgPSB0aGlzLnNldENsdXN0ZXJDbGFzcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRUb3RhbE1hcmtlcnMgPSB0aGlzLmdldFRvdGFsTWFya2Vycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRab29tT25DbGljayA9IHRoaXMuZ2V0Wm9vbU9uQ2xpY2suYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0Wm9vbU9uQ2xpY2sgPSB0aGlzLnNldFpvb21PbkNsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEJhdGNoU2l6ZUlFID0gdGhpcy5nZXRCYXRjaFNpemVJRS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRCYXRjaFNpemVJRSA9IHRoaXMuc2V0QmF0Y2hTaXplSUUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuY3JlYXRlQ2x1c3RlcnMgPSB0aGlzLmNyZWF0ZUNsdXN0ZXJzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9uWm9vbUNoYW5nZWQgPSB0aGlzLm9uWm9vbUNoYW5nZWQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0SW1hZ2VTaXplcyA9IHRoaXMuZ2V0SW1hZ2VTaXplcy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRJbWFnZVNpemVzID0gdGhpcy5zZXRJbWFnZVNpemVzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldENhbGN1bGF0b3IgPSB0aGlzLmdldENhbGN1bGF0b3IuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0Q2FsY3VsYXRvciA9IHRoaXMuc2V0Q2FsY3VsYXRvci5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5yZW1vdmVNYXJrZXJzID0gdGhpcy5yZW1vdmVNYXJrZXJzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnJlc2V0Vmlld3BvcnQgPSB0aGlzLnJlc2V0Vmlld3BvcnQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0SW1hZ2VQYXRoID0gdGhpcy5nZXRJbWFnZVBhdGguYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0SW1hZ2VQYXRoID0gdGhpcy5zZXRJbWFnZVBhdGguYmluZCh0aGlzKTtcclxuICAgIHRoaXMucHVzaE1hcmtlclRvID0gdGhpcy5wdXNoTWFya2VyVG8uYmluZCh0aGlzKTtcclxuICAgIHRoaXMucmVtb3ZlTWFya2VyID0gdGhpcy5yZW1vdmVNYXJrZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuY2xlYXJNYXJrZXJzID0gdGhpcy5jbGVhck1hcmtlcnMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0dXBTdHlsZXMgPSB0aGlzLnNldHVwU3R5bGVzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEdyaWRTaXplID0gdGhpcy5nZXRHcmlkU2l6ZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRHcmlkU2l6ZSA9IHRoaXMuc2V0R3JpZFNpemUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0Q2x1c3RlcnMgPSB0aGlzLmdldENsdXN0ZXJzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldE1heFpvb20gPSB0aGlzLmdldE1heFpvb20uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0TWF4Wm9vbSA9IHRoaXMuc2V0TWF4Wm9vbS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRNYXJrZXJzID0gdGhpcy5nZXRNYXJrZXJzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmFkZE1hcmtlcnMgPSB0aGlzLmFkZE1hcmtlcnMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0U3R5bGVzID0gdGhpcy5nZXRTdHlsZXMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0U3R5bGVzID0gdGhpcy5zZXRTdHlsZXMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkTWFya2VyID0gdGhpcy5hZGRNYXJrZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25SZW1vdmUgPSB0aGlzLm9uUmVtb3ZlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldFRpdGxlID0gdGhpcy5nZXRUaXRsZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRUaXRsZSA9IHRoaXMuc2V0VGl0bGUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMucmVwYWludCA9IHRoaXMucmVwYWludC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbklkbGUgPSB0aGlzLm9uSWRsZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5yZWRyYXcgPSB0aGlzLnJlZHJhdy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkFkZCA9IHRoaXMub25BZGQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZHJhdyA9IHRoaXMuZHJhdy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5leHRlbmQgPSB0aGlzLmV4dGVuZC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5leHRlbmQoQ2x1c3RlcmVyLCBnb29nbGUubWFwcy5PdmVybGF5Vmlldyk7XHJcbiAgICB0aGlzLm1hcmtlcnMgPSBbXTtcclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICAgIHRoaXMubGlzdGVuZXJzID0gW107XHJcbiAgICB0aGlzLmFjdGl2ZU1hcCA9IG51bGw7XHJcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XHJcbiAgICB0aGlzLmdyaWRTaXplID0gb3B0T3B0aW9ucy5ncmlkU2l6ZSB8fCA2MDtcclxuICAgIHRoaXMubWluQ2x1c3RlclNpemUgPSBvcHRPcHRpb25zLm1pbmltdW1DbHVzdGVyU2l6ZSB8fCAyO1xyXG4gICAgdGhpcy5tYXhab29tID0gb3B0T3B0aW9ucy5tYXhab29tIHx8IG51bGw7XHJcbiAgICB0aGlzLnN0eWxlcyA9IG9wdE9wdGlvbnMuc3R5bGVzIHx8IFtdO1xyXG4gICAgdGhpcy50aXRsZSA9IG9wdE9wdGlvbnMudGl0bGUgfHwgJyc7XHJcbiAgICB0aGlzLnpvb21PbkNsaWNrID0gdHJ1ZTtcclxuICAgIGlmIChvcHRPcHRpb25zLnpvb21PbkNsaWNrICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy56b29tT25DbGljayA9IG9wdE9wdGlvbnMuem9vbU9uQ2xpY2s7XHJcbiAgICB9XHJcbiAgICB0aGlzLmF2ZXJhZ2VDZW50ZXIgPSBmYWxzZTtcclxuICAgIGlmIChvcHRPcHRpb25zLmF2ZXJhZ2VDZW50ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLmF2ZXJhZ2VDZW50ZXIgPSBvcHRPcHRpb25zLmF2ZXJhZ2VDZW50ZXI7XHJcbiAgICB9XHJcbiAgICB0aGlzLmlnbm9yZUhpZGRlbiA9IGZhbHNlO1xyXG4gICAgaWYgKG9wdE9wdGlvbnMuaWdub3JlSGlkZGVuICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5pZ25vcmVIaWRkZW4gPSBvcHRPcHRpb25zLmlnbm9yZUhpZGRlbjtcclxuICAgIH1cclxuICAgIHRoaXMuZW5hYmxlUmV0aW5hSWNvbnMgPSBmYWxzZTtcclxuICAgIGlmIChvcHRPcHRpb25zLmVuYWJsZVJldGluYUljb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5lbmFibGVSZXRpbmFJY29ucyA9IG9wdE9wdGlvbnMuZW5hYmxlUmV0aW5hSWNvbnM7XHJcbiAgICB9XHJcbiAgICB0aGlzLmltYWdlUGF0aCA9IG9wdE9wdGlvbnMuaW1hZ2VQYXRoIHx8IElNQUdFX1BBVEg7XHJcbiAgICB0aGlzLmltYWdlRXh0ZW5zaW9uID0gb3B0T3B0aW9ucy5pbWFnZUV4dGVuc2lvbiB8fCBJTUFHRV9FWFRFTlNJT047XHJcbiAgICB0aGlzLmltYWdlU2l6ZXMgPSBvcHRPcHRpb25zLmltYWdlU2l6ZXMgfHwgSU1BR0VfU0laRVM7XHJcbiAgICB0aGlzLmNhbGN1bGF0b3IgPSBvcHRPcHRpb25zLmNhbGN1bGF0b3IgfHwgQ0FMQ1VMQVRPUjtcclxuICAgIHRoaXMuYmF0Y2hTaXplID0gb3B0T3B0aW9ucy5iYXRjaFNpemUgfHwgQkFUQ0hfU0laRTtcclxuICAgIHRoaXMuYmF0Y2hTaXplSUUgPSBvcHRPcHRpb25zLmJhdGNoU2l6ZUlFIHx8IEJBVENIX1NJWkVfSUU7XHJcbiAgICB0aGlzLmNsdXN0ZXJDbGFzcyA9IG9wdE9wdGlvbnMuY2x1c3RlckNsYXNzIHx8IENMVVNURVJFUl9DTEFTUztcclxuICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignbXNpZScpICE9PSAtMSkge1xyXG4gICAgICAvLyBUcnkgdG8gYXZvaWQgSUUgdGltZW91dCB3aGVuIHByb2Nlc3NpbmcgYSBodWdlIG51bWJlciBvZiBtYXJrZXJzOlxyXG4gICAgICB0aGlzLmJhdGNoU2l6ZSA9IHRoaXMuYmF0Y2hTaXplSUU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRpbWVyUmVmU3RhdGljID0gbnVsbDtcclxuICAgIHRoaXMuc2V0dXBTdHlsZXMoKTtcclxuICAgIHRoaXMuYWRkTWFya2VycyhvcHRNYXJrZXJzLCB0cnVlKTtcclxuICAgIHRoaXMuc2V0TWFwKG1hcCk7IC8vIE5vdGU6IHRoaXMgY2F1c2VzIG9uQWRkIHRvIGJlIGNhbGxlZFxyXG4gIH1cclxuICBDbHVzdGVyZXIucHJvdG90eXBlLm9uWm9vbUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgX2EsIF9iO1xyXG4gICAgdGhpcy5yZXNldFZpZXdwb3J0KGZhbHNlKTtcclxuICAgIC8vIFdvcmthcm91bmQgZm9yIHRoaXMgR29vZ2xlIGJ1Zzogd2hlbiBtYXAgaXMgYXQgbGV2ZWwgMCBhbmQgXCItXCIgb2ZcclxuICAgIC8vIHpvb20gc2xpZGVyIGlzIGNsaWNrZWQsIGEgXCJ6b29tX2NoYW5nZWRcIiBldmVudCBpcyBmaXJlZCBldmVuIHRob3VnaFxyXG4gICAgLy8gdGhlIG1hcCBkb2Vzbid0IHpvb20gb3V0IGFueSBmdXJ0aGVyLiBJbiB0aGlzIHNpdHVhdGlvbiwgbm8gXCJpZGxlXCJcclxuICAgIC8vIGV2ZW50IGlzIHRyaWdnZXJlZCBzbyB0aGUgY2x1c3RlciBtYXJrZXJzIHRoYXQgaGF2ZSBiZWVuIHJlbW92ZWRcclxuICAgIC8vIGRvIG5vdCBnZXQgcmVkcmF3bi4gU2FtZSBnb2VzIGZvciBhIHpvb20gaW4gYXQgbWF4Wm9vbS5cclxuICAgIGlmICgoKF9hID0gdGhpcy5nZXRNYXAoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFpvb20oKSkgPT09ICh0aGlzLmdldCgnbWluWm9vbScpIHx8IDApIHx8ICgoX2IgPSB0aGlzLmdldE1hcCgpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZ2V0Wm9vbSgpKSA9PT0gdGhpcy5nZXQoJ21heFpvb20nKSkge1xyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHRoaXMsICdpZGxlJyk7XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLm9uSWRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucmVkcmF3KCk7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLm9uQWRkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1hcCA9IHRoaXMuZ2V0TWFwKCk7XHJcbiAgICB0aGlzLmFjdGl2ZU1hcCA9IG1hcDtcclxuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xyXG4gICAgdGhpcy5yZXBhaW50KCk7XHJcbiAgICBpZiAobWFwICE9PSBudWxsKSB7XHJcbiAgICAgIC8vIEFkZCB0aGUgbWFwIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgICB0aGlzLmxpc3RlbmVycyA9IFtnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICd6b29tX2NoYW5nZWQnLCB0aGlzLm9uWm9vbUNoYW5nZWQpLCBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXAsICdpZGxlJywgdGhpcy5vbklkbGUpXTtcclxuICAgIH1cclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUub25SZW1vdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyBQdXQgYWxsIHRoZSBtYW5hZ2VkIG1hcmtlcnMgYmFjayBvbiB0aGUgbWFwOlxyXG4gICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMubWFya2VyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgdmFyIG1hcmtlciA9IF9hW19pXTtcclxuICAgICAgaWYgKG1hcmtlci5nZXRNYXAoKSAhPT0gdGhpcy5hY3RpdmVNYXApIHtcclxuICAgICAgICBtYXJrZXIuc2V0TWFwKHRoaXMuYWN0aXZlTWFwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gUmVtb3ZlIGFsbCBjbHVzdGVyczpcclxuICAgIGZvciAodmFyIF9iID0gMCwgX2MgPSB0aGlzLmNsdXN0ZXJzOyBfYiA8IF9jLmxlbmd0aDsgX2IrKykge1xyXG4gICAgICB2YXIgY2x1c3RlciA9IF9jW19iXTtcclxuICAgICAgY2x1c3Rlci5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICAgIC8vIFJlbW92ZSBtYXAgZXZlbnQgbGlzdGVuZXJzOlxyXG4gICAgZm9yICh2YXIgX2QgPSAwLCBfZSA9IHRoaXMubGlzdGVuZXJzOyBfZCA8IF9lLmxlbmd0aDsgX2QrKykge1xyXG4gICAgICB2YXIgbGlzdGVuZXIgPSBfZVtfZF07XHJcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTtcclxuICAgIH1cclxuICAgIHRoaXMubGlzdGVuZXJzID0gW107XHJcbiAgICB0aGlzLmFjdGl2ZU1hcCA9IG51bGw7XHJcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldE1hcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRQYW5lcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRQcm9qZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZnJvbUNvbnRhaW5lclBpeGVsVG9MYXRMbmc6IGZ1bmN0aW9uIGZyb21Db250YWluZXJQaXhlbFRvTGF0TG5nKCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9LFxyXG4gICAgICBmcm9tRGl2UGl4ZWxUb0xhdExuZzogZnVuY3Rpb24gZnJvbURpdlBpeGVsVG9MYXRMbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZyb21MYXRMbmdUb0NvbnRhaW5lclBpeGVsOiBmdW5jdGlvbiBmcm9tTGF0TG5nVG9Db250YWluZXJQaXhlbCgpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSxcclxuICAgICAgZnJvbUxhdExuZ1RvRGl2UGl4ZWw6IGZ1bmN0aW9uIGZyb21MYXRMbmdUb0RpdlBpeGVsKCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9LFxyXG4gICAgICBnZXRWaXNpYmxlUmVnaW9uOiBmdW5jdGlvbiBnZXRWaXNpYmxlUmVnaW9uKCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9LFxyXG4gICAgICBnZXRXb3JsZFdpZHRoOiBmdW5jdGlvbiBnZXRXb3JsZFdpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRNYXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5iaW5kVG8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybjtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldFZhbHVlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybjtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS51bmJpbmRBbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldHVwU3R5bGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuc3R5bGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmltYWdlU2l6ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdGhpcy5zdHlsZXMucHVzaCh7XHJcbiAgICAgICAgdXJsOiBcIlwiLmNvbmNhdCh0aGlzLmltYWdlUGF0aCArIChpICsgMSksIFwiLlwiKS5jb25jYXQodGhpcy5pbWFnZUV4dGVuc2lvbiksXHJcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmltYWdlU2l6ZXNbaV0gfHwgMCxcclxuICAgICAgICB3aWR0aDogdGhpcy5pbWFnZVNpemVzW2ldIHx8IDBcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmZpdE1hcFRvTWFya2VycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtYXJrZXJzID0gdGhpcy5nZXRNYXJrZXJzKCk7XHJcbiAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwLCBtYXJrZXJzXzEgPSBtYXJrZXJzOyBfaSA8IG1hcmtlcnNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNfMVtfaV07XHJcbiAgICAgIHZhciBwb3NpdGlvbiA9IG1hcmtlci5nZXRQb3NpdGlvbigpO1xyXG4gICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICBib3VuZHMuZXh0ZW5kKHBvc2l0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFyIG1hcCA9IHRoaXMuZ2V0TWFwKCk7XHJcbiAgICBpZiAobWFwICE9PSBudWxsICYmICdmaXRCb3VuZHMnIGluIG1hcCkge1xyXG4gICAgICBtYXAuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldEdyaWRTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3JpZFNpemU7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldEdyaWRTaXplID0gZnVuY3Rpb24gKGdyaWRTaXplKSB7XHJcbiAgICB0aGlzLmdyaWRTaXplID0gZ3JpZFNpemU7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldE1pbmltdW1DbHVzdGVyU2l6ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLm1pbkNsdXN0ZXJTaXplO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRNaW5pbXVtQ2x1c3RlclNpemUgPSBmdW5jdGlvbiAobWluaW11bUNsdXN0ZXJTaXplKSB7XHJcbiAgICB0aGlzLm1pbkNsdXN0ZXJTaXplID0gbWluaW11bUNsdXN0ZXJTaXplO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRNYXhab29tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWF4Wm9vbTtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuc2V0TWF4Wm9vbSA9IGZ1bmN0aW9uIChtYXhab29tKSB7XHJcbiAgICB0aGlzLm1heFpvb20gPSBtYXhab29tO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRTdHlsZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdHlsZXM7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldFN0eWxlcyA9IGZ1bmN0aW9uIChzdHlsZXMpIHtcclxuICAgIHRoaXMuc3R5bGVzID0gc3R5bGVzO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnRpdGxlO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRUaXRsZSA9IGZ1bmN0aW9uICh0aXRsZSkge1xyXG4gICAgdGhpcy50aXRsZSA9IHRpdGxlO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRab29tT25DbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnpvb21PbkNsaWNrO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRab29tT25DbGljayA9IGZ1bmN0aW9uICh6b29tT25DbGljaykge1xyXG4gICAgdGhpcy56b29tT25DbGljayA9IHpvb21PbkNsaWNrO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRBdmVyYWdlQ2VudGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuYXZlcmFnZUNlbnRlcjtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuc2V0QXZlcmFnZUNlbnRlciA9IGZ1bmN0aW9uIChhdmVyYWdlQ2VudGVyKSB7XHJcbiAgICB0aGlzLmF2ZXJhZ2VDZW50ZXIgPSBhdmVyYWdlQ2VudGVyO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRJZ25vcmVIaWRkZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pZ25vcmVIaWRkZW47XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldElnbm9yZUhpZGRlbiA9IGZ1bmN0aW9uIChpZ25vcmVIaWRkZW4pIHtcclxuICAgIHRoaXMuaWdub3JlSGlkZGVuID0gaWdub3JlSGlkZGVuO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRFbmFibGVSZXRpbmFJY29ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLmVuYWJsZVJldGluYUljb25zO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRFbmFibGVSZXRpbmFJY29ucyA9IGZ1bmN0aW9uIChlbmFibGVSZXRpbmFJY29ucykge1xyXG4gICAgdGhpcy5lbmFibGVSZXRpbmFJY29ucyA9IGVuYWJsZVJldGluYUljb25zO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRJbWFnZUV4dGVuc2lvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLmltYWdlRXh0ZW5zaW9uO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRJbWFnZUV4dGVuc2lvbiA9IGZ1bmN0aW9uIChpbWFnZUV4dGVuc2lvbikge1xyXG4gICAgdGhpcy5pbWFnZUV4dGVuc2lvbiA9IGltYWdlRXh0ZW5zaW9uO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRJbWFnZVBhdGggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbWFnZVBhdGg7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldEltYWdlUGF0aCA9IGZ1bmN0aW9uIChpbWFnZVBhdGgpIHtcclxuICAgIHRoaXMuaW1hZ2VQYXRoID0gaW1hZ2VQYXRoO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRJbWFnZVNpemVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VTaXplcztcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuc2V0SW1hZ2VTaXplcyA9IGZ1bmN0aW9uIChpbWFnZVNpemVzKSB7XHJcbiAgICB0aGlzLmltYWdlU2l6ZXMgPSBpbWFnZVNpemVzO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRDYWxjdWxhdG9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRvcjtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuc2V0Q2FsY3VsYXRvciA9IGZ1bmN0aW9uIChjYWxjdWxhdG9yKSB7XHJcbiAgICB0aGlzLmNhbGN1bGF0b3IgPSBjYWxjdWxhdG9yO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRCYXRjaFNpemVJRSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLmJhdGNoU2l6ZUlFO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5zZXRCYXRjaFNpemVJRSA9IGZ1bmN0aW9uIChiYXRjaFNpemVJRSkge1xyXG4gICAgdGhpcy5iYXRjaFNpemVJRSA9IGJhdGNoU2l6ZUlFO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRDbHVzdGVyQ2xhc3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jbHVzdGVyQ2xhc3M7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnNldENsdXN0ZXJDbGFzcyA9IGZ1bmN0aW9uIChjbHVzdGVyQ2xhc3MpIHtcclxuICAgIHRoaXMuY2x1c3RlckNsYXNzID0gY2x1c3RlckNsYXNzO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5nZXRNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFya2VycztcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuZ2V0VG90YWxNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFya2Vycy5sZW5ndGg7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldENsdXN0ZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY2x1c3RlcnM7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldFRvdGFsQ2x1c3RlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jbHVzdGVycy5sZW5ndGg7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmFkZE1hcmtlciA9IGZ1bmN0aW9uIChtYXJrZXIsIG9wdE5vRHJhdykge1xyXG4gICAgdGhpcy5wdXNoTWFya2VyVG8obWFya2VyKTtcclxuICAgIGlmICghb3B0Tm9EcmF3KSB7XHJcbiAgICAgIHRoaXMucmVkcmF3KCk7XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmFkZE1hcmtlcnMgPSBmdW5jdGlvbiAobWFya2Vycywgb3B0Tm9EcmF3KSB7XHJcbiAgICBmb3IgKHZhciBrZXkgaW4gbWFya2Vycykge1xyXG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1hcmtlcnMsIGtleSkpIHtcclxuICAgICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1trZXldO1xyXG4gICAgICAgIGlmIChtYXJrZXIpIHtcclxuICAgICAgICAgIHRoaXMucHVzaE1hcmtlclRvKG1hcmtlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIW9wdE5vRHJhdykge1xyXG4gICAgICB0aGlzLnJlZHJhdygpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5wdXNoTWFya2VyVG8gPSBmdW5jdGlvbiAobWFya2VyKSB7XHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgLy8gSWYgdGhlIG1hcmtlciBpcyBkcmFnZ2FibGUgYWRkIGEgbGlzdGVuZXIgc28gd2UgY2FuIHVwZGF0ZSB0aGUgY2x1c3RlcnMgb24gdGhlIGRyYWdlbmQ6XHJcbiAgICBpZiAobWFya2VyLmdldERyYWdnYWJsZSgpKSB7XHJcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2RyYWdlbmQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKF90aGlzLnJlYWR5KSB7XHJcbiAgICAgICAgICBtYXJrZXIuaXNBZGRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgX3RoaXMucmVwYWludCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBtYXJrZXIuaXNBZGRlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUucmVtb3ZlTWFya2VyXyA9IGZ1bmN0aW9uIChtYXJrZXIpIHtcclxuICAgIHZhciBpbmRleCA9IC0xO1xyXG4gICAgaWYgKHRoaXMubWFya2Vycy5pbmRleE9mKSB7XHJcbiAgICAgIGluZGV4ID0gdGhpcy5tYXJrZXJzLmluZGV4T2YobWFya2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tYXJrZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKG1hcmtlciA9PT0gdGhpcy5tYXJrZXJzW2ldKSB7XHJcbiAgICAgICAgICBpbmRleCA9IGk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgLy8gTWFya2VyIGlzIG5vdCBpbiBvdXIgbGlzdCBvZiBtYXJrZXJzLCBzbyBkbyBub3RoaW5nOlxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBtYXJrZXIuc2V0TWFwKG51bGwpO1xyXG4gICAgdGhpcy5tYXJrZXJzLnNwbGljZShpbmRleCwgMSk7IC8vIFJlbW92ZSB0aGUgbWFya2VyIGZyb20gdGhlIGxpc3Qgb2YgbWFuYWdlZCBtYXJrZXJzXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUucmVtb3ZlTWFya2VyID0gZnVuY3Rpb24gKG1hcmtlciwgb3B0Tm9EcmF3KSB7XHJcbiAgICB2YXIgcmVtb3ZlZCA9IHRoaXMucmVtb3ZlTWFya2VyXyhtYXJrZXIpO1xyXG4gICAgaWYgKCFvcHROb0RyYXcgJiYgcmVtb3ZlZCkge1xyXG4gICAgICB0aGlzLnJlcGFpbnQoKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZW1vdmVkO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5yZW1vdmVNYXJrZXJzID0gZnVuY3Rpb24gKG1hcmtlcnMsIG9wdE5vRHJhdykge1xyXG4gICAgdmFyIHJlbW92ZWQgPSBmYWxzZTtcclxuICAgIGZvciAodmFyIF9pID0gMCwgbWFya2Vyc18yID0gbWFya2VyczsgX2kgPCBtYXJrZXJzXzIubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgIHZhciBtYXJrZXIgPSBtYXJrZXJzXzJbX2ldO1xyXG4gICAgICByZW1vdmVkID0gcmVtb3ZlZCB8fCB0aGlzLnJlbW92ZU1hcmtlcl8obWFya2VyKTtcclxuICAgIH1cclxuICAgIGlmICghb3B0Tm9EcmF3ICYmIHJlbW92ZWQpIHtcclxuICAgICAgdGhpcy5yZXBhaW50KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVtb3ZlZDtcclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuY2xlYXJNYXJrZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5yZXNldFZpZXdwb3J0KHRydWUpO1xyXG4gICAgdGhpcy5tYXJrZXJzID0gW107XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnJlcGFpbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgb2xkQ2x1c3RlcnMgPSB0aGlzLmNsdXN0ZXJzLnNsaWNlKCk7XHJcbiAgICB0aGlzLmNsdXN0ZXJzID0gW107XHJcbiAgICB0aGlzLnJlc2V0Vmlld3BvcnQoZmFsc2UpO1xyXG4gICAgdGhpcy5yZWRyYXcoKTtcclxuICAgIC8vIFJlbW92ZSB0aGUgb2xkIGNsdXN0ZXJzLlxyXG4gICAgLy8gRG8gaXQgaW4gYSB0aW1lb3V0IHRvIHByZXZlbnQgYmxpbmtpbmcgZWZmZWN0LlxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkge1xyXG4gICAgICBmb3IgKHZhciBfaSA9IDAsIG9sZENsdXN0ZXJzXzEgPSBvbGRDbHVzdGVyczsgX2kgPCBvbGRDbHVzdGVyc18xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHZhciBvbGRDbHVzdGVyID0gb2xkQ2x1c3RlcnNfMVtfaV07XHJcbiAgICAgICAgb2xkQ2x1c3Rlci5yZW1vdmUoKTtcclxuICAgICAgfVxyXG4gICAgfSwgMCk7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmdldEV4dGVuZGVkQm91bmRzID0gZnVuY3Rpb24gKGJvdW5kcykge1xyXG4gICAgdmFyIHByb2plY3Rpb24gPSB0aGlzLmdldFByb2plY3Rpb24oKTtcclxuICAgIC8vIENvbnZlcnQgdGhlIHBvaW50cyB0byBwaXhlbHMgYW5kIHRoZSBleHRlbmQgb3V0IGJ5IHRoZSBncmlkIHNpemUuXHJcbiAgICB2YXIgdHJQaXggPSBwcm9qZWN0aW9uLmZyb21MYXRMbmdUb0RpdlBpeGVsKFxyXG4gICAgLy8gVHVybiB0aGUgYm91bmRzIGludG8gbGF0bG5nLlxyXG4gICAgbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhib3VuZHMuZ2V0Tm9ydGhFYXN0KCkubGF0KCksIGJvdW5kcy5nZXROb3J0aEVhc3QoKS5sbmcoKSkpO1xyXG4gICAgaWYgKHRyUGl4ICE9PSBudWxsKSB7XHJcbiAgICAgIHRyUGl4LnggKz0gdGhpcy5ncmlkU2l6ZTtcclxuICAgICAgdHJQaXgueSAtPSB0aGlzLmdyaWRTaXplO1xyXG4gICAgfVxyXG4gICAgdmFyIGJsUGl4ID0gcHJvamVjdGlvbi5mcm9tTGF0TG5nVG9EaXZQaXhlbChcclxuICAgIC8vIFR1cm4gdGhlIGJvdW5kcyBpbnRvIGxhdGxuZy5cclxuICAgIG5ldyBnb29nbGUubWFwcy5MYXRMbmcoYm91bmRzLmdldFNvdXRoV2VzdCgpLmxhdCgpLCBib3VuZHMuZ2V0U291dGhXZXN0KCkubG5nKCkpKTtcclxuICAgIGlmIChibFBpeCAhPT0gbnVsbCkge1xyXG4gICAgICBibFBpeC54IC09IHRoaXMuZ3JpZFNpemU7XHJcbiAgICAgIGJsUGl4LnkgKz0gdGhpcy5ncmlkU2l6ZTtcclxuICAgIH1cclxuICAgIC8vIEV4dGVuZCB0aGUgYm91bmRzIHRvIGNvbnRhaW4gdGhlIG5ldyBib3VuZHMuXHJcbiAgICBpZiAodHJQaXggIT09IG51bGwpIHtcclxuICAgICAgLy8gQ29udmVydCB0aGUgcGl4ZWwgcG9pbnRzIGJhY2sgdG8gTGF0TG5nIG53XHJcbiAgICAgIHZhciBwb2ludDEgPSBwcm9qZWN0aW9uLmZyb21EaXZQaXhlbFRvTGF0TG5nKHRyUGl4KTtcclxuICAgICAgaWYgKHBvaW50MSAhPT0gbnVsbCkge1xyXG4gICAgICAgIGJvdW5kcy5leHRlbmQocG9pbnQxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGJsUGl4ICE9PSBudWxsKSB7XHJcbiAgICAgIC8vIENvbnZlcnQgdGhlIHBpeGVsIHBvaW50cyBiYWNrIHRvIExhdExuZyBzd1xyXG4gICAgICB2YXIgcG9pbnQyID0gcHJvamVjdGlvbi5mcm9tRGl2UGl4ZWxUb0xhdExuZyhibFBpeCk7XHJcbiAgICAgIGlmIChwb2ludDIgIT09IG51bGwpIHtcclxuICAgICAgICBib3VuZHMuZXh0ZW5kKHBvaW50Mik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBib3VuZHM7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vIFJlZHJhd3MgYWxsIHRoZSBjbHVzdGVycy5cclxuICAgIHRoaXMuY3JlYXRlQ2x1c3RlcnMoMCk7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLnJlc2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAob3B0SGlkZSkge1xyXG4gICAgLy8gUmVtb3ZlIGFsbCB0aGUgY2x1c3RlcnNcclxuICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmNsdXN0ZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICB2YXIgY2x1c3RlciA9IF9hW19pXTtcclxuICAgICAgY2x1c3Rlci5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICAgIC8vIFJlc2V0IHRoZSBtYXJrZXJzIHRvIG5vdCBiZSBhZGRlZCBhbmQgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBtYXAuXHJcbiAgICBmb3IgKHZhciBfYiA9IDAsIF9jID0gdGhpcy5tYXJrZXJzOyBfYiA8IF9jLmxlbmd0aDsgX2IrKykge1xyXG4gICAgICB2YXIgbWFya2VyID0gX2NbX2JdO1xyXG4gICAgICBtYXJrZXIuaXNBZGRlZCA9IGZhbHNlO1xyXG4gICAgICBpZiAob3B0SGlkZSkge1xyXG4gICAgICAgIG1hcmtlci5zZXRNYXAobnVsbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG4gIENsdXN0ZXJlci5wcm90b3R5cGUuZGlzdGFuY2VCZXR3ZWVuUG9pbnRzID0gZnVuY3Rpb24gKHAxLCBwMikge1xyXG4gICAgdmFyIFIgPSA2MzcxOyAvLyBSYWRpdXMgb2YgdGhlIEVhcnRoIGluIGttXHJcbiAgICB2YXIgZExhdCA9IChwMi5sYXQoKSAtIHAxLmxhdCgpKSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICB2YXIgZExvbiA9IChwMi5sbmcoKSAtIHAxLmxuZygpKSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICB2YXIgYSA9IE1hdGguc2luKGRMYXQgLyAyKSAqIE1hdGguc2luKGRMYXQgLyAyKSArIE1hdGguY29zKHAxLmxhdCgpICogTWF0aC5QSSAvIDE4MCkgKiBNYXRoLmNvcyhwMi5sYXQoKSAqIE1hdGguUEkgLyAxODApICogTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gICAgcmV0dXJuIFIgKiAoMiAqIE1hdGguYXRhbjIoTWF0aC5zcXJ0KGEpLCBNYXRoLnNxcnQoMSAtIGEpKSk7XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmlzTWFya2VySW5Cb3VuZHMgPSBmdW5jdGlvbiAobWFya2VyLCBib3VuZHMpIHtcclxuICAgIHZhciBwb3NpdGlvbiA9IG1hcmtlci5nZXRQb3NpdGlvbigpO1xyXG4gICAgaWYgKHBvc2l0aW9uKSB7XHJcbiAgICAgIHJldHVybiBib3VuZHMuY29udGFpbnMocG9zaXRpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5hZGRUb0Nsb3Nlc3RDbHVzdGVyID0gZnVuY3Rpb24gKG1hcmtlcikge1xyXG4gICAgdmFyIGNsdXN0ZXI7XHJcbiAgICB2YXIgZGlzdGFuY2UgPSA0MDAwMDsgLy8gU29tZSBsYXJnZSBudW1iZXJcclxuICAgIHZhciBjbHVzdGVyVG9BZGRUbyA9IG51bGw7XHJcbiAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5jbHVzdGVyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgdmFyIGNsdXN0ZXJFbGVtZW50ID0gX2FbX2ldO1xyXG4gICAgICBjbHVzdGVyID0gY2x1c3RlckVsZW1lbnQ7XHJcbiAgICAgIHZhciBjZW50ZXIgPSBjbHVzdGVyLmdldENlbnRlcigpO1xyXG4gICAgICB2YXIgcG9zaXRpb24gPSBtYXJrZXIuZ2V0UG9zaXRpb24oKTtcclxuICAgICAgaWYgKGNlbnRlciAmJiBwb3NpdGlvbikge1xyXG4gICAgICAgIHZhciBkID0gdGhpcy5kaXN0YW5jZUJldHdlZW5Qb2ludHMoY2VudGVyLCBwb3NpdGlvbik7XHJcbiAgICAgICAgaWYgKGQgPCBkaXN0YW5jZSkge1xyXG4gICAgICAgICAgZGlzdGFuY2UgPSBkO1xyXG4gICAgICAgICAgY2x1c3RlclRvQWRkVG8gPSBjbHVzdGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNsdXN0ZXJUb0FkZFRvICYmIGNsdXN0ZXJUb0FkZFRvLmlzTWFya2VySW5DbHVzdGVyQm91bmRzKG1hcmtlcikpIHtcclxuICAgICAgY2x1c3RlclRvQWRkVG8uYWRkTWFya2VyKG1hcmtlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjbHVzdGVyID0gbmV3IENsdXN0ZXIkMSh0aGlzKTtcclxuICAgICAgY2x1c3Rlci5hZGRNYXJrZXIobWFya2VyKTtcclxuICAgICAgdGhpcy5jbHVzdGVycy5wdXNoKGNsdXN0ZXIpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgQ2x1c3RlcmVyLnByb3RvdHlwZS5jcmVhdGVDbHVzdGVycyA9IGZ1bmN0aW9uIChpRmlyc3QpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAoIXRoaXMucmVhZHkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gQ2FuY2VsIHByZXZpb3VzIGJhdGNoIHByb2Nlc3NpbmcgaWYgd2UncmUgd29ya2luZyBvbiB0aGUgZmlyc3QgYmF0Y2g6XHJcbiAgICBpZiAoaUZpcnN0ID09PSAwKSB7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIDxjb2RlPkNsdXN0ZXJlcjwvY29kZT4gYmVnaW5zXHJcbiAgICAgICAqICBjbHVzdGVyaW5nIG1hcmtlcnMuXHJcbiAgICAgICAqIEBuYW1lIENsdXN0ZXJlciNjbHVzdGVyaW5nYmVnaW5cclxuICAgICAgICogQHBhcmFtIHtDbHVzdGVyZXJ9IG1jIFRoZSBDbHVzdGVyZXIgd2hvc2UgbWFya2VycyBhcmUgYmVpbmcgY2x1c3RlcmVkLlxyXG4gICAgICAgKiBAZXZlbnRcclxuICAgICAgICovXHJcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodGhpcywgJ2NsdXN0ZXJpbmdiZWdpbicsIHRoaXMpO1xyXG4gICAgICBpZiAodGhpcy50aW1lclJlZlN0YXRpYyAhPT0gbnVsbCkge1xyXG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lclJlZlN0YXRpYyk7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBkZWxldGUgdGhpcy50aW1lclJlZlN0YXRpYztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdmFyIG1hcCA9IHRoaXMuZ2V0TWFwKCk7XHJcbiAgICB2YXIgYm91bmRzID0gbWFwICE9PSBudWxsICYmICdnZXRCb3VuZHMnIGluIG1hcCA/IG1hcC5nZXRCb3VuZHMoKSA6IG51bGw7XHJcbiAgICB2YXIgem9vbSA9IChtYXAgPT09IG51bGwgfHwgbWFwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXAuZ2V0Wm9vbSgpKSB8fCAwO1xyXG4gICAgLy8gR2V0IG91ciBjdXJyZW50IG1hcCB2aWV3IGJvdW5kcy5cclxuICAgIC8vIENyZWF0ZSBhIG5ldyBib3VuZHMgb2JqZWN0IHNvIHdlIGRvbid0IGFmZmVjdCB0aGUgbWFwLlxyXG4gICAgLy9cclxuICAgIC8vIFNlZSBDb21tZW50cyA5ICYgMTEgb24gSXNzdWUgMzY1MSByZWxhdGluZyB0byB0aGlzIHdvcmthcm91bmQgZm9yIGEgR29vZ2xlIE1hcHMgYnVnOlxyXG4gICAgdmFyIG1hcEJvdW5kcyA9IHpvb20gPiAzID8gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcyhib3VuZHMgPT09IG51bGwgfHwgYm91bmRzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBib3VuZHMuZ2V0U291dGhXZXN0KCksIGJvdW5kcyA9PT0gbnVsbCB8fCBib3VuZHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGJvdW5kcy5nZXROb3J0aEVhc3QoKSkgOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoODUuMDIwNzA3NzE3NDM0NzIsIC0xNzguNDgzODg0MzQzNzUpLCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKC04NS4wODEzNjQ0NDM4NDU0NCwgMTc4LjAwMDQ4ODY1NjI1KSk7XHJcbiAgICB2YXIgZXh0ZW5kZWRNYXBCb3VuZHMgPSB0aGlzLmdldEV4dGVuZGVkQm91bmRzKG1hcEJvdW5kcyk7XHJcbiAgICB2YXIgaUxhc3QgPSBNYXRoLm1pbihpRmlyc3QgKyB0aGlzLmJhdGNoU2l6ZSwgdGhpcy5tYXJrZXJzLmxlbmd0aCk7XHJcbiAgICBmb3IgKHZhciBpID0gaUZpcnN0OyBpIDwgaUxhc3Q7IGkrKykge1xyXG4gICAgICB2YXIgbWFya2VyID0gdGhpcy5tYXJrZXJzW2ldO1xyXG4gICAgICBpZiAobWFya2VyICYmICFtYXJrZXIuaXNBZGRlZCAmJiB0aGlzLmlzTWFya2VySW5Cb3VuZHMobWFya2VyLCBleHRlbmRlZE1hcEJvdW5kcykgJiYgKCF0aGlzLmlnbm9yZUhpZGRlbiB8fCB0aGlzLmlnbm9yZUhpZGRlbiAmJiBtYXJrZXIuZ2V0VmlzaWJsZSgpKSkge1xyXG4gICAgICAgIHRoaXMuYWRkVG9DbG9zZXN0Q2x1c3RlcihtYXJrZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoaUxhc3QgPCB0aGlzLm1hcmtlcnMubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMudGltZXJSZWZTdGF0aWMgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgX3RoaXMuY3JlYXRlQ2x1c3RlcnMoaUxhc3QpO1xyXG4gICAgICB9LCAwKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGltZXJSZWZTdGF0aWMgPSBudWxsO1xyXG4gICAgICAvKipcclxuICAgICAgICogVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIHRoZSA8Y29kZT5DbHVzdGVyZXI8L2NvZGU+IHN0b3BzXHJcbiAgICAgICAqICBjbHVzdGVyaW5nIG1hcmtlcnMuXHJcbiAgICAgICAqIEBuYW1lIENsdXN0ZXJlciNjbHVzdGVyaW5nZW5kXHJcbiAgICAgICAqIEBwYXJhbSB7Q2x1c3RlcmVyfSBtYyBUaGUgQ2x1c3RlcmVyIHdob3NlIG1hcmtlcnMgYXJlIGJlaW5nIGNsdXN0ZXJlZC5cclxuICAgICAgICogQGV2ZW50XHJcbiAgICAgICAqL1xyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHRoaXMsICdjbHVzdGVyaW5nZW5kJywgdGhpcyk7XHJcbiAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmNsdXN0ZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHZhciBjbHVzdGVyID0gX2FbX2ldO1xyXG4gICAgICAgIGNsdXN0ZXIudXBkYXRlSWNvbigpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuICBDbHVzdGVyZXIucHJvdG90eXBlLmV4dGVuZCA9IGZ1bmN0aW9uIChvYmoxLCBvYmoyKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gYXBwbHlFeHRlbmQob2JqZWN0KSB7XHJcbiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iamVjdC5wcm90b3R5cGUpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xyXG4gICAgICAgIHZhciBwcm9wID0gcHJvcGVydHk7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB0aGlzLnByb3RvdHlwZVtwcm9wXSA9IG9iamVjdC5wcm90b3R5cGVbcHJvcF07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LmFwcGx5KG9iajEsIFtvYmoyXSk7XHJcbiAgfTtcclxuICByZXR1cm4gQ2x1c3RlcmVyO1xyXG59KCk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzJGMoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfVxyXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkJGMoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyRjKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyRjKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9XHJcbnZhciBldmVudE1hcCRlID0ge1xyXG4gIG9uQ2xpY2s6ICdjbGljaycsXHJcbiAgb25DbHVzdGVyaW5nQmVnaW46ICdjbHVzdGVyaW5nYmVnaW4nLFxyXG4gIG9uQ2x1c3RlcmluZ0VuZDogJ2NsdXN0ZXJpbmdlbmQnLFxyXG4gIG9uTW91c2VPdXQ6ICdtb3VzZW91dCcsXHJcbiAgb25Nb3VzZU92ZXI6ICdtb3VzZW92ZXInXHJcbn07XHJcbnZhciB1cGRhdGVyTWFwJGUgPSB7XHJcbiAgYXZlcmFnZUNlbnRlcihpbnN0YW5jZSwgYXZlcmFnZUNlbnRlcikge1xyXG4gICAgaW5zdGFuY2Uuc2V0QXZlcmFnZUNlbnRlcihhdmVyYWdlQ2VudGVyKTtcclxuICB9LFxyXG4gIGJhdGNoU2l6ZUlFKGluc3RhbmNlLCBiYXRjaFNpemVJRSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0QmF0Y2hTaXplSUUoYmF0Y2hTaXplSUUpO1xyXG4gIH0sXHJcbiAgY2FsY3VsYXRvcihpbnN0YW5jZSwgY2FsY3VsYXRvcikge1xyXG4gICAgaW5zdGFuY2Uuc2V0Q2FsY3VsYXRvcihjYWxjdWxhdG9yKTtcclxuICB9LFxyXG4gIGNsdXN0ZXJDbGFzcyhpbnN0YW5jZSwgY2x1c3RlckNsYXNzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRDbHVzdGVyQ2xhc3MoY2x1c3RlckNsYXNzKTtcclxuICB9LFxyXG4gIGVuYWJsZVJldGluYUljb25zKGluc3RhbmNlLCBlbmFibGVSZXRpbmFJY29ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0RW5hYmxlUmV0aW5hSWNvbnMoZW5hYmxlUmV0aW5hSWNvbnMpO1xyXG4gIH0sXHJcbiAgZ3JpZFNpemUoaW5zdGFuY2UsIGdyaWRTaXplKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRHcmlkU2l6ZShncmlkU2l6ZSk7XHJcbiAgfSxcclxuICBpZ25vcmVIaWRkZW4oaW5zdGFuY2UsIGlnbm9yZUhpZGRlbikge1xyXG4gICAgaW5zdGFuY2Uuc2V0SWdub3JlSGlkZGVuKGlnbm9yZUhpZGRlbik7XHJcbiAgfSxcclxuICBpbWFnZUV4dGVuc2lvbihpbnN0YW5jZSwgaW1hZ2VFeHRlbnNpb24pIHtcclxuICAgIGluc3RhbmNlLnNldEltYWdlRXh0ZW5zaW9uKGltYWdlRXh0ZW5zaW9uKTtcclxuICB9LFxyXG4gIGltYWdlUGF0aChpbnN0YW5jZSwgaW1hZ2VQYXRoKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRJbWFnZVBhdGgoaW1hZ2VQYXRoKTtcclxuICB9LFxyXG4gIGltYWdlU2l6ZXMoaW5zdGFuY2UsIGltYWdlU2l6ZXMpIHtcclxuICAgIGluc3RhbmNlLnNldEltYWdlU2l6ZXMoaW1hZ2VTaXplcyk7XHJcbiAgfSxcclxuICBtYXhab29tKGluc3RhbmNlLCBtYXhab29tKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRNYXhab29tKG1heFpvb20pO1xyXG4gIH0sXHJcbiAgbWluaW11bUNsdXN0ZXJTaXplKGluc3RhbmNlLCBtaW5pbXVtQ2x1c3RlclNpemUpIHtcclxuICAgIGluc3RhbmNlLnNldE1pbmltdW1DbHVzdGVyU2l6ZShtaW5pbXVtQ2x1c3RlclNpemUpO1xyXG4gIH0sXHJcbiAgc3R5bGVzKGluc3RhbmNlLCBzdHlsZXMpIHtcclxuICAgIGluc3RhbmNlLnNldFN0eWxlcyhzdHlsZXMpO1xyXG4gIH0sXHJcbiAgdGl0bGUoaW5zdGFuY2UsIHRpdGxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRUaXRsZSh0aXRsZSk7XHJcbiAgfSxcclxuICB6b29tT25DbGljayhpbnN0YW5jZSwgem9vbU9uQ2xpY2spIHtcclxuICAgIGluc3RhbmNlLnNldFpvb21PbkNsaWNrKHpvb21PbkNsaWNrKTtcclxuICB9XHJcbn07XHJcbnZhciBkZWZhdWx0T3B0aW9ucyQ0ID0ge307XHJcbmZ1bmN0aW9uIE1hcmtlckNsdXN0ZXJlckZ1bmN0aW9uYWwocHJvcHMpIHtcclxuICB2YXIge1xyXG4gICAgY2hpbGRyZW4sXHJcbiAgICBvcHRpb25zLFxyXG4gICAgYXZlcmFnZUNlbnRlcixcclxuICAgIGJhdGNoU2l6ZUlFLFxyXG4gICAgY2FsY3VsYXRvcixcclxuICAgIGNsdXN0ZXJDbGFzcyxcclxuICAgIGVuYWJsZVJldGluYUljb25zLFxyXG4gICAgZ3JpZFNpemUsXHJcbiAgICBpZ25vcmVIaWRkZW4sXHJcbiAgICBpbWFnZUV4dGVuc2lvbixcclxuICAgIGltYWdlUGF0aCxcclxuICAgIGltYWdlU2l6ZXMsXHJcbiAgICBtYXhab29tLFxyXG4gICAgbWluaW11bUNsdXN0ZXJTaXplLFxyXG4gICAgc3R5bGVzLFxyXG4gICAgdGl0bGUsXHJcbiAgICB6b29tT25DbGljayxcclxuICAgIG9uQ2xpY2ssXHJcbiAgICBvbkNsdXN0ZXJpbmdCZWdpbixcclxuICAgIG9uQ2x1c3RlcmluZ0VuZCxcclxuICAgIG9uTW91c2VPdmVyLFxyXG4gICAgb25Nb3VzZU91dCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBwcm9wcztcclxuICB2YXIgW2luc3RhbmNlLCBzZXRJbnN0YW5jZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgbWFwID0gdXNlQ29udGV4dChNYXBDb250ZXh0KTtcclxuICB2YXIgW2NsaWNrTGlzdGVuZXIsIHNldENsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbHVzdGVyaW5nQmVnaW5MaXN0ZW5lciwgc2V0Q2x1c3RlcmluZ0JlZ2luTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbHVzdGVyaW5nRW5kTGlzdGVuZXIsIHNldENsdXN0ZXJpbmdFbmRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNlb3V0TGlzdGVuZXIsIHNldE1vdXNlb3V0TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW92ZXJMaXN0ZW5lciwgc2V0TW91c2VvdmVyTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlT3V0KSB7XHJcbiAgICAgIGlmIChtb3VzZW91dExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdXRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgZXZlbnRNYXAkZS5vbk1vdXNlT3V0LCBvbk1vdXNlT3V0KSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VPdXRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW92ZXJMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgZXZlbnRNYXAkZS5vbk1vdXNlT3Zlciwgb25Nb3VzZU92ZXIpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU92ZXJdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ2xpY2spIHtcclxuICAgICAgaWYgKGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCBldmVudE1hcCRlLm9uQ2xpY2ssIG9uQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25DbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25DbHVzdGVyaW5nQmVnaW4pIHtcclxuICAgICAgaWYgKGNsdXN0ZXJpbmdCZWdpbkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2x1c3RlcmluZ0JlZ2luTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsdXN0ZXJpbmdCZWdpbkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCBldmVudE1hcCRlLm9uQ2x1c3RlcmluZ0JlZ2luLCBvbkNsdXN0ZXJpbmdCZWdpbikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsdXN0ZXJpbmdCZWdpbl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25DbHVzdGVyaW5nRW5kKSB7XHJcbiAgICAgIGlmIChjbHVzdGVyaW5nRW5kTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbHVzdGVyaW5nRW5kTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsdXN0ZXJpbmdCZWdpbkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCBldmVudE1hcCRlLm9uQ2x1c3RlcmluZ0VuZCwgb25DbHVzdGVyaW5nRW5kKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQ2x1c3RlcmluZ0VuZF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGF2ZXJhZ2VDZW50ZXIgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5hdmVyYWdlQ2VudGVyKGluc3RhbmNlLCBhdmVyYWdlQ2VudGVyKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGF2ZXJhZ2VDZW50ZXJdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBiYXRjaFNpemVJRSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLmJhdGNoU2l6ZUlFKGluc3RhbmNlLCBiYXRjaFNpemVJRSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBiYXRjaFNpemVJRV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGNhbGN1bGF0b3IgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5jYWxjdWxhdG9yKGluc3RhbmNlLCBjYWxjdWxhdG9yKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGNhbGN1bGF0b3JdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBjbHVzdGVyQ2xhc3MgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5jbHVzdGVyQ2xhc3MoaW5zdGFuY2UsIGNsdXN0ZXJDbGFzcyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBjbHVzdGVyQ2xhc3NdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBlbmFibGVSZXRpbmFJY29ucyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLmVuYWJsZVJldGluYUljb25zKGluc3RhbmNlLCBlbmFibGVSZXRpbmFJY29ucyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBlbmFibGVSZXRpbmFJY29uc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGdyaWRTaXplICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuZ3JpZFNpemUoaW5zdGFuY2UsIGdyaWRTaXplKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGdyaWRTaXplXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgaWdub3JlSGlkZGVuICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuaWdub3JlSGlkZGVuKGluc3RhbmNlLCBpZ25vcmVIaWRkZW4pO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgaWdub3JlSGlkZGVuXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgaW1hZ2VFeHRlbnNpb24gIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5pbWFnZUV4dGVuc2lvbihpbnN0YW5jZSwgaW1hZ2VFeHRlbnNpb24pO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgaW1hZ2VFeHRlbnNpb25dKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBpbWFnZVBhdGggIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5pbWFnZVBhdGgoaW5zdGFuY2UsIGltYWdlUGF0aCk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBpbWFnZVBhdGhdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBpbWFnZVNpemVzICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuaW1hZ2VTaXplcyhpbnN0YW5jZSwgaW1hZ2VTaXplcyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBpbWFnZVNpemVzXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgbWF4Wm9vbSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLm1heFpvb20oaW5zdGFuY2UsIG1heFpvb20pO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgbWF4Wm9vbV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIG1pbmltdW1DbHVzdGVyU2l6ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLm1pbmltdW1DbHVzdGVyU2l6ZShpbnN0YW5jZSwgbWluaW11bUNsdXN0ZXJTaXplKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG1pbmltdW1DbHVzdGVyU2l6ZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHN0eWxlcyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLnN0eWxlcyhpbnN0YW5jZSwgc3R5bGVzKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHN0eWxlc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHRpdGxlICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICB1cGRhdGVyTWFwJGUudGl0bGUoaW5zdGFuY2UsIHRpdGxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHRpdGxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2Ygem9vbU9uQ2xpY2sgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS56b29tT25DbGljayhpbnN0YW5jZSwgem9vbU9uQ2xpY2spO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgem9vbU9uQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKCFtYXApIHJldHVybjtcclxuICAgIHZhciBjbHVzdGVyZXJPcHRpb25zID0gX29iamVjdFNwcmVhZCRjKHt9LCBvcHRpb25zIHx8IGRlZmF1bHRPcHRpb25zJDQpO1xyXG4gICAgdmFyIGNsdXN0ZXJlciA9IG5ldyBDbHVzdGVyZXIobWFwLCBbXSwgY2x1c3RlcmVyT3B0aW9ucyk7XHJcbiAgICBpZiAoYXZlcmFnZUNlbnRlcikge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuYXZlcmFnZUNlbnRlcihjbHVzdGVyZXIsIGF2ZXJhZ2VDZW50ZXIpO1xyXG4gICAgfVxyXG4gICAgaWYgKGJhdGNoU2l6ZUlFKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5iYXRjaFNpemVJRShjbHVzdGVyZXIsIGJhdGNoU2l6ZUlFKTtcclxuICAgIH1cclxuICAgIGlmIChjYWxjdWxhdG9yKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5jYWxjdWxhdG9yKGNsdXN0ZXJlciwgY2FsY3VsYXRvcik7XHJcbiAgICB9XHJcbiAgICBpZiAoY2x1c3RlckNsYXNzKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5jbHVzdGVyQ2xhc3MoY2x1c3RlcmVyLCBjbHVzdGVyQ2xhc3MpO1xyXG4gICAgfVxyXG4gICAgaWYgKGVuYWJsZVJldGluYUljb25zKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5lbmFibGVSZXRpbmFJY29ucyhjbHVzdGVyZXIsIGVuYWJsZVJldGluYUljb25zKTtcclxuICAgIH1cclxuICAgIGlmIChncmlkU2l6ZSkge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuZ3JpZFNpemUoY2x1c3RlcmVyLCBncmlkU2l6ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoaWdub3JlSGlkZGVuKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5pZ25vcmVIaWRkZW4oY2x1c3RlcmVyLCBpZ25vcmVIaWRkZW4pO1xyXG4gICAgfVxyXG4gICAgaWYgKGltYWdlRXh0ZW5zaW9uKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5pbWFnZUV4dGVuc2lvbihjbHVzdGVyZXIsIGltYWdlRXh0ZW5zaW9uKTtcclxuICAgIH1cclxuICAgIGlmIChpbWFnZVBhdGgpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLmltYWdlUGF0aChjbHVzdGVyZXIsIGltYWdlUGF0aCk7XHJcbiAgICB9XHJcbiAgICBpZiAoaW1hZ2VTaXplcykge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuaW1hZ2VTaXplcyhjbHVzdGVyZXIsIGltYWdlU2l6ZXMpO1xyXG4gICAgfVxyXG4gICAgaWYgKG1heFpvb20pIHtcclxuICAgICAgdXBkYXRlck1hcCRlLm1heFpvb20oY2x1c3RlcmVyLCBtYXhab29tKTtcclxuICAgIH1cclxuICAgIGlmIChtaW5pbXVtQ2x1c3RlclNpemUpIHtcclxuICAgICAgdXBkYXRlck1hcCRlLm1pbmltdW1DbHVzdGVyU2l6ZShjbHVzdGVyZXIsIG1pbmltdW1DbHVzdGVyU2l6ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoc3R5bGVzKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS5zdHlsZXMoY2x1c3RlcmVyLCBzdHlsZXMpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgIHVwZGF0ZXJNYXAkZS50aXRsZShjbHVzdGVyZXIsIHRpdGxlKTtcclxuICAgIH1cclxuICAgIGlmICh6b29tT25DbGljaykge1xyXG4gICAgICB1cGRhdGVyTWFwJGUuem9vbU9uQ2xpY2soY2x1c3RlcmVyLCB6b29tT25DbGljayk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU91dCkge1xyXG4gICAgICBzZXRNb3VzZW91dExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNsdXN0ZXJlciwgZXZlbnRNYXAkZS5vbk1vdXNlT3V0LCBvbk1vdXNlT3V0KSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU92ZXIpIHtcclxuICAgICAgc2V0TW91c2VvdmVyTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2x1c3RlcmVyLCBldmVudE1hcCRlLm9uTW91c2VPdmVyLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uQ2xpY2spIHtcclxuICAgICAgc2V0Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihjbHVzdGVyZXIsIGV2ZW50TWFwJGUub25DbGljaywgb25DbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uQ2x1c3RlcmluZ0JlZ2luKSB7XHJcbiAgICAgIHNldENsdXN0ZXJpbmdCZWdpbkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNsdXN0ZXJlciwgZXZlbnRNYXAkZS5vbkNsdXN0ZXJpbmdCZWdpbiwgb25DbHVzdGVyaW5nQmVnaW4pKTtcclxuICAgIH1cclxuICAgIGlmIChvbkNsdXN0ZXJpbmdFbmQpIHtcclxuICAgICAgc2V0Q2x1c3RlcmluZ0VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNsdXN0ZXJlciwgZXZlbnRNYXAkZS5vbkNsdXN0ZXJpbmdFbmQsIG9uQ2x1c3RlcmluZ0VuZCkpO1xyXG4gICAgfVxyXG4gICAgc2V0SW5zdGFuY2UoY2x1c3RlcmVyKTtcclxuICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgb25Mb2FkKGNsdXN0ZXJlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjbHVzdGVyaW5nQmVnaW5MaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsdXN0ZXJpbmdCZWdpbkxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2x1c3RlcmluZ0VuZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2x1c3RlcmluZ0VuZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgb25Vbm1vdW50KGNsdXN0ZXJlcik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG4gIHJldHVybiBpbnN0YW5jZSAhPT0gbnVsbCA/IGNoaWxkcmVuKGluc3RhbmNlKSB8fCBudWxsIDogbnVsbDtcclxufVxyXG52YXIgTWFya2VyQ2x1c3RlcmVyRiA9IG1lbW8oTWFya2VyQ2x1c3RlcmVyRnVuY3Rpb25hbCk7XHJcbmNsYXNzIENsdXN0ZXJlckNvbXBvbmVudCBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBtYXJrZXJDbHVzdGVyZXI6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0Q2x1c3RlcmVyQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5tYXJrZXJDbHVzdGVyZXIgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLm1hcmtlckNsdXN0ZXJlcik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIGlmICh0aGlzLmNvbnRleHQpIHtcclxuICAgICAgdmFyIG1hcmtlckNsdXN0ZXJlciA9IG5ldyBDbHVzdGVyZXIodGhpcy5jb250ZXh0LCBbXSwgdGhpcy5wcm9wcy5vcHRpb25zKTtcclxuICAgICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCRlLFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCRlLFxyXG4gICAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiBtYXJrZXJDbHVzdGVyZXJcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBtYXJrZXJDbHVzdGVyZXJcclxuICAgICAgICB9O1xyXG4gICAgICB9LCB0aGlzLnNldENsdXN0ZXJlckNhbGxiYWNrKTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUubWFya2VyQ2x1c3RlcmVyKSB7XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCRlLFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCRlLFxyXG4gICAgICAgIHByZXZQcm9wcyxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IHRoaXMuc3RhdGUubWFya2VyQ2x1c3RlcmVyXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLm1hcmtlckNsdXN0ZXJlciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLm1hcmtlckNsdXN0ZXJlcik7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgdGhpcy5zdGF0ZS5tYXJrZXJDbHVzdGVyZXIuc2V0TWFwKG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5tYXJrZXJDbHVzdGVyZXIgIT09IG51bGwgPyB0aGlzLnByb3BzLmNoaWxkcmVuKHRoaXMuc3RhdGUubWFya2VyQ2x1c3RlcmVyKSA6IG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShDbHVzdGVyZXJDb21wb25lbnQsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG4vLyBUaGlzIGhhbmRsZXIgcHJldmVudHMgYW4gZXZlbnQgaW4gdGhlIEluZm9Cb3ggZnJvbSBiZWluZyBwYXNzZWQgb24gdG8gdGhlIG1hcC5cclxuZnVuY3Rpb24gY2FuY2VsSGFuZGxlcihldmVudCkge1xyXG4gIGV2ZW50LmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xyXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgfVxyXG59XHJcbnZhciBJbmZvQm94ID0gLyoqIEBjbGFzcyAqL2Z1bmN0aW9uICgpIHtcclxuICBmdW5jdGlvbiBJbmZvQm94KG9wdGlvbnMpIHtcclxuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHtcclxuICAgICAgb3B0aW9ucyA9IHt9O1xyXG4gICAgfVxyXG4gICAgdGhpcy5nZXRDbG9zZUNsaWNrSGFuZGxlciA9IHRoaXMuZ2V0Q2xvc2VDbGlja0hhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuY2xvc2VDbGlja0hhbmRsZXIgPSB0aGlzLmNsb3NlQ2xpY2tIYW5kbGVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmNyZWF0ZUluZm9Cb3hEaXYgPSB0aGlzLmNyZWF0ZUluZm9Cb3hEaXYuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkQ2xpY2tIYW5kbGVyID0gdGhpcy5hZGRDbGlja0hhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0Q2xvc2VCb3hJbWcgPSB0aGlzLmdldENsb3NlQm94SW1nLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldEJveFdpZHRocyA9IHRoaXMuZ2V0Qm94V2lkdGhzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNldEJveFN0eWxlID0gdGhpcy5zZXRCb3hTdHlsZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRQb3NpdGlvbiA9IHRoaXMuc2V0UG9zaXRpb24uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0UG9zaXRpb24gPSB0aGlzLmdldFBvc2l0aW9uLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnNldE9wdGlvbnMgPSB0aGlzLnNldE9wdGlvbnMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2V0Q29udGVudCA9IHRoaXMuc2V0Q29udGVudC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRWaXNpYmxlID0gdGhpcy5zZXRWaXNpYmxlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmdldENvbnRlbnQgPSB0aGlzLmdldENvbnRlbnQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZ2V0VmlzaWJsZSA9IHRoaXMuZ2V0VmlzaWJsZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zZXRaSW5kZXggPSB0aGlzLnNldFpJbmRleC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRaSW5kZXggPSB0aGlzLmdldFpJbmRleC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblJlbW92ZSA9IHRoaXMub25SZW1vdmUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMucGFuQm94ID0gdGhpcy5wYW5Cb3guYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZXh0ZW5kID0gdGhpcy5leHRlbmQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuY2xvc2UgPSB0aGlzLmNsb3NlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmRyYXcgPSB0aGlzLmRyYXcuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2hvdyA9IHRoaXMuc2hvdy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5oaWRlID0gdGhpcy5oaWRlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9wZW4gPSB0aGlzLm9wZW4uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuZXh0ZW5kKEluZm9Cb3gsIGdvb2dsZS5tYXBzLk92ZXJsYXlWaWV3KTtcclxuICAgIC8vIFN0YW5kYXJkIG9wdGlvbnMgKGluIGNvbW1vbiB3aXRoIGdvb2dsZS5tYXBzLkluZm9XaW5kb3cpOlxyXG4gICAgdGhpcy5jb250ZW50ID0gb3B0aW9ucy5jb250ZW50IHx8ICcnO1xyXG4gICAgdGhpcy5kaXNhYmxlQXV0b1BhbiA9IG9wdGlvbnMuZGlzYWJsZUF1dG9QYW4gfHwgZmFsc2U7XHJcbiAgICB0aGlzLm1heFdpZHRoID0gb3B0aW9ucy5tYXhXaWR0aCB8fCAwO1xyXG4gICAgdGhpcy5waXhlbE9mZnNldCA9IG9wdGlvbnMucGl4ZWxPZmZzZXQgfHwgbmV3IGdvb2dsZS5tYXBzLlNpemUoMCwgMCk7XHJcbiAgICB0aGlzLnBvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbiB8fCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDAsIDApO1xyXG4gICAgdGhpcy56SW5kZXggPSBvcHRpb25zLnpJbmRleCB8fCBudWxsO1xyXG4gICAgLy8gQWRkaXRpb25hbCBvcHRpb25zICh1bmlxdWUgdG8gSW5mb0JveCk6XHJcbiAgICB0aGlzLmJveENsYXNzID0gb3B0aW9ucy5ib3hDbGFzcyB8fCAnaW5mb0JveCc7XHJcbiAgICB0aGlzLmJveFN0eWxlID0gb3B0aW9ucy5ib3hTdHlsZSB8fCB7fTtcclxuICAgIHRoaXMuY2xvc2VCb3hNYXJnaW4gPSBvcHRpb25zLmNsb3NlQm94TWFyZ2luIHx8ICcycHgnO1xyXG4gICAgdGhpcy5jbG9zZUJveFVSTCA9IG9wdGlvbnMuY2xvc2VCb3hVUkwgfHwgJ2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9pbnRsL2VuX3VzL21hcGZpbGVzL2Nsb3NlLmdpZic7XHJcbiAgICBpZiAob3B0aW9ucy5jbG9zZUJveFVSTCA9PT0gJycpIHtcclxuICAgICAgdGhpcy5jbG9zZUJveFVSTCA9ICcnO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbmZvQm94Q2xlYXJhbmNlID0gb3B0aW9ucy5pbmZvQm94Q2xlYXJhbmNlIHx8IG5ldyBnb29nbGUubWFwcy5TaXplKDEsIDEpO1xyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLnZpc2libGUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5pc0hpZGRlbiA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBvcHRpb25zLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG9wdGlvbnMudmlzaWJsZSA9ICFvcHRpb25zLmlzSGlkZGVuO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmlzSGlkZGVuID0gIW9wdGlvbnMudmlzaWJsZTtcclxuICAgIHRoaXMuYWxpZ25Cb3R0b20gPSBvcHRpb25zLmFsaWduQm90dG9tIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5wYW5lID0gb3B0aW9ucy5wYW5lIHx8ICdmbG9hdFBhbmUnO1xyXG4gICAgdGhpcy5lbmFibGVFdmVudFByb3BhZ2F0aW9uID0gb3B0aW9ucy5lbmFibGVFdmVudFByb3BhZ2F0aW9uIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5kaXYgPSBudWxsO1xyXG4gICAgdGhpcy5jbG9zZUxpc3RlbmVyID0gbnVsbDtcclxuICAgIHRoaXMubW92ZUxpc3RlbmVyID0gbnVsbDtcclxuICAgIHRoaXMubWFwTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgdGhpcy5jb250ZXh0TGlzdGVuZXIgPSBudWxsO1xyXG4gICAgdGhpcy5ldmVudExpc3RlbmVycyA9IG51bGw7XHJcbiAgICB0aGlzLmZpeGVkV2lkdGhTZXQgPSBudWxsO1xyXG4gIH1cclxuICBJbmZvQm94LnByb3RvdHlwZS5jcmVhdGVJbmZvQm94RGl2ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIC8vIFRoaXMgaGFuZGxlciBpZ25vcmVzIHRoZSBjdXJyZW50IGV2ZW50IGluIHRoZSBJbmZvQm94IGFuZCBjb25kaXRpb25hbGx5IHByZXZlbnRzXHJcbiAgICAvLyB0aGUgZXZlbnQgZnJvbSBiZWluZyBwYXNzZWQgb24gdG8gdGhlIG1hcC4gSXQgaXMgdXNlZCBmb3IgdGhlIGNvbnRleHRtZW51IGV2ZW50LlxyXG4gICAgdmFyIGlnbm9yZUhhbmRsZXIgPSBmdW5jdGlvbiBpZ25vcmVIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7XHJcbiAgICAgIGlmIChldmVudC5wcmV2ZW50RGVmYXVsdCkge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFfdGhpcy5lbmFibGVFdmVudFByb3BhZ2F0aW9uKSB7XHJcbiAgICAgICAgY2FuY2VsSGFuZGxlcihldmVudCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBpZiAoIXRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMuZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIHRoaXMuc2V0Qm94U3R5bGUoKTtcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gdGhpcy5nZXRDbG9zZUJveEltZygpICsgdGhpcy5jb250ZW50O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZGl2LmlubmVySFRNTCA9IHRoaXMuZ2V0Q2xvc2VCb3hJbWcoKTtcclxuICAgICAgICB0aGlzLmRpdi5hcHBlbmRDaGlsZCh0aGlzLmNvbnRlbnQpO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBwYW5lcyA9IHRoaXMuZ2V0UGFuZXMoKTtcclxuICAgICAgaWYgKHBhbmVzICE9PSBudWxsKSB7XHJcbiAgICAgICAgcGFuZXNbdGhpcy5wYW5lXS5hcHBlbmRDaGlsZCh0aGlzLmRpdik7IC8vIEFkZCB0aGUgSW5mb0JveCBkaXYgdG8gdGhlIERPTVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuYWRkQ2xpY2tIYW5kbGVyKCk7XHJcbiAgICAgIGlmICh0aGlzLmRpdi5zdHlsZS53aWR0aCkge1xyXG4gICAgICAgIHRoaXMuZml4ZWRXaWR0aFNldCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHRoaXMubWF4V2lkdGggIT09IDAgJiYgdGhpcy5kaXYub2Zmc2V0V2lkdGggPiB0aGlzLm1heFdpZHRoKSB7XHJcbiAgICAgICAgICB0aGlzLmRpdi5zdHlsZS53aWR0aCA9IHRoaXMubWF4V2lkdGggKyAncHgnO1xyXG4gICAgICAgICAgdGhpcy5maXhlZFdpZHRoU2V0ID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGlzIG5lZWRlZCB0byBvdmVyY29tZSBwcm9ibGVtcyB3aXRoIE1TSUVcclxuICAgICAgICAgIHZhciBidyA9IHRoaXMuZ2V0Qm94V2lkdGhzKCk7XHJcbiAgICAgICAgICB0aGlzLmRpdi5zdHlsZS53aWR0aCA9IHRoaXMuZGl2Lm9mZnNldFdpZHRoIC0gYncubGVmdCAtIGJ3LnJpZ2h0ICsgJ3B4JztcclxuICAgICAgICAgIHRoaXMuZml4ZWRXaWR0aFNldCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLnBhbkJveCh0aGlzLmRpc2FibGVBdXRvUGFuKTtcclxuICAgICAgaWYgKCF0aGlzLmVuYWJsZUV2ZW50UHJvcGFnYXRpb24pIHtcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgLy8gQ2FuY2VsIGV2ZW50IHByb3BhZ2F0aW9uLlxyXG4gICAgICAgIC8vIE5vdGU6IG1vdXNlbW92ZSBub3QgaW5jbHVkZWQgKHRvIHJlc29sdmUgSXNzdWUgMTUyKVxyXG4gICAgICAgIHZhciBldmVudHMgPSBbJ21vdXNlZG93bicsICdtb3VzZW92ZXInLCAnbW91c2VvdXQnLCAnbW91c2V1cCcsICdjbGljaycsICdkYmxjbGljaycsICd0b3VjaHN0YXJ0JywgJ3RvdWNoZW5kJywgJ3RvdWNobW92ZSddO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgZXZlbnRzXzEgPSBldmVudHM7IF9pIDwgZXZlbnRzXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICB2YXIgZXZlbnRfMSA9IGV2ZW50c18xW19pXTtcclxuICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcih0aGlzLmRpdiwgZXZlbnRfMSwgY2FuY2VsSGFuZGxlcikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBHb29nbGUgYnVnIHRoYXQgY2F1c2VzIHRoZSBjdXJzb3IgdG8gY2hhbmdlIHRvIGEgcG9pbnRlclxyXG4gICAgICAgIC8vIHdoZW4gdGhlIG1vdXNlIG1vdmVzIG92ZXIgYSBtYXJrZXIgdW5kZXJuZWF0aCBJbmZvQm94LlxyXG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaChnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcih0aGlzLmRpdiwgJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGlmIChfdGhpcy5kaXYpIHtcclxuICAgICAgICAgICAgX3RoaXMuZGl2LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5jb250ZXh0TGlzdGVuZXIgPSBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcih0aGlzLmRpdiwgJ2NvbnRleHRtZW51JywgaWdub3JlSGFuZGxlcik7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIERJViBjb250YWluaW5nIHRoZSBJbmZvQm94J3MgY29udGVudCBpcyBhdHRhY2hlZCB0byB0aGUgRE9NLlxyXG4gICAgICAgKiBAbmFtZSBJbmZvQm94I2RvbXJlYWR5XHJcbiAgICAgICAqIEBldmVudFxyXG4gICAgICAgKi9cclxuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLCAnZG9tcmVhZHknKTtcclxuICAgIH1cclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLmdldENsb3NlQm94SW1nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGltZyA9ICcnO1xyXG4gICAgaWYgKHRoaXMuY2xvc2VCb3hVUkwgIT09ICcnKSB7XHJcbiAgICAgIGltZyA9ICc8aW1nIGFsdD1cIlwiJztcclxuICAgICAgaW1nICs9ICcgYXJpYS1oaWRkZW49XCJ0cnVlXCInO1xyXG4gICAgICBpbWcgKz0gXCIgc3JjPSdcIiArIHRoaXMuY2xvc2VCb3hVUkwgKyBcIidcIjtcclxuICAgICAgaW1nICs9ICcgYWxpZ249cmlnaHQnOyAvLyBEbyB0aGlzIGJlY2F1c2UgT3BlcmEgY2hva2VzIG9uIHN0eWxlPSdmbG9hdDogcmlnaHQ7J1xyXG4gICAgICBpbWcgKz0gXCIgc3R5bGU9J1wiO1xyXG4gICAgICBpbWcgKz0gJyBwb3NpdGlvbjogcmVsYXRpdmU7JzsgLy8gUmVxdWlyZWQgYnkgTVNJRVxyXG4gICAgICBpbWcgKz0gJyBjdXJzb3I6IHBvaW50ZXI7JztcclxuICAgICAgaW1nICs9ICcgbWFyZ2luOiAnICsgdGhpcy5jbG9zZUJveE1hcmdpbiArICc7JztcclxuICAgICAgaW1nICs9IFwiJz5cIjtcclxuICAgIH1cclxuICAgIHJldHVybiBpbWc7XHJcbiAgfTtcclxuICBJbmZvQm94LnByb3RvdHlwZS5hZGRDbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmNsb3NlTGlzdGVuZXIgPSB0aGlzLmRpdiAmJiB0aGlzLmRpdi5maXJzdENoaWxkICYmIHRoaXMuY2xvc2VCb3hVUkwgIT09ICcnID8gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIodGhpcy5kaXYuZmlyc3RDaGlsZCwgJ2NsaWNrJywgdGhpcy5nZXRDbG9zZUNsaWNrSGFuZGxlcigpKSA6IG51bGw7XHJcbiAgfTtcclxuICBJbmZvQm94LnByb3RvdHlwZS5jbG9zZUNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgLy8gMS4wLjMgZml4OiBBbHdheXMgcHJldmVudCBwcm9wYWdhdGlvbiBvZiBhIGNsb3NlIGJveCBjbGljayB0byB0aGUgbWFwOlxyXG4gICAgZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24pIHtcclxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgSW5mb0JveCdzIGNsb3NlIGJveCBpcyBjbGlja2VkLlxyXG4gICAgICogQG5hbWUgSW5mb0JveCNjbG9zZWNsaWNrXHJcbiAgICAgKiBAZXZlbnRcclxuICAgICAqL1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLCAnY2xvc2VjbGljaycpO1xyXG4gICAgdGhpcy5jbG9zZSgpO1xyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuZ2V0Q2xvc2VDbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jbG9zZUNsaWNrSGFuZGxlcjtcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLnBhbkJveCA9IGZ1bmN0aW9uIChkaXNhYmxlUGFuKSB7XHJcbiAgICBpZiAodGhpcy5kaXYgJiYgIWRpc2FibGVQYW4pIHtcclxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xyXG4gICAgICAvLyBPbmx5IHBhbiBpZiBhdHRhY2hlZCB0byBtYXAsIG5vdCBwYW5vcmFtYVxyXG4gICAgICBpZiAobWFwIGluc3RhbmNlb2YgZ29vZ2xlLm1hcHMuTWFwKSB7XHJcbiAgICAgICAgdmFyIHhPZmZzZXQgPSAwO1xyXG4gICAgICAgIHZhciB5T2Zmc2V0ID0gMDtcclxuICAgICAgICB2YXIgYm91bmRzID0gbWFwLmdldEJvdW5kcygpO1xyXG4gICAgICAgIGlmIChib3VuZHMgJiYgIWJvdW5kcy5jb250YWlucyh0aGlzLnBvc2l0aW9uKSkge1xyXG4gICAgICAgICAgLy8gTWFya2VyIG5vdCBpbiB2aXNpYmxlIGFyZWEgb2YgbWFwLCBzbyBzZXQgY2VudGVyXHJcbiAgICAgICAgICAvLyBvZiBtYXAgdG8gdGhlIG1hcmtlciBwb3NpdGlvbiBmaXJzdC5cclxuICAgICAgICAgIG1hcC5zZXRDZW50ZXIodGhpcy5wb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtYXBEaXYgPSBtYXAuZ2V0RGl2KCk7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB2YXIgbWFwV2lkdGggPSBtYXBEaXYub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB2YXIgbWFwSGVpZ2h0ID0gbWFwRGl2Lm9mZnNldEhlaWdodDtcclxuICAgICAgICB2YXIgaXdPZmZzZXRYID0gdGhpcy5waXhlbE9mZnNldC53aWR0aDtcclxuICAgICAgICB2YXIgaXdPZmZzZXRZID0gdGhpcy5waXhlbE9mZnNldC5oZWlnaHQ7XHJcbiAgICAgICAgdmFyIGl3V2lkdGggPSB0aGlzLmRpdi5vZmZzZXRXaWR0aDtcclxuICAgICAgICB2YXIgaXdIZWlnaHQgPSB0aGlzLmRpdi5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgICAgdmFyIHBhZFggPSB0aGlzLmluZm9Cb3hDbGVhcmFuY2Uud2lkdGg7XHJcbiAgICAgICAgdmFyIHBhZFkgPSB0aGlzLmluZm9Cb3hDbGVhcmFuY2UuaGVpZ2h0O1xyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgdmFyIHByb2plY3Rpb24gPSB0aGlzLmdldFByb2plY3Rpb24oKTtcclxuICAgICAgICB2YXIgcGl4UG9zaXRpb24gPSBwcm9qZWN0aW9uLmZyb21MYXRMbmdUb0NvbnRhaW5lclBpeGVsKHRoaXMucG9zaXRpb24pO1xyXG4gICAgICAgIGlmIChwaXhQb3NpdGlvbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgaWYgKHBpeFBvc2l0aW9uLnggPCAtaXdPZmZzZXRYICsgcGFkWCkge1xyXG4gICAgICAgICAgICB4T2Zmc2V0ID0gcGl4UG9zaXRpb24ueCArIGl3T2Zmc2V0WCAtIHBhZFg7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHBpeFBvc2l0aW9uLnggKyBpd1dpZHRoICsgaXdPZmZzZXRYICsgcGFkWCA+IG1hcFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHhPZmZzZXQgPSBwaXhQb3NpdGlvbi54ICsgaXdXaWR0aCArIGl3T2Zmc2V0WCArIHBhZFggLSBtYXBXaWR0aDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmICh0aGlzLmFsaWduQm90dG9tKSB7XHJcbiAgICAgICAgICAgIGlmIChwaXhQb3NpdGlvbi55IDwgLWl3T2Zmc2V0WSArIHBhZFkgKyBpd0hlaWdodCkge1xyXG4gICAgICAgICAgICAgIHlPZmZzZXQgPSBwaXhQb3NpdGlvbi55ICsgaXdPZmZzZXRZIC0gcGFkWSAtIGl3SGVpZ2h0O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpeFBvc2l0aW9uLnkgKyBpd09mZnNldFkgKyBwYWRZID4gbWFwSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgeU9mZnNldCA9IHBpeFBvc2l0aW9uLnkgKyBpd09mZnNldFkgKyBwYWRZIC0gbWFwSGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAocGl4UG9zaXRpb24ueSA8IC1pd09mZnNldFkgKyBwYWRZKSB7XHJcbiAgICAgICAgICAgICAgeU9mZnNldCA9IHBpeFBvc2l0aW9uLnkgKyBpd09mZnNldFkgLSBwYWRZO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBpeFBvc2l0aW9uLnkgKyBpd0hlaWdodCArIGl3T2Zmc2V0WSArIHBhZFkgPiBtYXBIZWlnaHQpIHtcclxuICAgICAgICAgICAgICB5T2Zmc2V0ID0gcGl4UG9zaXRpb24ueSArIGl3SGVpZ2h0ICsgaXdPZmZzZXRZICsgcGFkWSAtIG1hcEhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoISh4T2Zmc2V0ID09PSAwICYmIHlPZmZzZXQgPT09IDApKSB7XHJcbiAgICAgICAgICAvLyBNb3ZlIHRoZSBtYXAgdG8gdGhlIHNoaWZ0ZWQgY2VudGVyLlxyXG4gICAgICAgICAgbWFwLnBhbkJ5KHhPZmZzZXQsIHlPZmZzZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuc2V0Qm94U3R5bGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAodGhpcy5kaXYpIHtcclxuICAgICAgLy8gQXBwbHkgc3R5bGUgdmFsdWVzIGZyb20gdGhlIHN0eWxlIHNoZWV0IGRlZmluZWQgaW4gdGhlIGJveENsYXNzIHBhcmFtZXRlcjpcclxuICAgICAgdGhpcy5kaXYuY2xhc3NOYW1lID0gdGhpcy5ib3hDbGFzcztcclxuICAgICAgLy8gQ2xlYXIgZXhpc3RpbmcgaW5saW5lIHN0eWxlIHZhbHVlczpcclxuICAgICAgdGhpcy5kaXYuc3R5bGUuY3NzVGV4dCA9ICcnO1xyXG4gICAgICAvLyBBcHBseSBzdHlsZSB2YWx1ZXMgZGVmaW5lZCBpbiB0aGUgYm94U3R5bGUgcGFyYW1ldGVyOlxyXG4gICAgICB2YXIgYm94U3R5bGUgPSB0aGlzLmJveFN0eWxlO1xyXG4gICAgICBmb3IgKHZhciBpIGluIGJveFN0eWxlKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChib3hTdHlsZSwgaSkpIHtcclxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgIHRoaXMuZGl2LnN0eWxlW2ldID0gYm94U3R5bGVbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIEZpeCBmb3IgaU9TIGRpc2FwcGVhcmluZyBJbmZvQm94IHByb2JsZW1cclxuICAgICAgLy8gU2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTIyOTUzNS9nb29nbGUtbWFwcy1tYXJrZXJzLWRpc2FwcGVhci1hdC1jZXJ0YWluLXpvb20tbGV2ZWwtb25seS1vbi1pcGhvbmUtaXBhZFxyXG4gICAgICB0aGlzLmRpdi5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlWigwKSc7XHJcbiAgICAgIC8vIEZpeCB1cCBvcGFjaXR5IHN0eWxlIGZvciBiZW5lZml0IG9mIE1TSUVcclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmRpdi5zdHlsZS5vcGFjaXR5ICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLmRpdi5zdHlsZS5vcGFjaXR5ICE9PSAnJykge1xyXG4gICAgICAgIC8vIFNlZSBodHRwOi8vd3d3LnF1aXJrc21vZGUub3JnL2Nzcy9vcGFjaXR5Lmh0bWxcclxuICAgICAgICB2YXIgb3BhY2l0eSA9IHBhcnNlRmxvYXQodGhpcy5kaXYuc3R5bGUub3BhY2l0eSB8fCAnJyk7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB0aGlzLmRpdi5zdHlsZS5tc0ZpbHRlciA9ICdcInByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYShPcGFjaXR5PScgKyBvcGFjaXR5ICogMTAwICsgJylcIic7XHJcbiAgICAgICAgdGhpcy5kaXYuc3R5bGUuZmlsdGVyID0gJ2FscGhhKG9wYWNpdHk9JyArIG9wYWNpdHkgKiAxMDAgKyAnKSc7XHJcbiAgICAgIH1cclxuICAgICAgLy8gQXBwbHkgcmVxdWlyZWQgc3R5bGVzXHJcbiAgICAgIHRoaXMuZGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgdGhpcy5kaXYuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gICAgICBpZiAodGhpcy56SW5kZXggIT09IG51bGwpIHtcclxuICAgICAgICB0aGlzLmRpdi5zdHlsZS56SW5kZXggPSB0aGlzLnpJbmRleCArICcnO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghdGhpcy5kaXYuc3R5bGUub3ZlcmZsb3cpIHtcclxuICAgICAgICB0aGlzLmRpdi5zdHlsZS5vdmVyZmxvdyA9ICdhdXRvJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuZ2V0Qm94V2lkdGhzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGJ3ID0ge1xyXG4gICAgICB0b3A6IDAsXHJcbiAgICAgIGJvdHRvbTogMCxcclxuICAgICAgbGVmdDogMCxcclxuICAgICAgcmlnaHQ6IDBcclxuICAgIH07XHJcbiAgICBpZiAoIXRoaXMuZGl2KSB7XHJcbiAgICAgIHJldHVybiBidztcclxuICAgIH1cclxuICAgIGlmIChkb2N1bWVudC5kZWZhdWx0Vmlldykge1xyXG4gICAgICB2YXIgb3duZXJEb2N1bWVudCA9IHRoaXMuZGl2Lm93bmVyRG9jdW1lbnQ7XHJcbiAgICAgIHZhciBjb21wdXRlZFN0eWxlID0gb3duZXJEb2N1bWVudCAmJiBvd25lckRvY3VtZW50LmRlZmF1bHRWaWV3ID8gb3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZGl2LCAnJykgOiBudWxsO1xyXG4gICAgICBpZiAoY29tcHV0ZWRTdHlsZSkge1xyXG4gICAgICAgIC8vIFRoZSBjb21wdXRlZCBzdHlsZXMgYXJlIGFsd2F5cyBpbiBwaXhlbCB1bml0cyAoZ29vZCEpXHJcbiAgICAgICAgYncudG9wID0gcGFyc2VJbnQoY29tcHV0ZWRTdHlsZS5ib3JkZXJUb3BXaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgICAgYncuYm90dG9tID0gcGFyc2VJbnQoY29tcHV0ZWRTdHlsZS5ib3JkZXJCb3R0b21XaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgICAgYncubGVmdCA9IHBhcnNlSW50KGNvbXB1dGVkU3R5bGUuYm9yZGVyTGVmdFdpZHRoIHx8ICcnLCAxMCkgfHwgMDtcclxuICAgICAgICBidy5yaWdodCA9IHBhcnNlSW50KGNvbXB1dGVkU3R5bGUuYm9yZGVyUmlnaHRXaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlIC8vIE1TSUVcclxuICAgICkge1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgdmFyIGN1cnJlbnRTdHlsZSA9IHRoaXMuZGl2LmN1cnJlbnRTdHlsZTtcclxuICAgICAgaWYgKGN1cnJlbnRTdHlsZSkge1xyXG4gICAgICAgIC8vIFRoZSBjdXJyZW50IHN0eWxlcyBtYXkgbm90IGJlIGluIHBpeGVsIHVuaXRzLCBidXQgYXNzdW1lIHRoZXkgYXJlIChiYWQhKVxyXG4gICAgICAgIGJ3LnRvcCA9IHBhcnNlSW50KGN1cnJlbnRTdHlsZS5ib3JkZXJUb3BXaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgICAgYncuYm90dG9tID0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlckJvdHRvbVdpZHRoIHx8ICcnLCAxMCkgfHwgMDtcclxuICAgICAgICBidy5sZWZ0ID0gcGFyc2VJbnQoY3VycmVudFN0eWxlLmJvcmRlckxlZnRXaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgICAgYncucmlnaHQgPSBwYXJzZUludChjdXJyZW50U3R5bGUuYm9yZGVyUmlnaHRXaWR0aCB8fCAnJywgMTApIHx8IDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBidztcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHRoaXMuZGl2ICYmIHRoaXMuZGl2LnBhcmVudE5vZGUpIHtcclxuICAgICAgdGhpcy5kaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRpdik7XHJcbiAgICAgIHRoaXMuZGl2ID0gbnVsbDtcclxuICAgIH1cclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmNyZWF0ZUluZm9Cb3hEaXYoKTtcclxuICAgIGlmICh0aGlzLmRpdikge1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgdmFyIHByb2plY3Rpb24gPSB0aGlzLmdldFByb2plY3Rpb24oKTtcclxuICAgICAgdmFyIHBpeFBvc2l0aW9uID0gcHJvamVjdGlvbi5mcm9tTGF0TG5nVG9EaXZQaXhlbCh0aGlzLnBvc2l0aW9uKTtcclxuICAgICAgaWYgKHBpeFBvc2l0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5kaXYuc3R5bGUubGVmdCA9IHBpeFBvc2l0aW9uLnggKyB0aGlzLnBpeGVsT2Zmc2V0LndpZHRoICsgJ3B4JztcclxuICAgICAgICBpZiAodGhpcy5hbGlnbkJvdHRvbSkge1xyXG4gICAgICAgICAgdGhpcy5kaXYuc3R5bGUuYm90dG9tID0gLShwaXhQb3NpdGlvbi55ICsgdGhpcy5waXhlbE9mZnNldC5oZWlnaHQpICsgJ3B4JztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5kaXYuc3R5bGUudG9wID0gcGl4UG9zaXRpb24ueSArIHRoaXMucGl4ZWxPZmZzZXQuaGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuaXNIaWRkZW4pIHtcclxuICAgICAgICB0aGlzLmRpdi5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5kaXYuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7XHJcbiAgICAgIG9wdGlvbnMgPSB7fTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ib3hDbGFzcyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgLy8gTXVzdCBiZSBmaXJzdFxyXG4gICAgICB0aGlzLmJveENsYXNzID0gb3B0aW9ucy5ib3hDbGFzcztcclxuICAgICAgdGhpcy5zZXRCb3hTdHlsZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmJveFN0eWxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAvLyBNdXN0IGJlIHNlY29uZFxyXG4gICAgICB0aGlzLmJveFN0eWxlID0gb3B0aW9ucy5ib3hTdHlsZTtcclxuICAgICAgdGhpcy5zZXRCb3hTdHlsZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmNvbnRlbnQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuc2V0Q29udGVudChvcHRpb25zLmNvbnRlbnQpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmRpc2FibGVBdXRvUGFuICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aGlzLmRpc2FibGVBdXRvUGFuID0gb3B0aW9ucy5kaXNhYmxlQXV0b1BhbjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhXaWR0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5tYXhXaWR0aCA9IG9wdGlvbnMubWF4V2lkdGg7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMucGl4ZWxPZmZzZXQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMucGl4ZWxPZmZzZXQgPSBvcHRpb25zLnBpeGVsT2Zmc2V0O1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmFsaWduQm90dG9tICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aGlzLmFsaWduQm90dG9tID0gb3B0aW9ucy5hbGlnbkJvdHRvbTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5wb3NpdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5zZXRQb3NpdGlvbihvcHRpb25zLnBvc2l0aW9uKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy56SW5kZXggIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuc2V0WkluZGV4KG9wdGlvbnMuekluZGV4KTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5jbG9zZUJveE1hcmdpbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5jbG9zZUJveE1hcmdpbiA9IG9wdGlvbnMuY2xvc2VCb3hNYXJnaW47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuY2xvc2VCb3hVUkwgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuY2xvc2VCb3hVUkwgPSBvcHRpb25zLmNsb3NlQm94VVJMO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLmluZm9Cb3hDbGVhcmFuY2UgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuaW5mb0JveENsZWFyYW5jZSA9IG9wdGlvbnMuaW5mb0JveENsZWFyYW5jZTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5pc0hpZGRlbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5pc0hpZGRlbiA9IG9wdGlvbnMuaXNIaWRkZW47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMudmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5pc0hpZGRlbiA9ICFvcHRpb25zLnZpc2libGU7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMuZW5hYmxlRXZlbnRQcm9wYWdhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5lbmFibGVFdmVudFByb3BhZ2F0aW9uID0gb3B0aW9ucy5lbmFibGVFdmVudFByb3BhZ2F0aW9uO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMuZHJhdygpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uIChjb250ZW50KSB7XHJcbiAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIGlmICh0aGlzLmNsb3NlTGlzdGVuZXIpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcih0aGlzLmNsb3NlTGlzdGVuZXIpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VMaXN0ZW5lciA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgLy8gT2RkIGNvZGUgcmVxdWlyZWQgdG8gbWFrZSB0aGluZ3Mgd29yayB3aXRoIE1TSUUuXHJcbiAgICAgIGlmICghdGhpcy5maXhlZFdpZHRoU2V0KSB7XHJcbiAgICAgICAgdGhpcy5kaXYuc3R5bGUud2lkdGggPSAnJztcclxuICAgICAgfVxyXG4gICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gdGhpcy5nZXRDbG9zZUJveEltZygpICsgY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmRpdi5pbm5lckhUTUwgPSB0aGlzLmdldENsb3NlQm94SW1nKCk7XHJcbiAgICAgICAgdGhpcy5kaXYuYXBwZW5kQ2hpbGQoY29udGVudCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gUGVydmVyc2UgY29kZSByZXF1aXJlZCB0byBtYWtlIHRoaW5ncyB3b3JrIHdpdGggTVNJRS5cclxuICAgICAgLy8gKEVuc3VyZXMgdGhlIGNsb3NlIGJveCBkb2VzLCBpbiBmYWN0LCBmbG9hdCB0byB0aGUgcmlnaHQuKVxyXG4gICAgICBpZiAoIXRoaXMuZml4ZWRXaWR0aFNldCkge1xyXG4gICAgICAgIHRoaXMuZGl2LnN0eWxlLndpZHRoID0gdGhpcy5kaXYub2Zmc2V0V2lkdGggKyAncHgnO1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIHRoaXMuZGl2LmlubmVySFRNTCA9IHRoaXMuZ2V0Q2xvc2VCb3hJbWcoKSArIGNvbnRlbnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZGl2LmlubmVySFRNTCA9IHRoaXMuZ2V0Q2xvc2VCb3hJbWcoKTtcclxuICAgICAgICAgIHRoaXMuZGl2LmFwcGVuZENoaWxkKGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLmFkZENsaWNrSGFuZGxlcigpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gdGhlIGNvbnRlbnQgb2YgdGhlIEluZm9Cb3ggY2hhbmdlcy5cclxuICAgICAqIEBuYW1lIEluZm9Cb3gjY29udGVudF9jaGFuZ2VkXHJcbiAgICAgKiBAZXZlbnRcclxuICAgICAqL1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLCAnY29udGVudF9jaGFuZ2VkJyk7XHJcbiAgfTtcclxuICBJbmZvQm94LnByb3RvdHlwZS5zZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChsYXRMbmcpIHtcclxuICAgIHRoaXMucG9zaXRpb24gPSBsYXRMbmc7XHJcbiAgICBpZiAodGhpcy5kaXYpIHtcclxuICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgcG9zaXRpb24gb2YgdGhlIEluZm9Cb3ggY2hhbmdlcy5cclxuICAgICAqIEBuYW1lIEluZm9Cb3gjcG9zaXRpb25fY2hhbmdlZFxyXG4gICAgICogQGV2ZW50XHJcbiAgICAgKi9cclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodGhpcywgJ3Bvc2l0aW9uX2NoYW5nZWQnKTtcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLnNldFZpc2libGUgPSBmdW5jdGlvbiAoaXNWaXNpYmxlKSB7XHJcbiAgICB0aGlzLmlzSGlkZGVuID0gIWlzVmlzaWJsZTtcclxuICAgIGlmICh0aGlzLmRpdikge1xyXG4gICAgICB0aGlzLmRpdi5zdHlsZS52aXNpYmlsaXR5ID0gdGhpcy5pc0hpZGRlbiA/ICdoaWRkZW4nIDogJ3Zpc2libGUnO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuc2V0WkluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICB0aGlzLnpJbmRleCA9IGluZGV4O1xyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMuZGl2LnN0eWxlLnpJbmRleCA9IGluZGV4ICsgJyc7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGUgekluZGV4IG9mIHRoZSBJbmZvQm94IGNoYW5nZXMuXHJcbiAgICAgKiBAbmFtZSBJbmZvQm94I3ppbmRleF9jaGFuZ2VkXHJcbiAgICAgKiBAZXZlbnRcclxuICAgICAqL1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih0aGlzLCAnemluZGV4X2NoYW5nZWQnKTtcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLmdldENvbnRlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250ZW50O1xyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjtcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLmdldFpJbmRleCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLnpJbmRleDtcclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLmdldFZpc2libGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbWFwID0gdGhpcy5nZXRNYXAoKTtcclxuICAgIHJldHVybiB0eXBlb2YgbWFwID09PSAndW5kZWZpbmVkJyB8fCBtYXAgPT09IG51bGwgPyBmYWxzZSA6ICF0aGlzLmlzSGlkZGVuO1xyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuaXNIaWRkZW4gPSBmYWxzZTtcclxuICAgIGlmICh0aGlzLmRpdikge1xyXG4gICAgICB0aGlzLmRpdi5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgSW5mb0JveC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuaXNIaWRkZW4gPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMuZGl2LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAgIH1cclxuICB9O1xyXG4gIEluZm9Cb3gucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAobWFwLCBhbmNob3IpIHtcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICBpZiAoYW5jaG9yKSB7XHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICB0aGlzLnBvc2l0aW9uID0gYW5jaG9yLmdldFBvc2l0aW9uKCk7XHJcbiAgICAgIHRoaXMubW92ZUxpc3RlbmVyID0gZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoYW5jaG9yLCAncG9zaXRpb25fY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHZhciBwb3NpdGlvbiA9IGFuY2hvci5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIF90aGlzLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMubWFwTGlzdGVuZXIgPSBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihhbmNob3IsICdtYXBfY2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIF90aGlzLnNldE1hcChhbmNob3IubWFwKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldE1hcChtYXApO1xyXG4gICAgaWYgKHRoaXMuZGl2KSB7XHJcbiAgICAgIHRoaXMucGFuQm94KCk7XHJcbiAgICB9XHJcbiAgfTtcclxuICBJbmZvQm94LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh0aGlzLmNsb3NlTGlzdGVuZXIpIHtcclxuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIodGhpcy5jbG9zZUxpc3RlbmVyKTtcclxuICAgICAgdGhpcy5jbG9zZUxpc3RlbmVyID0gbnVsbDtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmV2ZW50TGlzdGVuZXJzKSB7XHJcbiAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmV2ZW50TGlzdGVuZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHZhciBldmVudExpc3RlbmVyID0gX2FbX2ldO1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGV2ZW50TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubW92ZUxpc3RlbmVyKSB7XHJcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHRoaXMubW92ZUxpc3RlbmVyKTtcclxuICAgICAgdGhpcy5tb3ZlTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubWFwTGlzdGVuZXIpIHtcclxuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIodGhpcy5tYXBMaXN0ZW5lcik7XHJcbiAgICAgIHRoaXMubWFwTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY29udGV4dExpc3RlbmVyKSB7XHJcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHRoaXMuY29udGV4dExpc3RlbmVyKTtcclxuICAgICAgdGhpcy5jb250ZXh0TGlzdGVuZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgdGhpcy5zZXRNYXAobnVsbCk7XHJcbiAgfTtcclxuICBJbmZvQm94LnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAob2JqMSwgb2JqMikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIGFwcGx5RXh0ZW5kKG9iamVjdCkge1xyXG4gICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBvYmplY3QucHJvdG90eXBlKSB7XHJcbiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGhpcywgcHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICB0aGlzLnByb3RvdHlwZVtwcm9wZXJ0eV0gPSBvYmplY3QucHJvdG90eXBlW3Byb3BlcnR5XTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LmFwcGx5KG9iajEsIFtvYmoyXSk7XHJcbiAgfTtcclxuICByZXR1cm4gSW5mb0JveDtcclxufSgpO1xyXG5cclxudmFyIF9leGNsdWRlZCA9IFtcInBvc2l0aW9uXCJdLFxyXG4gIF9leGNsdWRlZDIgPSBbXCJwb3NpdGlvblwiXTtcclxuZnVuY3Rpb24gb3duS2V5cyRiKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH1cclxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCRiKGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMkYihPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IF9kZWZpbmVQcm9wZXJ0eShlLCByLCB0W3JdKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMkYihPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfVxyXG52YXIgZXZlbnRNYXAkZCA9IHtcclxuICBvbkNsb3NlQ2xpY2s6ICdjbG9zZWNsaWNrJyxcclxuICBvbkNvbnRlbnRDaGFuZ2VkOiAnY29udGVudF9jaGFuZ2VkJyxcclxuICBvbkRvbVJlYWR5OiAnZG9tcmVhZHknLFxyXG4gIG9uUG9zaXRpb25DaGFuZ2VkOiAncG9zaXRpb25fY2hhbmdlZCcsXHJcbiAgb25aaW5kZXhDaGFuZ2VkOiAnemluZGV4X2NoYW5nZWQnXHJcbn07XHJcbnZhciB1cGRhdGVyTWFwJGQgPSB7XHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHBvc2l0aW9uKGluc3RhbmNlLCBwb3NpdGlvbikge1xyXG4gICAgaWYgKHBvc2l0aW9uIGluc3RhbmNlb2YgZ29vZ2xlLm1hcHMuTGF0TG5nKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFBvc2l0aW9uKG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zaXRpb24ubGF0LCBwb3NpdGlvbi5sbmcpKTtcclxuICAgIH1cclxuICB9LFxyXG4gIHZpc2libGUoaW5zdGFuY2UsIHZpc2libGUpIHtcclxuICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgfSxcclxuICB6SW5kZXgoaW5zdGFuY2UsIHpJbmRleCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgfVxyXG59O1xyXG52YXIgZGVmYXVsdE9wdGlvbnMkMyA9IHt9O1xyXG5mdW5jdGlvbiBJbmZvQm94RnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIGNoaWxkcmVuLFxyXG4gICAgYW5jaG9yLFxyXG4gICAgb3B0aW9ucyxcclxuICAgIHBvc2l0aW9uLFxyXG4gICAgekluZGV4LFxyXG4gICAgb25DbG9zZUNsaWNrLFxyXG4gICAgb25Eb21SZWFkeSxcclxuICAgIG9uQ29udGVudENoYW5nZWQsXHJcbiAgICBvblBvc2l0aW9uQ2hhbmdlZCxcclxuICAgIG9uWmluZGV4Q2hhbmdlZCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIHZhciBbaW5zdGFuY2UsIHNldEluc3RhbmNlXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbY2xvc2VDbGlja0xpc3RlbmVyLCBzZXRDbG9zZUNsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkb21SZWFkeUNsaWNrTGlzdGVuZXIsIHNldERvbVJlYWR5Q2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NvbnRlbnRDaGFuZ2VkQ2xpY2tMaXN0ZW5lciwgc2V0Q29udGVudENoYW5nZWRDbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcG9zaXRpb25DaGFuZ2VkQ2xpY2tMaXN0ZW5lciwgc2V0UG9zaXRpb25DaGFuZ2VkQ2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW3pJbmRleENoYW5nZWRDbGlja0xpc3RlbmVyLCBzZXRaaW5kZXhDaGFuZ2VkQ2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgY29udGFpbmVyRWxlbWVudFJlZiA9IHVzZVJlZihudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAobWFwICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgIGlmIChhbmNob3IpIHtcclxuICAgICAgICBpbnN0YW5jZS5vcGVuKG1hcCwgYW5jaG9yKTtcclxuICAgICAgfSBlbHNlIGlmIChpbnN0YW5jZS5nZXRQb3NpdGlvbigpKSB7XHJcbiAgICAgICAgaW5zdGFuY2Uub3BlbihtYXApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSwgW21hcCwgaW5zdGFuY2UsIGFuY2hvcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgb3B0aW9uc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAocG9zaXRpb24gJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgdmFyIHBvc2l0aW9uTGF0TG5nID0gcG9zaXRpb24gaW5zdGFuY2VvZiBnb29nbGUubWFwcy5MYXRMbmcgPyBwb3NpdGlvbiA6XHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvc2l0aW9uLmxhdCwgcG9zaXRpb24ubG5nKTtcclxuICAgICAgaW5zdGFuY2Uuc2V0UG9zaXRpb24ocG9zaXRpb25MYXRMbmcpO1xyXG4gICAgfVxyXG4gIH0sIFtwb3NpdGlvbl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHpJbmRleCA9PT0gJ251bWJlcicgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgICB9XHJcbiAgfSwgW3pJbmRleF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25DbG9zZUNsaWNrKSB7XHJcbiAgICAgIGlmIChjbG9zZUNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbG9zZUNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsb3NlQ2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2Nsb3NlY2xpY2snLCBvbkNsb3NlQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25DbG9zZUNsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRvbVJlYWR5KSB7XHJcbiAgICAgIGlmIChkb21SZWFkeUNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkb21SZWFkeUNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERvbVJlYWR5Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RvbXJlYWR5Jywgb25Eb21SZWFkeSkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRvbVJlYWR5XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkNvbnRlbnRDaGFuZ2VkKSB7XHJcbiAgICAgIGlmIChjb250ZW50Q2hhbmdlZENsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjb250ZW50Q2hhbmdlZENsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENvbnRlbnRDaGFuZ2VkQ2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2NvbnRlbnRfY2hhbmdlZCcsIG9uQ29udGVudENoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25Db250ZW50Q2hhbmdlZF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Qb3NpdGlvbkNoYW5nZWQpIHtcclxuICAgICAgaWYgKHBvc2l0aW9uQ2hhbmdlZENsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihwb3NpdGlvbkNoYW5nZWRDbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRQb3NpdGlvbkNoYW5nZWRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncG9zaXRpb25fY2hhbmdlZCcsIG9uUG9zaXRpb25DaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uUG9zaXRpb25DaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblppbmRleENoYW5nZWQpIHtcclxuICAgICAgaWYgKHpJbmRleENoYW5nZWRDbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoekluZGV4Q2hhbmdlZENsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFppbmRleENoYW5nZWRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnemluZGV4X2NoYW5nZWQnLCBvblppbmRleENoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25aaW5kZXhDaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChtYXApIHtcclxuICAgICAgdmFyIF9yZWYyID0gb3B0aW9ucyB8fCBkZWZhdWx0T3B0aW9ucyQzLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHBvc2l0aW9uOiBfcG9zaXRpb25cclxuICAgICAgICB9ID0gX3JlZjIsXHJcbiAgICAgICAgaW5mb0JveE9wdGlvbnMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX3JlZjIsIF9leGNsdWRlZCk7XHJcbiAgICAgIHZhciBwb3NpdGlvbkxhdExuZztcclxuICAgICAgaWYgKF9wb3NpdGlvbiAmJiAhKF9wb3NpdGlvbiBpbnN0YW5jZW9mIGdvb2dsZS5tYXBzLkxhdExuZykpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHBvc2l0aW9uTGF0TG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhfcG9zaXRpb24ubGF0LCBfcG9zaXRpb24ubG5nKTtcclxuICAgICAgfVxyXG4gICAgICB2YXIgaW5mb0JveCA9IG5ldyBJbmZvQm94KF9vYmplY3RTcHJlYWQkYihfb2JqZWN0U3ByZWFkJGIoe30sIGluZm9Cb3hPcHRpb25zKSwgcG9zaXRpb25MYXRMbmcgPyB7XHJcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uTGF0TG5nXHJcbiAgICAgIH0gOiB7fSkpO1xyXG4gICAgICBjb250YWluZXJFbGVtZW50UmVmLmN1cnJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgc2V0SW5zdGFuY2UoaW5mb0JveCk7XHJcbiAgICAgIGlmIChvbkNsb3NlQ2xpY2spIHtcclxuICAgICAgICBzZXRDbG9zZUNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5mb0JveCwgJ2Nsb3NlY2xpY2snLCBvbkNsb3NlQ2xpY2spKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Eb21SZWFkeSkge1xyXG4gICAgICAgIHNldERvbVJlYWR5Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbmZvQm94LCAnZG9tcmVhZHknLCBvbkRvbVJlYWR5KSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9uQ29udGVudENoYW5nZWQpIHtcclxuICAgICAgICBzZXRDb250ZW50Q2hhbmdlZENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5mb0JveCwgJ2NvbnRlbnRfY2hhbmdlZCcsIG9uQ29udGVudENoYW5nZWQpKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Qb3NpdGlvbkNoYW5nZWQpIHtcclxuICAgICAgICBzZXRQb3NpdGlvbkNoYW5nZWRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluZm9Cb3gsICdwb3NpdGlvbl9jaGFuZ2VkJywgb25Qb3NpdGlvbkNoYW5nZWQpKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25aaW5kZXhDaGFuZ2VkKSB7XHJcbiAgICAgICAgc2V0WmluZGV4Q2hhbmdlZENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5mb0JveCwgJ3ppbmRleF9jaGFuZ2VkJywgb25aaW5kZXhDaGFuZ2VkKSk7XHJcbiAgICAgIH1cclxuICAgICAgaW5mb0JveC5zZXRDb250ZW50KGNvbnRhaW5lckVsZW1lbnRSZWYuY3VycmVudCk7XHJcbiAgICAgIGlmIChhbmNob3IpIHtcclxuICAgICAgICBpbmZvQm94Lm9wZW4obWFwLCBhbmNob3IpO1xyXG4gICAgICB9IGVsc2UgaWYgKGluZm9Cb3guZ2V0UG9zaXRpb24oKSkge1xyXG4gICAgICAgIGluZm9Cb3gub3BlbihtYXApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGludmFyaWFudChmYWxzZSwgJ1lvdSBtdXN0IHByb3ZpZGUgZWl0aGVyIGFuIGFuY2hvciBvciBhIHBvc2l0aW9uIHByb3AgZm9yIDxJbmZvQm94Pi4nKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Mb2FkKSB7XHJcbiAgICAgICAgb25Mb2FkKGluZm9Cb3gpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgICBpZiAoY2xvc2VDbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbG9zZUNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY29udGVudENoYW5nZWRDbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjb250ZW50Q2hhbmdlZENsaWNrTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZG9tUmVhZHlDbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkb21SZWFkeUNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocG9zaXRpb25DaGFuZ2VkQ2xpY2tMaXN0ZW5lcikge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocG9zaXRpb25DaGFuZ2VkQ2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh6SW5kZXhDaGFuZ2VkQ2xpY2tMaXN0ZW5lcikge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoekluZGV4Q2hhbmdlZENsaWNrTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgICBvblVubW91bnQoaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4gY29udGFpbmVyRWxlbWVudFJlZi5jdXJyZW50ID8gY3JlYXRlUG9ydGFsKENoaWxkcmVuLm9ubHkoY2hpbGRyZW4pLCBjb250YWluZXJFbGVtZW50UmVmLmN1cnJlbnQpIDogbnVsbDtcclxufVxyXG52YXIgSW5mb0JveEYgPSBtZW1vKEluZm9Cb3hGdW5jdGlvbmFsKTtcclxuY2xhc3MgSW5mb0JveENvbXBvbmVudCBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29udGFpbmVyRWxlbWVudFwiLCBudWxsKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgaW5mb0JveDogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJvcGVuXCIsIChpbmZvQm94LCBhbmNob3IpID0+IHtcclxuICAgICAgaWYgKGFuY2hvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQgIT09IG51bGwpIHtcclxuICAgICAgICAgIGluZm9Cb3gub3Blbih0aGlzLmNvbnRleHQsIGFuY2hvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGluZm9Cb3guZ2V0UG9zaXRpb24oKSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQgIT09IG51bGwpIHtcclxuICAgICAgICAgIGluZm9Cb3gub3Blbih0aGlzLmNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbnZhcmlhbnQoZmFsc2UsICdZb3UgbXVzdCBwcm92aWRlIGVpdGhlciBhbiBhbmNob3Igb3IgYSBwb3NpdGlvbiBwcm9wIGZvciA8SW5mb0JveD4uJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0SW5mb0JveENhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUuaW5mb0JveCAhPT0gbnVsbCAmJiB0aGlzLmNvbnRhaW5lckVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICB0aGlzLnN0YXRlLmluZm9Cb3guc2V0Q29udGVudCh0aGlzLmNvbnRhaW5lckVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMub3Blbih0aGlzLnN0YXRlLmluZm9Cb3gsIHRoaXMucHJvcHMuYW5jaG9yKTtcclxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUuaW5mb0JveCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB2YXIgX3JlZjMgPSB0aGlzLnByb3BzLm9wdGlvbnMgfHwge30sXHJcbiAgICAgIHtcclxuICAgICAgICBwb3NpdGlvblxyXG4gICAgICB9ID0gX3JlZjMsXHJcbiAgICAgIGluZm9Cb3hPcHRpb25zID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9yZWYzLCBfZXhjbHVkZWQyKTtcclxuICAgIHZhciBwb3NpdGlvbkxhdExuZztcclxuICAgIGlmIChwb3NpdGlvbiAmJiAhKHBvc2l0aW9uIGluc3RhbmNlb2YgZ29vZ2xlLm1hcHMuTGF0TG5nKSkge1xyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgcG9zaXRpb25MYXRMbmcgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHBvc2l0aW9uLmxhdCwgcG9zaXRpb24ubG5nKTtcclxuICAgIH1cclxuICAgIHZhciBpbmZvQm94ID0gbmV3IEluZm9Cb3goX29iamVjdFNwcmVhZCRiKF9vYmplY3RTcHJlYWQkYih7fSwgaW5mb0JveE9wdGlvbnMpLCBwb3NpdGlvbkxhdExuZyA/IHtcclxuICAgICAgcG9zaXRpb246IHBvc2l0aW9uTGF0TG5nXHJcbiAgICB9IDoge30pKTtcclxuICAgIHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkZCxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGQsXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IGluZm9Cb3hcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgIGluZm9Cb3hcclxuICAgIH0sIHRoaXMuc2V0SW5mb0JveENhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgdmFyIHtcclxuICAgICAgaW5mb0JveFxyXG4gICAgfSA9IHRoaXMuc3RhdGU7XHJcbiAgICBpZiAoaW5mb0JveCAhPT0gbnVsbCkge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkZCxcclxuICAgICAgICBldmVudE1hcDogZXZlbnRNYXAkZCxcclxuICAgICAgICBwcmV2UHJvcHMsXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiBpbmZvQm94XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIHZhciB7XHJcbiAgICAgIG9uVW5tb3VudFxyXG4gICAgfSA9IHRoaXMucHJvcHM7XHJcbiAgICB2YXIge1xyXG4gICAgICBpbmZvQm94XHJcbiAgICB9ID0gdGhpcy5zdGF0ZTtcclxuICAgIGlmIChpbmZvQm94ICE9PSBudWxsKSB7XHJcbiAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICBvblVubW91bnQoaW5mb0JveCk7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICBpbmZvQm94LmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiB0aGlzLmNvbnRhaW5lckVsZW1lbnQgPyBjcmVhdGVQb3J0YWwoQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKSwgdGhpcy5jb250YWluZXJFbGVtZW50KSA6IG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShJbmZvQm94Q29tcG9uZW50LCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxudmFyIGZhc3REZWVwRXF1YWw7XHJcbnZhciBoYXNSZXF1aXJlZEZhc3REZWVwRXF1YWw7XHJcbmZ1bmN0aW9uIHJlcXVpcmVGYXN0RGVlcEVxdWFsKCkge1xyXG4gIGlmIChoYXNSZXF1aXJlZEZhc3REZWVwRXF1YWwpIHJldHVybiBmYXN0RGVlcEVxdWFsO1xyXG4gIGhhc1JlcXVpcmVkRmFzdERlZXBFcXVhbCA9IDE7XHJcblxyXG4gIC8vIGRvIG5vdCBlZGl0IC5qcyBmaWxlcyBkaXJlY3RseSAtIGVkaXQgc3JjL2luZGV4LmpzdFxyXG5cclxuICBmYXN0RGVlcEVxdWFsID0gZnVuY3Rpb24gZXF1YWwoYSwgYikge1xyXG4gICAgaWYgKGEgPT09IGIpIHJldHVybiB0cnVlO1xyXG4gICAgaWYgKGEgJiYgYiAmJiB0eXBlb2YgYSA9PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiA9PSAnb2JqZWN0Jykge1xyXG4gICAgICBpZiAoYS5jb25zdHJ1Y3RvciAhPT0gYi5jb25zdHJ1Y3RvcikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB2YXIgbGVuZ3RoLCBpLCBrZXlzO1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSkge1xyXG4gICAgICAgIGxlbmd0aCA9IGEubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW5ndGggIT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBmb3IgKGkgPSBsZW5ndGg7IGktLSAhPT0gMDspIGlmICghZXF1YWwoYVtpXSwgYltpXSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYS5jb25zdHJ1Y3RvciA9PT0gUmVnRXhwKSByZXR1cm4gYS5zb3VyY2UgPT09IGIuc291cmNlICYmIGEuZmxhZ3MgPT09IGIuZmxhZ3M7XHJcbiAgICAgIGlmIChhLnZhbHVlT2YgIT09IE9iamVjdC5wcm90b3R5cGUudmFsdWVPZikgcmV0dXJuIGEudmFsdWVPZigpID09PSBiLnZhbHVlT2YoKTtcclxuICAgICAgaWYgKGEudG9TdHJpbmcgIT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcpIHJldHVybiBhLnRvU3RyaW5nKCkgPT09IGIudG9TdHJpbmcoKTtcclxuICAgICAga2V5cyA9IE9iamVjdC5rZXlzKGEpO1xyXG4gICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDtcclxuICAgICAgaWYgKGxlbmd0aCAhPT0gT2JqZWN0LmtleXMoYikubGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgIGZvciAoaSA9IGxlbmd0aDsgaS0tICE9PSAwOykgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwga2V5c1tpXSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgZm9yIChpID0gbGVuZ3RoOyBpLS0gIT09IDA7KSB7XHJcbiAgICAgICAgdmFyIGtleSA9IGtleXNbaV07XHJcbiAgICAgICAgaWYgKCFlcXVhbChhW2tleV0sIGJba2V5XSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0cnVlIGlmIGJvdGggTmFOLCBmYWxzZSBvdGhlcndpc2VcclxuICAgIHJldHVybiBhICE9PSBhICYmIGIgIT09IGI7XHJcbiAgfTtcclxuICByZXR1cm4gZmFzdERlZXBFcXVhbDtcclxufVxyXG5cclxudmFyIGZhc3REZWVwRXF1YWxFeHBvcnRzID0gcmVxdWlyZUZhc3REZWVwRXF1YWwoKTtcclxudmFyIGVxdWFsID0gLypAX19QVVJFX18qL2dldERlZmF1bHRFeHBvcnRGcm9tQ2pzJDEoZmFzdERlZXBFcXVhbEV4cG9ydHMpO1xyXG5cclxudmFyIEFSUkFZX1RZUEVTID0gW0ludDhBcnJheSwgVWludDhBcnJheSwgVWludDhDbGFtcGVkQXJyYXksIEludDE2QXJyYXksIFVpbnQxNkFycmF5LCBJbnQzMkFycmF5LCBVaW50MzJBcnJheSwgRmxvYXQzMkFycmF5LCBGbG9hdDY0QXJyYXldO1xyXG5cclxuLyoqIEB0eXBlZGVmIHtJbnQ4QXJyYXlDb25zdHJ1Y3RvciB8IFVpbnQ4QXJyYXlDb25zdHJ1Y3RvciB8IFVpbnQ4Q2xhbXBlZEFycmF5Q29uc3RydWN0b3IgfCBJbnQxNkFycmF5Q29uc3RydWN0b3IgfCBVaW50MTZBcnJheUNvbnN0cnVjdG9yIHwgSW50MzJBcnJheUNvbnN0cnVjdG9yIHwgVWludDMyQXJyYXlDb25zdHJ1Y3RvciB8IEZsb2F0MzJBcnJheUNvbnN0cnVjdG9yIHwgRmxvYXQ2NEFycmF5Q29uc3RydWN0b3J9IFR5cGVkQXJyYXlDb25zdHJ1Y3RvciAqL1xyXG5cclxudmFyIFZFUlNJT04gPSAxOyAvLyBzZXJpYWxpemVkIGZvcm1hdCB2ZXJzaW9uXHJcbnZhciBIRUFERVJfU0laRSA9IDg7XHJcbmNsYXNzIEtEQnVzaCB7XHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBpbmRleCBmcm9tIHJhdyBgQXJyYXlCdWZmZXJgIGRhdGEuXHJcbiAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gZGF0YVxyXG4gICAqL1xyXG4gIHN0YXRpYyBmcm9tKGRhdGEpIHtcclxuICAgIGlmICghKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgQXJyYXlCdWZmZXIuJyk7XHJcbiAgICB9XHJcbiAgICB2YXIgW21hZ2ljLCB2ZXJzaW9uQW5kVHlwZV0gPSBuZXcgVWludDhBcnJheShkYXRhLCAwLCAyKTtcclxuICAgIGlmIChtYWdpYyAhPT0gMHhkYikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGEgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGluIGEgS0RCdXNoIGZvcm1hdC4nKTtcclxuICAgIH1cclxuICAgIHZhciB2ZXJzaW9uID0gdmVyc2lvbkFuZFR5cGUgPj4gNDtcclxuICAgIGlmICh2ZXJzaW9uICE9PSBWRVJTSU9OKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdvdCB2XCIuY29uY2F0KHZlcnNpb24sIFwiIGRhdGEgd2hlbiBleHBlY3RlZCB2XCIpLmNvbmNhdChWRVJTSU9OLCBcIi5cIikpO1xyXG4gICAgfVxyXG4gICAgdmFyIEFycmF5VHlwZSA9IEFSUkFZX1RZUEVTW3ZlcnNpb25BbmRUeXBlICYgMHgwZl07XHJcbiAgICBpZiAoIUFycmF5VHlwZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VucmVjb2duaXplZCBhcnJheSB0eXBlLicpO1xyXG4gICAgfVxyXG4gICAgdmFyIFtub2RlU2l6ZV0gPSBuZXcgVWludDE2QXJyYXkoZGF0YSwgMiwgMSk7XHJcbiAgICB2YXIgW251bUl0ZW1zXSA9IG5ldyBVaW50MzJBcnJheShkYXRhLCA0LCAxKTtcclxuICAgIHJldHVybiBuZXcgS0RCdXNoKG51bUl0ZW1zLCBub2RlU2l6ZSwgQXJyYXlUeXBlLCBkYXRhKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYW4gaW5kZXggdGhhdCB3aWxsIGhvbGQgYSBnaXZlbiBudW1iZXIgb2YgaXRlbXMuXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG51bUl0ZW1zXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IFtub2RlU2l6ZT02NF0gU2l6ZSBvZiB0aGUgS0QtdHJlZSBub2RlICg2NCBieSBkZWZhdWx0KS5cclxuICAgKiBAcGFyYW0ge1R5cGVkQXJyYXlDb25zdHJ1Y3Rvcn0gW0FycmF5VHlwZT1GbG9hdDY0QXJyYXldIFRoZSBhcnJheSB0eXBlIHVzZWQgZm9yIGNvb3JkaW5hdGVzIHN0b3JhZ2UgKGBGbG9hdDY0QXJyYXlgIGJ5IGRlZmF1bHQpLlxyXG4gICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IFtkYXRhXSAoRm9yIGludGVybmFsIHVzZSBvbmx5KVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKG51bUl0ZW1zKSB7XHJcbiAgICB2YXIgbm9kZVNpemUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDY0O1xyXG4gICAgdmFyIEFycmF5VHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogRmxvYXQ2NEFycmF5O1xyXG4gICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDtcclxuICAgIGlmIChpc05hTihudW1JdGVtcykgfHwgbnVtSXRlbXMgPCAwKSB0aHJvdyBuZXcgRXJyb3IoXCJVbnBleHBlY3RlZCBudW1JdGVtcyB2YWx1ZTogXCIuY29uY2F0KG51bUl0ZW1zLCBcIi5cIikpO1xyXG4gICAgdGhpcy5udW1JdGVtcyA9ICtudW1JdGVtcztcclxuICAgIHRoaXMubm9kZVNpemUgPSBNYXRoLm1pbihNYXRoLm1heCgrbm9kZVNpemUsIDIpLCA2NTUzNSk7XHJcbiAgICB0aGlzLkFycmF5VHlwZSA9IEFycmF5VHlwZTtcclxuICAgIHRoaXMuSW5kZXhBcnJheVR5cGUgPSBudW1JdGVtcyA8IDY1NTM2ID8gVWludDE2QXJyYXkgOiBVaW50MzJBcnJheTtcclxuICAgIHZhciBhcnJheVR5cGVJbmRleCA9IEFSUkFZX1RZUEVTLmluZGV4T2YodGhpcy5BcnJheVR5cGUpO1xyXG4gICAgdmFyIGNvb3Jkc0J5dGVTaXplID0gbnVtSXRlbXMgKiAyICogdGhpcy5BcnJheVR5cGUuQllURVNfUEVSX0VMRU1FTlQ7XHJcbiAgICB2YXIgaWRzQnl0ZVNpemUgPSBudW1JdGVtcyAqIHRoaXMuSW5kZXhBcnJheVR5cGUuQllURVNfUEVSX0VMRU1FTlQ7XHJcbiAgICB2YXIgcGFkQ29vcmRzID0gKDggLSBpZHNCeXRlU2l6ZSAlIDgpICUgODtcclxuICAgIGlmIChhcnJheVR5cGVJbmRleCA8IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCB0eXBlZCBhcnJheSBjbGFzczogXCIuY29uY2F0KEFycmF5VHlwZSwgXCIuXCIpKTtcclxuICAgIH1cclxuICAgIGlmIChkYXRhICYmIGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xyXG4gICAgICAvLyByZWNvbnN0cnVjdCBhbiBpbmRleCBmcm9tIGEgYnVmZmVyXHJcbiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgIHRoaXMuaWRzID0gbmV3IHRoaXMuSW5kZXhBcnJheVR5cGUodGhpcy5kYXRhLCBIRUFERVJfU0laRSwgbnVtSXRlbXMpO1xyXG4gICAgICB0aGlzLmNvb3JkcyA9IG5ldyB0aGlzLkFycmF5VHlwZSh0aGlzLmRhdGEsIEhFQURFUl9TSVpFICsgaWRzQnl0ZVNpemUgKyBwYWRDb29yZHMsIG51bUl0ZW1zICogMik7XHJcbiAgICAgIHRoaXMuX3BvcyA9IG51bUl0ZW1zICogMjtcclxuICAgICAgdGhpcy5fZmluaXNoZWQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gaW5pdGlhbGl6ZSBhIG5ldyBpbmRleFxyXG4gICAgICB0aGlzLmRhdGEgPSBuZXcgQXJyYXlCdWZmZXIoSEVBREVSX1NJWkUgKyBjb29yZHNCeXRlU2l6ZSArIGlkc0J5dGVTaXplICsgcGFkQ29vcmRzKTtcclxuICAgICAgdGhpcy5pZHMgPSBuZXcgdGhpcy5JbmRleEFycmF5VHlwZSh0aGlzLmRhdGEsIEhFQURFUl9TSVpFLCBudW1JdGVtcyk7XHJcbiAgICAgIHRoaXMuY29vcmRzID0gbmV3IHRoaXMuQXJyYXlUeXBlKHRoaXMuZGF0YSwgSEVBREVSX1NJWkUgKyBpZHNCeXRlU2l6ZSArIHBhZENvb3JkcywgbnVtSXRlbXMgKiAyKTtcclxuICAgICAgdGhpcy5fcG9zID0gMDtcclxuICAgICAgdGhpcy5fZmluaXNoZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgIC8vIHNldCBoZWFkZXJcclxuICAgICAgbmV3IFVpbnQ4QXJyYXkodGhpcy5kYXRhLCAwLCAyKS5zZXQoWzB4ZGIsIChWRVJTSU9OIDw8IDQpICsgYXJyYXlUeXBlSW5kZXhdKTtcclxuICAgICAgbmV3IFVpbnQxNkFycmF5KHRoaXMuZGF0YSwgMiwgMSlbMF0gPSBub2RlU2l6ZTtcclxuICAgICAgbmV3IFVpbnQzMkFycmF5KHRoaXMuZGF0YSwgNCwgMSlbMF0gPSBudW1JdGVtcztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBhIHBvaW50IHRvIHRoZSBpbmRleC5cclxuICAgKiBAcGFyYW0ge251bWJlcn0geFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcbiAgICogQHJldHVybnMge251bWJlcn0gQW4gaW5jcmVtZW50YWwgaW5kZXggYXNzb2NpYXRlZCB3aXRoIHRoZSBhZGRlZCBpdGVtIChzdGFydGluZyBmcm9tIGAwYCkuXHJcbiAgICovXHJcbiAgYWRkKHgsIHkpIHtcclxuICAgIHZhciBpbmRleCA9IHRoaXMuX3BvcyA+PiAxO1xyXG4gICAgdGhpcy5pZHNbaW5kZXhdID0gaW5kZXg7XHJcbiAgICB0aGlzLmNvb3Jkc1t0aGlzLl9wb3MrK10gPSB4O1xyXG4gICAgdGhpcy5jb29yZHNbdGhpcy5fcG9zKytdID0geTtcclxuICAgIHJldHVybiBpbmRleDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBlcmZvcm0gaW5kZXhpbmcgb2YgdGhlIGFkZGVkIHBvaW50cy5cclxuICAgKi9cclxuICBmaW5pc2goKSB7XHJcbiAgICB2YXIgbnVtQWRkZWQgPSB0aGlzLl9wb3MgPj4gMTtcclxuICAgIGlmIChudW1BZGRlZCAhPT0gdGhpcy5udW1JdGVtcykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBZGRlZCBcIi5jb25jYXQobnVtQWRkZWQsIFwiIGl0ZW1zIHdoZW4gZXhwZWN0ZWQgXCIpLmNvbmNhdCh0aGlzLm51bUl0ZW1zLCBcIi5cIikpO1xyXG4gICAgfVxyXG4gICAgLy8ga2Qtc29ydCBib3RoIGFycmF5cyBmb3IgZWZmaWNpZW50IHNlYXJjaFxyXG4gICAgc29ydCh0aGlzLmlkcywgdGhpcy5jb29yZHMsIHRoaXMubm9kZVNpemUsIDAsIHRoaXMubnVtSXRlbXMgLSAxLCAwKTtcclxuICAgIHRoaXMuX2ZpbmlzaGVkID0gdHJ1ZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VhcmNoIHRoZSBpbmRleCBmb3IgaXRlbXMgd2l0aGluIGEgZ2l2ZW4gYm91bmRpbmcgYm94LlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtaW5YXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1pbllcclxuICAgKiBAcGFyYW0ge251bWJlcn0gbWF4WFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhZXHJcbiAgICogQHJldHVybnMge251bWJlcltdfSBBbiBhcnJheSBvZiBpbmRpY2VzIGNvcnJlcG9uZGluZyB0byB0aGUgZm91bmQgaXRlbXMuXHJcbiAgICovXHJcbiAgcmFuZ2UobWluWCwgbWluWSwgbWF4WCwgbWF4WSkge1xyXG4gICAgaWYgKCF0aGlzLl9maW5pc2hlZCkgdGhyb3cgbmV3IEVycm9yKCdEYXRhIG5vdCB5ZXQgaW5kZXhlZCAtIGNhbGwgaW5kZXguZmluaXNoKCkuJyk7XHJcbiAgICB2YXIge1xyXG4gICAgICBpZHMsXHJcbiAgICAgIGNvb3JkcyxcclxuICAgICAgbm9kZVNpemVcclxuICAgIH0gPSB0aGlzO1xyXG4gICAgdmFyIHN0YWNrID0gWzAsIGlkcy5sZW5ndGggLSAxLCAwXTtcclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuXHJcbiAgICAvLyByZWN1cnNpdmVseSBzZWFyY2ggZm9yIGl0ZW1zIGluIHJhbmdlIGluIHRoZSBrZC1zb3J0ZWQgYXJyYXlzXHJcbiAgICB3aGlsZSAoc3RhY2subGVuZ3RoKSB7XHJcbiAgICAgIHZhciBheGlzID0gc3RhY2sucG9wKCkgfHwgMDtcclxuICAgICAgdmFyIHJpZ2h0ID0gc3RhY2sucG9wKCkgfHwgMDtcclxuICAgICAgdmFyIGxlZnQgPSBzdGFjay5wb3AoKSB8fCAwO1xyXG5cclxuICAgICAgLy8gaWYgd2UgcmVhY2hlZCBcInRyZWUgbm9kZVwiLCBzZWFyY2ggbGluZWFybHlcclxuICAgICAgaWYgKHJpZ2h0IC0gbGVmdCA8PSBub2RlU2l6ZSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSBsZWZ0OyBpIDw9IHJpZ2h0OyBpKyspIHtcclxuICAgICAgICAgIHZhciBfeCA9IGNvb3Jkc1syICogaV07XHJcbiAgICAgICAgICB2YXIgX3kgPSBjb29yZHNbMiAqIGkgKyAxXTtcclxuICAgICAgICAgIGlmIChfeCA+PSBtaW5YICYmIF94IDw9IG1heFggJiYgX3kgPj0gbWluWSAmJiBfeSA8PSBtYXhZKSByZXN1bHQucHVzaChpZHNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gb3RoZXJ3aXNlIGZpbmQgdGhlIG1pZGRsZSBpbmRleFxyXG4gICAgICB2YXIgbSA9IGxlZnQgKyByaWdodCA+PiAxO1xyXG5cclxuICAgICAgLy8gaW5jbHVkZSB0aGUgbWlkZGxlIGl0ZW0gaWYgaXQncyBpbiByYW5nZVxyXG4gICAgICB2YXIgeCA9IGNvb3Jkc1syICogbV07XHJcbiAgICAgIHZhciB5ID0gY29vcmRzWzIgKiBtICsgMV07XHJcbiAgICAgIGlmICh4ID49IG1pblggJiYgeCA8PSBtYXhYICYmIHkgPj0gbWluWSAmJiB5IDw9IG1heFkpIHJlc3VsdC5wdXNoKGlkc1ttXSk7XHJcblxyXG4gICAgICAvLyBxdWV1ZSBzZWFyY2ggaW4gaGFsdmVzIHRoYXQgaW50ZXJzZWN0IHRoZSBxdWVyeVxyXG4gICAgICBpZiAoYXhpcyA9PT0gMCA/IG1pblggPD0geCA6IG1pblkgPD0geSkge1xyXG4gICAgICAgIHN0YWNrLnB1c2gobGVmdCk7XHJcbiAgICAgICAgc3RhY2sucHVzaChtIC0gMSk7XHJcbiAgICAgICAgc3RhY2sucHVzaCgxIC0gYXhpcyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGF4aXMgPT09IDAgPyBtYXhYID49IHggOiBtYXhZID49IHkpIHtcclxuICAgICAgICBzdGFjay5wdXNoKG0gKyAxKTtcclxuICAgICAgICBzdGFjay5wdXNoKHJpZ2h0KTtcclxuICAgICAgICBzdGFjay5wdXNoKDEgLSBheGlzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlYXJjaCB0aGUgaW5kZXggZm9yIGl0ZW1zIHdpdGhpbiBhIGdpdmVuIHJhZGl1cy5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gcXhcclxuICAgKiBAcGFyYW0ge251bWJlcn0gcXlcclxuICAgKiBAcGFyYW0ge251bWJlcn0gciBRdWVyeSByYWRpdXMuXHJcbiAgICogQHJldHVybnMge251bWJlcltdfSBBbiBhcnJheSBvZiBpbmRpY2VzIGNvcnJlcG9uZGluZyB0byB0aGUgZm91bmQgaXRlbXMuXHJcbiAgICovXHJcbiAgd2l0aGluKHF4LCBxeSwgcikge1xyXG4gICAgaWYgKCF0aGlzLl9maW5pc2hlZCkgdGhyb3cgbmV3IEVycm9yKCdEYXRhIG5vdCB5ZXQgaW5kZXhlZCAtIGNhbGwgaW5kZXguZmluaXNoKCkuJyk7XHJcbiAgICB2YXIge1xyXG4gICAgICBpZHMsXHJcbiAgICAgIGNvb3JkcyxcclxuICAgICAgbm9kZVNpemVcclxuICAgIH0gPSB0aGlzO1xyXG4gICAgdmFyIHN0YWNrID0gWzAsIGlkcy5sZW5ndGggLSAxLCAwXTtcclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgIHZhciByMiA9IHIgKiByO1xyXG5cclxuICAgIC8vIHJlY3Vyc2l2ZWx5IHNlYXJjaCBmb3IgaXRlbXMgd2l0aGluIHJhZGl1cyBpbiB0aGUga2Qtc29ydGVkIGFycmF5c1xyXG4gICAgd2hpbGUgKHN0YWNrLmxlbmd0aCkge1xyXG4gICAgICB2YXIgYXhpcyA9IHN0YWNrLnBvcCgpIHx8IDA7XHJcbiAgICAgIHZhciByaWdodCA9IHN0YWNrLnBvcCgpIHx8IDA7XHJcbiAgICAgIHZhciBsZWZ0ID0gc3RhY2sucG9wKCkgfHwgMDtcclxuXHJcbiAgICAgIC8vIGlmIHdlIHJlYWNoZWQgXCJ0cmVlIG5vZGVcIiwgc2VhcmNoIGxpbmVhcmx5XHJcbiAgICAgIGlmIChyaWdodCAtIGxlZnQgPD0gbm9kZVNpemUpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gbGVmdDsgaSA8PSByaWdodDsgaSsrKSB7XHJcbiAgICAgICAgICBpZiAoc3FEaXN0KGNvb3Jkc1syICogaV0sIGNvb3Jkc1syICogaSArIDFdLCBxeCwgcXkpIDw9IHIyKSByZXN1bHQucHVzaChpZHNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gb3RoZXJ3aXNlIGZpbmQgdGhlIG1pZGRsZSBpbmRleFxyXG4gICAgICB2YXIgbSA9IGxlZnQgKyByaWdodCA+PiAxO1xyXG5cclxuICAgICAgLy8gaW5jbHVkZSB0aGUgbWlkZGxlIGl0ZW0gaWYgaXQncyBpbiByYW5nZVxyXG4gICAgICB2YXIgeCA9IGNvb3Jkc1syICogbV07XHJcbiAgICAgIHZhciB5ID0gY29vcmRzWzIgKiBtICsgMV07XHJcbiAgICAgIGlmIChzcURpc3QoeCwgeSwgcXgsIHF5KSA8PSByMikgcmVzdWx0LnB1c2goaWRzW21dKTtcclxuXHJcbiAgICAgIC8vIHF1ZXVlIHNlYXJjaCBpbiBoYWx2ZXMgdGhhdCBpbnRlcnNlY3QgdGhlIHF1ZXJ5XHJcbiAgICAgIGlmIChheGlzID09PSAwID8gcXggLSByIDw9IHggOiBxeSAtIHIgPD0geSkge1xyXG4gICAgICAgIHN0YWNrLnB1c2gobGVmdCk7XHJcbiAgICAgICAgc3RhY2sucHVzaChtIC0gMSk7XHJcbiAgICAgICAgc3RhY2sucHVzaCgxIC0gYXhpcyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGF4aXMgPT09IDAgPyBxeCArIHIgPj0geCA6IHF5ICsgciA+PSB5KSB7XHJcbiAgICAgICAgc3RhY2sucHVzaChtICsgMSk7XHJcbiAgICAgICAgc3RhY2sucHVzaChyaWdodCk7XHJcbiAgICAgICAgc3RhY2sucHVzaCgxIC0gYXhpcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtVaW50MTZBcnJheSB8IFVpbnQzMkFycmF5fSBpZHNcclxuICogQHBhcmFtIHtJbnN0YW5jZVR5cGU8VHlwZWRBcnJheUNvbnN0cnVjdG9yPn0gY29vcmRzXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBub2RlU2l6ZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbGVmdFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcmlnaHRcclxuICogQHBhcmFtIHtudW1iZXJ9IGF4aXNcclxuICovXHJcbmZ1bmN0aW9uIHNvcnQoaWRzLCBjb29yZHMsIG5vZGVTaXplLCBsZWZ0LCByaWdodCwgYXhpcykge1xyXG4gIGlmIChyaWdodCAtIGxlZnQgPD0gbm9kZVNpemUpIHJldHVybjtcclxuICB2YXIgbSA9IGxlZnQgKyByaWdodCA+PiAxOyAvLyBtaWRkbGUgaW5kZXhcclxuXHJcbiAgLy8gc29ydCBpZHMgYW5kIGNvb3JkcyBhcm91bmQgdGhlIG1pZGRsZSBpbmRleCBzbyB0aGF0IHRoZSBoYWx2ZXMgbGllXHJcbiAgLy8gZWl0aGVyIGxlZnQvcmlnaHQgb3IgdG9wL2JvdHRvbSBjb3JyZXNwb25kaW5nbHkgKHRha2luZyB0dXJucylcclxuICBzZWxlY3QoaWRzLCBjb29yZHMsIG0sIGxlZnQsIHJpZ2h0LCBheGlzKTtcclxuXHJcbiAgLy8gcmVjdXJzaXZlbHkga2Qtc29ydCBmaXJzdCBoYWxmIGFuZCBzZWNvbmQgaGFsZiBvbiB0aGUgb3Bwb3NpdGUgYXhpc1xyXG4gIHNvcnQoaWRzLCBjb29yZHMsIG5vZGVTaXplLCBsZWZ0LCBtIC0gMSwgMSAtIGF4aXMpO1xyXG4gIHNvcnQoaWRzLCBjb29yZHMsIG5vZGVTaXplLCBtICsgMSwgcmlnaHQsIDEgLSBheGlzKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEN1c3RvbSBGbG95ZC1SaXZlc3Qgc2VsZWN0aW9uIGFsZ29yaXRobTogc29ydCBpZHMgYW5kIGNvb3JkcyBzbyB0aGF0XHJcbiAqIFtsZWZ0Li5rLTFdIGl0ZW1zIGFyZSBzbWFsbGVyIHRoYW4gay10aCBpdGVtIChvbiBlaXRoZXIgeCBvciB5IGF4aXMpXHJcbiAqIEBwYXJhbSB7VWludDE2QXJyYXkgfCBVaW50MzJBcnJheX0gaWRzXHJcbiAqIEBwYXJhbSB7SW5zdGFuY2VUeXBlPFR5cGVkQXJyYXlDb25zdHJ1Y3Rvcj59IGNvb3Jkc1xyXG4gKiBAcGFyYW0ge251bWJlcn0ga1xyXG4gKiBAcGFyYW0ge251bWJlcn0gbGVmdFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcmlnaHRcclxuICogQHBhcmFtIHtudW1iZXJ9IGF4aXNcclxuICovXHJcbmZ1bmN0aW9uIHNlbGVjdChpZHMsIGNvb3JkcywgaywgbGVmdCwgcmlnaHQsIGF4aXMpIHtcclxuICB3aGlsZSAocmlnaHQgPiBsZWZ0KSB7XHJcbiAgICBpZiAocmlnaHQgLSBsZWZ0ID4gNjAwKSB7XHJcbiAgICAgIHZhciBuID0gcmlnaHQgLSBsZWZ0ICsgMTtcclxuICAgICAgdmFyIG0gPSBrIC0gbGVmdCArIDE7XHJcbiAgICAgIHZhciB6ID0gTWF0aC5sb2cobik7XHJcbiAgICAgIHZhciBzID0gMC41ICogTWF0aC5leHAoMiAqIHogLyAzKTtcclxuICAgICAgdmFyIHNkID0gMC41ICogTWF0aC5zcXJ0KHogKiBzICogKG4gLSBzKSAvIG4pICogKG0gLSBuIC8gMiA8IDAgPyAtMSA6IDEpO1xyXG4gICAgICB2YXIgbmV3TGVmdCA9IE1hdGgubWF4KGxlZnQsIE1hdGguZmxvb3IoayAtIG0gKiBzIC8gbiArIHNkKSk7XHJcbiAgICAgIHZhciBuZXdSaWdodCA9IE1hdGgubWluKHJpZ2h0LCBNYXRoLmZsb29yKGsgKyAobiAtIG0pICogcyAvIG4gKyBzZCkpO1xyXG4gICAgICBzZWxlY3QoaWRzLCBjb29yZHMsIGssIG5ld0xlZnQsIG5ld1JpZ2h0LCBheGlzKTtcclxuICAgIH1cclxuICAgIHZhciB0ID0gY29vcmRzWzIgKiBrICsgYXhpc107XHJcbiAgICB2YXIgaSA9IGxlZnQ7XHJcbiAgICB2YXIgaiA9IHJpZ2h0O1xyXG4gICAgc3dhcEl0ZW0oaWRzLCBjb29yZHMsIGxlZnQsIGspO1xyXG4gICAgaWYgKGNvb3Jkc1syICogcmlnaHQgKyBheGlzXSA+IHQpIHN3YXBJdGVtKGlkcywgY29vcmRzLCBsZWZ0LCByaWdodCk7XHJcbiAgICB3aGlsZSAoaSA8IGopIHtcclxuICAgICAgc3dhcEl0ZW0oaWRzLCBjb29yZHMsIGksIGopO1xyXG4gICAgICBpKys7XHJcbiAgICAgIGotLTtcclxuICAgICAgd2hpbGUgKGNvb3Jkc1syICogaSArIGF4aXNdIDwgdCkgaSsrO1xyXG4gICAgICB3aGlsZSAoY29vcmRzWzIgKiBqICsgYXhpc10gPiB0KSBqLS07XHJcbiAgICB9XHJcbiAgICBpZiAoY29vcmRzWzIgKiBsZWZ0ICsgYXhpc10gPT09IHQpIHN3YXBJdGVtKGlkcywgY29vcmRzLCBsZWZ0LCBqKTtlbHNlIHtcclxuICAgICAgaisrO1xyXG4gICAgICBzd2FwSXRlbShpZHMsIGNvb3JkcywgaiwgcmlnaHQpO1xyXG4gICAgfVxyXG4gICAgaWYgKGogPD0gaykgbGVmdCA9IGogKyAxO1xyXG4gICAgaWYgKGsgPD0gaikgcmlnaHQgPSBqIC0gMTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge1VpbnQxNkFycmF5IHwgVWludDMyQXJyYXl9IGlkc1xyXG4gKiBAcGFyYW0ge0luc3RhbmNlVHlwZTxUeXBlZEFycmF5Q29uc3RydWN0b3I+fSBjb29yZHNcclxuICogQHBhcmFtIHtudW1iZXJ9IGlcclxuICogQHBhcmFtIHtudW1iZXJ9IGpcclxuICovXHJcbmZ1bmN0aW9uIHN3YXBJdGVtKGlkcywgY29vcmRzLCBpLCBqKSB7XHJcbiAgc3dhcChpZHMsIGksIGopO1xyXG4gIHN3YXAoY29vcmRzLCAyICogaSwgMiAqIGopO1xyXG4gIHN3YXAoY29vcmRzLCAyICogaSArIDEsIDIgKiBqICsgMSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge0luc3RhbmNlVHlwZTxUeXBlZEFycmF5Q29uc3RydWN0b3I+fSBhcnJcclxuICogQHBhcmFtIHtudW1iZXJ9IGlcclxuICogQHBhcmFtIHtudW1iZXJ9IGpcclxuICovXHJcbmZ1bmN0aW9uIHN3YXAoYXJyLCBpLCBqKSB7XHJcbiAgdmFyIHRtcCA9IGFycltpXTtcclxuICBhcnJbaV0gPSBhcnJbal07XHJcbiAgYXJyW2pdID0gdG1wO1xyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtudW1iZXJ9IGF4XHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBheVxyXG4gKiBAcGFyYW0ge251bWJlcn0gYnhcclxuICogQHBhcmFtIHtudW1iZXJ9IGJ5XHJcbiAqL1xyXG5mdW5jdGlvbiBzcURpc3QoYXgsIGF5LCBieCwgYnkpIHtcclxuICB2YXIgZHggPSBheCAtIGJ4O1xyXG4gIHZhciBkeSA9IGF5IC0gYnk7XHJcbiAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5O1xyXG59XHJcblxyXG52YXIgZGVmYXVsdE9wdGlvbnMkMiA9IHtcclxuICBtaW5ab29tOiAwLFxyXG4gIC8vIG1pbiB6b29tIHRvIGdlbmVyYXRlIGNsdXN0ZXJzIG9uXHJcbiAgbWF4Wm9vbTogMTYsXHJcbiAgLy8gbWF4IHpvb20gbGV2ZWwgdG8gY2x1c3RlciB0aGUgcG9pbnRzIG9uXHJcbiAgbWluUG9pbnRzOiAyLFxyXG4gIC8vIG1pbmltdW0gcG9pbnRzIHRvIGZvcm0gYSBjbHVzdGVyXHJcbiAgcmFkaXVzOiA0MCxcclxuICAvLyBjbHVzdGVyIHJhZGl1cyBpbiBwaXhlbHNcclxuICBleHRlbnQ6IDUxMixcclxuICAvLyB0aWxlIGV4dGVudCAocmFkaXVzIGlzIGNhbGN1bGF0ZWQgcmVsYXRpdmUgdG8gaXQpXHJcbiAgbm9kZVNpemU6IDY0LFxyXG4gIC8vIHNpemUgb2YgdGhlIEtELXRyZWUgbGVhZiBub2RlLCBhZmZlY3RzIHBlcmZvcm1hbmNlXHJcbiAgbG9nOiBmYWxzZSxcclxuICAvLyB3aGV0aGVyIHRvIGxvZyB0aW1pbmcgaW5mb1xyXG5cclxuICAvLyB3aGV0aGVyIHRvIGdlbmVyYXRlIG51bWVyaWMgaWRzIGZvciBpbnB1dCBmZWF0dXJlcyAoaW4gdmVjdG9yIHRpbGVzKVxyXG4gIGdlbmVyYXRlSWQ6IGZhbHNlLFxyXG4gIC8vIGEgcmVkdWNlIGZ1bmN0aW9uIGZvciBjYWxjdWxhdGluZyBjdXN0b20gY2x1c3RlciBwcm9wZXJ0aWVzXHJcbiAgcmVkdWNlOiBudWxsLFxyXG4gIC8vIChhY2N1bXVsYXRlZCwgcHJvcHMpID0+IHsgYWNjdW11bGF0ZWQuc3VtICs9IHByb3BzLnN1bTsgfVxyXG5cclxuICAvLyBwcm9wZXJ0aWVzIHRvIHVzZSBmb3IgaW5kaXZpZHVhbCBwb2ludHMgd2hlbiBydW5uaW5nIHRoZSByZWR1Y2VyXHJcbiAgbWFwOiBwcm9wcyA9PiBwcm9wcyAvLyBwcm9wcyA9PiAoe3N1bTogcHJvcHMubXlfdmFsdWV9KVxyXG59O1xyXG52YXIgZnJvdW5kID0gTWF0aC5mcm91bmQgfHwgKHRtcCA9PiB4ID0+IHtcclxuICB0bXBbMF0gPSAreDtcclxuICByZXR1cm4gdG1wWzBdO1xyXG59KShuZXcgRmxvYXQzMkFycmF5KDEpKTtcclxudmFyIE9GRlNFVF9aT09NID0gMjtcclxudmFyIE9GRlNFVF9JRCA9IDM7XHJcbnZhciBPRkZTRVRfUEFSRU5UID0gNDtcclxudmFyIE9GRlNFVF9OVU0gPSA1O1xyXG52YXIgT0ZGU0VUX1BST1AgPSA2O1xyXG5jbGFzcyBTdXBlcmNsdXN0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShkZWZhdWx0T3B0aW9ucyQyKSwgb3B0aW9ucyk7XHJcbiAgICB0aGlzLnRyZWVzID0gbmV3IEFycmF5KHRoaXMub3B0aW9ucy5tYXhab29tICsgMSk7XHJcbiAgICB0aGlzLnN0cmlkZSA9IHRoaXMub3B0aW9ucy5yZWR1Y2UgPyA3IDogNjtcclxuICAgIHRoaXMuY2x1c3RlclByb3BzID0gW107XHJcbiAgfVxyXG4gIGxvYWQocG9pbnRzKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBsb2csXHJcbiAgICAgIG1pblpvb20sXHJcbiAgICAgIG1heFpvb21cclxuICAgIH0gPSB0aGlzLm9wdGlvbnM7XHJcbiAgICBpZiAobG9nKSBjb25zb2xlLnRpbWUoJ3RvdGFsIHRpbWUnKTtcclxuICAgIHZhciB0aW1lcklkID0gXCJwcmVwYXJlIFwiLmNvbmNhdChwb2ludHMubGVuZ3RoLCBcIiBwb2ludHNcIik7XHJcbiAgICBpZiAobG9nKSBjb25zb2xlLnRpbWUodGltZXJJZCk7XHJcbiAgICB0aGlzLnBvaW50cyA9IHBvaW50cztcclxuXHJcbiAgICAvLyBnZW5lcmF0ZSBhIGNsdXN0ZXIgb2JqZWN0IGZvciBlYWNoIHBvaW50IGFuZCBpbmRleCBpbnB1dCBwb2ludHMgaW50byBhIEtELXRyZWVcclxuICAgIHZhciBkYXRhID0gW107XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICB2YXIgcCA9IHBvaW50c1tpXTtcclxuICAgICAgaWYgKCFwLmdlb21ldHJ5KSBjb250aW51ZTtcclxuICAgICAgdmFyIFtsbmcsIGxhdF0gPSBwLmdlb21ldHJ5LmNvb3JkaW5hdGVzO1xyXG4gICAgICB2YXIgeCA9IGZyb3VuZChsbmdYKGxuZykpO1xyXG4gICAgICB2YXIgeSA9IGZyb3VuZChsYXRZKGxhdCkpO1xyXG4gICAgICAvLyBzdG9yZSBpbnRlcm5hbCBwb2ludC9jbHVzdGVyIGRhdGEgaW4gZmxhdCBudW1lcmljIGFycmF5cyBmb3IgcGVyZm9ybWFuY2VcclxuICAgICAgZGF0YS5wdXNoKHgsIHksXHJcbiAgICAgIC8vIHByb2plY3RlZCBwb2ludCBjb29yZGluYXRlc1xyXG4gICAgICBJbmZpbml0eSxcclxuICAgICAgLy8gdGhlIGxhc3Qgem9vbSB0aGUgcG9pbnQgd2FzIHByb2Nlc3NlZCBhdFxyXG4gICAgICBpLFxyXG4gICAgICAvLyBpbmRleCBvZiB0aGUgc291cmNlIGZlYXR1cmUgaW4gdGhlIG9yaWdpbmFsIGlucHV0IGFycmF5XHJcbiAgICAgIC0xLFxyXG4gICAgICAvLyBwYXJlbnQgY2x1c3RlciBpZFxyXG4gICAgICAxIC8vIG51bWJlciBvZiBwb2ludHMgaW4gYSBjbHVzdGVyXHJcbiAgICAgICk7XHJcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVkdWNlKSBkYXRhLnB1c2goMCk7IC8vIG5vb3BcclxuICAgIH1cclxuICAgIHZhciB0cmVlID0gdGhpcy50cmVlc1ttYXhab29tICsgMV0gPSB0aGlzLl9jcmVhdGVUcmVlKGRhdGEpO1xyXG4gICAgaWYgKGxvZykgY29uc29sZS50aW1lRW5kKHRpbWVySWQpO1xyXG5cclxuICAgIC8vIGNsdXN0ZXIgcG9pbnRzIG9uIG1heCB6b29tLCB0aGVuIGNsdXN0ZXIgdGhlIHJlc3VsdHMgb24gcHJldmlvdXMgem9vbSwgZXRjLjtcclxuICAgIC8vIHJlc3VsdHMgaW4gYSBjbHVzdGVyIGhpZXJhcmNoeSBhY3Jvc3Mgem9vbSBsZXZlbHNcclxuICAgIGZvciAodmFyIHogPSBtYXhab29tOyB6ID49IG1pblpvb207IHotLSkge1xyXG4gICAgICB2YXIgbm93ID0gK0RhdGUubm93KCk7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgYSBuZXcgc2V0IG9mIGNsdXN0ZXJzIGZvciB0aGUgem9vbSBhbmQgaW5kZXggdGhlbSB3aXRoIGEgS0QtdHJlZVxyXG4gICAgICB0cmVlID0gdGhpcy50cmVlc1t6XSA9IHRoaXMuX2NyZWF0ZVRyZWUodGhpcy5fY2x1c3Rlcih0cmVlLCB6KSk7XHJcbiAgICAgIGlmIChsb2cpIGNvbnNvbGUubG9nKCd6JWQ6ICVkIGNsdXN0ZXJzIGluICVkbXMnLCB6LCB0cmVlLm51bUl0ZW1zLCArRGF0ZS5ub3coKSAtIG5vdyk7XHJcbiAgICB9XHJcbiAgICBpZiAobG9nKSBjb25zb2xlLnRpbWVFbmQoJ3RvdGFsIHRpbWUnKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuICBnZXRDbHVzdGVycyhiYm94LCB6b29tKSB7XHJcbiAgICB2YXIgbWluTG5nID0gKChiYm94WzBdICsgMTgwKSAlIDM2MCArIDM2MCkgJSAzNjAgLSAxODA7XHJcbiAgICB2YXIgbWluTGF0ID0gTWF0aC5tYXgoLTkwLCBNYXRoLm1pbig5MCwgYmJveFsxXSkpO1xyXG4gICAgdmFyIG1heExuZyA9IGJib3hbMl0gPT09IDE4MCA/IDE4MCA6ICgoYmJveFsyXSArIDE4MCkgJSAzNjAgKyAzNjApICUgMzYwIC0gMTgwO1xyXG4gICAgdmFyIG1heExhdCA9IE1hdGgubWF4KC05MCwgTWF0aC5taW4oOTAsIGJib3hbM10pKTtcclxuICAgIGlmIChiYm94WzJdIC0gYmJveFswXSA+PSAzNjApIHtcclxuICAgICAgbWluTG5nID0gLTE4MDtcclxuICAgICAgbWF4TG5nID0gMTgwO1xyXG4gICAgfSBlbHNlIGlmIChtaW5MbmcgPiBtYXhMbmcpIHtcclxuICAgICAgdmFyIGVhc3Rlcm5IZW0gPSB0aGlzLmdldENsdXN0ZXJzKFttaW5MbmcsIG1pbkxhdCwgMTgwLCBtYXhMYXRdLCB6b29tKTtcclxuICAgICAgdmFyIHdlc3Rlcm5IZW0gPSB0aGlzLmdldENsdXN0ZXJzKFstMTgwLCBtaW5MYXQsIG1heExuZywgbWF4TGF0XSwgem9vbSk7XHJcbiAgICAgIHJldHVybiBlYXN0ZXJuSGVtLmNvbmNhdCh3ZXN0ZXJuSGVtKTtcclxuICAgIH1cclxuICAgIHZhciB0cmVlID0gdGhpcy50cmVlc1t0aGlzLl9saW1pdFpvb20oem9vbSldO1xyXG4gICAgdmFyIGlkcyA9IHRyZWUucmFuZ2UobG5nWChtaW5MbmcpLCBsYXRZKG1heExhdCksIGxuZ1gobWF4TG5nKSwgbGF0WShtaW5MYXQpKTtcclxuICAgIHZhciBkYXRhID0gdHJlZS5kYXRhO1xyXG4gICAgdmFyIGNsdXN0ZXJzID0gW107XHJcbiAgICBmb3IgKHZhciBpZCBvZiBpZHMpIHtcclxuICAgICAgdmFyIGsgPSB0aGlzLnN0cmlkZSAqIGlkO1xyXG4gICAgICBjbHVzdGVycy5wdXNoKGRhdGFbayArIE9GRlNFVF9OVU1dID4gMSA/IGdldENsdXN0ZXJKU09OKGRhdGEsIGssIHRoaXMuY2x1c3RlclByb3BzKSA6IHRoaXMucG9pbnRzW2RhdGFbayArIE9GRlNFVF9JRF1dKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjbHVzdGVycztcclxuICB9XHJcbiAgZ2V0Q2hpbGRyZW4oY2x1c3RlcklkKSB7XHJcbiAgICB2YXIgb3JpZ2luSWQgPSB0aGlzLl9nZXRPcmlnaW5JZChjbHVzdGVySWQpO1xyXG4gICAgdmFyIG9yaWdpblpvb20gPSB0aGlzLl9nZXRPcmlnaW5ab29tKGNsdXN0ZXJJZCk7XHJcbiAgICB2YXIgZXJyb3JNc2cgPSAnTm8gY2x1c3RlciB3aXRoIHRoZSBzcGVjaWZpZWQgaWQuJztcclxuICAgIHZhciB0cmVlID0gdGhpcy50cmVlc1tvcmlnaW5ab29tXTtcclxuICAgIGlmICghdHJlZSkgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTtcclxuICAgIHZhciBkYXRhID0gdHJlZS5kYXRhO1xyXG4gICAgaWYgKG9yaWdpbklkICogdGhpcy5zdHJpZGUgPj0gZGF0YS5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyk7XHJcbiAgICB2YXIgciA9IHRoaXMub3B0aW9ucy5yYWRpdXMgLyAodGhpcy5vcHRpb25zLmV4dGVudCAqIE1hdGgucG93KDIsIG9yaWdpblpvb20gLSAxKSk7XHJcbiAgICB2YXIgeCA9IGRhdGFbb3JpZ2luSWQgKiB0aGlzLnN0cmlkZV07XHJcbiAgICB2YXIgeSA9IGRhdGFbb3JpZ2luSWQgKiB0aGlzLnN0cmlkZSArIDFdO1xyXG4gICAgdmFyIGlkcyA9IHRyZWUud2l0aGluKHgsIHksIHIpO1xyXG4gICAgdmFyIGNoaWxkcmVuID0gW107XHJcbiAgICBmb3IgKHZhciBpZCBvZiBpZHMpIHtcclxuICAgICAgdmFyIGsgPSBpZCAqIHRoaXMuc3RyaWRlO1xyXG4gICAgICBpZiAoZGF0YVtrICsgT0ZGU0VUX1BBUkVOVF0gPT09IGNsdXN0ZXJJZCkge1xyXG4gICAgICAgIGNoaWxkcmVuLnB1c2goZGF0YVtrICsgT0ZGU0VUX05VTV0gPiAxID8gZ2V0Q2x1c3RlckpTT04oZGF0YSwgaywgdGhpcy5jbHVzdGVyUHJvcHMpIDogdGhpcy5wb2ludHNbZGF0YVtrICsgT0ZGU0VUX0lEXV0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cpO1xyXG4gICAgcmV0dXJuIGNoaWxkcmVuO1xyXG4gIH1cclxuICBnZXRMZWF2ZXMoY2x1c3RlcklkLCBsaW1pdCwgb2Zmc2V0KSB7XHJcbiAgICBsaW1pdCA9IGxpbWl0IHx8IDEwO1xyXG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XHJcbiAgICB2YXIgbGVhdmVzID0gW107XHJcbiAgICB0aGlzLl9hcHBlbmRMZWF2ZXMobGVhdmVzLCBjbHVzdGVySWQsIGxpbWl0LCBvZmZzZXQsIDApO1xyXG4gICAgcmV0dXJuIGxlYXZlcztcclxuICB9XHJcbiAgZ2V0VGlsZSh6LCB4LCB5KSB7XHJcbiAgICB2YXIgdHJlZSA9IHRoaXMudHJlZXNbdGhpcy5fbGltaXRab29tKHopXTtcclxuICAgIHZhciB6MiA9IE1hdGgucG93KDIsIHopO1xyXG4gICAgdmFyIHtcclxuICAgICAgZXh0ZW50LFxyXG4gICAgICByYWRpdXNcclxuICAgIH0gPSB0aGlzLm9wdGlvbnM7XHJcbiAgICB2YXIgcCA9IHJhZGl1cyAvIGV4dGVudDtcclxuICAgIHZhciB0b3AgPSAoeSAtIHApIC8gejI7XHJcbiAgICB2YXIgYm90dG9tID0gKHkgKyAxICsgcCkgLyB6MjtcclxuICAgIHZhciB0aWxlID0ge1xyXG4gICAgICBmZWF0dXJlczogW11cclxuICAgIH07XHJcbiAgICB0aGlzLl9hZGRUaWxlRmVhdHVyZXModHJlZS5yYW5nZSgoeCAtIHApIC8gejIsIHRvcCwgKHggKyAxICsgcCkgLyB6MiwgYm90dG9tKSwgdHJlZS5kYXRhLCB4LCB5LCB6MiwgdGlsZSk7XHJcbiAgICBpZiAoeCA9PT0gMCkge1xyXG4gICAgICB0aGlzLl9hZGRUaWxlRmVhdHVyZXModHJlZS5yYW5nZSgxIC0gcCAvIHoyLCB0b3AsIDEsIGJvdHRvbSksIHRyZWUuZGF0YSwgejIsIHksIHoyLCB0aWxlKTtcclxuICAgIH1cclxuICAgIGlmICh4ID09PSB6MiAtIDEpIHtcclxuICAgICAgdGhpcy5fYWRkVGlsZUZlYXR1cmVzKHRyZWUucmFuZ2UoMCwgdG9wLCBwIC8gejIsIGJvdHRvbSksIHRyZWUuZGF0YSwgLTEsIHksIHoyLCB0aWxlKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aWxlLmZlYXR1cmVzLmxlbmd0aCA/IHRpbGUgOiBudWxsO1xyXG4gIH1cclxuICBnZXRDbHVzdGVyRXhwYW5zaW9uWm9vbShjbHVzdGVySWQpIHtcclxuICAgIHZhciBleHBhbnNpb25ab29tID0gdGhpcy5fZ2V0T3JpZ2luWm9vbShjbHVzdGVySWQpIC0gMTtcclxuICAgIHdoaWxlIChleHBhbnNpb25ab29tIDw9IHRoaXMub3B0aW9ucy5tYXhab29tKSB7XHJcbiAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuZ2V0Q2hpbGRyZW4oY2x1c3RlcklkKTtcclxuICAgICAgZXhwYW5zaW9uWm9vbSsrO1xyXG4gICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoICE9PSAxKSBicmVhaztcclxuICAgICAgY2x1c3RlcklkID0gY2hpbGRyZW5bMF0ucHJvcGVydGllcy5jbHVzdGVyX2lkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGV4cGFuc2lvblpvb207XHJcbiAgfVxyXG4gIF9hcHBlbmRMZWF2ZXMocmVzdWx0LCBjbHVzdGVySWQsIGxpbWl0LCBvZmZzZXQsIHNraXBwZWQpIHtcclxuICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuZ2V0Q2hpbGRyZW4oY2x1c3RlcklkKTtcclxuICAgIGZvciAodmFyIGNoaWxkIG9mIGNoaWxkcmVuKSB7XHJcbiAgICAgIHZhciBwcm9wcyA9IGNoaWxkLnByb3BlcnRpZXM7XHJcbiAgICAgIGlmIChwcm9wcyAmJiBwcm9wcy5jbHVzdGVyKSB7XHJcbiAgICAgICAgaWYgKHNraXBwZWQgKyBwcm9wcy5wb2ludF9jb3VudCA8PSBvZmZzZXQpIHtcclxuICAgICAgICAgIC8vIHNraXAgdGhlIHdob2xlIGNsdXN0ZXJcclxuICAgICAgICAgIHNraXBwZWQgKz0gcHJvcHMucG9pbnRfY291bnQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGVudGVyIHRoZSBjbHVzdGVyXHJcbiAgICAgICAgICBza2lwcGVkID0gdGhpcy5fYXBwZW5kTGVhdmVzKHJlc3VsdCwgcHJvcHMuY2x1c3Rlcl9pZCwgbGltaXQsIG9mZnNldCwgc2tpcHBlZCk7XHJcbiAgICAgICAgICAvLyBleGl0IHRoZSBjbHVzdGVyXHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHNraXBwZWQgPCBvZmZzZXQpIHtcclxuICAgICAgICAvLyBza2lwIGEgc2luZ2xlIHBvaW50XHJcbiAgICAgICAgc2tpcHBlZCsrO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIGFkZCBhIHNpbmdsZSBwb2ludFxyXG4gICAgICAgIHJlc3VsdC5wdXNoKGNoaWxkKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gbGltaXQpIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNraXBwZWQ7XHJcbiAgfVxyXG4gIF9jcmVhdGVUcmVlKGRhdGEpIHtcclxuICAgIHZhciB0cmVlID0gbmV3IEtEQnVzaChkYXRhLmxlbmd0aCAvIHRoaXMuc3RyaWRlIHwgMCwgdGhpcy5vcHRpb25zLm5vZGVTaXplLCBGbG9hdDMyQXJyYXkpO1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSB0aGlzLnN0cmlkZSkgdHJlZS5hZGQoZGF0YVtpXSwgZGF0YVtpICsgMV0pO1xyXG4gICAgdHJlZS5maW5pc2goKTtcclxuICAgIHRyZWUuZGF0YSA9IGRhdGE7XHJcbiAgICByZXR1cm4gdHJlZTtcclxuICB9XHJcbiAgX2FkZFRpbGVGZWF0dXJlcyhpZHMsIGRhdGEsIHgsIHksIHoyLCB0aWxlKSB7XHJcbiAgICBmb3IgKHZhciBpIG9mIGlkcykge1xyXG4gICAgICB2YXIgayA9IGkgKiB0aGlzLnN0cmlkZTtcclxuICAgICAgdmFyIGlzQ2x1c3RlciA9IGRhdGFbayArIE9GRlNFVF9OVU1dID4gMTtcclxuICAgICAgdmFyIHRhZ3MgPSB2b2lkIDAsXHJcbiAgICAgICAgcHggPSB2b2lkIDAsXHJcbiAgICAgICAgcHkgPSB2b2lkIDA7XHJcbiAgICAgIGlmIChpc0NsdXN0ZXIpIHtcclxuICAgICAgICB0YWdzID0gZ2V0Q2x1c3RlclByb3BlcnRpZXMoZGF0YSwgaywgdGhpcy5jbHVzdGVyUHJvcHMpO1xyXG4gICAgICAgIHB4ID0gZGF0YVtrXTtcclxuICAgICAgICBweSA9IGRhdGFbayArIDFdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBwID0gdGhpcy5wb2ludHNbZGF0YVtrICsgT0ZGU0VUX0lEXV07XHJcbiAgICAgICAgdGFncyA9IHAucHJvcGVydGllcztcclxuICAgICAgICB2YXIgW2xuZywgbGF0XSA9IHAuZ2VvbWV0cnkuY29vcmRpbmF0ZXM7XHJcbiAgICAgICAgcHggPSBsbmdYKGxuZyk7XHJcbiAgICAgICAgcHkgPSBsYXRZKGxhdCk7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIGYgPSB7XHJcbiAgICAgICAgdHlwZTogMSxcclxuICAgICAgICBnZW9tZXRyeTogW1tNYXRoLnJvdW5kKHRoaXMub3B0aW9ucy5leHRlbnQgKiAocHggKiB6MiAtIHgpKSwgTWF0aC5yb3VuZCh0aGlzLm9wdGlvbnMuZXh0ZW50ICogKHB5ICogejIgLSB5KSldXSxcclxuICAgICAgICB0YWdzXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBhc3NpZ24gaWRcclxuICAgICAgdmFyIGlkID0gdm9pZCAwO1xyXG4gICAgICBpZiAoaXNDbHVzdGVyIHx8IHRoaXMub3B0aW9ucy5nZW5lcmF0ZUlkKSB7XHJcbiAgICAgICAgLy8gb3B0aW9uYWxseSBnZW5lcmF0ZSBpZCBmb3IgcG9pbnRzXHJcbiAgICAgICAgaWQgPSBkYXRhW2sgKyBPRkZTRVRfSURdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIGtlZXAgaWQgaWYgYWxyZWFkeSBhc3NpZ25lZFxyXG4gICAgICAgIGlkID0gdGhpcy5wb2ludHNbZGF0YVtrICsgT0ZGU0VUX0lEXV0uaWQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlkICE9PSB1bmRlZmluZWQpIGYuaWQgPSBpZDtcclxuICAgICAgdGlsZS5mZWF0dXJlcy5wdXNoKGYpO1xyXG4gICAgfVxyXG4gIH1cclxuICBfbGltaXRab29tKHopIHtcclxuICAgIHJldHVybiBNYXRoLm1heCh0aGlzLm9wdGlvbnMubWluWm9vbSwgTWF0aC5taW4oTWF0aC5mbG9vcigreiksIHRoaXMub3B0aW9ucy5tYXhab29tICsgMSkpO1xyXG4gIH1cclxuICBfY2x1c3Rlcih0cmVlLCB6b29tKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICByYWRpdXMsXHJcbiAgICAgIGV4dGVudCxcclxuICAgICAgcmVkdWNlLFxyXG4gICAgICBtaW5Qb2ludHNcclxuICAgIH0gPSB0aGlzLm9wdGlvbnM7XHJcbiAgICB2YXIgciA9IHJhZGl1cyAvIChleHRlbnQgKiBNYXRoLnBvdygyLCB6b29tKSk7XHJcbiAgICB2YXIgZGF0YSA9IHRyZWUuZGF0YTtcclxuICAgIHZhciBuZXh0RGF0YSA9IFtdO1xyXG4gICAgdmFyIHN0cmlkZSA9IHRoaXMuc3RyaWRlO1xyXG5cclxuICAgIC8vIGxvb3AgdGhyb3VnaCBlYWNoIHBvaW50XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IHN0cmlkZSkge1xyXG4gICAgICAvLyBpZiB3ZSd2ZSBhbHJlYWR5IHZpc2l0ZWQgdGhlIHBvaW50IGF0IHRoaXMgem9vbSBsZXZlbCwgc2tpcCBpdFxyXG4gICAgICBpZiAoZGF0YVtpICsgT0ZGU0VUX1pPT01dIDw9IHpvb20pIGNvbnRpbnVlO1xyXG4gICAgICBkYXRhW2kgKyBPRkZTRVRfWk9PTV0gPSB6b29tO1xyXG5cclxuICAgICAgLy8gZmluZCBhbGwgbmVhcmJ5IHBvaW50c1xyXG4gICAgICB2YXIgeCA9IGRhdGFbaV07XHJcbiAgICAgIHZhciB5ID0gZGF0YVtpICsgMV07XHJcbiAgICAgIHZhciBuZWlnaGJvcklkcyA9IHRyZWUud2l0aGluKGRhdGFbaV0sIGRhdGFbaSArIDFdLCByKTtcclxuICAgICAgdmFyIG51bVBvaW50c09yaWdpbiA9IGRhdGFbaSArIE9GRlNFVF9OVU1dO1xyXG4gICAgICB2YXIgbnVtUG9pbnRzID0gbnVtUG9pbnRzT3JpZ2luO1xyXG5cclxuICAgICAgLy8gY291bnQgdGhlIG51bWJlciBvZiBwb2ludHMgaW4gYSBwb3RlbnRpYWwgY2x1c3RlclxyXG4gICAgICBmb3IgKHZhciBuZWlnaGJvcklkIG9mIG5laWdoYm9ySWRzKSB7XHJcbiAgICAgICAgdmFyIGsgPSBuZWlnaGJvcklkICogc3RyaWRlO1xyXG4gICAgICAgIC8vIGZpbHRlciBvdXQgbmVpZ2hib3JzIHRoYXQgYXJlIGFscmVhZHkgcHJvY2Vzc2VkXHJcbiAgICAgICAgaWYgKGRhdGFbayArIE9GRlNFVF9aT09NXSA+IHpvb20pIG51bVBvaW50cyArPSBkYXRhW2sgKyBPRkZTRVRfTlVNXTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gaWYgdGhlcmUgd2VyZSBuZWlnaGJvcnMgdG8gbWVyZ2UsIGFuZCB0aGVyZSBhcmUgZW5vdWdoIHBvaW50cyB0byBmb3JtIGEgY2x1c3RlclxyXG4gICAgICBpZiAobnVtUG9pbnRzID4gbnVtUG9pbnRzT3JpZ2luICYmIG51bVBvaW50cyA+PSBtaW5Qb2ludHMpIHtcclxuICAgICAgICB2YXIgd3ggPSB4ICogbnVtUG9pbnRzT3JpZ2luO1xyXG4gICAgICAgIHZhciB3eSA9IHkgKiBudW1Qb2ludHNPcmlnaW47XHJcbiAgICAgICAgdmFyIGNsdXN0ZXJQcm9wZXJ0aWVzID0gdm9pZCAwO1xyXG4gICAgICAgIHZhciBjbHVzdGVyUHJvcEluZGV4ID0gLTE7XHJcblxyXG4gICAgICAgIC8vIGVuY29kZSBib3RoIHpvb20gYW5kIHBvaW50IGluZGV4IG9uIHdoaWNoIHRoZSBjbHVzdGVyIG9yaWdpbmF0ZWQgLS0gb2Zmc2V0IGJ5IHRvdGFsIGxlbmd0aCBvZiBmZWF0dXJlc1xyXG4gICAgICAgIHZhciBpZCA9ICgoaSAvIHN0cmlkZSB8IDApIDw8IDUpICsgKHpvb20gKyAxKSArIHRoaXMucG9pbnRzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBfbmVpZ2hib3JJZCBvZiBuZWlnaGJvcklkcykge1xyXG4gICAgICAgICAgdmFyIF9rID0gX25laWdoYm9ySWQgKiBzdHJpZGU7XHJcbiAgICAgICAgICBpZiAoZGF0YVtfayArIE9GRlNFVF9aT09NXSA8PSB6b29tKSBjb250aW51ZTtcclxuICAgICAgICAgIGRhdGFbX2sgKyBPRkZTRVRfWk9PTV0gPSB6b29tOyAvLyBzYXZlIHRoZSB6b29tIChzbyBpdCBkb2Vzbid0IGdldCBwcm9jZXNzZWQgdHdpY2UpXHJcblxyXG4gICAgICAgICAgdmFyIG51bVBvaW50czIgPSBkYXRhW19rICsgT0ZGU0VUX05VTV07XHJcbiAgICAgICAgICB3eCArPSBkYXRhW19rXSAqIG51bVBvaW50czI7IC8vIGFjY3VtdWxhdGUgY29vcmRpbmF0ZXMgZm9yIGNhbGN1bGF0aW5nIHdlaWdodGVkIGNlbnRlclxyXG4gICAgICAgICAgd3kgKz0gZGF0YVtfayArIDFdICogbnVtUG9pbnRzMjtcclxuICAgICAgICAgIGRhdGFbX2sgKyBPRkZTRVRfUEFSRU5UXSA9IGlkO1xyXG4gICAgICAgICAgaWYgKHJlZHVjZSkge1xyXG4gICAgICAgICAgICBpZiAoIWNsdXN0ZXJQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgY2x1c3RlclByb3BlcnRpZXMgPSB0aGlzLl9tYXAoZGF0YSwgaSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgY2x1c3RlclByb3BJbmRleCA9IHRoaXMuY2x1c3RlclByb3BzLmxlbmd0aDtcclxuICAgICAgICAgICAgICB0aGlzLmNsdXN0ZXJQcm9wcy5wdXNoKGNsdXN0ZXJQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZWR1Y2UoY2x1c3RlclByb3BlcnRpZXMsIHRoaXMuX21hcChkYXRhLCBfaykpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBkYXRhW2kgKyBPRkZTRVRfUEFSRU5UXSA9IGlkO1xyXG4gICAgICAgIG5leHREYXRhLnB1c2god3ggLyBudW1Qb2ludHMsIHd5IC8gbnVtUG9pbnRzLCBJbmZpbml0eSwgaWQsIC0xLCBudW1Qb2ludHMpO1xyXG4gICAgICAgIGlmIChyZWR1Y2UpIG5leHREYXRhLnB1c2goY2x1c3RlclByb3BJbmRleCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gbGVmdCBwb2ludHMgYXMgdW5jbHVzdGVyZWRcclxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHN0cmlkZTsgaisrKSBuZXh0RGF0YS5wdXNoKGRhdGFbaSArIGpdKTtcclxuICAgICAgICBpZiAobnVtUG9pbnRzID4gMSkge1xyXG4gICAgICAgICAgZm9yICh2YXIgX25laWdoYm9ySWQyIG9mIG5laWdoYm9ySWRzKSB7XHJcbiAgICAgICAgICAgIHZhciBfazIgPSBfbmVpZ2hib3JJZDIgKiBzdHJpZGU7XHJcbiAgICAgICAgICAgIGlmIChkYXRhW19rMiArIE9GRlNFVF9aT09NXSA8PSB6b29tKSBjb250aW51ZTtcclxuICAgICAgICAgICAgZGF0YVtfazIgKyBPRkZTRVRfWk9PTV0gPSB6b29tO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgc3RyaWRlOyBfaisrKSBuZXh0RGF0YS5wdXNoKGRhdGFbX2syICsgX2pdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXh0RGF0YTtcclxuICB9XHJcblxyXG4gIC8vIGdldCBpbmRleCBvZiB0aGUgcG9pbnQgZnJvbSB3aGljaCB0aGUgY2x1c3RlciBvcmlnaW5hdGVkXHJcbiAgX2dldE9yaWdpbklkKGNsdXN0ZXJJZCkge1xyXG4gICAgcmV0dXJuIGNsdXN0ZXJJZCAtIHRoaXMucG9pbnRzLmxlbmd0aCA+PiA1O1xyXG4gIH1cclxuXHJcbiAgLy8gZ2V0IHpvb20gb2YgdGhlIHBvaW50IGZyb20gd2hpY2ggdGhlIGNsdXN0ZXIgb3JpZ2luYXRlZFxyXG4gIF9nZXRPcmlnaW5ab29tKGNsdXN0ZXJJZCkge1xyXG4gICAgcmV0dXJuIChjbHVzdGVySWQgLSB0aGlzLnBvaW50cy5sZW5ndGgpICUgMzI7XHJcbiAgfVxyXG4gIF9tYXAoZGF0YSwgaSwgY2xvbmUpIHtcclxuICAgIGlmIChkYXRhW2kgKyBPRkZTRVRfTlVNXSA+IDEpIHtcclxuICAgICAgdmFyIHByb3BzID0gdGhpcy5jbHVzdGVyUHJvcHNbZGF0YVtpICsgT0ZGU0VUX1BST1BdXTtcclxuICAgICAgcmV0dXJuIGNsb25lID8gT2JqZWN0LmFzc2lnbih7fSwgcHJvcHMpIDogcHJvcHM7XHJcbiAgICB9XHJcbiAgICB2YXIgb3JpZ2luYWwgPSB0aGlzLnBvaW50c1tkYXRhW2kgKyBPRkZTRVRfSURdXS5wcm9wZXJ0aWVzO1xyXG4gICAgdmFyIHJlc3VsdCA9IHRoaXMub3B0aW9ucy5tYXAob3JpZ2luYWwpO1xyXG4gICAgcmV0dXJuIGNsb25lICYmIHJlc3VsdCA9PT0gb3JpZ2luYWwgPyBPYmplY3QuYXNzaWduKHt9LCByZXN1bHQpIDogcmVzdWx0O1xyXG4gIH1cclxufVxyXG5mdW5jdGlvbiBnZXRDbHVzdGVySlNPTihkYXRhLCBpLCBjbHVzdGVyUHJvcHMpIHtcclxuICByZXR1cm4ge1xyXG4gICAgdHlwZTogJ0ZlYXR1cmUnLFxyXG4gICAgaWQ6IGRhdGFbaSArIE9GRlNFVF9JRF0sXHJcbiAgICBwcm9wZXJ0aWVzOiBnZXRDbHVzdGVyUHJvcGVydGllcyhkYXRhLCBpLCBjbHVzdGVyUHJvcHMpLFxyXG4gICAgZ2VvbWV0cnk6IHtcclxuICAgICAgdHlwZTogJ1BvaW50JyxcclxuICAgICAgY29vcmRpbmF0ZXM6IFt4TG5nKGRhdGFbaV0pLCB5TGF0KGRhdGFbaSArIDFdKV1cclxuICAgIH1cclxuICB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldENsdXN0ZXJQcm9wZXJ0aWVzKGRhdGEsIGksIGNsdXN0ZXJQcm9wcykge1xyXG4gIHZhciBjb3VudCA9IGRhdGFbaSArIE9GRlNFVF9OVU1dO1xyXG4gIHZhciBhYmJyZXYgPSBjb3VudCA+PSAxMDAwMCA/IFwiXCIuY29uY2F0KE1hdGgucm91bmQoY291bnQgLyAxMDAwKSwgXCJrXCIpIDogY291bnQgPj0gMTAwMCA/IFwiXCIuY29uY2F0KE1hdGgucm91bmQoY291bnQgLyAxMDApIC8gMTAsIFwia1wiKSA6IGNvdW50O1xyXG4gIHZhciBwcm9wSW5kZXggPSBkYXRhW2kgKyBPRkZTRVRfUFJPUF07XHJcbiAgdmFyIHByb3BlcnRpZXMgPSBwcm9wSW5kZXggPT09IC0xID8ge30gOiBPYmplY3QuYXNzaWduKHt9LCBjbHVzdGVyUHJvcHNbcHJvcEluZGV4XSk7XHJcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24ocHJvcGVydGllcywge1xyXG4gICAgY2x1c3RlcjogdHJ1ZSxcclxuICAgIGNsdXN0ZXJfaWQ6IGRhdGFbaSArIE9GRlNFVF9JRF0sXHJcbiAgICBwb2ludF9jb3VudDogY291bnQsXHJcbiAgICBwb2ludF9jb3VudF9hYmJyZXZpYXRlZDogYWJicmV2XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vIGxvbmdpdHVkZS9sYXRpdHVkZSB0byBzcGhlcmljYWwgbWVyY2F0b3IgaW4gWzAuLjFdIHJhbmdlXHJcbmZ1bmN0aW9uIGxuZ1gobG5nKSB7XHJcbiAgcmV0dXJuIGxuZyAvIDM2MCArIDAuNTtcclxufVxyXG5mdW5jdGlvbiBsYXRZKGxhdCkge1xyXG4gIHZhciBzaW4gPSBNYXRoLnNpbihsYXQgKiBNYXRoLlBJIC8gMTgwKTtcclxuICB2YXIgeSA9IDAuNSAtIDAuMjUgKiBNYXRoLmxvZygoMSArIHNpbikgLyAoMSAtIHNpbikpIC8gTWF0aC5QSTtcclxuICByZXR1cm4geSA8IDAgPyAwIDogeSA+IDEgPyAxIDogeTtcclxufVxyXG5cclxuLy8gc3BoZXJpY2FsIG1lcmNhdG9yIHRvIGxvbmdpdHVkZS9sYXRpdHVkZVxyXG5mdW5jdGlvbiB4TG5nKHgpIHtcclxuICByZXR1cm4gKHggLSAwLjUpICogMzYwO1xyXG59XHJcbmZ1bmN0aW9uIHlMYXQoeSkge1xyXG4gIHZhciB5MiA9ICgxODAgLSB5ICogMzYwKSAqIE1hdGguUEkgLyAxODA7XHJcbiAgcmV0dXJuIDM2MCAqIE1hdGguYXRhbihNYXRoLmV4cCh5MikpIC8gTWF0aC5QSSAtIDkwO1xyXG59XHJcblxyXG4vKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG5cclxuZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICB2YXIgdCA9IHt9O1xyXG4gIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKSB0W3BdID0gc1twXTtcclxuICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSkgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgfVxyXG4gIHJldHVybiB0O1xyXG59XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogdXRpbCBjbGFzcyB0aGF0IGNyZWF0ZXMgYSBjb21tb24gc2V0IG9mIGNvbnZlbmllbmNlIGZ1bmN0aW9ucyB0byB3cmFwXHJcbiAqIHNoYXJlZCBiZWhhdmlvciBvZiBBZHZhbmNlZCBNYXJrZXJzIGFuZCBNYXJrZXJzLlxyXG4gKi9cclxuY2xhc3MgTWFya2VyVXRpbHMge1xyXG4gIHN0YXRpYyBpc0FkdmFuY2VkTWFya2VyQXZhaWxhYmxlKG1hcCkge1xyXG4gICAgcmV0dXJuIGdvb2dsZS5tYXBzLm1hcmtlciAmJiBtYXAuZ2V0TWFwQ2FwYWJpbGl0aWVzKCkuaXNBZHZhbmNlZE1hcmtlcnNBdmFpbGFibGUgPT09IHRydWU7XHJcbiAgfVxyXG4gIHN0YXRpYyBpc0FkdmFuY2VkTWFya2VyKG1hcmtlcikge1xyXG4gICAgcmV0dXJuIGdvb2dsZS5tYXBzLm1hcmtlciAmJiBtYXJrZXIgaW5zdGFuY2VvZiBnb29nbGUubWFwcy5tYXJrZXIuQWR2YW5jZWRNYXJrZXJFbGVtZW50O1xyXG4gIH1cclxuICBzdGF0aWMgc2V0TWFwKG1hcmtlciwgbWFwKSB7XHJcbiAgICBpZiAodGhpcy5pc0FkdmFuY2VkTWFya2VyKG1hcmtlcikpIHtcclxuICAgICAgbWFya2VyLm1hcCA9IG1hcDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcmtlci5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9XHJcbiAgc3RhdGljIGdldFBvc2l0aW9uKG1hcmtlcikge1xyXG4gICAgLy8gU3VwZXJDbHVzdGVyQWxnb3JpdGhtLmNhbGN1bGF0ZSBleHBlY3RzIGEgTGF0TG5nIGluc3RhbmNlIHNvIHdlIGZha2UgaXQgZm9yIEFkdiBNYXJrZXJzXHJcbiAgICBpZiAodGhpcy5pc0FkdmFuY2VkTWFya2VyKG1hcmtlcikpIHtcclxuICAgICAgaWYgKG1hcmtlci5wb3NpdGlvbikge1xyXG4gICAgICAgIGlmIChtYXJrZXIucG9zaXRpb24gaW5zdGFuY2VvZiBnb29nbGUubWFwcy5MYXRMbmcpIHtcclxuICAgICAgICAgIHJldHVybiBtYXJrZXIucG9zaXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IGNhc3QgdG8gTGF0TG5nTGl0ZXJhbCBmb3IgcmVhc29ucyA9KFxyXG4gICAgICAgIGlmIChtYXJrZXIucG9zaXRpb24ubGF0ICYmIG1hcmtlci5wb3NpdGlvbi5sbmcpIHtcclxuICAgICAgICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKG1hcmtlci5wb3NpdGlvbi5sYXQsIG1hcmtlci5wb3NpdGlvbi5sbmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhudWxsKTtcclxuICAgIH1cclxuICAgIHJldHVybiBtYXJrZXIuZ2V0UG9zaXRpb24oKTtcclxuICB9XHJcbiAgc3RhdGljIGdldFZpc2libGUobWFya2VyKSB7XHJcbiAgICBpZiAodGhpcy5pc0FkdmFuY2VkTWFya2VyKG1hcmtlcikpIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIEFsd2F5cyByZXR1cm4gdHJ1ZSBmb3IgQWR2YW5jZWQgTWFya2VycyBiZWNhdXNlIHRoZSBjbHVzdGVyZXJcclxuICAgICAgICogdXNlcyBnZXRWaXNpYmxlIGFzIGEgd2F5IHRvIGNvdW50IGxlZ2FjeSBtYXJrZXJzIG5vdCBhcyBhbiBhY3R1YWxcclxuICAgICAgICogaW5kaWNhdG9yIG9mIHZpc2liaWxpdHkgZm9yIHNvbWUgcmVhc29uLiBFdmVuIHdoZW4gbWFya2VycyBhcmUgaGlkZGVuXHJcbiAgICAgICAqIE1hcmtlci5nZXRWaXNpYmxlIHJldHVybnMgYHRydWVgIGFuZCB0aGlzIGlzIHVzZWQgdG8gc2V0IHRoZSBtYXJrZXIgY291bnRcclxuICAgICAgICogb24gdGhlIGNsdXN0ZXIuIFNlZSB0aGUgYmVoYXZpb3Igb2YgQ2x1c3Rlci5jb3VudFxyXG4gICAgICAgKi9cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbWFya2VyLmdldFZpc2libGUoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIENsdXN0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKF9yZWYpIHtcclxuICAgIHZhciB7XHJcbiAgICAgIG1hcmtlcnMsXHJcbiAgICAgIHBvc2l0aW9uXHJcbiAgICB9ID0gX3JlZjtcclxuICAgIHRoaXMubWFya2VycyA9IG1hcmtlcnM7XHJcbiAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgaWYgKHBvc2l0aW9uIGluc3RhbmNlb2YgZ29vZ2xlLm1hcHMuTGF0TG5nKSB7XHJcbiAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocG9zaXRpb24pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldCBib3VuZHMoKSB7XHJcbiAgICBpZiAodGhpcy5tYXJrZXJzLmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5fcG9zaXRpb24pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHModGhpcy5fcG9zaXRpb24sIHRoaXMuX3Bvc2l0aW9uKTtcclxuICAgIGZvciAodmFyIG1hcmtlciBvZiB0aGlzLm1hcmtlcnMpIHtcclxuICAgICAgYm91bmRzLmV4dGVuZChNYXJrZXJVdGlscy5nZXRQb3NpdGlvbihtYXJrZXIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBib3VuZHM7XHJcbiAgfVxyXG4gIGdldCBwb3NpdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbiB8fCB0aGlzLmJvdW5kcy5nZXRDZW50ZXIoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBjb3VudCBvZiAqKnZpc2libGUqKiBtYXJrZXJzLlxyXG4gICAqL1xyXG4gIGdldCBjb3VudCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1hcmtlcnMuZmlsdGVyKG0gPT4gTWFya2VyVXRpbHMuZ2V0VmlzaWJsZShtKSkubGVuZ3RoO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBBZGQgYSBtYXJrZXIgdG8gdGhlIGNsdXN0ZXIuXHJcbiAgICovXHJcbiAgcHVzaChtYXJrZXIpIHtcclxuICAgIHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIENsZWFudXAgcmVmZXJlbmNlcyBhbmQgcmVtb3ZlIG1hcmtlciBmcm9tIG1hcC5cclxuICAgKi9cclxuICBkZWxldGUoKSB7XHJcbiAgICBpZiAodGhpcy5tYXJrZXIpIHtcclxuICAgICAgTWFya2VyVXRpbHMuc2V0TWFwKHRoaXMubWFya2VyLCBudWxsKTtcclxuICAgICAgdGhpcy5tYXJrZXIgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLm1hcmtlcnMubGVuZ3RoID0gMDtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSBtYXJrZXJzIHZpc2libGUgaW4gYSBwYWRkZWQgbWFwIHZpZXdwb3J0XHJcbiAqXHJcbiAqIEBwYXJhbSBtYXBcclxuICogQHBhcmFtIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICogQHBhcmFtIG1hcmtlcnMgVGhlIGxpc3Qgb2YgbWFya2VyIHRvIGZpbHRlclxyXG4gKiBAcGFyYW0gdmlld3BvcnRQYWRkaW5nUGl4ZWxzIFRoZSBwYWRkaW5nIGluIHBpeGVsXHJcbiAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIG1hcmtlcnMgaW4gdGhlIHBhZGRlZCB2aWV3cG9ydFxyXG4gKi9cclxudmFyIGZpbHRlck1hcmtlcnNUb1BhZGRlZFZpZXdwb3J0ID0gKG1hcCwgbWFwQ2FudmFzUHJvamVjdGlvbiwgbWFya2Vycywgdmlld3BvcnRQYWRkaW5nUGl4ZWxzKSA9PiB7XHJcbiAgdmFyIGV4dGVuZGVkTWFwQm91bmRzID0gZXh0ZW5kQm91bmRzVG9QYWRkZWRWaWV3cG9ydChtYXAuZ2V0Qm91bmRzKCksIG1hcENhbnZhc1Byb2plY3Rpb24sIHZpZXdwb3J0UGFkZGluZ1BpeGVscyk7XHJcbiAgcmV0dXJuIG1hcmtlcnMuZmlsdGVyKG1hcmtlciA9PiBleHRlbmRlZE1hcEJvdW5kcy5jb250YWlucyhNYXJrZXJVdGlscy5nZXRQb3NpdGlvbihtYXJrZXIpKSk7XHJcbn07XHJcbi8qKlxyXG4gKiBFeHRlbmRzIGEgYm91bmRzIGJ5IGEgbnVtYmVyIG9mIHBpeGVscyBpbiBlYWNoIGRpcmVjdGlvblxyXG4gKi9cclxudmFyIGV4dGVuZEJvdW5kc1RvUGFkZGVkVmlld3BvcnQgPSAoYm91bmRzLCBwcm9qZWN0aW9uLCBudW1QaXhlbHMpID0+IHtcclxuICB2YXIge1xyXG4gICAgbm9ydGhFYXN0LFxyXG4gICAgc291dGhXZXN0XHJcbiAgfSA9IGxhdExuZ0JvdW5kc1RvUGl4ZWxCb3VuZHMoYm91bmRzLCBwcm9qZWN0aW9uKTtcclxuICB2YXIgZXh0ZW5kZWRQaXhlbEJvdW5kcyA9IGV4dGVuZFBpeGVsQm91bmRzKHtcclxuICAgIG5vcnRoRWFzdCxcclxuICAgIHNvdXRoV2VzdFxyXG4gIH0sIG51bVBpeGVscyk7XHJcbiAgcmV0dXJuIHBpeGVsQm91bmRzVG9MYXRMbmdCb3VuZHMoZXh0ZW5kZWRQaXhlbEJvdW5kcywgcHJvamVjdGlvbik7XHJcbn07XHJcbi8qKlxyXG4gKiBHZXRzIHRoZSBleHRlbmRlZCBib3VuZHMgYXMgYSBiYm94IFt3ZXN0TG5nLCBzb3V0aExhdCwgZWFzdExuZywgbm9ydGhMYXRdXHJcbiAqL1xyXG52YXIgZ2V0UGFkZGVkVmlld3BvcnQgPSAoYm91bmRzLCBwcm9qZWN0aW9uLCBwaXhlbHMpID0+IHtcclxuICB2YXIgZXh0ZW5kZWQgPSBleHRlbmRCb3VuZHNUb1BhZGRlZFZpZXdwb3J0KGJvdW5kcywgcHJvamVjdGlvbiwgcGl4ZWxzKTtcclxuICB2YXIgbmUgPSBleHRlbmRlZC5nZXROb3J0aEVhc3QoKTtcclxuICB2YXIgc3cgPSBleHRlbmRlZC5nZXRTb3V0aFdlc3QoKTtcclxuICByZXR1cm4gW3N3LmxuZygpLCBzdy5sYXQoKSwgbmUubG5nKCksIG5lLmxhdCgpXTtcclxufTtcclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIGRpc3RhbmNlIGJldHdlZW4gMiBwb3NpdGlvbnMuXHJcbiAqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBkaXN0YW5jZUJldHdlZW5Qb2ludHMgPSAocDEsIHAyKSA9PiB7XHJcbiAgdmFyIFIgPSA2MzcxOyAvLyBSYWRpdXMgb2YgdGhlIEVhcnRoIGluIGttXHJcbiAgdmFyIGRMYXQgPSAocDIubGF0IC0gcDEubGF0KSAqIE1hdGguUEkgLyAxODA7XHJcbiAgdmFyIGRMb24gPSAocDIubG5nIC0gcDEubG5nKSAqIE1hdGguUEkgLyAxODA7XHJcbiAgdmFyIHNpbkRMYXQgPSBNYXRoLnNpbihkTGF0IC8gMik7XHJcbiAgdmFyIHNpbkRMb24gPSBNYXRoLnNpbihkTG9uIC8gMik7XHJcbiAgdmFyIGEgPSBzaW5ETGF0ICogc2luRExhdCArIE1hdGguY29zKHAxLmxhdCAqIE1hdGguUEkgLyAxODApICogTWF0aC5jb3MocDIubGF0ICogTWF0aC5QSSAvIDE4MCkgKiBzaW5ETG9uICogc2luRExvbjtcclxuICB2YXIgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSk7XHJcbiAgcmV0dXJuIFIgKiBjO1xyXG59O1xyXG4vKipcclxuICogQ29udmVydHMgYSBMYXRMbmcgYm91bmQgdG8gcGl4ZWxzLlxyXG4gKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG52YXIgbGF0TG5nQm91bmRzVG9QaXhlbEJvdW5kcyA9IChib3VuZHMsIHByb2plY3Rpb24pID0+IHtcclxuICByZXR1cm4ge1xyXG4gICAgbm9ydGhFYXN0OiBwcm9qZWN0aW9uLmZyb21MYXRMbmdUb0RpdlBpeGVsKGJvdW5kcy5nZXROb3J0aEVhc3QoKSksXHJcbiAgICBzb3V0aFdlc3Q6IHByb2plY3Rpb24uZnJvbUxhdExuZ1RvRGl2UGl4ZWwoYm91bmRzLmdldFNvdXRoV2VzdCgpKVxyXG4gIH07XHJcbn07XHJcbi8qKlxyXG4gKiBFeHRlbmRzIGEgcGl4ZWwgYm91bmRzIGJ5IG51bVBpeGVscyBpbiBhbGwgZGlyZWN0aW9ucy5cclxuICpcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIGV4dGVuZFBpeGVsQm91bmRzID0gKF9yZWYyLCBudW1QaXhlbHMpID0+IHtcclxuICB2YXIge1xyXG4gICAgbm9ydGhFYXN0LFxyXG4gICAgc291dGhXZXN0XHJcbiAgfSA9IF9yZWYyO1xyXG4gIG5vcnRoRWFzdC54ICs9IG51bVBpeGVscztcclxuICBub3J0aEVhc3QueSAtPSBudW1QaXhlbHM7XHJcbiAgc291dGhXZXN0LnggLT0gbnVtUGl4ZWxzO1xyXG4gIHNvdXRoV2VzdC55ICs9IG51bVBpeGVscztcclxuICByZXR1cm4ge1xyXG4gICAgbm9ydGhFYXN0LFxyXG4gICAgc291dGhXZXN0XHJcbiAgfTtcclxufTtcclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBwaXhlbEJvdW5kc1RvTGF0TG5nQm91bmRzID0gKF9yZWYzLCBwcm9qZWN0aW9uKSA9PiB7XHJcbiAgdmFyIHtcclxuICAgIG5vcnRoRWFzdCxcclxuICAgIHNvdXRoV2VzdFxyXG4gIH0gPSBfcmVmMztcclxuICB2YXIgc3cgPSBwcm9qZWN0aW9uLmZyb21EaXZQaXhlbFRvTGF0TG5nKHNvdXRoV2VzdCk7XHJcbiAgdmFyIG5lID0gcHJvamVjdGlvbi5mcm9tRGl2UGl4ZWxUb0xhdExuZyhub3J0aEVhc3QpO1xyXG4gIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKHN3LCBuZSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxuY2xhc3MgQWJzdHJhY3RBbGdvcml0aG0ge1xyXG4gIGNvbnN0cnVjdG9yKF9yZWY0KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXhab29tID0gMTZcclxuICAgIH0gPSBfcmVmNDtcclxuICAgIHRoaXMubWF4Wm9vbSA9IG1heFpvb207XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIEhlbHBlciBmdW5jdGlvbiB0byBieXBhc3MgY2x1c3RlcmluZyBiYXNlZCB1cG9uIHNvbWUgbWFwIHN0YXRlIHN1Y2ggYXNcclxuICAgKiB6b29tLCBudW1iZXIgb2YgbWFya2VycywgZXRjLlxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqICBjbHVzdGVyKHttYXJrZXJzLCBtYXB9OiBBbGdvcml0aG1JbnB1dCk6IENsdXN0ZXJbXSB7XHJcbiAgICogICAgaWYgKHNob3VsZEJ5cGFzc0NsdXN0ZXJpbmcobWFwKSkge1xyXG4gICAqICAgICAgcmV0dXJuIHRoaXMubm9vcCh7bWFya2Vyc30pXHJcbiAgICogICAgfVxyXG4gICAqIH1cclxuICAgKiBgYGBcclxuICAgKi9cclxuICBub29wKF9yZWY1KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXJrZXJzXHJcbiAgICB9ID0gX3JlZjU7XHJcbiAgICByZXR1cm4gbm9vcCQxKG1hcmtlcnMpO1xyXG4gIH1cclxufVxyXG4vKipcclxuICogQWJzdHJhY3Qgdmlld3BvcnQgYWxnb3JpdGhtIHByb3ZlcyBhIGNsYXNzIHRvIGZpbHRlciBtYXJrZXJzIGJ5IGEgcGFkZGVkXHJcbiAqIHZpZXdwb3J0LiBUaGlzIGlzIGEgY29tbW9uIG9wdGltaXphdGlvbi5cclxuICpcclxuICogQGhpZGRlblxyXG4gKi9cclxuY2xhc3MgQWJzdHJhY3RWaWV3cG9ydEFsZ29yaXRobSBleHRlbmRzIEFic3RyYWN0QWxnb3JpdGhtIHtcclxuICBjb25zdHJ1Y3RvcihfYSkge1xyXG4gICAgdmFyIHtcclxuICAgICAgICB2aWV3cG9ydFBhZGRpbmcgPSA2MFxyXG4gICAgICB9ID0gX2EsXHJcbiAgICAgIG9wdGlvbnMgPSBfX3Jlc3QoX2EsIFtcInZpZXdwb3J0UGFkZGluZ1wiXSk7XHJcbiAgICBzdXBlcihvcHRpb25zKTtcclxuICAgIHRoaXMudmlld3BvcnRQYWRkaW5nID0gNjA7XHJcbiAgICB0aGlzLnZpZXdwb3J0UGFkZGluZyA9IHZpZXdwb3J0UGFkZGluZztcclxuICB9XHJcbiAgY2FsY3VsYXRlKF9yZWY2KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXJrZXJzLFxyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgIH0gPSBfcmVmNjtcclxuICAgIGlmIChtYXAuZ2V0Wm9vbSgpID49IHRoaXMubWF4Wm9vbSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGNsdXN0ZXJzOiB0aGlzLm5vb3Aoe1xyXG4gICAgICAgICAgbWFya2Vyc1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIGNoYW5nZWQ6IGZhbHNlXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBjbHVzdGVyczogdGhpcy5jbHVzdGVyKHtcclxuICAgICAgICBtYXJrZXJzOiBmaWx0ZXJNYXJrZXJzVG9QYWRkZWRWaWV3cG9ydChtYXAsIG1hcENhbnZhc1Byb2plY3Rpb24sIG1hcmtlcnMsIHRoaXMudmlld3BvcnRQYWRkaW5nKSxcclxuICAgICAgICBtYXAsXHJcbiAgICAgICAgbWFwQ2FudmFzUHJvamVjdGlvblxyXG4gICAgICB9KVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBub29wJDEgPSBtYXJrZXJzID0+IHtcclxuICB2YXIgY2x1c3RlcnMgPSBtYXJrZXJzLm1hcChtYXJrZXIgPT4gbmV3IENsdXN0ZXIoe1xyXG4gICAgcG9zaXRpb246IE1hcmtlclV0aWxzLmdldFBvc2l0aW9uKG1hcmtlciksXHJcbiAgICBtYXJrZXJzOiBbbWFya2VyXVxyXG4gIH0pKTtcclxuICByZXR1cm4gY2x1c3RlcnM7XHJcbn07XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVGhlIGRlZmF1bHQgR3JpZCBhbGdvcml0aG0gaGlzdG9yaWNhbGx5IHVzZWQgaW4gR29vZ2xlIE1hcHMgbWFya2VyXHJcbiAqIGNsdXN0ZXJpbmcuXHJcbiAqXHJcbiAqIFRoZSBHcmlkIGFsZ29yaXRobSBkb2VzIG5vdCBpbXBsZW1lbnQgY2FjaGluZyBhbmQgbWFya2VycyBtYXkgZmxhc2ggYXMgdGhlXHJcbiAqIHZpZXdwb3J0IGNoYW5nZXMuIEluc3RlYWQgdXNlIHtAbGluayBTdXBlckNsdXN0ZXJBbGdvcml0aG19LlxyXG4gKi9cclxuY2xhc3MgR3JpZEFsZ29yaXRobSBleHRlbmRzIEFic3RyYWN0Vmlld3BvcnRBbGdvcml0aG0ge1xyXG4gIGNvbnN0cnVjdG9yKF9hKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICAgIG1heERpc3RhbmNlID0gNDAwMDAsXHJcbiAgICAgICAgZ3JpZFNpemUgPSA0MFxyXG4gICAgICB9ID0gX2EsXHJcbiAgICAgIG9wdGlvbnMgPSBfX3Jlc3QoX2EsIFtcIm1heERpc3RhbmNlXCIsIFwiZ3JpZFNpemVcIl0pO1xyXG4gICAgc3VwZXIob3B0aW9ucyk7XHJcbiAgICB0aGlzLmNsdXN0ZXJzID0gW107XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICB6b29tOiAtMVxyXG4gICAgfTtcclxuICAgIHRoaXMubWF4RGlzdGFuY2UgPSBtYXhEaXN0YW5jZTtcclxuICAgIHRoaXMuZ3JpZFNpemUgPSBncmlkU2l6ZTtcclxuICB9XHJcbiAgY2FsY3VsYXRlKF9yZWY3KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXJrZXJzLFxyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgIH0gPSBfcmVmNztcclxuICAgIHZhciBzdGF0ZSA9IHtcclxuICAgICAgem9vbTogbWFwLmdldFpvb20oKVxyXG4gICAgfTtcclxuICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS56b29tID49IHRoaXMubWF4Wm9vbSAmJiBzdGF0ZS56b29tID49IHRoaXMubWF4Wm9vbSkgO2Vsc2Uge1xyXG4gICAgICBjaGFuZ2VkID0gIWVxdWFsKHRoaXMuc3RhdGUsIHN0YXRlKTtcclxuICAgIH1cclxuICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgIGlmIChtYXAuZ2V0Wm9vbSgpID49IHRoaXMubWF4Wm9vbSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGNsdXN0ZXJzOiB0aGlzLm5vb3Aoe1xyXG4gICAgICAgICAgbWFya2Vyc1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIGNoYW5nZWRcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNsdXN0ZXJzOiB0aGlzLmNsdXN0ZXIoe1xyXG4gICAgICAgIG1hcmtlcnM6IGZpbHRlck1hcmtlcnNUb1BhZGRlZFZpZXdwb3J0KG1hcCwgbWFwQ2FudmFzUHJvamVjdGlvbiwgbWFya2VycywgdGhpcy52aWV3cG9ydFBhZGRpbmcpLFxyXG4gICAgICAgIG1hcCxcclxuICAgICAgICBtYXBDYW52YXNQcm9qZWN0aW9uXHJcbiAgICAgIH0pXHJcbiAgICB9O1xyXG4gIH1cclxuICBjbHVzdGVyKF9yZWY4KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXJrZXJzLFxyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgIH0gPSBfcmVmODtcclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICAgIG1hcmtlcnMuZm9yRWFjaChtYXJrZXIgPT4ge1xyXG4gICAgICB0aGlzLmFkZFRvQ2xvc2VzdENsdXN0ZXIobWFya2VyLCBtYXAsIG1hcENhbnZhc1Byb2plY3Rpb24pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5jbHVzdGVycztcclxuICB9XHJcbiAgYWRkVG9DbG9zZXN0Q2x1c3RlcihtYXJrZXIsIG1hcCwgcHJvamVjdGlvbikge1xyXG4gICAgdmFyIG1heERpc3RhbmNlID0gdGhpcy5tYXhEaXN0YW5jZTsgLy8gU29tZSBsYXJnZSBudW1iZXJcclxuICAgIHZhciBjbHVzdGVyID0gbnVsbDtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jbHVzdGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICB2YXIgY2FuZGlkYXRlID0gdGhpcy5jbHVzdGVyc1tpXTtcclxuICAgICAgdmFyIGRpc3RhbmNlID0gZGlzdGFuY2VCZXR3ZWVuUG9pbnRzKGNhbmRpZGF0ZS5ib3VuZHMuZ2V0Q2VudGVyKCkudG9KU09OKCksIE1hcmtlclV0aWxzLmdldFBvc2l0aW9uKG1hcmtlcikudG9KU09OKCkpO1xyXG4gICAgICBpZiAoZGlzdGFuY2UgPCBtYXhEaXN0YW5jZSkge1xyXG4gICAgICAgIG1heERpc3RhbmNlID0gZGlzdGFuY2U7XHJcbiAgICAgICAgY2x1c3RlciA9IGNhbmRpZGF0ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNsdXN0ZXIgJiYgZXh0ZW5kQm91bmRzVG9QYWRkZWRWaWV3cG9ydChjbHVzdGVyLmJvdW5kcywgcHJvamVjdGlvbiwgdGhpcy5ncmlkU2l6ZSkuY29udGFpbnMoTWFya2VyVXRpbHMuZ2V0UG9zaXRpb24obWFya2VyKSkpIHtcclxuICAgICAgY2x1c3Rlci5wdXNoKG1hcmtlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YXIgX2NsdXN0ZXIgPSBuZXcgQ2x1c3Rlcih7XHJcbiAgICAgICAgbWFya2VyczogW21hcmtlcl1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuY2x1c3RlcnMucHVzaChfY2x1c3Rlcik7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogTm9vcCBhbGdvcml0aG0gZG9lcyBub3QgZ2VuZXJhdGUgYW55IGNsdXN0ZXJzIG9yIGZpbHRlciBtYXJrZXJzIGJ5IHRoZSBhbiBleHRlbmRlZCB2aWV3cG9ydC5cclxuICovXHJcbmNsYXNzIE5vb3BBbGdvcml0aG0gZXh0ZW5kcyBBYnN0cmFjdEFsZ29yaXRobSB7XHJcbiAgY29uc3RydWN0b3IoX2EpIHtcclxuICAgIHZhciBvcHRpb25zID0gX19yZXN0KF9hLCBbXSk7XHJcbiAgICBzdXBlcihvcHRpb25zKTtcclxuICB9XHJcbiAgY2FsY3VsYXRlKF9yZWY5KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXJrZXJzLFxyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgIH0gPSBfcmVmOTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNsdXN0ZXJzOiB0aGlzLmNsdXN0ZXIoe1xyXG4gICAgICAgIG1hcmtlcnMsXHJcbiAgICAgICAgbWFwLFxyXG4gICAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgICAgfSksXHJcbiAgICAgIGNoYW5nZWQ6IGZhbHNlXHJcbiAgICB9O1xyXG4gIH1cclxuICBjbHVzdGVyKGlucHV0KSB7XHJcbiAgICByZXR1cm4gdGhpcy5ub29wKGlucHV0KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBIHZlcnkgZmFzdCBKYXZhU2NyaXB0IGFsZ29yaXRobSBmb3IgZ2Vvc3BhdGlhbCBwb2ludCBjbHVzdGVyaW5nIHVzaW5nIEtEIHRyZWVzLlxyXG4gKlxyXG4gKiBAc2VlIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3N1cGVyY2x1c3RlciBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBvcHRpb25zLlxyXG4gKi9cclxuY2xhc3MgU3VwZXJDbHVzdGVyQWxnb3JpdGhtIGV4dGVuZHMgQWJzdHJhY3RBbGdvcml0aG0ge1xyXG4gIGNvbnN0cnVjdG9yKF9hKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICAgIG1heFpvb20sXHJcbiAgICAgICAgcmFkaXVzID0gNjBcclxuICAgICAgfSA9IF9hLFxyXG4gICAgICBvcHRpb25zID0gX19yZXN0KF9hLCBbXCJtYXhab29tXCIsIFwicmFkaXVzXCJdKTtcclxuICAgIHN1cGVyKHtcclxuICAgICAgbWF4Wm9vbVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICB6b29tOiAtMVxyXG4gICAgfTtcclxuICAgIHRoaXMuc3VwZXJDbHVzdGVyID0gbmV3IFN1cGVyY2x1c3RlcihPYmplY3QuYXNzaWduKHtcclxuICAgICAgbWF4Wm9vbTogdGhpcy5tYXhab29tLFxyXG4gICAgICByYWRpdXNcclxuICAgIH0sIG9wdGlvbnMpKTtcclxuICB9XHJcbiAgY2FsY3VsYXRlKGlucHV0KSB7XHJcbiAgICB2YXIgY2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgdmFyIHN0YXRlID0ge1xyXG4gICAgICB6b29tOiBpbnB1dC5tYXAuZ2V0Wm9vbSgpXHJcbiAgICB9O1xyXG4gICAgaWYgKCFlcXVhbChpbnB1dC5tYXJrZXJzLCB0aGlzLm1hcmtlcnMpKSB7XHJcbiAgICAgIGNoYW5nZWQgPSB0cnVlO1xyXG4gICAgICAvLyBUT0RPIHVzZSBwcm94eSB0byBhdm9pZCBjb3B5P1xyXG4gICAgICB0aGlzLm1hcmtlcnMgPSBbLi4uaW5wdXQubWFya2Vyc107XHJcbiAgICAgIHZhciBwb2ludHMgPSB0aGlzLm1hcmtlcnMubWFwKG1hcmtlciA9PiB7XHJcbiAgICAgICAgdmFyIHBvc2l0aW9uID0gTWFya2VyVXRpbHMuZ2V0UG9zaXRpb24obWFya2VyKTtcclxuICAgICAgICB2YXIgY29vcmRpbmF0ZXMgPSBbcG9zaXRpb24ubG5nKCksIHBvc2l0aW9uLmxhdCgpXTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgdHlwZTogXCJGZWF0dXJlXCIsXHJcbiAgICAgICAgICBnZW9tZXRyeToge1xyXG4gICAgICAgICAgICB0eXBlOiBcIlBvaW50XCIsXHJcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcHJvcGVydGllczoge1xyXG4gICAgICAgICAgICBtYXJrZXJcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zdXBlckNsdXN0ZXIubG9hZChwb2ludHMpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFjaGFuZ2VkKSB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLnpvb20gPD0gdGhpcy5tYXhab29tIHx8IHN0YXRlLnpvb20gPD0gdGhpcy5tYXhab29tKSB7XHJcbiAgICAgICAgY2hhbmdlZCA9ICFlcXVhbCh0aGlzLnN0YXRlLCBzdGF0ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgIGlmIChjaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMuY2x1c3RlcnMgPSB0aGlzLmNsdXN0ZXIoaW5wdXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2x1c3RlcnM6IHRoaXMuY2x1c3RlcnMsXHJcbiAgICAgIGNoYW5nZWRcclxuICAgIH07XHJcbiAgfVxyXG4gIGNsdXN0ZXIoX3JlZjEwKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXBcclxuICAgIH0gPSBfcmVmMTA7XHJcbiAgICByZXR1cm4gdGhpcy5zdXBlckNsdXN0ZXIuZ2V0Q2x1c3RlcnMoWy0xODAsIC05MCwgMTgwLCA5MF0sIE1hdGgucm91bmQobWFwLmdldFpvb20oKSkpLm1hcChmZWF0dXJlID0+IHRoaXMudHJhbnNmb3JtQ2x1c3RlcihmZWF0dXJlKSk7XHJcbiAgfVxyXG4gIHRyYW5zZm9ybUNsdXN0ZXIoX3JlZjExKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBnZW9tZXRyeToge1xyXG4gICAgICAgIGNvb3JkaW5hdGVzOiBbbG5nLCBsYXRdXHJcbiAgICAgIH0sXHJcbiAgICAgIHByb3BlcnRpZXNcclxuICAgIH0gPSBfcmVmMTE7XHJcbiAgICBpZiAocHJvcGVydGllcy5jbHVzdGVyKSB7XHJcbiAgICAgIHJldHVybiBuZXcgQ2x1c3Rlcih7XHJcbiAgICAgICAgbWFya2VyczogdGhpcy5zdXBlckNsdXN0ZXIuZ2V0TGVhdmVzKHByb3BlcnRpZXMuY2x1c3Rlcl9pZCwgSW5maW5pdHkpLm1hcChsZWFmID0+IGxlYWYucHJvcGVydGllcy5tYXJrZXIpLFxyXG4gICAgICAgIHBvc2l0aW9uOiB7XHJcbiAgICAgICAgICBsYXQsXHJcbiAgICAgICAgICBsbmdcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdmFyIG1hcmtlciA9IHByb3BlcnRpZXMubWFya2VyO1xyXG4gICAgcmV0dXJuIG5ldyBDbHVzdGVyKHtcclxuICAgICAgbWFya2VyczogW21hcmtlcl0sXHJcbiAgICAgIHBvc2l0aW9uOiBNYXJrZXJVdGlscy5nZXRQb3NpdGlvbihtYXJrZXIpXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBIHZlcnkgZmFzdCBKYXZhU2NyaXB0IGFsZ29yaXRobSBmb3IgZ2Vvc3BhdGlhbCBwb2ludCBjbHVzdGVyaW5nIHVzaW5nIEtEIHRyZWVzLlxyXG4gKlxyXG4gKiBAc2VlIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3N1cGVyY2x1c3RlciBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBvcHRpb25zLlxyXG4gKi9cclxuY2xhc3MgU3VwZXJDbHVzdGVyVmlld3BvcnRBbGdvcml0aG0gZXh0ZW5kcyBBYnN0cmFjdFZpZXdwb3J0QWxnb3JpdGhtIHtcclxuICBjb25zdHJ1Y3RvcihfYSkge1xyXG4gICAgdmFyIHtcclxuICAgICAgICBtYXhab29tLFxyXG4gICAgICAgIHJhZGl1cyA9IDYwLFxyXG4gICAgICAgIHZpZXdwb3J0UGFkZGluZyA9IDYwXHJcbiAgICAgIH0gPSBfYSxcclxuICAgICAgb3B0aW9ucyA9IF9fcmVzdChfYSwgW1wibWF4Wm9vbVwiLCBcInJhZGl1c1wiLCBcInZpZXdwb3J0UGFkZGluZ1wiXSk7XHJcbiAgICBzdXBlcih7XHJcbiAgICAgIG1heFpvb20sXHJcbiAgICAgIHZpZXdwb3J0UGFkZGluZ1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnN1cGVyQ2x1c3RlciA9IG5ldyBTdXBlcmNsdXN0ZXIoT2JqZWN0LmFzc2lnbih7XHJcbiAgICAgIG1heFpvb206IHRoaXMubWF4Wm9vbSxcclxuICAgICAgcmFkaXVzXHJcbiAgICB9LCBvcHRpb25zKSk7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICB6b29tOiAtMSxcclxuICAgICAgdmlldzogWzAsIDAsIDAsIDBdXHJcbiAgICB9O1xyXG4gIH1cclxuICBjYWxjdWxhdGUoaW5wdXQpIHtcclxuICAgIHZhciBzdGF0ZSA9IHtcclxuICAgICAgem9vbTogTWF0aC5yb3VuZChpbnB1dC5tYXAuZ2V0Wm9vbSgpKSxcclxuICAgICAgdmlldzogZ2V0UGFkZGVkVmlld3BvcnQoaW5wdXQubWFwLmdldEJvdW5kcygpLCBpbnB1dC5tYXBDYW52YXNQcm9qZWN0aW9uLCB0aGlzLnZpZXdwb3J0UGFkZGluZylcclxuICAgIH07XHJcbiAgICB2YXIgY2hhbmdlZCA9ICFlcXVhbCh0aGlzLnN0YXRlLCBzdGF0ZSk7XHJcbiAgICBpZiAoIWVxdWFsKGlucHV0Lm1hcmtlcnMsIHRoaXMubWFya2VycykpIHtcclxuICAgICAgY2hhbmdlZCA9IHRydWU7XHJcbiAgICAgIC8vIFRPRE8gdXNlIHByb3h5IHRvIGF2b2lkIGNvcHk/XHJcbiAgICAgIHRoaXMubWFya2VycyA9IFsuLi5pbnB1dC5tYXJrZXJzXTtcclxuICAgICAgdmFyIHBvaW50cyA9IHRoaXMubWFya2Vycy5tYXAobWFya2VyID0+IHtcclxuICAgICAgICB2YXIgcG9zaXRpb24gPSBNYXJrZXJVdGlscy5nZXRQb3NpdGlvbihtYXJrZXIpO1xyXG4gICAgICAgIHZhciBjb29yZGluYXRlcyA9IFtwb3NpdGlvbi5sbmcoKSwgcG9zaXRpb24ubGF0KCldO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICB0eXBlOiBcIkZlYXR1cmVcIixcclxuICAgICAgICAgIGdlb21ldHJ5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiUG9pbnRcIixcclxuICAgICAgICAgICAgY29vcmRpbmF0ZXNcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgICAgIG1hcmtlclxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnN1cGVyQ2x1c3Rlci5sb2FkKHBvaW50cyk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2hhbmdlZCkge1xyXG4gICAgICB0aGlzLmNsdXN0ZXJzID0gdGhpcy5jbHVzdGVyKGlucHV0KTtcclxuICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2x1c3RlcnM6IHRoaXMuY2x1c3RlcnMsXHJcbiAgICAgIGNoYW5nZWRcclxuICAgIH07XHJcbiAgfVxyXG4gIGNsdXN0ZXIoX3JlZjEyKSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcENhbnZhc1Byb2plY3Rpb25cclxuICAgIH0gPSBfcmVmMTI7XHJcbiAgICAvKiByZWNhbGN1bGF0ZSBuZXcgc3RhdGUgYmVjYXVzZSB3ZSBjYW4ndCB1c2UgdGhlIGNhY2hlZCB2ZXJzaW9uLiAqL1xyXG4gICAgdmFyIHN0YXRlID0ge1xyXG4gICAgICB6b29tOiBNYXRoLnJvdW5kKG1hcC5nZXRab29tKCkpLFxyXG4gICAgICB2aWV3OiBnZXRQYWRkZWRWaWV3cG9ydChtYXAuZ2V0Qm91bmRzKCksIG1hcENhbnZhc1Byb2plY3Rpb24sIHRoaXMudmlld3BvcnRQYWRkaW5nKVxyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnN1cGVyQ2x1c3Rlci5nZXRDbHVzdGVycyhzdGF0ZS52aWV3LCBzdGF0ZS56b29tKS5tYXAoZmVhdHVyZSA9PiB0aGlzLnRyYW5zZm9ybUNsdXN0ZXIoZmVhdHVyZSkpO1xyXG4gIH1cclxuICB0cmFuc2Zvcm1DbHVzdGVyKF9yZWYxMykge1xyXG4gICAgdmFyIHtcclxuICAgICAgZ2VvbWV0cnk6IHtcclxuICAgICAgICBjb29yZGluYXRlczogW2xuZywgbGF0XVxyXG4gICAgICB9LFxyXG4gICAgICBwcm9wZXJ0aWVzXHJcbiAgICB9ID0gX3JlZjEzO1xyXG4gICAgaWYgKHByb3BlcnRpZXMuY2x1c3Rlcikge1xyXG4gICAgICByZXR1cm4gbmV3IENsdXN0ZXIoe1xyXG4gICAgICAgIG1hcmtlcnM6IHRoaXMuc3VwZXJDbHVzdGVyLmdldExlYXZlcyhwcm9wZXJ0aWVzLmNsdXN0ZXJfaWQsIEluZmluaXR5KS5tYXAobGVhZiA9PiBsZWFmLnByb3BlcnRpZXMubWFya2VyKSxcclxuICAgICAgICBwb3NpdGlvbjoge1xyXG4gICAgICAgICAgbGF0LFxyXG4gICAgICAgICAgbG5nXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHZhciBtYXJrZXIgPSBwcm9wZXJ0aWVzLm1hcmtlcjtcclxuICAgIHJldHVybiBuZXcgQ2x1c3Rlcih7XHJcbiAgICAgIG1hcmtlcnM6IFttYXJrZXJdLFxyXG4gICAgICBwb3NpdGlvbjogTWFya2VyVXRpbHMuZ2V0UG9zaXRpb24obWFya2VyKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXMgc3RhdGlzdGljcyBvbiBhbGwgY2x1c3RlcnMgaW4gdGhlIGN1cnJlbnQgcmVuZGVyIGN5Y2xlIGZvciB1c2UgaW4ge0BsaW5rIFJlbmRlcmVyLnJlbmRlcn0uXHJcbiAqL1xyXG5jbGFzcyBDbHVzdGVyU3RhdHMge1xyXG4gIGNvbnN0cnVjdG9yKG1hcmtlcnMsIGNsdXN0ZXJzKSB7XHJcbiAgICB0aGlzLm1hcmtlcnMgPSB7XHJcbiAgICAgIHN1bTogbWFya2Vycy5sZW5ndGhcclxuICAgIH07XHJcbiAgICB2YXIgY2x1c3Rlck1hcmtlckNvdW50cyA9IGNsdXN0ZXJzLm1hcChhID0+IGEuY291bnQpO1xyXG4gICAgdmFyIGNsdXN0ZXJNYXJrZXJTdW0gPSBjbHVzdGVyTWFya2VyQ291bnRzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApO1xyXG4gICAgdGhpcy5jbHVzdGVycyA9IHtcclxuICAgICAgY291bnQ6IGNsdXN0ZXJzLmxlbmd0aCxcclxuICAgICAgbWFya2Vyczoge1xyXG4gICAgICAgIG1lYW46IGNsdXN0ZXJNYXJrZXJTdW0gLyBjbHVzdGVycy5sZW5ndGgsXHJcbiAgICAgICAgc3VtOiBjbHVzdGVyTWFya2VyU3VtLFxyXG4gICAgICAgIG1pbjogTWF0aC5taW4oLi4uY2x1c3Rlck1hcmtlckNvdW50cyksXHJcbiAgICAgICAgbWF4OiBNYXRoLm1heCguLi5jbHVzdGVyTWFya2VyQ291bnRzKVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5jbGFzcyBEZWZhdWx0UmVuZGVyZXIge1xyXG4gIC8qKlxyXG4gICAqIFRoZSBkZWZhdWx0IHJlbmRlciBmdW5jdGlvbiBmb3IgdGhlIGxpYnJhcnkgdXNlZCBieSB7QGxpbmsgTWFya2VyQ2x1c3RlcmVyfS5cclxuICAgKlxyXG4gICAqIEN1cnJlbnRseSBzZXQgdG8gdXNlIHRoZSBmb2xsb3dpbmc6XHJcbiAgICpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogLy8gY2hhbmdlIGNvbG9yIGlmIHRoaXMgY2x1c3RlciBoYXMgbW9yZSBtYXJrZXJzIHRoYW4gdGhlIG1lYW4gY2x1c3RlclxyXG4gICAqIGNvbnN0IGNvbG9yID1cclxuICAgKiAgIGNvdW50ID4gTWF0aC5tYXgoMTAsIHN0YXRzLmNsdXN0ZXJzLm1hcmtlcnMubWVhbilcclxuICAgKiAgICAgPyBcIiNmZjAwMDBcIlxyXG4gICAqICAgICA6IFwiIzAwMDBmZlwiO1xyXG4gICAqXHJcbiAgICogLy8gY3JlYXRlIHN2ZyB1cmwgd2l0aCBmaWxsIGNvbG9yXHJcbiAgICogY29uc3Qgc3ZnID0gd2luZG93LmJ0b2EoYFxyXG4gICAqIDxzdmcgZmlsbD1cIiR7Y29sb3J9XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCIwIDAgMjQwIDI0MFwiPlxyXG4gICAqICAgPGNpcmNsZSBjeD1cIjEyMFwiIGN5PVwiMTIwXCIgb3BhY2l0eT1cIi42XCIgcj1cIjcwXCIgLz5cclxuICAgKiAgIDxjaXJjbGUgY3g9XCIxMjBcIiBjeT1cIjEyMFwiIG9wYWNpdHk9XCIuM1wiIHI9XCI5MFwiIC8+XHJcbiAgICogICA8Y2lyY2xlIGN4PVwiMTIwXCIgY3k9XCIxMjBcIiBvcGFjaXR5PVwiLjJcIiByPVwiMTEwXCIgLz5cclxuICAgKiAgIDxjaXJjbGUgY3g9XCIxMjBcIiBjeT1cIjEyMFwiIG9wYWNpdHk9XCIuMVwiIHI9XCIxMzBcIiAvPlxyXG4gICAqIDwvc3ZnPmApO1xyXG4gICAqXHJcbiAgICogLy8gY3JlYXRlIG1hcmtlciB1c2luZyBzdmcgaWNvblxyXG4gICAqIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgKiAgIHBvc2l0aW9uLFxyXG4gICAqICAgaWNvbjoge1xyXG4gICAqICAgICB1cmw6IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7c3ZnfWAsXHJcbiAgICogICAgIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDQ1LCA0NSksXHJcbiAgICogICB9LFxyXG4gICAqICAgbGFiZWw6IHtcclxuICAgKiAgICAgdGV4dDogU3RyaW5nKGNvdW50KSxcclxuICAgKiAgICAgY29sb3I6IFwicmdiYSgyNTUsMjU1LDI1NSwwLjkpXCIsXHJcbiAgICogICAgIGZvbnRTaXplOiBcIjEycHhcIixcclxuICAgKiAgIH0sXHJcbiAgICogICAvLyBhZGp1c3QgekluZGV4IHRvIGJlIGFib3ZlIG90aGVyIG1hcmtlcnNcclxuICAgKiAgIHpJbmRleDogMTAwMCArIGNvdW50LFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJlbmRlcihfcmVmMTQsIHN0YXRzLCBtYXApIHtcclxuICAgIHZhciB7XHJcbiAgICAgIGNvdW50LFxyXG4gICAgICBwb3NpdGlvblxyXG4gICAgfSA9IF9yZWYxNDtcclxuICAgIC8vIGNoYW5nZSBjb2xvciBpZiB0aGlzIGNsdXN0ZXIgaGFzIG1vcmUgbWFya2VycyB0aGFuIHRoZSBtZWFuIGNsdXN0ZXJcclxuICAgIHZhciBjb2xvciA9IGNvdW50ID4gTWF0aC5tYXgoMTAsIHN0YXRzLmNsdXN0ZXJzLm1hcmtlcnMubWVhbikgPyBcIiNmZjAwMDBcIiA6IFwiIzAwMDBmZlwiO1xyXG4gICAgLy8gY3JlYXRlIHN2ZyBsaXRlcmFsIHdpdGggZmlsbCBjb2xvclxyXG4gICAgdmFyIHN2ZyA9IFwiPHN2ZyBmaWxsPVxcXCJcIi5jb25jYXQoY29sb3IsIFwiXFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiIHZpZXdCb3g9XFxcIjAgMCAyNDAgMjQwXFxcIiB3aWR0aD1cXFwiNTBcXFwiIGhlaWdodD1cXFwiNTBcXFwiPlxcbjxjaXJjbGUgY3g9XFxcIjEyMFxcXCIgY3k9XFxcIjEyMFxcXCIgb3BhY2l0eT1cXFwiLjZcXFwiIHI9XFxcIjcwXFxcIiAvPlxcbjxjaXJjbGUgY3g9XFxcIjEyMFxcXCIgY3k9XFxcIjEyMFxcXCIgb3BhY2l0eT1cXFwiLjNcXFwiIHI9XFxcIjkwXFxcIiAvPlxcbjxjaXJjbGUgY3g9XFxcIjEyMFxcXCIgY3k9XFxcIjEyMFxcXCIgb3BhY2l0eT1cXFwiLjJcXFwiIHI9XFxcIjExMFxcXCIgLz5cXG48dGV4dCB4PVxcXCI1MCVcXFwiIHk9XFxcIjUwJVxcXCIgc3R5bGU9XFxcImZpbGw6I2ZmZlxcXCIgdGV4dC1hbmNob3I9XFxcIm1pZGRsZVxcXCIgZm9udC1zaXplPVxcXCI1MFxcXCIgZG9taW5hbnQtYmFzZWxpbmU9XFxcIm1pZGRsZVxcXCIgZm9udC1mYW1pbHk9XFxcInJvYm90byxhcmlhbCxzYW5zLXNlcmlmXFxcIj5cIikuY29uY2F0KGNvdW50LCBcIjwvdGV4dD5cXG48L3N2Zz5cIik7XHJcbiAgICB2YXIgdGl0bGUgPSBcIkNsdXN0ZXIgb2YgXCIuY29uY2F0KGNvdW50LCBcIiBtYXJrZXJzXCIpLFxyXG4gICAgICAvLyBhZGp1c3QgekluZGV4IHRvIGJlIGFib3ZlIG90aGVyIG1hcmtlcnNcclxuICAgICAgekluZGV4ID0gTnVtYmVyKGdvb2dsZS5tYXBzLk1hcmtlci5NQVhfWklOREVYKSArIGNvdW50O1xyXG4gICAgaWYgKE1hcmtlclV0aWxzLmlzQWR2YW5jZWRNYXJrZXJBdmFpbGFibGUobWFwKSkge1xyXG4gICAgICAvLyBjcmVhdGUgY2x1c3RlciBTVkcgZWxlbWVudFxyXG4gICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xyXG4gICAgICB2YXIgc3ZnRWwgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHN2ZywgXCJpbWFnZS9zdmcreG1sXCIpLmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgc3ZnRWwuc2V0QXR0cmlidXRlKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAgMjUpXCIpO1xyXG4gICAgICB2YXIgX2NsdXN0ZXJPcHRpb25zID0ge1xyXG4gICAgICAgIG1hcCxcclxuICAgICAgICBwb3NpdGlvbixcclxuICAgICAgICB6SW5kZXgsXHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgY29udGVudDogc3ZnRWxcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5tYXJrZXIuQWR2YW5jZWRNYXJrZXJFbGVtZW50KF9jbHVzdGVyT3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICB2YXIgY2x1c3Rlck9wdGlvbnMgPSB7XHJcbiAgICAgIHBvc2l0aW9uLFxyXG4gICAgICB6SW5kZXgsXHJcbiAgICAgIHRpdGxlLFxyXG4gICAgICBpY29uOiB7XHJcbiAgICAgICAgdXJsOiBcImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsXCIuY29uY2F0KGJ0b2Eoc3ZnKSksXHJcbiAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjUsIDI1KVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5NYXJrZXIoY2x1c3Rlck9wdGlvbnMpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBFeHRlbmRzIGFuIG9iamVjdCdzIHByb3RvdHlwZSBieSBhbm90aGVyJ3MuXHJcbiAqXHJcbiAqIEBwYXJhbSB0eXBlMSBUaGUgVHlwZSB0byBiZSBleHRlbmRlZC5cclxuICogQHBhcmFtIHR5cGUyIFRoZSBUeXBlIHRvIGV4dGVuZCB3aXRoLlxyXG4gKiBAaWdub3JlXHJcbiAqL1xyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5mdW5jdGlvbiBleHRlbmQodHlwZTEsIHR5cGUyKSB7XHJcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XHJcbiAgZm9yICh2YXIgcHJvcGVydHkgaW4gdHlwZTIucHJvdG90eXBlKSB7XHJcbiAgICB0eXBlMS5wcm90b3R5cGVbcHJvcGVydHldID0gdHlwZTIucHJvdG90eXBlW3Byb3BlcnR5XTtcclxuICB9XHJcbn1cclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICovXHJcbmNsYXNzIE92ZXJsYXlWaWV3U2FmZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAvLyBNYXJrZXJDbHVzdGVyZXIgaW1wbGVtZW50cyBnb29nbGUubWFwcy5PdmVybGF5VmlldyBpbnRlcmZhY2UuIFdlIHVzZSB0aGVcclxuICAgIC8vIGV4dGVuZCBmdW5jdGlvbiB0byBleHRlbmQgTWFya2VyQ2x1c3RlcmVyIHdpdGggZ29vZ2xlLm1hcHMuT3ZlcmxheVZpZXdcclxuICAgIC8vIGJlY2F1c2UgaXQgbWlnaHQgbm90IGFsd2F5cyBiZSBhdmFpbGFibGUgd2hlbiB0aGUgY29kZSBpcyBkZWZpbmVkIHNvIHdlXHJcbiAgICAvLyBsb29rIGZvciBpdCBhdCB0aGUgbGFzdCBwb3NzaWJsZSBtb21lbnQuIElmIGl0IGRvZXNuJ3QgZXhpc3Qgbm93IHRoZW5cclxuICAgIC8vIHRoZXJlIGlzIG5vIHBvaW50IGdvaW5nIGFoZWFkIDopXHJcbiAgICBleHRlbmQoT3ZlcmxheVZpZXdTYWZlLCBnb29nbGUubWFwcy5PdmVybGF5Vmlldyk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG52YXIgTWFya2VyQ2x1c3RlcmVyRXZlbnRzO1xyXG4oZnVuY3Rpb24gKE1hcmtlckNsdXN0ZXJlckV2ZW50cykge1xyXG4gIE1hcmtlckNsdXN0ZXJlckV2ZW50c1tcIkNMVVNURVJJTkdfQkVHSU5cIl0gPSBcImNsdXN0ZXJpbmdiZWdpblwiO1xyXG4gIE1hcmtlckNsdXN0ZXJlckV2ZW50c1tcIkNMVVNURVJJTkdfRU5EXCJdID0gXCJjbHVzdGVyaW5nZW5kXCI7XHJcbiAgTWFya2VyQ2x1c3RlcmVyRXZlbnRzW1wiQ0xVU1RFUl9DTElDS1wiXSA9IFwiY2xpY2tcIjtcclxufSkoTWFya2VyQ2x1c3RlcmVyRXZlbnRzIHx8IChNYXJrZXJDbHVzdGVyZXJFdmVudHMgPSB7fSkpO1xyXG52YXIgZGVmYXVsdE9uQ2x1c3RlckNsaWNrSGFuZGxlciA9IChfLCBjbHVzdGVyLCBtYXApID0+IHtcclxuICBtYXAuZml0Qm91bmRzKGNsdXN0ZXIuYm91bmRzKTtcclxufTtcclxuLyoqXHJcbiAqIE1hcmtlckNsdXN0ZXJlciBjcmVhdGVzIGFuZCBtYW5hZ2VzIHBlci16b29tLWxldmVsIGNsdXN0ZXJzIGZvciBsYXJnZSBhbW91bnRzXHJcbiAqIG9mIG1hcmtlcnMuIFNlZSB7QGxpbmsgTWFya2VyQ2x1c3RlcmVyT3B0aW9uc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICpcclxuICovXHJcbmNsYXNzIE1hcmtlckNsdXN0ZXJlciBleHRlbmRzIE92ZXJsYXlWaWV3U2FmZSB7XHJcbiAgY29uc3RydWN0b3IoX3JlZjE1KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICBtYXAsXHJcbiAgICAgIG1hcmtlcnMgPSBbXSxcclxuICAgICAgYWxnb3JpdGhtT3B0aW9ucyA9IHt9LFxyXG4gICAgICBhbGdvcml0aG0gPSBuZXcgU3VwZXJDbHVzdGVyQWxnb3JpdGhtKGFsZ29yaXRobU9wdGlvbnMpLFxyXG4gICAgICByZW5kZXJlciA9IG5ldyBEZWZhdWx0UmVuZGVyZXIoKSxcclxuICAgICAgb25DbHVzdGVyQ2xpY2sgPSBkZWZhdWx0T25DbHVzdGVyQ2xpY2tIYW5kbGVyXHJcbiAgICB9ID0gX3JlZjE1O1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMubWFya2VycyA9IFsuLi5tYXJrZXJzXTtcclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtO1xyXG4gICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5vbkNsdXN0ZXJDbGljayA9IG9uQ2x1c3RlckNsaWNrO1xyXG4gICAgaWYgKG1hcCkge1xyXG4gICAgICB0aGlzLnNldE1hcChtYXApO1xyXG4gICAgfVxyXG4gIH1cclxuICBhZGRNYXJrZXIobWFya2VyLCBub0RyYXcpIHtcclxuICAgIGlmICh0aGlzLm1hcmtlcnMuaW5jbHVkZXMobWFya2VyKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gICAgaWYgKCFub0RyYXcpIHtcclxuICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgIH1cclxuICB9XHJcbiAgYWRkTWFya2VycyhtYXJrZXJzLCBub0RyYXcpIHtcclxuICAgIG1hcmtlcnMuZm9yRWFjaChtYXJrZXIgPT4ge1xyXG4gICAgICB0aGlzLmFkZE1hcmtlcihtYXJrZXIsIHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoIW5vRHJhdykge1xyXG4gICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW1vdmVNYXJrZXIobWFya2VyLCBub0RyYXcpIHtcclxuICAgIHZhciBpbmRleCA9IHRoaXMubWFya2Vycy5pbmRleE9mKG1hcmtlcik7XHJcbiAgICBpZiAoaW5kZXggPT09IC0xKSB7XHJcbiAgICAgIC8vIE1hcmtlciBpcyBub3QgaW4gb3VyIGxpc3Qgb2YgbWFya2Vycywgc28gZG8gbm90aGluZzpcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgTWFya2VyVXRpbHMuc2V0TWFwKG1hcmtlciwgbnVsbCk7XHJcbiAgICB0aGlzLm1hcmtlcnMuc3BsaWNlKGluZGV4LCAxKTsgLy8gUmVtb3ZlIHRoZSBtYXJrZXIgZnJvbSB0aGUgbGlzdCBvZiBtYW5hZ2VkIG1hcmtlcnNcclxuICAgIGlmICghbm9EcmF3KSB7XHJcbiAgICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgcmVtb3ZlTWFya2VycyhtYXJrZXJzLCBub0RyYXcpIHtcclxuICAgIHZhciByZW1vdmVkID0gZmFsc2U7XHJcbiAgICBtYXJrZXJzLmZvckVhY2gobWFya2VyID0+IHtcclxuICAgICAgcmVtb3ZlZCA9IHRoaXMucmVtb3ZlTWFya2VyKG1hcmtlciwgdHJ1ZSkgfHwgcmVtb3ZlZDtcclxuICAgIH0pO1xyXG4gICAgaWYgKHJlbW92ZWQgJiYgIW5vRHJhdykge1xyXG4gICAgICB0aGlzLnJlbmRlcigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlbW92ZWQ7XHJcbiAgfVxyXG4gIGNsZWFyTWFya2Vycyhub0RyYXcpIHtcclxuICAgIHRoaXMubWFya2Vycy5sZW5ndGggPSAwO1xyXG4gICAgaWYgKCFub0RyYXcpIHtcclxuICAgICAgdGhpcy5yZW5kZXIoKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICogUmVjYWxjdWxhdGVzIGFuZCBkcmF3cyBhbGwgdGhlIG1hcmtlciBjbHVzdGVycy5cclxuICAgKi9cclxuICByZW5kZXIoKSB7XHJcbiAgICB2YXIgbWFwID0gdGhpcy5nZXRNYXAoKTtcclxuICAgIGlmIChtYXAgaW5zdGFuY2VvZiBnb29nbGUubWFwcy5NYXAgJiYgbWFwLmdldFByb2plY3Rpb24oKSkge1xyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHRoaXMsIE1hcmtlckNsdXN0ZXJlckV2ZW50cy5DTFVTVEVSSU5HX0JFR0lOLCB0aGlzKTtcclxuICAgICAgdmFyIHtcclxuICAgICAgICBjbHVzdGVycyxcclxuICAgICAgICBjaGFuZ2VkXHJcbiAgICAgIH0gPSB0aGlzLmFsZ29yaXRobS5jYWxjdWxhdGUoe1xyXG4gICAgICAgIG1hcmtlcnM6IHRoaXMubWFya2VycyxcclxuICAgICAgICBtYXAsXHJcbiAgICAgICAgbWFwQ2FudmFzUHJvamVjdGlvbjogdGhpcy5nZXRQcm9qZWN0aW9uKClcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIEFsbG93IGFsZ29yaXRobXMgdG8gcmV0dXJuIGZsYWcgb24gd2hldGhlciB0aGUgY2x1c3RlcnMvbWFya2VycyBoYXZlIGNoYW5nZWQuXHJcbiAgICAgIGlmIChjaGFuZ2VkIHx8IGNoYW5nZWQgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgbWFya2VycyBvZiB0aGUgY2x1c3RlcnMgY29tcG9zZWQgb2YgYSBzaW5nbGUgbWFya2VyLlxyXG4gICAgICAgIC8vIFRob3NlIGNsdXN0ZXJzIGRpcmVjdGx5IHVzZSB0aGUgbWFya2VyLlxyXG4gICAgICAgIC8vIENsdXN0ZXJzIHdpdGggbW9yZSB0aGFuIG9uZSBtYXJrZXJzIHVzZSBhIGdyb3VwIG1hcmtlciBnZW5lcmF0ZWQgYnkgYSByZW5kZXJlci5cclxuICAgICAgICB2YXIgc2luZ2xlTWFya2VyID0gbmV3IFNldCgpO1xyXG4gICAgICAgIGZvciAodmFyIGNsdXN0ZXIgb2YgY2x1c3RlcnMpIHtcclxuICAgICAgICAgIGlmIChjbHVzdGVyLm1hcmtlcnMubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgc2luZ2xlTWFya2VyLmFkZChjbHVzdGVyLm1hcmtlcnNbMF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZ3JvdXBNYXJrZXJzID0gW107XHJcbiAgICAgICAgLy8gSXRlcmF0ZSB0aGUgY2x1c3RlcnMgdGhhdCBhcmUgY3VycmVudGx5IHJlbmRlcmVkLlxyXG4gICAgICAgIGZvciAodmFyIF9jbHVzdGVyMiBvZiB0aGlzLmNsdXN0ZXJzKSB7XHJcbiAgICAgICAgICBpZiAoX2NsdXN0ZXIyLm1hcmtlciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKF9jbHVzdGVyMi5tYXJrZXJzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgIGlmICghc2luZ2xlTWFya2VyLmhhcyhfY2x1c3RlcjIubWFya2VyKSkge1xyXG4gICAgICAgICAgICAgIC8vIFRoZSBtYXJrZXI6XHJcbiAgICAgICAgICAgICAgLy8gLSB3YXMgcHJldmlvdXNseSByZW5kZXJlZCBiZWNhdXNlIGl0IGlzIGZyb20gYSBjbHVzdGVyIHdpdGggMSBtYXJrZXIsXHJcbiAgICAgICAgICAgICAgLy8gLSBzaG91bGQgbm8gbW9yZSBiZSByZW5kZXJlZCBhcyBpdCBpcyBub3QgaW4gc2luZ2xlTWFya2VyLlxyXG4gICAgICAgICAgICAgIE1hcmtlclV0aWxzLnNldE1hcChfY2x1c3RlcjIubWFya2VyLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gRGVsYXkgdGhlIHJlbW92YWwgb2Ygb2xkIGdyb3VwIG1hcmtlcnMgdG8gYXZvaWQgZmxpY2tlcmluZy5cclxuICAgICAgICAgICAgZ3JvdXBNYXJrZXJzLnB1c2goX2NsdXN0ZXIyLm1hcmtlcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2x1c3RlcnMgPSBjbHVzdGVycztcclxuICAgICAgICB0aGlzLnJlbmRlckNsdXN0ZXJzKCk7XHJcbiAgICAgICAgLy8gRGVsYXllZCByZW1vdmFsIG9mIHRoZSBtYXJrZXJzIG9mIHRoZSBmb3JtZXIgZ3JvdXBzLlxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiBncm91cE1hcmtlcnMuZm9yRWFjaChtYXJrZXIgPT4gTWFya2VyVXRpbHMuc2V0TWFwKG1hcmtlciwgbnVsbCkpKTtcclxuICAgICAgfVxyXG4gICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHRoaXMsIE1hcmtlckNsdXN0ZXJlckV2ZW50cy5DTFVTVEVSSU5HX0VORCwgdGhpcyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uQWRkKCkge1xyXG4gICAgdGhpcy5pZGxlTGlzdGVuZXIgPSB0aGlzLmdldE1hcCgpLmFkZExpc3RlbmVyKFwiaWRsZVwiLCB0aGlzLnJlbmRlci5iaW5kKHRoaXMpKTtcclxuICAgIHRoaXMucmVuZGVyKCk7XHJcbiAgfVxyXG4gIG9uUmVtb3ZlKCkge1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIodGhpcy5pZGxlTGlzdGVuZXIpO1xyXG4gICAgdGhpcy5yZXNldCgpO1xyXG4gIH1cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMubWFya2Vycy5mb3JFYWNoKG1hcmtlciA9PiBNYXJrZXJVdGlscy5zZXRNYXAobWFya2VyLCBudWxsKSk7XHJcbiAgICB0aGlzLmNsdXN0ZXJzLmZvckVhY2goY2x1c3RlciA9PiBjbHVzdGVyLmRlbGV0ZSgpKTtcclxuICAgIHRoaXMuY2x1c3RlcnMgPSBbXTtcclxuICB9XHJcbiAgcmVuZGVyQ2x1c3RlcnMoKSB7XHJcbiAgICAvLyBHZW5lcmF0ZSBzdGF0cyB0byBwYXNzIHRvIHJlbmRlcmVycy5cclxuICAgIHZhciBzdGF0cyA9IG5ldyBDbHVzdGVyU3RhdHModGhpcy5tYXJrZXJzLCB0aGlzLmNsdXN0ZXJzKTtcclxuICAgIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xyXG4gICAgdGhpcy5jbHVzdGVycy5mb3JFYWNoKGNsdXN0ZXIgPT4ge1xyXG4gICAgICBpZiAoY2x1c3Rlci5tYXJrZXJzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIGNsdXN0ZXIubWFya2VyID0gY2x1c3Rlci5tYXJrZXJzWzBdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdlbmVyYXRlIHRoZSBtYXJrZXIgdG8gcmVwcmVzZW50IHRoZSBncm91cC5cclxuICAgICAgICBjbHVzdGVyLm1hcmtlciA9IHRoaXMucmVuZGVyZXIucmVuZGVyKGNsdXN0ZXIsIHN0YXRzLCBtYXApO1xyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSBhbGwgaW5kaXZpZHVhbCBtYXJrZXJzIGFyZSByZW1vdmVkIGZyb20gdGhlIG1hcC5cclxuICAgICAgICBjbHVzdGVyLm1hcmtlcnMuZm9yRWFjaChtYXJrZXIgPT4gTWFya2VyVXRpbHMuc2V0TWFwKG1hcmtlciwgbnVsbCkpO1xyXG4gICAgICAgIGlmICh0aGlzLm9uQ2x1c3RlckNsaWNrKSB7XHJcbiAgICAgICAgICBjbHVzdGVyLm1hcmtlci5hZGRMaXN0ZW5lcihcImNsaWNrXCIsIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXHJcbiAgICAgICAgICBldmVudCA9PiB7XHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodGhpcywgTWFya2VyQ2x1c3RlcmVyRXZlbnRzLkNMVVNURVJfQ0xJQ0ssIGNsdXN0ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLm9uQ2x1c3RlckNsaWNrKGV2ZW50LCBjbHVzdGVyLCBtYXApO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIE1hcmtlclV0aWxzLnNldE1hcChjbHVzdGVyLm1hcmtlciwgbWFwKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxudmFyIGluZGV4X2VzbSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcclxuICBfX3Byb3RvX186IG51bGwsXHJcbiAgQWJzdHJhY3RBbGdvcml0aG06IEFic3RyYWN0QWxnb3JpdGhtLFxyXG4gIEFic3RyYWN0Vmlld3BvcnRBbGdvcml0aG06IEFic3RyYWN0Vmlld3BvcnRBbGdvcml0aG0sXHJcbiAgQ2x1c3RlcjogQ2x1c3RlcixcclxuICBDbHVzdGVyU3RhdHM6IENsdXN0ZXJTdGF0cyxcclxuICBEZWZhdWx0UmVuZGVyZXI6IERlZmF1bHRSZW5kZXJlcixcclxuICBHcmlkQWxnb3JpdGhtOiBHcmlkQWxnb3JpdGhtLFxyXG4gIE1hcmtlckNsdXN0ZXJlcjogTWFya2VyQ2x1c3RlcmVyLFxyXG4gIGdldCBNYXJrZXJDbHVzdGVyZXJFdmVudHMgKCkgeyByZXR1cm4gTWFya2VyQ2x1c3RlcmVyRXZlbnRzOyB9LFxyXG4gIE1hcmtlclV0aWxzOiBNYXJrZXJVdGlscyxcclxuICBOb29wQWxnb3JpdGhtOiBOb29wQWxnb3JpdGhtLFxyXG4gIFN1cGVyQ2x1c3RlckFsZ29yaXRobTogU3VwZXJDbHVzdGVyQWxnb3JpdGhtLFxyXG4gIFN1cGVyQ2x1c3RlclZpZXdwb3J0QWxnb3JpdGhtOiBTdXBlckNsdXN0ZXJWaWV3cG9ydEFsZ29yaXRobSxcclxuICBkZWZhdWx0T25DbHVzdGVyQ2xpY2tIYW5kbGVyOiBkZWZhdWx0T25DbHVzdGVyQ2xpY2tIYW5kbGVyLFxyXG4gIGRpc3RhbmNlQmV0d2VlblBvaW50czogZGlzdGFuY2VCZXR3ZWVuUG9pbnRzLFxyXG4gIGV4dGVuZEJvdW5kc1RvUGFkZGVkVmlld3BvcnQ6IGV4dGVuZEJvdW5kc1RvUGFkZGVkVmlld3BvcnQsXHJcbiAgZXh0ZW5kUGl4ZWxCb3VuZHM6IGV4dGVuZFBpeGVsQm91bmRzLFxyXG4gIGZpbHRlck1hcmtlcnNUb1BhZGRlZFZpZXdwb3J0OiBmaWx0ZXJNYXJrZXJzVG9QYWRkZWRWaWV3cG9ydCxcclxuICBnZXRQYWRkZWRWaWV3cG9ydDogZ2V0UGFkZGVkVmlld3BvcnQsXHJcbiAgbm9vcDogbm9vcCQxLFxyXG4gIHBpeGVsQm91bmRzVG9MYXRMbmdCb3VuZHM6IHBpeGVsQm91bmRzVG9MYXRMbmdCb3VuZHNcclxufSk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzJGEoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfVxyXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkJGEoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyRhKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyRhKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9XHJcbmZ1bmN0aW9uIHVzZUdvb2dsZU1hcmtlckNsdXN0ZXJlcihvcHRpb25zKSB7XHJcbiAgdmFyIG1hcCA9IHVzZUdvb2dsZU1hcCgpO1xyXG4gIHZhciBbbWFya2VyQ2x1c3RlcmVyLCBzZXRNYXJrZXJDbHVzdGVyZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChtYXAgJiYgbWFya2VyQ2x1c3RlcmVyID09PSBudWxsKSB7XHJcbiAgICAgIHZhciBtYXJrZXJDbHVzdGVyID0gbmV3IE1hcmtlckNsdXN0ZXJlcihfb2JqZWN0U3ByZWFkJGEoX29iamVjdFNwcmVhZCRhKHt9LCBvcHRpb25zKSwge30sIHtcclxuICAgICAgICBtYXBcclxuICAgICAgfSkpO1xyXG4gICAgICBzZXRNYXJrZXJDbHVzdGVyZXIobWFya2VyQ2x1c3Rlcik7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHJldHVybiBtYXJrZXJDbHVzdGVyZXI7XHJcbn1cclxuLyoqIFdyYXBwZXIgYXJvdW5kIFtAZ29vZ2xlbWFwcy9tYXJrZXJjbHVzdGVyZXJdKGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGVtYXBzL2pzLW1hcmtlcmNsdXN0ZXJlcilcclxuICpcclxuICogQWNjZXB0cyB7QGxpbmsgIE1hcmtlckNsdXN0ZXJlck9wdGlvbnNTdWJzZXR9IHdoaWNoIGlzIGEgc3Vic2V0IG9mICB7QGxpbmsgTWFya2VyQ2x1c3RlcmVyT3B0aW9uc31cclxuICovXHJcbmZ1bmN0aW9uIEdvb2dsZU1hcmtlckNsdXN0ZXJlcihfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIGNoaWxkcmVuLFxyXG4gICAgb3B0aW9uc1xyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXJrZXJDbHVzdGVyZXIgPSB1c2VHb29nbGVNYXJrZXJDbHVzdGVyZXIob3B0aW9ucyk7XHJcbiAgcmV0dXJuIG1hcmtlckNsdXN0ZXJlciAhPT0gbnVsbCA/IGNoaWxkcmVuKG1hcmtlckNsdXN0ZXJlcikgOiBudWxsO1xyXG59XHJcbnZhciBHb29nbGVNYXJrZXJDbHVzdGVyZXIkMSA9IG1lbW8oR29vZ2xlTWFya2VyQ2x1c3RlcmVyKTtcclxuXHJcbnZhciBldmVudE1hcCRjID0ge1xyXG4gIG9uQ2xvc2VDbGljazogJ2Nsb3NlY2xpY2snLFxyXG4gIG9uQ29udGVudENoYW5nZWQ6ICdjb250ZW50X2NoYW5nZWQnLFxyXG4gIG9uRG9tUmVhZHk6ICdkb21yZWFkeScsXHJcbiAgb25Qb3NpdGlvbkNoYW5nZWQ6ICdwb3NpdGlvbl9jaGFuZ2VkJyxcclxuICBvblppbmRleENoYW5nZWQ6ICd6aW5kZXhfY2hhbmdlZCdcclxufTtcclxudmFyIHVwZGF0ZXJNYXAkYyA9IHtcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH0sXHJcbiAgcG9zaXRpb24oaW5zdGFuY2UsIHBvc2l0aW9uKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgfSxcclxuICB6SW5kZXgoaW5zdGFuY2UsIHpJbmRleCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgfVxyXG59O1xyXG5mdW5jdGlvbiBJbmZvV2luZG93RnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIGNoaWxkcmVuLFxyXG4gICAgYW5jaG9yLFxyXG4gICAgb3B0aW9ucyxcclxuICAgIHBvc2l0aW9uLFxyXG4gICAgekluZGV4LFxyXG4gICAgb25DbG9zZUNsaWNrLFxyXG4gICAgb25Eb21SZWFkeSxcclxuICAgIG9uQ29udGVudENoYW5nZWQsXHJcbiAgICBvblBvc2l0aW9uQ2hhbmdlZCxcclxuICAgIG9uWmluZGV4Q2hhbmdlZCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIHZhciBbaW5zdGFuY2UsIHNldEluc3RhbmNlXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbY2xvc2VjbGlja0xpc3RlbmVyLCBzZXRDbG9zZUNsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkb21yZWFkeWNsaWNrTGlzdGVuZXIsIHNldERvbVJlYWR5Q2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NvbnRlbnRjaGFuZ2VkY2xpY2tMaXN0ZW5lciwgc2V0Q29udGVudENoYW5nZWRDbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcG9zaXRpb25jaGFuZ2VkY2xpY2tMaXN0ZW5lciwgc2V0UG9zaXRpb25DaGFuZ2VkQ2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW3ppbmRleGNoYW5nZWRjbGlja0xpc3RlbmVyLCBzZXRaaW5kZXhDaGFuZ2VkQ2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgY29udGFpbmVyRWxlbWVudFJlZiA9IHVzZVJlZihudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgaWYgKGFuY2hvcikge1xyXG4gICAgICAgIGluc3RhbmNlLm9wZW4obWFwLCBhbmNob3IpO1xyXG4gICAgICB9IGVsc2UgaWYgKGluc3RhbmNlLmdldFBvc2l0aW9uKCkpIHtcclxuICAgICAgICBpbnN0YW5jZS5vcGVuKG1hcCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LCBbbWFwLCBpbnN0YW5jZSwgYW5jaG9yXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChvcHRpb25zICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBvcHRpb25zXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChwb3NpdGlvbiAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICB9XHJcbiAgfSwgW3Bvc2l0aW9uXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgekluZGV4ID09PSAnbnVtYmVyJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRaSW5kZXgoekluZGV4KTtcclxuICAgIH1cclxuICB9LCBbekluZGV4XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkNsb3NlQ2xpY2spIHtcclxuICAgICAgaWYgKGNsb3NlY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsb3NlY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Q2xvc2VDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnY2xvc2VjbGljaycsIG9uQ2xvc2VDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsb3NlQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRG9tUmVhZHkpIHtcclxuICAgICAgaWYgKGRvbXJlYWR5Y2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRvbXJlYWR5Y2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RG9tUmVhZHlDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZG9tcmVhZHknLCBvbkRvbVJlYWR5KSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRG9tUmVhZHldKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ29udGVudENoYW5nZWQpIHtcclxuICAgICAgaWYgKGNvbnRlbnRjaGFuZ2VkY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNvbnRlbnRjaGFuZ2VkY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Q29udGVudENoYW5nZWRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnY29udGVudF9jaGFuZ2VkJywgb25Db250ZW50Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNvbnRlbnRDaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblBvc2l0aW9uQ2hhbmdlZCkge1xyXG4gICAgICBpZiAocG9zaXRpb25jaGFuZ2VkY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHBvc2l0aW9uY2hhbmdlZGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFBvc2l0aW9uQ2hhbmdlZENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdwb3NpdGlvbl9jaGFuZ2VkJywgb25Qb3NpdGlvbkNoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25Qb3NpdGlvbkNoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uWmluZGV4Q2hhbmdlZCkge1xyXG4gICAgICBpZiAoemluZGV4Y2hhbmdlZGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcih6aW5kZXhjaGFuZ2VkY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0WmluZGV4Q2hhbmdlZENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICd6aW5kZXhfY2hhbmdlZCcsIG9uWmluZGV4Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblppbmRleENoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyhvcHRpb25zKTtcclxuICAgIHNldEluc3RhbmNlKGluZm9XaW5kb3cpO1xyXG4gICAgY29udGFpbmVyRWxlbWVudFJlZi5jdXJyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBpZiAob25DbG9zZUNsaWNrKSB7XHJcbiAgICAgIHNldENsb3NlQ2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbmZvV2luZG93LCAnY2xvc2VjbGljaycsIG9uQ2xvc2VDbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRG9tUmVhZHkpIHtcclxuICAgICAgc2V0RG9tUmVhZHlDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluZm9XaW5kb3csICdkb21yZWFkeScsIG9uRG9tUmVhZHkpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkNvbnRlbnRDaGFuZ2VkKSB7XHJcbiAgICAgIHNldENvbnRlbnRDaGFuZ2VkQ2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbmZvV2luZG93LCAnY29udGVudF9jaGFuZ2VkJywgb25Db250ZW50Q2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uUG9zaXRpb25DaGFuZ2VkKSB7XHJcbiAgICAgIHNldFBvc2l0aW9uQ2hhbmdlZENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5mb1dpbmRvdywgJ3Bvc2l0aW9uX2NoYW5nZWQnLCBvblBvc2l0aW9uQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uWmluZGV4Q2hhbmdlZCkge1xyXG4gICAgICBzZXRaaW5kZXhDaGFuZ2VkQ2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbmZvV2luZG93LCAnemluZGV4X2NoYW5nZWQnLCBvblppbmRleENoYW5nZWQpKTtcclxuICAgIH1cclxuICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChjb250YWluZXJFbGVtZW50UmVmLmN1cnJlbnQpO1xyXG4gICAgaWYgKHBvc2l0aW9uKSB7XHJcbiAgICAgIGluZm9XaW5kb3cuc2V0UG9zaXRpb24ocG9zaXRpb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHpJbmRleCkge1xyXG4gICAgICBpbmZvV2luZG93LnNldFpJbmRleCh6SW5kZXgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGFuY2hvcikge1xyXG4gICAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBhbmNob3IpO1xyXG4gICAgfSBlbHNlIGlmIChpbmZvV2luZG93LmdldFBvc2l0aW9uKCkpIHtcclxuICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpbnZhcmlhbnQoZmFsc2UsIFwiWW91IG11c3QgcHJvdmlkZSBlaXRoZXIgYW4gYW5jaG9yICh0eXBpY2FsbHkgcmVuZGVyIGl0IGluc2lkZSBhIDxNYXJrZXI+KSBvciBhIHBvc2l0aW9uIHByb3BzIGZvciA8SW5mb1dpbmRvdz4uXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICBvbkxvYWQoaW5mb1dpbmRvdyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBpZiAoY2xvc2VjbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2xvc2VjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY29udGVudGNoYW5nZWRjbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY29udGVudGNoYW5nZWRjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZG9tcmVhZHljbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZG9tcmVhZHljbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocG9zaXRpb25jaGFuZ2VkY2xpY2tMaXN0ZW5lcikge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHBvc2l0aW9uY2hhbmdlZGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh6aW5kZXhjaGFuZ2VkY2xpY2tMaXN0ZW5lcikge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHppbmRleGNoYW5nZWRjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgb25Vbm1vdW50KGluZm9XaW5kb3cpO1xyXG4gICAgICB9XHJcbiAgICAgIGluZm9XaW5kb3cuY2xvc2UoKTtcclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG4gIHJldHVybiBjb250YWluZXJFbGVtZW50UmVmLmN1cnJlbnQgPyBjcmVhdGVQb3J0YWwoQ2hpbGRyZW4ub25seShjaGlsZHJlbiksIGNvbnRhaW5lckVsZW1lbnRSZWYuY3VycmVudCkgOiBudWxsO1xyXG59XHJcbnZhciBJbmZvV2luZG93RiA9IG1lbW8oSW5mb1dpbmRvd0Z1bmN0aW9uYWwpO1xyXG5jbGFzcyBJbmZvV2luZG93IGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVnaXN0ZXJlZEV2ZW50c1wiLCBbXSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb250YWluZXJFbGVtZW50XCIsIG51bGwpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBpbmZvV2luZG93OiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9wZW5cIiwgKGluZm9XaW5kb3csIGFuY2hvcikgPT4ge1xyXG4gICAgICBpZiAoYW5jaG9yKSB7XHJcbiAgICAgICAgaW5mb1dpbmRvdy5vcGVuKHRoaXMuY29udGV4dCwgYW5jaG9yKTtcclxuICAgICAgfSBlbHNlIGlmIChpbmZvV2luZG93LmdldFBvc2l0aW9uKCkpIHtcclxuICAgICAgICBpbmZvV2luZG93Lm9wZW4odGhpcy5jb250ZXh0KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbnZhcmlhbnQoZmFsc2UsIFwiWW91IG11c3QgcHJvdmlkZSBlaXRoZXIgYW4gYW5jaG9yICh0eXBpY2FsbHkgcmVuZGVyIGl0IGluc2lkZSBhIDxNYXJrZXI+KSBvciBhIHBvc2l0aW9uIHByb3BzIGZvciA8SW5mb1dpbmRvdz4uXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldEluZm9XaW5kb3dDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLmluZm9XaW5kb3cgIT09IG51bGwgJiYgdGhpcy5jb250YWluZXJFbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0ZS5pbmZvV2luZG93LnNldENvbnRlbnQodGhpcy5jb250YWluZXJFbGVtZW50KTtcclxuICAgICAgICB0aGlzLm9wZW4odGhpcy5zdGF0ZS5pbmZvV2luZG93LCB0aGlzLnByb3BzLmFuY2hvcik7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLmluZm9XaW5kb3cpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh0aGlzLnByb3BzLm9wdGlvbnMpO1xyXG4gICAgdGhpcy5jb250YWluZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCRjLFxyXG4gICAgICBldmVudE1hcDogZXZlbnRNYXAkYyxcclxuICAgICAgcHJldlByb3BzOiB7fSxcclxuICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICBpbnN0YW5jZTogaW5mb1dpbmRvd1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+IHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpbmZvV2luZG93XHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldEluZm9XaW5kb3dDYWxsYmFjayk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmluZm9XaW5kb3cgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGMsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGMsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5pbmZvV2luZG93XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmluZm9XaW5kb3cgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmluZm9XaW5kb3cpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc3RhdGUuaW5mb1dpbmRvdy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250YWluZXJFbGVtZW50ID8gY3JlYXRlUG9ydGFsKENoaWxkcmVuLm9ubHkodGhpcy5wcm9wcy5jaGlsZHJlbiksIHRoaXMuY29udGFpbmVyRWxlbWVudCkgOiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoSW5mb1dpbmRvdywgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIG93bktleXMkOShlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkOShlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJDkoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJDkoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxudmFyIGV2ZW50TWFwJGIgPSB7XHJcbiAgb25DbGljazogJ2NsaWNrJyxcclxuICBvbkRibENsaWNrOiAnZGJsY2xpY2snLFxyXG4gIG9uRHJhZzogJ2RyYWcnLFxyXG4gIG9uRHJhZ0VuZDogJ2RyYWdlbmQnLFxyXG4gIG9uRHJhZ1N0YXJ0OiAnZHJhZ3N0YXJ0JyxcclxuICBvbk1vdXNlRG93bjogJ21vdXNlZG93bicsXHJcbiAgb25Nb3VzZU1vdmU6ICdtb3VzZW1vdmUnLFxyXG4gIG9uTW91c2VPdXQ6ICdtb3VzZW91dCcsXHJcbiAgb25Nb3VzZU92ZXI6ICdtb3VzZW92ZXInLFxyXG4gIG9uTW91c2VVcDogJ21vdXNldXAnLFxyXG4gIG9uUmlnaHRDbGljazogJ3JpZ2h0Y2xpY2snXHJcbn07XHJcbnZhciB1cGRhdGVyTWFwJGIgPSB7XHJcbiAgZHJhZ2dhYmxlKGluc3RhbmNlLCBkcmFnZ2FibGUpIHtcclxuICAgIGluc3RhbmNlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gIH0sXHJcbiAgZWRpdGFibGUoaW5zdGFuY2UsIGVkaXRhYmxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgfSxcclxuICBtYXAoaW5zdGFuY2UsIG1hcCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgfSxcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH0sXHJcbiAgcGF0aChpbnN0YW5jZSwgcGF0aCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0UGF0aChwYXRoKTtcclxuICB9LFxyXG4gIHZpc2libGUoaW5zdGFuY2UsIHZpc2libGUpIHtcclxuICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgfVxyXG59O1xyXG52YXIgZGVmYXVsdE9wdGlvbnMkMSA9IHt9O1xyXG5mdW5jdGlvbiBQb2x5bGluZUZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBvcHRpb25zLFxyXG4gICAgZHJhZ2dhYmxlLFxyXG4gICAgZWRpdGFibGUsXHJcbiAgICB2aXNpYmxlLFxyXG4gICAgcGF0aCxcclxuICAgIG9uRGJsQ2xpY2ssXHJcbiAgICBvbkRyYWdFbmQsXHJcbiAgICBvbkRyYWdTdGFydCxcclxuICAgIG9uTW91c2VEb3duLFxyXG4gICAgb25Nb3VzZU1vdmUsXHJcbiAgICBvbk1vdXNlT3V0LFxyXG4gICAgb25Nb3VzZU92ZXIsXHJcbiAgICBvbk1vdXNlVXAsXHJcbiAgICBvblJpZ2h0Q2xpY2ssXHJcbiAgICBvbkNsaWNrLFxyXG4gICAgb25EcmFnLFxyXG4gICAgb25Mb2FkLFxyXG4gICAgb25Vbm1vdW50XHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIFtpbnN0YW5jZSwgc2V0SW5zdGFuY2VdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkYmxjbGlja0xpc3RlbmVyLCBzZXREYmxjbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ2VuZExpc3RlbmVyLCBzZXREcmFnZW5kTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnc3RhcnRMaXN0ZW5lciwgc2V0RHJhZ3N0YXJ0TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZWRvd25MaXN0ZW5lciwgc2V0TW91c2Vkb3duTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW1vdmVMaXN0ZW5lciwgc2V0TW91c2Vtb3ZlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW91dExpc3RlbmVyLCBzZXRNb3VzZW91dExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdmVyTGlzdGVuZXIsIHNldE1vdXNlb3Zlckxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2V1cExpc3RlbmVyLCBzZXRNb3VzZXVwTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyaWdodGNsaWNrTGlzdGVuZXIsIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NsaWNrTGlzdGVuZXIsIHNldENsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnTGlzdGVuZXIsIHNldERyYWdMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBvcHRpb25zXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgZHJhZ2dhYmxlICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGRyYWdnYWJsZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGVkaXRhYmxlICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBlZGl0YWJsZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHZpc2libGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCB2aXNpYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0UGF0aChwYXRoKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHBhdGhdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRGJsQ2xpY2spIHtcclxuICAgICAgaWYgKGRibGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkYmxjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREYmxjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZGJsY2xpY2snLCBvbkRibENsaWNrKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRGJsQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRHJhZ0VuZCkge1xyXG4gICAgICBpZiAoZHJhZ2VuZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ2VuZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnZW5kTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkcmFnZW5kJywgb25EcmFnRW5kKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRHJhZ0VuZF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25EcmFnU3RhcnQpIHtcclxuICAgICAgaWYgKGRyYWdzdGFydExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ3N0YXJ0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERyYWdzdGFydExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnU3RhcnRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VEb3duKSB7XHJcbiAgICAgIGlmIChtb3VzZWRvd25MaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlZG93bkxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZWRvd25MaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VEb3duXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlTW92ZSkge1xyXG4gICAgICBpZiAobW91c2Vtb3ZlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW1vdmVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vtb3ZlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlTW92ZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZU91dCkge1xyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlb3V0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU91dF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZU92ZXIpIHtcclxuICAgICAgaWYgKG1vdXNlb3Zlckxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdmVyTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlb3Zlckxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2VvdmVyJywgb25Nb3VzZU92ZXIpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU92ZXJdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VVcCkge1xyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZXVwTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZXVwJywgb25Nb3VzZVVwKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VVcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25SaWdodENsaWNrKSB7XHJcbiAgICAgIGlmIChyaWdodGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyaWdodGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25SaWdodENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkNsaWNrKSB7XHJcbiAgICAgIGlmIChjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2NsaWNrJywgb25DbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkNsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRyYWcpIHtcclxuICAgICAgaWYgKGRyYWdMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZycsIG9uRHJhZykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWddKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdmFyIHBvbHlsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKF9vYmplY3RTcHJlYWQkOShfb2JqZWN0U3ByZWFkJDkoe30sIG9wdGlvbnMgfHwgZGVmYXVsdE9wdGlvbnMkMSksIHt9LCB7XHJcbiAgICAgIG1hcFxyXG4gICAgfSkpO1xyXG4gICAgaWYgKHBhdGgpIHtcclxuICAgICAgcG9seWxpbmUuc2V0UGF0aChwYXRoKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcG9seWxpbmUuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZWRpdGFibGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHBvbHlsaW5lLnNldEVkaXRhYmxlKGVkaXRhYmxlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZHJhZ2dhYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBwb2x5bGluZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRibENsaWNrKSB7XHJcbiAgICAgIHNldERibGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWxpbmUsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdFbmQpIHtcclxuICAgICAgc2V0RHJhZ2VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlsaW5lLCAnZHJhZ2VuZCcsIG9uRHJhZ0VuZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZ1N0YXJ0KSB7XHJcbiAgICAgIHNldERyYWdzdGFydExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlsaW5lLCAnZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlRG93bikge1xyXG4gICAgICBzZXRNb3VzZWRvd25MaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5bGluZSwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU1vdmUpIHtcclxuICAgICAgc2V0TW91c2Vtb3ZlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWxpbmUsICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VPdXQpIHtcclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5bGluZSwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIHNldE1vdXNlb3Zlckxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlsaW5lLCAnbW91c2VvdmVyJywgb25Nb3VzZU92ZXIpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlVXApIHtcclxuICAgICAgc2V0TW91c2V1cExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlsaW5lLCAnbW91c2V1cCcsIG9uTW91c2VVcCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uUmlnaHRDbGljaykge1xyXG4gICAgICBzZXRSaWdodGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWxpbmUsICdyaWdodGNsaWNrJywgb25SaWdodENsaWNrKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25DbGljaykge1xyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlsaW5lLCAnY2xpY2snLCBvbkNsaWNrKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25EcmFnKSB7XHJcbiAgICAgIHNldERyYWdMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5bGluZSwgJ2RyYWcnLCBvbkRyYWcpKTtcclxuICAgIH1cclxuICAgIHNldEluc3RhbmNlKHBvbHlsaW5lKTtcclxuICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgb25Mb2FkKHBvbHlsaW5lKTtcclxuICAgIH1cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdlbmRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdlbmRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdzdGFydExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ3N0YXJ0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZWRvd25MaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlZG93bkxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2Vtb3ZlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW1vdmVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNlb3V0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW91dExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2VvdmVyTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW92ZXJMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNldXBMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNldXBMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJpZ2h0Y2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJpZ2h0Y2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgb25Vbm1vdW50KHBvbHlsaW5lKTtcclxuICAgICAgfVxyXG4gICAgICBwb2x5bGluZS5zZXRNYXAobnVsbCk7XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgUG9seWxpbmVGID0gbWVtbyhQb2x5bGluZUZ1bmN0aW9uYWwpO1xyXG5jbGFzcyBQb2x5bGluZSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBwb2x5bGluZTogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRQb2x5bGluZUNhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUucG9seWxpbmUgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLnBvbHlsaW5lKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIHBvbHlsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKF9vYmplY3RTcHJlYWQkOShfb2JqZWN0U3ByZWFkJDkoe30sIHRoaXMucHJvcHMub3B0aW9ucyksIHt9LCB7XHJcbiAgICAgIG1hcDogdGhpcy5jb250ZXh0XHJcbiAgICB9KSk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCRiLFxyXG4gICAgICBldmVudE1hcDogZXZlbnRNYXAkYixcclxuICAgICAgcHJldlByb3BzOiB7fSxcclxuICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICBpbnN0YW5jZTogcG9seWxpbmVcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRQb2x5bGluZSgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBwb2x5bGluZVxyXG4gICAgICB9O1xyXG4gICAgfSwgdGhpcy5zZXRQb2x5bGluZUNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUucG9seWxpbmUgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGIsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGIsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5wb2x5bGluZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5wb2x5bGluZSA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQodGhpcy5zdGF0ZS5wb2x5bGluZSk7XHJcbiAgICB9XHJcbiAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICB0aGlzLnN0YXRlLnBvbHlsaW5lLnNldE1hcChudWxsKTtcclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShQb2x5bGluZSwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIG93bktleXMkOChlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkOChlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJDgoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJDgoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxudmFyIGV2ZW50TWFwJGEgPSB7XHJcbiAgb25DbGljazogJ2NsaWNrJyxcclxuICBvbkRibENsaWNrOiAnZGJsY2xpY2snLFxyXG4gIG9uRHJhZzogJ2RyYWcnLFxyXG4gIG9uRHJhZ0VuZDogJ2RyYWdlbmQnLFxyXG4gIG9uRHJhZ1N0YXJ0OiAnZHJhZ3N0YXJ0JyxcclxuICBvbk1vdXNlRG93bjogJ21vdXNlZG93bicsXHJcbiAgb25Nb3VzZU1vdmU6ICdtb3VzZW1vdmUnLFxyXG4gIG9uTW91c2VPdXQ6ICdtb3VzZW91dCcsXHJcbiAgb25Nb3VzZU92ZXI6ICdtb3VzZW92ZXInLFxyXG4gIG9uTW91c2VVcDogJ21vdXNldXAnLFxyXG4gIG9uUmlnaHRDbGljazogJ3JpZ2h0Y2xpY2snXHJcbn07XHJcbnZhciB1cGRhdGVyTWFwJGEgPSB7XHJcbiAgZHJhZ2dhYmxlKGluc3RhbmNlLCBkcmFnZ2FibGUpIHtcclxuICAgIGluc3RhbmNlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gIH0sXHJcbiAgZWRpdGFibGUoaW5zdGFuY2UsIGVkaXRhYmxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgfSxcclxuICBtYXAoaW5zdGFuY2UsIG1hcCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgfSxcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH0sXHJcbiAgcGF0aChpbnN0YW5jZSwgcGF0aCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0UGF0aChwYXRoKTtcclxuICB9LFxyXG4gIHBhdGhzKGluc3RhbmNlLCBwYXRocykge1xyXG4gICAgaW5zdGFuY2Uuc2V0UGF0aHMocGF0aHMpO1xyXG4gIH0sXHJcbiAgdmlzaWJsZShpbnN0YW5jZSwgdmlzaWJsZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICB9XHJcbn07XHJcbmZ1bmN0aW9uIFBvbHlnb25GdW5jdGlvbmFsKF9yZWYpIHtcclxuICB2YXIge1xyXG4gICAgb3B0aW9ucyxcclxuICAgIGRyYWdnYWJsZSxcclxuICAgIGVkaXRhYmxlLFxyXG4gICAgdmlzaWJsZSxcclxuICAgIHBhdGgsXHJcbiAgICBwYXRocyxcclxuICAgIG9uRGJsQ2xpY2ssXHJcbiAgICBvbkRyYWdFbmQsXHJcbiAgICBvbkRyYWdTdGFydCxcclxuICAgIG9uTW91c2VEb3duLFxyXG4gICAgb25Nb3VzZU1vdmUsXHJcbiAgICBvbk1vdXNlT3V0LFxyXG4gICAgb25Nb3VzZU92ZXIsXHJcbiAgICBvbk1vdXNlVXAsXHJcbiAgICBvblJpZ2h0Q2xpY2ssXHJcbiAgICBvbkNsaWNrLFxyXG4gICAgb25EcmFnLFxyXG4gICAgb25Mb2FkLFxyXG4gICAgb25Vbm1vdW50LFxyXG4gICAgb25FZGl0XHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIFtpbnN0YW5jZSwgc2V0SW5zdGFuY2VdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkYmxjbGlja0xpc3RlbmVyLCBzZXREYmxjbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ2VuZExpc3RlbmVyLCBzZXREcmFnZW5kTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnc3RhcnRMaXN0ZW5lciwgc2V0RHJhZ3N0YXJ0TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZWRvd25MaXN0ZW5lciwgc2V0TW91c2Vkb3duTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW1vdmVMaXN0ZW5lciwgc2V0TW91c2Vtb3ZlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW91dExpc3RlbmVyLCBzZXRNb3VzZW91dExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdmVyTGlzdGVuZXIsIHNldE1vdXNlb3Zlckxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2V1cExpc3RlbmVyLCBzZXRNb3VzZXVwTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyaWdodGNsaWNrTGlzdGVuZXIsIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NsaWNrTGlzdGVuZXIsIHNldENsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnTGlzdGVuZXIsIHNldERyYWdMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBvcHRpb25zXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgZHJhZ2dhYmxlICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGRyYWdnYWJsZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIGVkaXRhYmxlICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCBlZGl0YWJsZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHZpc2libGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgICB9XHJcbiAgfSwgW2luc3RhbmNlLCB2aXNpYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0UGF0aChwYXRoKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHBhdGhdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBwYXRocyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0UGF0aHMocGF0aHMpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgcGF0aHNdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIHR5cGVvZiBvbkRibENsaWNrID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRibENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICghaW5zdGFuY2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UuZ2V0UGF0aCgpLCAnaW5zZXJ0X2F0JywgKCkgPT4ge1xyXG4gICAgICBvbkVkaXQgPT09IG51bGwgfHwgb25FZGl0ID09PSB2b2lkIDAgfHwgb25FZGl0KGluc3RhbmNlKTtcclxuICAgIH0pO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UuZ2V0UGF0aCgpLCAnc2V0X2F0JywgKCkgPT4ge1xyXG4gICAgICBvbkVkaXQgPT09IG51bGwgfHwgb25FZGl0ID09PSB2b2lkIDAgfHwgb25FZGl0KGluc3RhbmNlKTtcclxuICAgIH0pO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UuZ2V0UGF0aCgpLCAncmVtb3ZlX2F0JywgKCkgPT4ge1xyXG4gICAgICBvbkVkaXQgPT09IG51bGwgfHwgb25FZGl0ID09PSB2b2lkIDAgfHwgb25FZGl0KGluc3RhbmNlKTtcclxuICAgIH0pO1xyXG4gIH0sIFtpbnN0YW5jZSwgb25FZGl0XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25EcmFnRW5kID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChkcmFnZW5kTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnZW5kTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERyYWdlbmRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RyYWdlbmQnLCBvbkRyYWdFbmQpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnRW5kXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25EcmFnU3RhcnQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgaWYgKGRyYWdzdGFydExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ3N0YXJ0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERyYWdzdGFydExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnU3RhcnRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIHR5cGVvZiBvbk1vdXNlRG93biA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBpZiAobW91c2Vkb3duTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZWRvd25MaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vkb3duTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZWRvd24nLCBvbk1vdXNlRG93bikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlRG93bl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgdHlwZW9mIG9uTW91c2VNb3ZlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlbW92ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW1vdmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VNb3ZlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25Nb3VzZU91dCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlb3V0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU91dF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgdHlwZW9mIG9uTW91c2VPdmVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW92ZXJMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlb3ZlcicsIG9uTW91c2VPdmVyKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VPdmVyXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25Nb3VzZVVwID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChtb3VzZXVwTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZXVwTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNldXBMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNldXAnLCBvbk1vdXNlVXApKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZVVwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25SaWdodENsaWNrID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGlmIChyaWdodGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyaWdodGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFJpZ2h0Y2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25SaWdodENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2Ygb25DbGljayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdjbGljaycsIG9uQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25DbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgdHlwZW9mIG9uRHJhZyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBpZiAoZHJhZ0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkcmFnJywgb25EcmFnKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRHJhZ10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2YXIgcG9seWdvbiA9IG5ldyBnb29nbGUubWFwcy5Qb2x5Z29uKF9vYmplY3RTcHJlYWQkOChfb2JqZWN0U3ByZWFkJDgoe30sIG9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBtYXBcclxuICAgIH0pKTtcclxuICAgIGlmIChwYXRoKSB7XHJcbiAgICAgIHBvbHlnb24uc2V0UGF0aChwYXRoKTtcclxuICAgIH1cclxuICAgIGlmIChwYXRocykge1xyXG4gICAgICBwb2x5Z29uLnNldFBhdGhzKHBhdGhzKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcG9seWdvbi5zZXRWaXNpYmxlKHZpc2libGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBlZGl0YWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcG9seWdvbi5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGRyYWdnYWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcG9seWdvbi5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRibENsaWNrKSB7XHJcbiAgICAgIHNldERibGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWdvbiwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZ0VuZCkge1xyXG4gICAgICBzZXREcmFnZW5kTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWdvbiwgJ2RyYWdlbmQnLCBvbkRyYWdFbmQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdTdGFydCkge1xyXG4gICAgICBzZXREcmFnc3RhcnRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5Z29uLCAnZHJhZ3N0YXJ0Jywgb25EcmFnU3RhcnQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlRG93bikge1xyXG4gICAgICBzZXRNb3VzZWRvd25MaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5Z29uLCAnbW91c2Vkb3duJywgb25Nb3VzZURvd24pKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlTW92ZSkge1xyXG4gICAgICBzZXRNb3VzZW1vdmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihwb2x5Z29uLCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlT3V0KSB7XHJcbiAgICAgIHNldE1vdXNlb3V0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWdvbiwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIHNldE1vdXNlb3Zlckxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlnb24sICdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VVcCkge1xyXG4gICAgICBzZXRNb3VzZXVwTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocG9seWdvbiwgJ21vdXNldXAnLCBvbk1vdXNlVXApKTtcclxuICAgIH1cclxuICAgIGlmIChvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgc2V0UmlnaHRjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlnb24sICdyaWdodGNsaWNrJywgb25SaWdodENsaWNrKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25DbGljaykge1xyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlnb24sICdjbGljaycsIG9uQ2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWcpIHtcclxuICAgICAgc2V0RHJhZ0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHBvbHlnb24sICdkcmFnJywgb25EcmFnKSk7XHJcbiAgICB9XHJcbiAgICBzZXRJbnN0YW5jZShwb2x5Z29uKTtcclxuICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgb25Mb2FkKHBvbHlnb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKGRibGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkYmxjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZHJhZ2VuZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ2VuZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZHJhZ3N0YXJ0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnc3RhcnRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNlZG93bkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vkb3duTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlbW92ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocmlnaHRjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmlnaHRjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICBvblVubW91bnQocG9seWdvbik7XHJcbiAgICAgIH1cclxuICAgICAgcG9seWdvbi5zZXRNYXAobnVsbCk7XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgUG9seWdvbkYgPSBtZW1vKFBvbHlnb25GdW5jdGlvbmFsKTtcclxuY2xhc3MgUG9seWdvbiBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIHZhciBwb2x5Z29uT3B0aW9ucyA9IHRoaXMucHJvcHMub3B0aW9ucyB8fCB7fTtcclxuICAgIHRoaXMucG9seWdvbiA9IG5ldyBnb29nbGUubWFwcy5Qb2x5Z29uKHBvbHlnb25PcHRpb25zKTtcclxuICAgIHRoaXMucG9seWdvbi5zZXRNYXAodGhpcy5jb250ZXh0KTtcclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGEsXHJcbiAgICAgIGV2ZW50TWFwOiBldmVudE1hcCRhLFxyXG4gICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIGluc3RhbmNlOiB0aGlzLnBvbHlnb25cclxuICAgIH0pO1xyXG4gICAgaWYgKHRoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMucG9seWdvbik7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcclxuICAgIGlmICh0aGlzLnBvbHlnb24pIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJGEsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJGEsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5wb2x5Z29uXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnBvbHlnb24pIHtcclxuICAgICAgaWYgKHRoaXMucHJvcHMub25Vbm1vdW50KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQodGhpcy5wb2x5Z29uKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIGlmICh0aGlzLnBvbHlnb24pIHtcclxuICAgICAgICB0aGlzLnBvbHlnb24uc2V0TWFwKG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoUG9seWdvbiwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIG93bktleXMkNyhlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkNyhlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJDcoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJDcoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxudmFyIGV2ZW50TWFwJDkgPSB7XHJcbiAgb25Cb3VuZHNDaGFuZ2VkOiAnYm91bmRzX2NoYW5nZWQnLFxyXG4gIG9uQ2xpY2s6ICdjbGljaycsXHJcbiAgb25EYmxDbGljazogJ2RibGNsaWNrJyxcclxuICBvbkRyYWc6ICdkcmFnJyxcclxuICBvbkRyYWdFbmQ6ICdkcmFnZW5kJyxcclxuICBvbkRyYWdTdGFydDogJ2RyYWdzdGFydCcsXHJcbiAgb25Nb3VzZURvd246ICdtb3VzZWRvd24nLFxyXG4gIG9uTW91c2VNb3ZlOiAnbW91c2Vtb3ZlJyxcclxuICBvbk1vdXNlT3V0OiAnbW91c2VvdXQnLFxyXG4gIG9uTW91c2VPdmVyOiAnbW91c2VvdmVyJyxcclxuICBvbk1vdXNlVXA6ICdtb3VzZXVwJyxcclxuICBvblJpZ2h0Q2xpY2s6ICdyaWdodGNsaWNrJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQ5ID0ge1xyXG4gIGJvdW5kcyhpbnN0YW5jZSwgYm91bmRzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRCb3VuZHMoYm91bmRzKTtcclxuICB9LFxyXG4gIGRyYWdnYWJsZShpbnN0YW5jZSwgZHJhZ2dhYmxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICB9LFxyXG4gIGVkaXRhYmxlKGluc3RhbmNlLCBlZGl0YWJsZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0RWRpdGFibGUoZWRpdGFibGUpO1xyXG4gIH0sXHJcbiAgbWFwKGluc3RhbmNlLCBtYXApIHtcclxuICAgIGluc3RhbmNlLnNldE1hcChtYXApO1xyXG4gIH0sXHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHZpc2libGUoaW5zdGFuY2UsIHZpc2libGUpIHtcclxuICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgfVxyXG59O1xyXG5mdW5jdGlvbiBSZWN0YW5nbGVGdW5jdGlvbmFsKF9yZWYpIHtcclxuICB2YXIge1xyXG4gICAgb3B0aW9ucyxcclxuICAgIGJvdW5kcyxcclxuICAgIGRyYWdnYWJsZSxcclxuICAgIGVkaXRhYmxlLFxyXG4gICAgdmlzaWJsZSxcclxuICAgIG9uRGJsQ2xpY2ssXHJcbiAgICBvbkRyYWdFbmQsXHJcbiAgICBvbkRyYWdTdGFydCxcclxuICAgIG9uTW91c2VEb3duLFxyXG4gICAgb25Nb3VzZU1vdmUsXHJcbiAgICBvbk1vdXNlT3V0LFxyXG4gICAgb25Nb3VzZU92ZXIsXHJcbiAgICBvbk1vdXNlVXAsXHJcbiAgICBvblJpZ2h0Q2xpY2ssXHJcbiAgICBvbkNsaWNrLFxyXG4gICAgb25EcmFnLFxyXG4gICAgb25Cb3VuZHNDaGFuZ2VkLFxyXG4gICAgb25Mb2FkLFxyXG4gICAgb25Vbm1vdW50XHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIFtpbnN0YW5jZSwgc2V0SW5zdGFuY2VdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkYmxjbGlja0xpc3RlbmVyLCBzZXREYmxjbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ2VuZExpc3RlbmVyLCBzZXREcmFnZW5kTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnc3RhcnRMaXN0ZW5lciwgc2V0RHJhZ3N0YXJ0TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZWRvd25MaXN0ZW5lciwgc2V0TW91c2Vkb3duTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW1vdmVMaXN0ZW5lciwgc2V0TW91c2Vtb3ZlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFttb3VzZW91dExpc3RlbmVyLCBzZXRNb3VzZW91dExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdmVyTGlzdGVuZXIsIHNldE1vdXNlb3Zlckxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2V1cExpc3RlbmVyLCBzZXRNb3VzZXVwTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyaWdodENsaWNrTGlzdGVuZXIsIHNldFJpZ2h0Q2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2NsaWNrTGlzdGVuZXIsIHNldENsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkcmFnTGlzdGVuZXIsIHNldERyYWdMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2JvdW5kc0NoYW5nZWRMaXN0ZW5lciwgc2V0Qm91bmRzQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIC8vIE9yZGVyIGRvZXMgbWF0dGVyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9LCBbbWFwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9wdGlvbnNdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBkcmFnZ2FibGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgZHJhZ2dhYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgZWRpdGFibGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldEVkaXRhYmxlKGVkaXRhYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGVkaXRhYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHZpc2libGVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBib3VuZHMgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldEJvdW5kcyhib3VuZHMpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgYm91bmRzXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRibENsaWNrKSB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRibENsaWNrXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRyYWdFbmQpIHtcclxuICAgICAgaWYgKGRyYWdlbmRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdlbmRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ2VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnZHJhZ2VuZCcsIG9uRHJhZ0VuZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWdFbmRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRHJhZ1N0YXJ0KSB7XHJcbiAgICAgIGlmIChkcmFnc3RhcnRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdzdGFydExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnc3RhcnRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RyYWdzdGFydCcsIG9uRHJhZ1N0YXJ0KSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRHJhZ1N0YXJ0XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlRG93bikge1xyXG4gICAgICBpZiAobW91c2Vkb3duTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZWRvd25MaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2Vkb3duTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZWRvd24nLCBvbk1vdXNlRG93bikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlRG93bl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZU1vdmUpIHtcclxuICAgICAgaWYgKG1vdXNlbW92ZUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vtb3ZlTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlbW92ZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZU1vdmVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VPdXQpIHtcclxuICAgICAgaWYgKG1vdXNlb3V0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW91dExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW91dExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2VvdXQnLCBvbk1vdXNlT3V0KSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VPdXRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VPdmVyKSB7XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW92ZXJMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlb3ZlcicsIG9uTW91c2VPdmVyKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VPdmVyXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlVXApIHtcclxuICAgICAgaWYgKG1vdXNldXBMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNldXBMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2V1cExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2V1cCcsIG9uTW91c2VVcCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlVXBdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uUmlnaHRDbGljaykge1xyXG4gICAgICBpZiAocmlnaHRDbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmlnaHRDbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRSaWdodENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdyaWdodGNsaWNrJywgb25SaWdodENsaWNrKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uUmlnaHRDbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25DbGljaykge1xyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdjbGljaycsIG9uQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25DbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25EcmFnKSB7XHJcbiAgICAgIGlmIChkcmFnTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERyYWdMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RyYWcnLCBvbkRyYWcpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkJvdW5kc0NoYW5nZWQpIHtcclxuICAgICAgaWYgKGJvdW5kc0NoYW5nZWRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGJvdW5kc0NoYW5nZWRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0Qm91bmRzQ2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnYm91bmRzX2NoYW5nZWQnLCBvbkJvdW5kc0NoYW5nZWQpKTtcclxuICAgIH1cclxuICB9LCBbb25Cb3VuZHNDaGFuZ2VkXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHZhciByZWN0YW5nbGUgPSBuZXcgZ29vZ2xlLm1hcHMuUmVjdGFuZ2xlKF9vYmplY3RTcHJlYWQkNyhfb2JqZWN0U3ByZWFkJDcoe30sIG9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBtYXBcclxuICAgIH0pKTtcclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcmVjdGFuZ2xlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGVkaXRhYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICByZWN0YW5nbGUuc2V0RWRpdGFibGUoZWRpdGFibGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBkcmFnZ2FibGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHJlY3RhbmdsZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgYm91bmRzICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICByZWN0YW5nbGUuc2V0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICB9XHJcbiAgICBpZiAob25EYmxDbGljaykge1xyXG4gICAgICBzZXREYmxjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHJlY3RhbmdsZSwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZ0VuZCkge1xyXG4gICAgICBzZXREcmFnZW5kTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVjdGFuZ2xlLCAnZHJhZ2VuZCcsIG9uRHJhZ0VuZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRHJhZ1N0YXJ0KSB7XHJcbiAgICAgIHNldERyYWdzdGFydExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHJlY3RhbmdsZSwgJ2RyYWdzdGFydCcsIG9uRHJhZ1N0YXJ0KSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZURvd24pIHtcclxuICAgICAgc2V0TW91c2Vkb3duTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVjdGFuZ2xlLCAnbW91c2Vkb3duJywgb25Nb3VzZURvd24pKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlTW92ZSkge1xyXG4gICAgICBzZXRNb3VzZW1vdmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihyZWN0YW5nbGUsICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VPdXQpIHtcclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihyZWN0YW5nbGUsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlT3Zlcikge1xyXG4gICAgICBzZXRNb3VzZW92ZXJMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihyZWN0YW5nbGUsICdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VVcCkge1xyXG4gICAgICBzZXRNb3VzZXVwTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVjdGFuZ2xlLCAnbW91c2V1cCcsIG9uTW91c2VVcCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uUmlnaHRDbGljaykge1xyXG4gICAgICBzZXRSaWdodENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIocmVjdGFuZ2xlLCAncmlnaHRjbGljaycsIG9uUmlnaHRDbGljaykpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uQ2xpY2spIHtcclxuICAgICAgc2V0Q2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihyZWN0YW5nbGUsICdjbGljaycsIG9uQ2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWcpIHtcclxuICAgICAgc2V0RHJhZ0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHJlY3RhbmdsZSwgJ2RyYWcnLCBvbkRyYWcpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkJvdW5kc0NoYW5nZWQpIHtcclxuICAgICAgc2V0Qm91bmRzQ2hhbmdlZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHJlY3RhbmdsZSwgJ2JvdW5kc19jaGFuZ2VkJywgb25Cb3VuZHNDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgICBzZXRJbnN0YW5jZShyZWN0YW5nbGUpO1xyXG4gICAgaWYgKG9uTG9hZCkge1xyXG4gICAgICBvbkxvYWQocmVjdGFuZ2xlKTtcclxuICAgIH1cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZGJsY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdlbmRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRyYWdlbmRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRyYWdzdGFydExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ3N0YXJ0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZWRvd25MaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlZG93bkxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2Vtb3ZlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW1vdmVMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNlb3V0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW91dExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2VvdmVyTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW92ZXJMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNldXBMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNldXBMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJpZ2h0Q2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJpZ2h0Q2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZHJhZ0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYm91bmRzQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoYm91bmRzQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25Vbm1vdW50KSB7XHJcbiAgICAgICAgb25Vbm1vdW50KHJlY3RhbmdsZSk7XHJcbiAgICAgIH1cclxuICAgICAgcmVjdGFuZ2xlLnNldE1hcChudWxsKTtcclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG4gIHJldHVybiBudWxsO1xyXG59XHJcbnZhciBSZWN0YW5nbGVGID0gbWVtbyhSZWN0YW5nbGVGdW5jdGlvbmFsKTtcclxuY2xhc3MgUmVjdGFuZ2xlIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVnaXN0ZXJlZEV2ZW50c1wiLCBbXSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIHJlY3RhbmdsZTogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRSZWN0YW5nbGVDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLnJlY3RhbmdsZSAhPT0gbnVsbCAmJiB0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUucmVjdGFuZ2xlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIHJlY3RhbmdsZSA9IG5ldyBnb29nbGUubWFwcy5SZWN0YW5nbGUoX29iamVjdFNwcmVhZCQ3KF9vYmplY3RTcHJlYWQkNyh7fSwgdGhpcy5wcm9wcy5vcHRpb25zKSwge30sIHtcclxuICAgICAgbWFwOiB0aGlzLmNvbnRleHRcclxuICAgIH0pKTtcclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDksXHJcbiAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQ5LFxyXG4gICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIGluc3RhbmNlOiByZWN0YW5nbGVcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRSZWN0YW5nbGUoKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVjdGFuZ2xlXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldFJlY3RhbmdsZUNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUucmVjdGFuZ2xlICE9PSBudWxsKSB7XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCQ5LFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQ5LFxyXG4gICAgICAgIHByZXZQcm9wcyxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IHRoaXMuc3RhdGUucmVjdGFuZ2xlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLnJlY3RhbmdsZSAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLnJlY3RhbmdsZSk7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnN0YXRlLnJlY3RhbmdsZS5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoUmVjdGFuZ2xlLCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxuZnVuY3Rpb24gb3duS2V5cyQ2KGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH1cclxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ2KGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMkNihPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IF9kZWZpbmVQcm9wZXJ0eShlLCByLCB0W3JdKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMkNihPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfVxyXG52YXIgZXZlbnRNYXAkOCA9IHtcclxuICBvbkNlbnRlckNoYW5nZWQ6ICdjZW50ZXJfY2hhbmdlZCcsXHJcbiAgb25SYWRpdXNDaGFuZ2VkOiAncmFkaXVzX2NoYW5nZWQnLFxyXG4gIG9uQ2xpY2s6ICdjbGljaycsXHJcbiAgb25EYmxDbGljazogJ2RibGNsaWNrJyxcclxuICBvbkRyYWc6ICdkcmFnJyxcclxuICBvbkRyYWdFbmQ6ICdkcmFnZW5kJyxcclxuICBvbkRyYWdTdGFydDogJ2RyYWdzdGFydCcsXHJcbiAgb25Nb3VzZURvd246ICdtb3VzZWRvd24nLFxyXG4gIG9uTW91c2VNb3ZlOiAnbW91c2Vtb3ZlJyxcclxuICBvbk1vdXNlT3V0OiAnbW91c2VvdXQnLFxyXG4gIG9uTW91c2VPdmVyOiAnbW91c2VvdmVyJyxcclxuICBvbk1vdXNlVXA6ICdtb3VzZXVwJyxcclxuICBvblJpZ2h0Q2xpY2s6ICdyaWdodGNsaWNrJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQ4ID0ge1xyXG4gIGNlbnRlcihpbnN0YW5jZSwgY2VudGVyKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRDZW50ZXIoY2VudGVyKTtcclxuICB9LFxyXG4gIGRyYWdnYWJsZShpbnN0YW5jZSwgZHJhZ2dhYmxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXREcmFnZ2FibGUoZHJhZ2dhYmxlKTtcclxuICB9LFxyXG4gIGVkaXRhYmxlKGluc3RhbmNlLCBlZGl0YWJsZSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0RWRpdGFibGUoZWRpdGFibGUpO1xyXG4gIH0sXHJcbiAgbWFwKGluc3RhbmNlLCBtYXApIHtcclxuICAgIGluc3RhbmNlLnNldE1hcChtYXApO1xyXG4gIH0sXHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHJhZGl1cyhpbnN0YW5jZSwgcmFkaXVzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRSYWRpdXMocmFkaXVzKTtcclxuICB9LFxyXG4gIHZpc2libGUoaW5zdGFuY2UsIHZpc2libGUpIHtcclxuICAgIGluc3RhbmNlLnNldFZpc2libGUodmlzaWJsZSk7XHJcbiAgfVxyXG59O1xyXG52YXIgZGVmYXVsdE9wdGlvbnMgPSB7fTtcclxuZnVuY3Rpb24gQ2lyY2xlRnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIG9wdGlvbnMsXHJcbiAgICBjZW50ZXIsXHJcbiAgICByYWRpdXMsXHJcbiAgICBkcmFnZ2FibGUsXHJcbiAgICBlZGl0YWJsZSxcclxuICAgIHZpc2libGUsXHJcbiAgICBvbkRibENsaWNrLFxyXG4gICAgb25EcmFnRW5kLFxyXG4gICAgb25EcmFnU3RhcnQsXHJcbiAgICBvbk1vdXNlRG93bixcclxuICAgIG9uTW91c2VNb3ZlLFxyXG4gICAgb25Nb3VzZU91dCxcclxuICAgIG9uTW91c2VPdmVyLFxyXG4gICAgb25Nb3VzZVVwLFxyXG4gICAgb25SaWdodENsaWNrLFxyXG4gICAgb25DbGljayxcclxuICAgIG9uRHJhZyxcclxuICAgIG9uQ2VudGVyQ2hhbmdlZCxcclxuICAgIG9uUmFkaXVzQ2hhbmdlZCxcclxuICAgIG9uTG9hZCxcclxuICAgIG9uVW5tb3VudFxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIHZhciBbaW5zdGFuY2UsIHNldEluc3RhbmNlXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZGJsY2xpY2tMaXN0ZW5lciwgc2V0RGJsY2xpY2tMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW2RyYWdlbmRMaXN0ZW5lciwgc2V0RHJhZ2VuZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ3N0YXJ0TGlzdGVuZXIsIHNldERyYWdzdGFydExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2Vkb3duTGlzdGVuZXIsIHNldE1vdXNlZG93bkxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2Vtb3ZlTGlzdGVuZXIsIHNldE1vdXNlbW92ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdXRMaXN0ZW5lciwgc2V0TW91c2VvdXRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNlb3Zlckxpc3RlbmVyLCBzZXRNb3VzZW92ZXJMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNldXBMaXN0ZW5lciwgc2V0TW91c2V1cExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcmlnaHRjbGlja0xpc3RlbmVyLCBzZXRSaWdodGNsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbGlja0xpc3RlbmVyLCBzZXRDbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbZHJhZ0xpc3RlbmVyLCBzZXREcmFnTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjZW50ZXJDaGFuZ2VkTGlzdGVuZXIsIHNldENlbnRlckNoYW5nZWRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW3JhZGl1c0NoYW5nZWRMaXN0ZW5lciwgc2V0UmFkaXVzQ2hhbmdlZExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIC8vIE9yZGVyIGRvZXMgbWF0dGVyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9LCBbbWFwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9wdGlvbnNdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBkcmFnZ2FibGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgZHJhZ2dhYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgZWRpdGFibGUgIT09ICd1bmRlZmluZWQnICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldEVkaXRhYmxlKGVkaXRhYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGVkaXRhYmxlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIHZpc2libGVdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiByYWRpdXMgPT09ICdudW1iZXInICYmIGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldFJhZGl1cyhyYWRpdXMpO1xyXG4gICAgfVxyXG4gIH0sIFtpbnN0YW5jZSwgcmFkaXVzXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgY2VudGVyICE9PSAndW5kZWZpbmVkJyAmJiBpbnN0YW5jZSAhPT0gbnVsbCkge1xyXG4gICAgICBpbnN0YW5jZS5zZXRDZW50ZXIoY2VudGVyKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIGNlbnRlcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25EYmxDbGljaykge1xyXG4gICAgICBpZiAoZGJsY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRibGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERibGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25EYmxDbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25EcmFnRW5kKSB7XHJcbiAgICAgIGlmIChkcmFnZW5kTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnZW5kTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERyYWdlbmRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2RyYWdlbmQnLCBvbkRyYWdFbmQpKTtcclxuICAgIH1cclxuICB9LCBbb25EcmFnRW5kXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbkRyYWdTdGFydCkge1xyXG4gICAgICBpZiAoZHJhZ3N0YXJ0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnc3RhcnRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0RHJhZ3N0YXJ0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkcmFnc3RhcnQnLCBvbkRyYWdTdGFydCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbkRyYWdTdGFydF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZURvd24pIHtcclxuICAgICAgaWYgKG1vdXNlZG93bkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vkb3duTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlZG93bkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2Vkb3duJywgb25Nb3VzZURvd24pKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZURvd25dKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VNb3ZlKSB7XHJcbiAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlbW92ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW1vdmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VNb3ZlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlT3V0KSB7XHJcbiAgICAgIGlmIChtb3VzZW91dExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdXRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlT3V0XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlT3Zlcikge1xyXG4gICAgICBpZiAobW91c2VvdmVyTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW92ZXJMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdmVyTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlT3Zlcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZVVwKSB7XHJcbiAgICAgIGlmIChtb3VzZXVwTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZXVwTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNldXBMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNldXAnLCBvbk1vdXNlVXApKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZVVwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgaWYgKHJpZ2h0Y2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJpZ2h0Y2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UmlnaHRjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncmlnaHRjbGljaycsIG9uUmlnaHRDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvblJpZ2h0Q2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ2xpY2spIHtcclxuICAgICAgaWYgKGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnY2xpY2snLCBvbkNsaWNrKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uRHJhZykge1xyXG4gICAgICBpZiAoZHJhZ0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXREcmFnTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkcmFnJywgb25EcmFnKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uRHJhZ10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25DZW50ZXJDaGFuZ2VkKSB7XHJcbiAgICAgIGlmIChjZW50ZXJDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjZW50ZXJDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldENlbnRlckNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ2NlbnRlcl9jaGFuZ2VkJywgb25DZW50ZXJDaGFuZ2VkKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uUmFkaXVzQ2hhbmdlZCkge1xyXG4gICAgICBpZiAocmFkaXVzQ2hhbmdlZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmFkaXVzQ2hhbmdlZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRSYWRpdXNDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdyYWRpdXNfY2hhbmdlZCcsIG9uUmFkaXVzQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblJhZGl1c0NoYW5nZWRdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdmFyIGNpcmNsZSA9IG5ldyBnb29nbGUubWFwcy5DaXJjbGUoX29iamVjdFNwcmVhZCQ2KF9vYmplY3RTcHJlYWQkNih7fSwgb3B0aW9ucyB8fCBkZWZhdWx0T3B0aW9ucyksIHt9LCB7XHJcbiAgICAgIG1hcFxyXG4gICAgfSkpO1xyXG4gICAgaWYgKHR5cGVvZiByYWRpdXMgPT09ICdudW1iZXInKSB7XHJcbiAgICAgIGNpcmNsZS5zZXRSYWRpdXMocmFkaXVzKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY2VudGVyICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjaXJjbGUuc2V0Q2VudGVyKGNlbnRlcik7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHJhZGl1cyA9PT0gJ251bWJlcicpIHtcclxuICAgICAgY2lyY2xlLnNldFJhZGl1cyhyYWRpdXMpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB2aXNpYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjaXJjbGUuc2V0VmlzaWJsZSh2aXNpYmxlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZWRpdGFibGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNpcmNsZS5zZXRFZGl0YWJsZShlZGl0YWJsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGRyYWdnYWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgY2lyY2xlLnNldERyYWdnYWJsZShkcmFnZ2FibGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uRGJsQ2xpY2spIHtcclxuICAgICAgc2V0RGJsY2xpY2tMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihjaXJjbGUsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdFbmQpIHtcclxuICAgICAgc2V0RHJhZ2VuZExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNpcmNsZSwgJ2RyYWdlbmQnLCBvbkRyYWdFbmQpKTtcclxuICAgIH1cclxuICAgIGlmIChvbkRyYWdTdGFydCkge1xyXG4gICAgICBzZXREcmFnc3RhcnRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihjaXJjbGUsICdkcmFnc3RhcnQnLCBvbkRyYWdTdGFydCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uTW91c2VEb3duKSB7XHJcbiAgICAgIHNldE1vdXNlZG93bkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNpcmNsZSwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU1vdmUpIHtcclxuICAgICAgc2V0TW91c2Vtb3ZlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2lyY2xlLCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlT3V0KSB7XHJcbiAgICAgIHNldE1vdXNlb3V0TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2lyY2xlLCAnbW91c2VvdXQnLCBvbk1vdXNlT3V0KSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25Nb3VzZU92ZXIpIHtcclxuICAgICAgc2V0TW91c2VvdmVyTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2lyY2xlLCAnbW91c2VvdmVyJywgb25Nb3VzZU92ZXIpKTtcclxuICAgIH1cclxuICAgIGlmIChvbk1vdXNlVXApIHtcclxuICAgICAgc2V0TW91c2V1cExpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNpcmNsZSwgJ21vdXNldXAnLCBvbk1vdXNlVXApKTtcclxuICAgIH1cclxuICAgIGlmIChvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgc2V0UmlnaHRjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGNpcmNsZSwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgIH1cclxuICAgIGlmIChvbkNsaWNrKSB7XHJcbiAgICAgIHNldENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2lyY2xlLCAnY2xpY2snLCBvbkNsaWNrKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25EcmFnKSB7XHJcbiAgICAgIHNldERyYWdMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihjaXJjbGUsICdkcmFnJywgb25EcmFnKSk7XHJcbiAgICB9XHJcbiAgICBpZiAob25DZW50ZXJDaGFuZ2VkKSB7XHJcbiAgICAgIHNldENlbnRlckNoYW5nZWRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihjaXJjbGUsICdjZW50ZXJfY2hhbmdlZCcsIG9uQ2VudGVyQ2hhbmdlZCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKG9uUmFkaXVzQ2hhbmdlZCkge1xyXG4gICAgICBzZXRSYWRpdXNDaGFuZ2VkTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoY2lyY2xlLCAncmFkaXVzX2NoYW5nZWQnLCBvblJhZGl1c0NoYW5nZWQpKTtcclxuICAgIH1cclxuICAgIHNldEluc3RhbmNlKGNpcmNsZSk7XHJcbiAgICBpZiAob25Mb2FkKSB7XHJcbiAgICAgIG9uTG9hZChjaXJjbGUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKGRibGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkYmxjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZHJhZ2VuZExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoZHJhZ2VuZExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZHJhZ3N0YXJ0TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkcmFnc3RhcnRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG1vdXNlZG93bkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vkb3duTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlbW92ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3V0TGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlb3Zlckxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2V1cExpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAocmlnaHRjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmlnaHRjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjZW50ZXJDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjZW50ZXJDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChyYWRpdXNDaGFuZ2VkTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyYWRpdXNDaGFuZ2VkTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICBvblVubW91bnQoY2lyY2xlKTtcclxuICAgICAgfVxyXG4gICAgICBjaXJjbGUuc2V0TWFwKG51bGwpO1xyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxudmFyIENpcmNsZUYgPSBtZW1vKENpcmNsZUZ1bmN0aW9uYWwpO1xyXG5jbGFzcyBDaXJjbGUgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZWdpc3RlcmVkRXZlbnRzXCIsIFtdKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgY2lyY2xlOiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldENpcmNsZUNhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUuY2lyY2xlICE9PSBudWxsICYmIHRoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQodGhpcy5zdGF0ZS5jaXJjbGUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB2YXIgY2lyY2xlID0gbmV3IGdvb2dsZS5tYXBzLkNpcmNsZShfb2JqZWN0U3ByZWFkJDYoX29iamVjdFNwcmVhZCQ2KHt9LCB0aGlzLnByb3BzLm9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBtYXA6IHRoaXMuY29udGV4dFxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkOCxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDgsXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IGNpcmNsZVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldENpcmNsZSgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBjaXJjbGVcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0Q2lyY2xlQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5jaXJjbGUgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDgsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDgsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5jaXJjbGVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuY2lyY2xlICE9PSBudWxsKSB7XHJcbiAgICAgIHZhciBfdGhpcyRzdGF0ZSRjaXJjbGU7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUuY2lyY2xlKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIChfdGhpcyRzdGF0ZSRjaXJjbGUgPSB0aGlzLnN0YXRlLmNpcmNsZSkgPT09IG51bGwgfHwgX3RoaXMkc3RhdGUkY2lyY2xlID09PSB2b2lkIDAgfHwgX3RoaXMkc3RhdGUkY2lyY2xlLnNldE1hcChudWxsKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShDaXJjbGUsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzJDUoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfVxyXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkJDUoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyQ1KE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyQ1KE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9XHJcbnZhciBldmVudE1hcCQ3ID0ge1xyXG4gIG9uQ2xpY2s6ICdjbGljaycsXHJcbiAgb25EYmxDbGljazogJ2RibGNsaWNrJyxcclxuICBvbk1vdXNlRG93bjogJ21vdXNlZG93bicsXHJcbiAgb25Nb3VzZU91dDogJ21vdXNlb3V0JyxcclxuICBvbk1vdXNlT3ZlcjogJ21vdXNlb3ZlcicsXHJcbiAgb25Nb3VzZVVwOiAnbW91c2V1cCcsXHJcbiAgb25SaWdodENsaWNrOiAncmlnaHRjbGljaycsXHJcbiAgb25BZGRGZWF0dXJlOiAnYWRkZmVhdHVyZScsXHJcbiAgb25SZW1vdmVGZWF0dXJlOiAncmVtb3ZlZmVhdHVyZScsXHJcbiAgb25SZW1vdmVQcm9wZXJ0eTogJ3JlbW92ZXByb3BlcnR5JyxcclxuICBvblNldEdlb21ldHJ5OiAnc2V0Z2VvbWV0cnknLFxyXG4gIG9uU2V0UHJvcGVydHk6ICdzZXRwcm9wZXJ0eSdcclxufTtcclxudmFyIHVwZGF0ZXJNYXAkNyA9IHtcclxuICBhZGQoaW5zdGFuY2UsIGZlYXR1cmUpIHtcclxuICAgIGluc3RhbmNlLmFkZChmZWF0dXJlKTtcclxuICB9LFxyXG4gIGFkZGdlb2pzb24oaW5zdGFuY2UsIGdlb2pzb24sIG9wdGlvbnMpIHtcclxuICAgIGluc3RhbmNlLmFkZEdlb0pzb24oZ2VvanNvbiwgb3B0aW9ucyk7XHJcbiAgfSxcclxuICBjb250YWlucyhpbnN0YW5jZSwgZmVhdHVyZSkge1xyXG4gICAgaW5zdGFuY2UuY29udGFpbnMoZmVhdHVyZSk7XHJcbiAgfSxcclxuICBmb3JlYWNoKGluc3RhbmNlLCBjYWxsYmFjaykge1xyXG4gICAgaW5zdGFuY2UuZm9yRWFjaChjYWxsYmFjayk7XHJcbiAgfSxcclxuICBsb2FkZ2VvanNvbihpbnN0YW5jZSwgdXJsLCBvcHRpb25zLCBjYWxsYmFjaykge1xyXG4gICAgaW5zdGFuY2UubG9hZEdlb0pzb24odXJsLCBvcHRpb25zLCBjYWxsYmFjayk7XHJcbiAgfSxcclxuICBvdmVycmlkZXN0eWxlKGluc3RhbmNlLCBmZWF0dXJlLCBzdHlsZSkge1xyXG4gICAgaW5zdGFuY2Uub3ZlcnJpZGVTdHlsZShmZWF0dXJlLCBzdHlsZSk7XHJcbiAgfSxcclxuICByZW1vdmUoaW5zdGFuY2UsIGZlYXR1cmUpIHtcclxuICAgIGluc3RhbmNlLnJlbW92ZShmZWF0dXJlKTtcclxuICB9LFxyXG4gIHJldmVydHN0eWxlKGluc3RhbmNlLCBmZWF0dXJlKSB7XHJcbiAgICBpbnN0YW5jZS5yZXZlcnRTdHlsZShmZWF0dXJlKTtcclxuICB9LFxyXG4gIGNvbnRyb2xwb3NpdGlvbihpbnN0YW5jZSwgY29udHJvbFBvc2l0aW9uKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRDb250cm9sUG9zaXRpb24oY29udHJvbFBvc2l0aW9uKTtcclxuICB9LFxyXG4gIGNvbnRyb2xzKGluc3RhbmNlLCBjb250cm9scykge1xyXG4gICAgaW5zdGFuY2Uuc2V0Q29udHJvbHMoY29udHJvbHMpO1xyXG4gIH0sXHJcbiAgZHJhd2luZ21vZGUoaW5zdGFuY2UsIG1vZGUpIHtcclxuICAgIGluc3RhbmNlLnNldERyYXdpbmdNb2RlKG1vZGUpO1xyXG4gIH0sXHJcbiAgbWFwKGluc3RhbmNlLCBtYXApIHtcclxuICAgIGluc3RhbmNlLnNldE1hcChtYXApO1xyXG4gIH0sXHJcbiAgc3R5bGUoaW5zdGFuY2UsIHN0eWxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRTdHlsZShzdHlsZSk7XHJcbiAgfSxcclxuICB0b2dlb2pzb24oaW5zdGFuY2UsIGNhbGxiYWNrKSB7XHJcbiAgICBpbnN0YW5jZS50b0dlb0pzb24oY2FsbGJhY2spO1xyXG4gIH1cclxufTtcclxuZnVuY3Rpb24gRGF0YUZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBvcHRpb25zLFxyXG4gICAgb25DbGljayxcclxuICAgIG9uRGJsQ2xpY2ssXHJcbiAgICBvbk1vdXNlRG93bixcclxuICAgIG9uTW91c2VNb3ZlLFxyXG4gICAgb25Nb3VzZU91dCxcclxuICAgIG9uTW91c2VPdmVyLFxyXG4gICAgb25Nb3VzZVVwLFxyXG4gICAgb25SaWdodENsaWNrLFxyXG4gICAgb25BZGRGZWF0dXJlLFxyXG4gICAgb25SZW1vdmVGZWF0dXJlLFxyXG4gICAgb25SZW1vdmVQcm9wZXJ0eSxcclxuICAgIG9uU2V0R2VvbWV0cnksXHJcbiAgICBvblNldFByb3BlcnR5LFxyXG4gICAgb25Mb2FkLFxyXG4gICAgb25Vbm1vdW50XHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIFtpbnN0YW5jZSwgc2V0SW5zdGFuY2VdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtkYmxjbGlja0xpc3RlbmVyLCBzZXREYmxjbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2Vkb3duTGlzdGVuZXIsIHNldE1vdXNlZG93bkxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2Vtb3ZlTGlzdGVuZXIsIHNldE1vdXNlbW92ZUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbbW91c2VvdXRMaXN0ZW5lciwgc2V0TW91c2VvdXRMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNlb3Zlckxpc3RlbmVyLCBzZXRNb3VzZW92ZXJMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW21vdXNldXBMaXN0ZW5lciwgc2V0TW91c2V1cExpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbcmlnaHRjbGlja0xpc3RlbmVyLCBzZXRSaWdodGNsaWNrTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtjbGlja0xpc3RlbmVyLCBzZXRDbGlja0xpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbYWRkRmVhdHVyZUxpc3RlbmVyLCBzZXRBZGRGZWF0dXJlTGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtyZW1vdmVGZWF0dXJlTGlzdGVuZXIsIHNldFJlbW92ZUZlYXR1cmVMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICB2YXIgW3JlbW92ZVByb3BlcnR5TGlzdGVuZXIsIHNldFJlbW92ZVByb3BlcnR5TGlzdGVuZXJdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdmFyIFtzZXRHZW9tZXRyeUxpc3RlbmVyLCBzZXRTZXRHZW9tZXRyeUxpc3RlbmVyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIHZhciBbc2V0UHJvcGVydHlMaXN0ZW5lciwgc2V0U2V0UHJvcGVydHlMaXN0ZW5lcl0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBPcmRlciBkb2VzIG1hdHRlclxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25EYmxDbGljaykge1xyXG4gICAgICBpZiAoZGJsY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGRibGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldERibGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdkYmxjbGljaycsIG9uRGJsQ2xpY2spKTtcclxuICAgIH1cclxuICB9LCBbb25EYmxDbGlja10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZURvd24pIHtcclxuICAgICAgaWYgKG1vdXNlZG93bkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vkb3duTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNlZG93bkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnbW91c2Vkb3duJywgb25Nb3VzZURvd24pKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZURvd25dKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uTW91c2VNb3ZlKSB7XHJcbiAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKG1vdXNlbW92ZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRNb3VzZW1vdmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uTW91c2VNb3ZlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlT3V0KSB7XHJcbiAgICAgIGlmIChtb3VzZW91dExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdXRMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCkpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlT3V0XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvbk1vdXNlT3Zlcikge1xyXG4gICAgICBpZiAobW91c2VvdmVyTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZW92ZXJMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0TW91c2VvdmVyTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdtb3VzZW92ZXInLCBvbk1vdXNlT3ZlcikpO1xyXG4gICAgfVxyXG4gIH0sIFtvbk1vdXNlT3Zlcl0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25Nb3VzZVVwKSB7XHJcbiAgICAgIGlmIChtb3VzZXVwTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZXVwTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldE1vdXNldXBMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ21vdXNldXAnLCBvbk1vdXNlVXApKTtcclxuICAgIH1cclxuICB9LCBbb25Nb3VzZVVwXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgaWYgKHJpZ2h0Y2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJpZ2h0Y2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UmlnaHRjbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAncmlnaHRjbGljaycsIG9uUmlnaHRDbGljaykpO1xyXG4gICAgfVxyXG4gIH0sIFtvblJpZ2h0Q2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQ2xpY2spIHtcclxuICAgICAgaWYgKGNsaWNrTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihjbGlja0xpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRDbGlja0xpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGluc3RhbmNlLCAnY2xpY2snLCBvbkNsaWNrKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQ2xpY2tdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICYmIG9uQWRkRmVhdHVyZSkge1xyXG4gICAgICBpZiAoYWRkRmVhdHVyZUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoYWRkRmVhdHVyZUxpc3RlbmVyKTtcclxuICAgICAgfVxyXG4gICAgICBzZXRBZGRGZWF0dXJlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaW5zdGFuY2UsICdhZGRmZWF0dXJlJywgb25BZGRGZWF0dXJlKSk7XHJcbiAgICB9XHJcbiAgfSwgW29uQWRkRmVhdHVyZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoaW5zdGFuY2UgJiYgb25SZW1vdmVGZWF0dXJlKSB7XHJcbiAgICAgIGlmIChyZW1vdmVGZWF0dXJlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyZW1vdmVGZWF0dXJlTGlzdGVuZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldFJlbW92ZUZlYXR1cmVMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JlbW92ZWZlYXR1cmUnLCBvblJlbW92ZUZlYXR1cmUpKTtcclxuICAgIH1cclxuICB9LCBbb25SZW1vdmVGZWF0dXJlXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblJlbW92ZVByb3BlcnR5KSB7XHJcbiAgICAgIGlmIChyZW1vdmVQcm9wZXJ0eUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIocmVtb3ZlUHJvcGVydHlMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0UmVtb3ZlUHJvcGVydHlMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3JlbW92ZXByb3BlcnR5Jywgb25SZW1vdmVQcm9wZXJ0eSkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblJlbW92ZVByb3BlcnR5XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblNldEdlb21ldHJ5KSB7XHJcbiAgICAgIGlmIChzZXRHZW9tZXRyeUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoc2V0R2VvbWV0cnlMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0U2V0R2VvbWV0cnlMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3NldGdlb21ldHJ5Jywgb25TZXRHZW9tZXRyeSkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblNldEdlb21ldHJ5XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpbnN0YW5jZSAmJiBvblNldFByb3BlcnR5KSB7XHJcbiAgICAgIGlmIChzZXRQcm9wZXJ0eUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoc2V0UHJvcGVydHlMaXN0ZW5lcik7XHJcbiAgICAgIH1cclxuICAgICAgc2V0U2V0UHJvcGVydHlMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpbnN0YW5jZSwgJ3NldHByb3BlcnR5Jywgb25TZXRQcm9wZXJ0eSkpO1xyXG4gICAgfVxyXG4gIH0sIFtvblNldFByb3BlcnR5XSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChtYXAgIT09IG51bGwpIHtcclxuICAgICAgdmFyIGRhdGEgPSBuZXcgZ29vZ2xlLm1hcHMuRGF0YShfb2JqZWN0U3ByZWFkJDUoX29iamVjdFNwcmVhZCQ1KHt9LCBvcHRpb25zKSwge30sIHtcclxuICAgICAgICBtYXBcclxuICAgICAgfSkpO1xyXG4gICAgICBpZiAob25EYmxDbGljaykge1xyXG4gICAgICAgIHNldERibGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ2RibGNsaWNrJywgb25EYmxDbGljaykpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvbk1vdXNlRG93bikge1xyXG4gICAgICAgIHNldE1vdXNlZG93bkxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGRhdGEsICdtb3VzZWRvd24nLCBvbk1vdXNlRG93bikpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvbk1vdXNlTW92ZSkge1xyXG4gICAgICAgIHNldE1vdXNlbW92ZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGRhdGEsICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvbk1vdXNlT3V0KSB7XHJcbiAgICAgICAgc2V0TW91c2VvdXRMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihkYXRhLCAnbW91c2VvdXQnLCBvbk1vdXNlT3V0KSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9uTW91c2VPdmVyKSB7XHJcbiAgICAgICAgc2V0TW91c2VvdmVyTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ21vdXNlb3ZlcicsIG9uTW91c2VPdmVyKSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9uTW91c2VVcCkge1xyXG4gICAgICAgIHNldE1vdXNldXBMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihkYXRhLCAnbW91c2V1cCcsIG9uTW91c2VVcCkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvblJpZ2h0Q2xpY2spIHtcclxuICAgICAgICBzZXRSaWdodGNsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ3JpZ2h0Y2xpY2snLCBvblJpZ2h0Q2xpY2spKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25DbGljaykge1xyXG4gICAgICAgIHNldENsaWNrTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ2NsaWNrJywgb25DbGljaykpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvbkFkZEZlYXR1cmUpIHtcclxuICAgICAgICBzZXRBZGRGZWF0dXJlTGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ2FkZGZlYXR1cmUnLCBvbkFkZEZlYXR1cmUpKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25SZW1vdmVGZWF0dXJlKSB7XHJcbiAgICAgICAgc2V0UmVtb3ZlRmVhdHVyZUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGRhdGEsICdyZW1vdmVmZWF0dXJlJywgb25SZW1vdmVGZWF0dXJlKSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9uUmVtb3ZlUHJvcGVydHkpIHtcclxuICAgICAgICBzZXRSZW1vdmVQcm9wZXJ0eUxpc3RlbmVyKGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKGRhdGEsICdyZW1vdmVwcm9wZXJ0eScsIG9uUmVtb3ZlUHJvcGVydHkpKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob25TZXRHZW9tZXRyeSkge1xyXG4gICAgICAgIHNldFNldEdlb21ldHJ5TGlzdGVuZXIoZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoZGF0YSwgJ3NldGdlb21ldHJ5Jywgb25TZXRHZW9tZXRyeSkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvblNldFByb3BlcnR5KSB7XHJcbiAgICAgICAgc2V0U2V0UHJvcGVydHlMaXN0ZW5lcihnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihkYXRhLCAnc2V0cHJvcGVydHknLCBvblNldFByb3BlcnR5KSk7XHJcbiAgICAgIH1cclxuICAgICAgc2V0SW5zdGFuY2UoZGF0YSk7XHJcbiAgICAgIGlmIChvbkxvYWQpIHtcclxuICAgICAgICBvbkxvYWQoZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChpbnN0YW5jZSkge1xyXG4gICAgICAgIGlmIChkYmxjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihkYmxjbGlja0xpc3RlbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vdXNlZG93bkxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZWRvd25MaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb3VzZW1vdmVMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2Vtb3ZlTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW91c2VvdXRMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdXRMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb3VzZW92ZXJMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIobW91c2VvdmVyTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW91c2V1cExpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihtb3VzZXVwTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmlnaHRjbGlja0xpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyaWdodGNsaWNrTGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2xpY2tMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoY2xpY2tMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhZGRGZWF0dXJlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKGFkZEZlYXR1cmVMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZW1vdmVGZWF0dXJlTGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHJlbW92ZUZlYXR1cmVMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZW1vdmVQcm9wZXJ0eUxpc3RlbmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5yZW1vdmVMaXN0ZW5lcihyZW1vdmVQcm9wZXJ0eUxpc3RlbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNldEdlb21ldHJ5TGlzdGVuZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnJlbW92ZUxpc3RlbmVyKHNldEdlb21ldHJ5TGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2V0UHJvcGVydHlMaXN0ZW5lciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQucmVtb3ZlTGlzdGVuZXIoc2V0UHJvcGVydHlMaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvblVubW91bnQpIHtcclxuICAgICAgICAgIG9uVW5tb3VudChpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RhbmNlLnNldE1hcChudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxudmFyIERhdGFGID0gbWVtbyhEYXRhRnVuY3Rpb25hbCk7XHJcbmNsYXNzIERhdGEgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZWdpc3RlcmVkRXZlbnRzXCIsIFtdKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgZGF0YTogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXREYXRhQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5kYXRhICE9PSBudWxsICYmIHRoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQodGhpcy5zdGF0ZS5kYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuY29udGV4dCAhPT0gbnVsbCkge1xyXG4gICAgICB2YXIgZGF0YSA9IG5ldyBnb29nbGUubWFwcy5EYXRhKF9vYmplY3RTcHJlYWQkNShfb2JqZWN0U3ByZWFkJDUoe30sIHRoaXMucHJvcHMub3B0aW9ucyksIHt9LCB7XHJcbiAgICAgICAgbWFwOiB0aGlzLmNvbnRleHRcclxuICAgICAgfSkpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDcsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDcsXHJcbiAgICAgICAgcHJldlByb3BzOiB7fSxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IGRhdGFcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBkYXRhXHJcbiAgICAgICAgfTtcclxuICAgICAgfSwgdGhpcy5zZXREYXRhQ2FsbGJhY2spO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kYXRhICE9PSBudWxsKSB7XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCQ3LFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQ3LFxyXG4gICAgICAgIHByZXZQcm9wcyxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IHRoaXMuc3RhdGUuZGF0YVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kYXRhICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUuZGF0YSk7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5kYXRhKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0ZS5kYXRhLnNldE1hcChudWxsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KERhdGEsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzJDQoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfVxyXG5mdW5jdGlvbiBfb2JqZWN0U3ByZWFkJDQoZSkgeyBmb3IgKHZhciByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgeyB2YXIgdCA9IG51bGwgIT0gYXJndW1lbnRzW3JdID8gYXJndW1lbnRzW3JdIDoge307IHIgJSAyID8gb3duS2V5cyQ0KE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyQ0KE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9XHJcbnZhciBldmVudE1hcCQ2ID0ge1xyXG4gIG9uQ2xpY2s6ICdjbGljaycsXHJcbiAgb25EZWZhdWx0Vmlld3BvcnRDaGFuZ2VkOiAnZGVmYXVsdHZpZXdwb3J0X2NoYW5nZWQnLFxyXG4gIG9uU3RhdHVzQ2hhbmdlZDogJ3N0YXR1c19jaGFuZ2VkJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQ2ID0ge1xyXG4gIG9wdGlvbnMoaW5zdGFuY2UsIG9wdGlvbnMpIHtcclxuICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgfSxcclxuICB1cmwoaW5zdGFuY2UsIHVybCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0VXJsKHVybCk7XHJcbiAgfSxcclxuICB6SW5kZXgoaW5zdGFuY2UsIHpJbmRleCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgfVxyXG59O1xyXG5jbGFzcyBLbWxMYXllciBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBrbWxMYXllcjogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRLbWxMYXllckNhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUua21sTGF5ZXIgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLmttbExheWVyKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIGttbExheWVyID0gbmV3IGdvb2dsZS5tYXBzLkttbExheWVyKF9vYmplY3RTcHJlYWQkNChfb2JqZWN0U3ByZWFkJDQoe30sIHRoaXMucHJvcHMub3B0aW9ucyksIHt9LCB7XHJcbiAgICAgIG1hcDogdGhpcy5jb250ZXh0XHJcbiAgICB9KSk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCQ2LFxyXG4gICAgICBldmVudE1hcDogZXZlbnRNYXAkNixcclxuICAgICAgcHJldlByb3BzOiB7fSxcclxuICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICBpbnN0YW5jZToga21sTGF5ZXJcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRMbWxMYXllcigpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBrbWxMYXllclxyXG4gICAgICB9O1xyXG4gICAgfSwgdGhpcy5zZXRLbWxMYXllckNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUua21sTGF5ZXIgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDYsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDYsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5rbWxMYXllclxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5rbWxMYXllciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmttbExheWVyKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMuc3RhdGUua21sTGF5ZXIuc2V0TWFwKG51bGwpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KEttbExheWVyLCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxuZnVuY3Rpb24gZ2V0T2Zmc2V0T3ZlcnJpZGUoY29udGFpbmVyRWxlbWVudCwgZ2V0UGl4ZWxQb3NpdGlvbk9mZnNldCkge1xyXG4gIHJldHVybiB0eXBlb2YgZ2V0UGl4ZWxQb3NpdGlvbk9mZnNldCA9PT0gJ2Z1bmN0aW9uJyA/IGdldFBpeGVsUG9zaXRpb25PZmZzZXQoY29udGFpbmVyRWxlbWVudC5vZmZzZXRXaWR0aCwgY29udGFpbmVyRWxlbWVudC5vZmZzZXRIZWlnaHQpIDoge1xyXG4gICAgeDogMCxcclxuICAgIHk6IDBcclxuICB9O1xyXG59XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmZ1bmN0aW9uIGNyZWF0ZUxhdExuZyhpbnN0LCBUeXBlKSB7XHJcbiAgcmV0dXJuIG5ldyBUeXBlKGluc3QubGF0LCBpbnN0LmxuZyk7XHJcbn1cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuZnVuY3Rpb24gY3JlYXRlTGF0TG5nQm91bmRzKGluc3QsIFR5cGUpIHtcclxuICByZXR1cm4gbmV3IFR5cGUobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhpbnN0Lm5lLmxhdCwgaW5zdC5uZS5sbmcpLCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGluc3Quc3cubGF0LCBpbnN0LnN3LmxuZykpO1xyXG59XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmZ1bmN0aW9uIGVuc3VyZU9mVHlwZShpbnN0LFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG50eXBlLFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5mYWN0b3J5XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbikge1xyXG4gIHJldHVybiBpbnN0IGluc3RhbmNlb2YgdHlwZSA/IGluc3QgOiBmYWN0b3J5KGluc3QsIHR5cGUpO1xyXG59XHJcbmZ1bmN0aW9uIGVuc3VyZU9mVHlwZUJvdW5kcyhpbnN0LFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG50eXBlLFxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG5mYWN0b3J5XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbikge1xyXG4gIHJldHVybiBpbnN0IGluc3RhbmNlb2YgdHlwZSA/IGluc3QgOiBmYWN0b3J5KGluc3QsIHR5cGUpO1xyXG59XHJcbmZ1bmN0aW9uIGdldExheW91dFN0eWxlc0J5Qm91bmRzKG1hcENhbnZhc1Byb2plY3Rpb24sIG9mZnNldCwgYm91bmRzKSB7XHJcbiAgdmFyIG5lID0gbWFwQ2FudmFzUHJvamVjdGlvbiAmJiBtYXBDYW52YXNQcm9qZWN0aW9uLmZyb21MYXRMbmdUb0RpdlBpeGVsKGJvdW5kcy5nZXROb3J0aEVhc3QoKSk7XHJcbiAgdmFyIHN3ID0gbWFwQ2FudmFzUHJvamVjdGlvbiAmJiBtYXBDYW52YXNQcm9qZWN0aW9uLmZyb21MYXRMbmdUb0RpdlBpeGVsKGJvdW5kcy5nZXRTb3V0aFdlc3QoKSk7XHJcbiAgaWYgKG5lICYmIHN3KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBcIlwiLmNvbmNhdChzdy54ICsgb2Zmc2V0LngsIFwicHhcIiksXHJcbiAgICAgIHRvcDogXCJcIi5jb25jYXQobmUueSArIG9mZnNldC55LCBcInB4XCIpLFxyXG4gICAgICB3aWR0aDogXCJcIi5jb25jYXQobmUueCAtIHN3LnggLSBvZmZzZXQueCwgXCJweFwiKSxcclxuICAgICAgaGVpZ2h0OiBcIlwiLmNvbmNhdChzdy55IC0gbmUueSAtIG9mZnNldC55LCBcInB4XCIpXHJcbiAgICB9O1xyXG4gIH1cclxuICByZXR1cm4ge1xyXG4gICAgbGVmdDogJy05OTk5cHgnLFxyXG4gICAgdG9wOiAnLTk5OTlweCdcclxuICB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldExheW91dFN0eWxlc0J5UG9zaXRpb24obWFwQ2FudmFzUHJvamVjdGlvbiwgb2Zmc2V0LCBwb3NpdGlvbikge1xyXG4gIHZhciBwb2ludCA9IG1hcENhbnZhc1Byb2plY3Rpb24gJiYgbWFwQ2FudmFzUHJvamVjdGlvbi5mcm9tTGF0TG5nVG9EaXZQaXhlbChwb3NpdGlvbik7XHJcbiAgaWYgKHBvaW50KSB7XHJcbiAgICB2YXIge1xyXG4gICAgICB4LFxyXG4gICAgICB5XHJcbiAgICB9ID0gcG9pbnQ7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBcIlwiLmNvbmNhdCh4ICsgb2Zmc2V0LngsIFwicHhcIiksXHJcbiAgICAgIHRvcDogXCJcIi5jb25jYXQoeSArIG9mZnNldC55LCBcInB4XCIpXHJcbiAgICB9O1xyXG4gIH1cclxuICByZXR1cm4ge1xyXG4gICAgbGVmdDogJy05OTk5cHgnLFxyXG4gICAgdG9wOiAnLTk5OTlweCdcclxuICB9O1xyXG59XHJcbmZ1bmN0aW9uIGdldExheW91dFN0eWxlcyhtYXBDYW52YXNQcm9qZWN0aW9uLCBvZmZzZXQsIGJvdW5kcywgcG9zaXRpb24pIHtcclxuICByZXR1cm4gYm91bmRzICE9PSB1bmRlZmluZWQgPyBnZXRMYXlvdXRTdHlsZXNCeUJvdW5kcyhtYXBDYW52YXNQcm9qZWN0aW9uLCBvZmZzZXQsIGVuc3VyZU9mVHlwZUJvdW5kcyhib3VuZHMsIGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcywgY3JlYXRlTGF0TG5nQm91bmRzKSkgOiBnZXRMYXlvdXRTdHlsZXNCeVBvc2l0aW9uKG1hcENhbnZhc1Byb2plY3Rpb24sIG9mZnNldCwgZW5zdXJlT2ZUeXBlKHBvc2l0aW9uLCBnb29nbGUubWFwcy5MYXRMbmcsIGNyZWF0ZUxhdExuZykpO1xyXG59XHJcbmZ1bmN0aW9uIGFyZVBvc2l0aW9uc0VxdWFsKGN1cnJlbnRQb3NpdGlvbiwgcHJldmlvdXNQb3NpdGlvbikge1xyXG4gIHJldHVybiBjdXJyZW50UG9zaXRpb24ubGVmdCA9PT0gcHJldmlvdXNQb3NpdGlvbi5sZWZ0ICYmIGN1cnJlbnRQb3NpdGlvbi50b3AgPT09IHByZXZpb3VzUG9zaXRpb24udG9wICYmIGN1cnJlbnRQb3NpdGlvbi53aWR0aCA9PT0gcHJldmlvdXNQb3NpdGlvbi5oZWlnaHQgJiYgY3VycmVudFBvc2l0aW9uLmhlaWdodCA9PT0gcHJldmlvdXNQb3NpdGlvbi5oZWlnaHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG93bktleXMkMyhlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkMyhlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJDMoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJDMoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxuZnVuY3Rpb24gY3JlYXRlT3ZlcmxheShjb250YWluZXIsIHBhbmUsIHBvc2l0aW9uLCBib3VuZHMsIGdldFBpeGVsUG9zaXRpb25PZmZzZXQpIHtcclxuICBjbGFzcyBPdmVybGF5IGV4dGVuZHMgZ29vZ2xlLm1hcHMuT3ZlcmxheVZpZXcge1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyLCBwYW5lLCBwb3NpdGlvbiwgYm91bmRzKSB7XHJcbiAgICAgIHN1cGVyKCk7XHJcbiAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICB0aGlzLnBhbmUgPSBwYW5lO1xyXG4gICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XHJcbiAgICAgIHRoaXMuYm91bmRzID0gYm91bmRzO1xyXG4gICAgfVxyXG4gICAgb25BZGQoKSB7XHJcbiAgICAgIHZhciBfdGhpcyRnZXRQYW5lcztcclxuICAgICAgdmFyIHBhbmUgPSAoX3RoaXMkZ2V0UGFuZXMgPSB0aGlzLmdldFBhbmVzKCkpID09PSBudWxsIHx8IF90aGlzJGdldFBhbmVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRnZXRQYW5lc1t0aGlzLnBhbmVdO1xyXG4gICAgICBwYW5lID09PSBudWxsIHx8IHBhbmUgPT09IHZvaWQgMCB8fCBwYW5lLmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGRyYXcoKSB7XHJcbiAgICAgIHZhciBwcm9qZWN0aW9uID0gdGhpcy5nZXRQcm9qZWN0aW9uKCk7XHJcbiAgICAgIHZhciBvZmZzZXQgPSBfb2JqZWN0U3ByZWFkJDMoe30sIHRoaXMuY29udGFpbmVyID8gZ2V0T2Zmc2V0T3ZlcnJpZGUodGhpcy5jb250YWluZXIsIGdldFBpeGVsUG9zaXRpb25PZmZzZXQpIDoge1xyXG4gICAgICAgIHg6IDAsXHJcbiAgICAgICAgeTogMFxyXG4gICAgICB9KTtcclxuICAgICAgdmFyIGxheW91dFN0eWxlcyA9IGdldExheW91dFN0eWxlcyhwcm9qZWN0aW9uLCBvZmZzZXQsIHRoaXMuYm91bmRzLCB0aGlzLnBvc2l0aW9uKTtcclxuICAgICAgZm9yICh2YXIgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGxheW91dFN0eWxlcykpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlW2tleV0gPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25SZW1vdmUoKSB7XHJcbiAgICAgIGlmICh0aGlzLmNvbnRhaW5lci5wYXJlbnROb2RlICE9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIG5ldyBPdmVybGF5KGNvbnRhaW5lciwgcGFuZSwgcG9zaXRpb24sIGJvdW5kcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG93bktleXMkMihlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9XHJcbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkMihlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzJDIoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzJDIoT2JqZWN0KHQpKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsIHIpKTsgfSk7IH0gcmV0dXJuIGU7IH1cclxuZnVuY3Rpb24gY29udmVydFRvTGF0TG5nU3RyaW5nKGxhdExuZ0xpa2UpIHtcclxuICBpZiAoIWxhdExuZ0xpa2UpIHtcclxuICAgIHJldHVybiAnJztcclxuICB9XHJcbiAgdmFyIGxhdExuZyA9IGxhdExuZ0xpa2UgaW5zdGFuY2VvZiBnb29nbGUubWFwcy5MYXRMbmcgPyBsYXRMbmdMaWtlIDogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsYXRMbmdMaWtlLmxhdCwgbGF0TG5nTGlrZS5sbmcpO1xyXG4gIHJldHVybiBsYXRMbmcgKyAnJztcclxufVxyXG5mdW5jdGlvbiBjb252ZXJ0VG9MYXRMbmdCb3VuZHNTdHJpbmcobGF0TG5nQm91bmRzTGlrZSkge1xyXG4gIGlmICghbGF0TG5nQm91bmRzTGlrZSkge1xyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuICB2YXIgbGF0TG5nQm91bmRzID0gbGF0TG5nQm91bmRzTGlrZSBpbnN0YW5jZW9mIGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcyA/IGxhdExuZ0JvdW5kc0xpa2UgOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKG5ldyBnb29nbGUubWFwcy5MYXRMbmcobGF0TG5nQm91bmRzTGlrZS5zb3V0aCwgbGF0TG5nQm91bmRzTGlrZS5lYXN0KSwgbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsYXRMbmdCb3VuZHNMaWtlLm5vcnRoLCBsYXRMbmdCb3VuZHNMaWtlLndlc3QpKTtcclxuICByZXR1cm4gbGF0TG5nQm91bmRzICsgJyc7XHJcbn1cclxudmFyIEZMT0FUX1BBTkUgPSBcImZsb2F0UGFuZVwiO1xyXG52YXIgTUFQX1BBTkUgPSBcIm1hcFBhbmVcIjtcclxudmFyIE1BUktFUl9MQVlFUiA9IFwibWFya2VyTGF5ZXJcIjtcclxudmFyIE9WRVJMQVlfTEFZRVIgPSBcIm92ZXJsYXlMYXllclwiO1xyXG52YXIgT1ZFUkxBWV9NT1VTRV9UQVJHRVQgPSBcIm92ZXJsYXlNb3VzZVRhcmdldFwiO1xyXG5mdW5jdGlvbiBPdmVybGF5Vmlld0Z1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICBwb3NpdGlvbixcclxuICAgIGJvdW5kcyxcclxuICAgIG1hcFBhbmVOYW1lLFxyXG4gICAgekluZGV4LFxyXG4gICAgb25Mb2FkLFxyXG4gICAgb25Vbm1vdW50LFxyXG4gICAgZ2V0UGl4ZWxQb3NpdGlvbk9mZnNldCxcclxuICAgIGNoaWxkcmVuXHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIGNvbnRhaW5lciA9IHVzZU1lbW8oKCkgPT4ge1xyXG4gICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgZGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgIHJldHVybiBkaXY7XHJcbiAgfSwgW10pO1xyXG4gIHZhciBvdmVybGF5ID0gdXNlTWVtbygoKSA9PiB7XHJcbiAgICByZXR1cm4gY3JlYXRlT3ZlcmxheShjb250YWluZXIsIG1hcFBhbmVOYW1lLCBwb3NpdGlvbiwgYm91bmRzLCBnZXRQaXhlbFBvc2l0aW9uT2Zmc2V0KTtcclxuICB9LCBbY29udGFpbmVyLCBtYXBQYW5lTmFtZSwgcG9zaXRpb24sIGJvdW5kc10pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBvbkxvYWQgPT09IG51bGwgfHwgb25Mb2FkID09PSB2b2lkIDAgfHwgb25Mb2FkKG92ZXJsYXkpO1xyXG4gICAgb3ZlcmxheSA9PT0gbnVsbCB8fCBvdmVybGF5ID09PSB2b2lkIDAgfHwgb3ZlcmxheS5zZXRNYXAobWFwKTtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIG9uVW5tb3VudCA9PT0gbnVsbCB8fCBvblVubW91bnQgPT09IHZvaWQgMCB8fCBvblVubW91bnQob3ZlcmxheSk7XHJcbiAgICAgIG92ZXJsYXkgPT09IG51bGwgfHwgb3ZlcmxheSA9PT0gdm9pZCAwIHx8IG92ZXJsYXkuc2V0TWFwKG51bGwpO1xyXG4gICAgfTtcclxuICB9LCBbbWFwLCBvdmVybGF5XSk7XHJcbiAgLy8gdG8gbW92ZSB0aGUgY29udGFpbmVyIHRvIHRoZSBmb3JlZ3JvdW5kIGFuZCBiYWNrZ3JvdW5kXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGNvbnRhaW5lci5zdHlsZS56SW5kZXggPSBcIlwiLmNvbmNhdCh6SW5kZXgpO1xyXG4gIH0sIFt6SW5kZXgsIGNvbnRhaW5lcl0pO1xyXG4gIHJldHVybiBSZWFjdERPTS5jcmVhdGVQb3J0YWwoY2hpbGRyZW4sIGNvbnRhaW5lcik7XHJcbn1cclxudmFyIE92ZXJsYXlWaWV3RiA9IG1lbW8oT3ZlcmxheVZpZXdGdW5jdGlvbmFsKTtcclxuY2xhc3MgT3ZlcmxheVZpZXcgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBwYW5lRWw6IG51bGwsXHJcbiAgICAgIGNvbnRhaW5lclN0eWxlOiB7XHJcbiAgICAgICAgLy8gc2V0IGluaXRpYWwgcG9zaXRpb25cclxuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInVwZGF0ZVBhbmVcIiwgKCkgPT4ge1xyXG4gICAgICB2YXIgbWFwUGFuZU5hbWUgPSB0aGlzLnByb3BzLm1hcFBhbmVOYW1lO1xyXG4gICAgICAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9tYXBzL2RvY3VtZW50YXRpb24vamF2YXNjcmlwdC8zLmV4cC9yZWZlcmVuY2UjTWFwUGFuZXNcclxuICAgICAgdmFyIG1hcFBhbmVzID0gdGhpcy5vdmVybGF5Vmlldy5nZXRQYW5lcygpO1xyXG4gICAgICBpbnZhcmlhbnQoISFtYXBQYW5lTmFtZSwgXCJPdmVybGF5VmlldyByZXF1aXJlcyBwcm9wcy5tYXBQYW5lTmFtZSBidXQgZ290ICVzXCIsIG1hcFBhbmVOYW1lKTtcclxuICAgICAgaWYgKG1hcFBhbmVzKSB7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICBwYW5lRWw6IG1hcFBhbmVzW21hcFBhbmVOYW1lXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgcGFuZUVsOiBudWxsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwib25BZGRcIiwgKCkgPT4ge1xyXG4gICAgICB2YXIgX3RoaXMkcHJvcHMkb25Mb2FkLCBfdGhpcyRwcm9wcztcclxuICAgICAgdGhpcy51cGRhdGVQYW5lKCk7XHJcbiAgICAgIChfdGhpcyRwcm9wcyRvbkxvYWQgPSAoX3RoaXMkcHJvcHMgPSB0aGlzLnByb3BzKS5vbkxvYWQpID09PSBudWxsIHx8IF90aGlzJHByb3BzJG9uTG9hZCA9PT0gdm9pZCAwIHx8IF90aGlzJHByb3BzJG9uTG9hZC5jYWxsKF90aGlzJHByb3BzLCB0aGlzLm92ZXJsYXlWaWV3KTtcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwib25Qb3NpdGlvbkVsZW1lbnRcIiwgKCkgPT4ge1xyXG4gICAgICB2YXIgbWFwQ2FudmFzUHJvamVjdGlvbiA9IHRoaXMub3ZlcmxheVZpZXcuZ2V0UHJvamVjdGlvbigpO1xyXG4gICAgICB2YXIgb2Zmc2V0ID0gX29iamVjdFNwcmVhZCQyKHtcclxuICAgICAgICB4OiAwLFxyXG4gICAgICAgIHk6IDBcclxuICAgICAgfSwgdGhpcy5jb250YWluZXJSZWYuY3VycmVudCA/IGdldE9mZnNldE92ZXJyaWRlKHRoaXMuY29udGFpbmVyUmVmLmN1cnJlbnQsIHRoaXMucHJvcHMuZ2V0UGl4ZWxQb3NpdGlvbk9mZnNldCkgOiB7fSk7XHJcbiAgICAgIHZhciBsYXlvdXRTdHlsZXMgPSBnZXRMYXlvdXRTdHlsZXMobWFwQ2FudmFzUHJvamVjdGlvbiwgb2Zmc2V0LCB0aGlzLnByb3BzLmJvdW5kcywgdGhpcy5wcm9wcy5wb3NpdGlvbik7XHJcbiAgICAgIGlmICghYXJlUG9zaXRpb25zRXF1YWwobGF5b3V0U3R5bGVzLCB7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBsZWZ0OiB0aGlzLnN0YXRlLmNvbnRhaW5lclN0eWxlLmxlZnQsXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB0b3A6IHRoaXMuc3RhdGUuY29udGFpbmVyU3R5bGUudG9wLFxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgd2lkdGg6IHRoaXMuc3RhdGUuY29udGFpbmVyU3R5bGUud2lkdGgsXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBoZWlnaHQ6IHRoaXMuc3RhdGUuY29udGFpbmVyU3R5bGUuaGVpZ2h0XHJcbiAgICAgIH0pKSB7XHJcbiAgICAgICAgdmFyIF9sYXlvdXRTdHlsZXMkdG9wLCBfbGF5b3V0U3R5bGVzJGxlZnQsIF9sYXlvdXRTdHlsZXMkd2lkdGgsIF9sYXlvdXRTdHlsZXMkaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgICAgY29udGFpbmVyU3R5bGU6IHtcclxuICAgICAgICAgICAgdG9wOiAoX2xheW91dFN0eWxlcyR0b3AgPSBsYXlvdXRTdHlsZXMudG9wKSAhPT0gbnVsbCAmJiBfbGF5b3V0U3R5bGVzJHRvcCAhPT0gdm9pZCAwID8gX2xheW91dFN0eWxlcyR0b3AgOiAwLFxyXG4gICAgICAgICAgICBsZWZ0OiAoX2xheW91dFN0eWxlcyRsZWZ0ID0gbGF5b3V0U3R5bGVzLmxlZnQpICE9PSBudWxsICYmIF9sYXlvdXRTdHlsZXMkbGVmdCAhPT0gdm9pZCAwID8gX2xheW91dFN0eWxlcyRsZWZ0IDogMCxcclxuICAgICAgICAgICAgd2lkdGg6IChfbGF5b3V0U3R5bGVzJHdpZHRoID0gbGF5b3V0U3R5bGVzLndpZHRoKSAhPT0gbnVsbCAmJiBfbGF5b3V0U3R5bGVzJHdpZHRoICE9PSB2b2lkIDAgPyBfbGF5b3V0U3R5bGVzJHdpZHRoIDogMCxcclxuICAgICAgICAgICAgaGVpZ2h0OiAoX2xheW91dFN0eWxlcyRoZWlnaHQgPSBsYXlvdXRTdHlsZXMuaGVpZ2h0KSAhPT0gbnVsbCAmJiBfbGF5b3V0U3R5bGVzJGhlaWdodCAhPT0gdm9pZCAwID8gX2xheW91dFN0eWxlcyRoZWlnaHQgOiAwLFxyXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRyYXdcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLm9uUG9zaXRpb25FbGVtZW50KCk7XHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9uUmVtb3ZlXCIsICgpID0+IHtcclxuICAgICAgdmFyIF90aGlzJHByb3BzJG9uVW5tb3VudCwgX3RoaXMkcHJvcHMyO1xyXG4gICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XHJcbiAgICAgICAgcGFuZUVsOiBudWxsXHJcbiAgICAgIH0pKTtcclxuICAgICAgKF90aGlzJHByb3BzJG9uVW5tb3VudCA9IChfdGhpcyRwcm9wczIgPSB0aGlzLnByb3BzKS5vblVubW91bnQpID09PSBudWxsIHx8IF90aGlzJHByb3BzJG9uVW5tb3VudCA9PT0gdm9pZCAwIHx8IF90aGlzJHByb3BzJG9uVW5tb3VudC5jYWxsKF90aGlzJHByb3BzMiwgdGhpcy5vdmVybGF5Vmlldyk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuY29udGFpbmVyUmVmID0gY3JlYXRlUmVmKCk7XHJcbiAgICAvLyBZb3UgbXVzdCBpbXBsZW1lbnQgdGhyZWUgbWV0aG9kczogb25BZGQoKSwgZHJhdygpLCBhbmQgb25SZW1vdmUoKS5cclxuICAgIHZhciBvdmVybGF5VmlldyA9IG5ldyBnb29nbGUubWFwcy5PdmVybGF5VmlldygpO1xyXG4gICAgb3ZlcmxheVZpZXcub25BZGQgPSB0aGlzLm9uQWRkO1xyXG4gICAgb3ZlcmxheVZpZXcuZHJhdyA9IHRoaXMuZHJhdztcclxuICAgIG92ZXJsYXlWaWV3Lm9uUmVtb3ZlID0gdGhpcy5vblJlbW92ZTtcclxuICAgIHRoaXMub3ZlcmxheVZpZXcgPSBvdmVybGF5VmlldztcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB0aGlzLm92ZXJsYXlWaWV3LnNldE1hcCh0aGlzLmNvbnRleHQpO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICB2YXIgcHJldlBvc2l0aW9uU3RyaW5nID0gY29udmVydFRvTGF0TG5nU3RyaW5nKHByZXZQcm9wcy5wb3NpdGlvbik7XHJcbiAgICB2YXIgcG9zaXRpb25TdHJpbmcgPSBjb252ZXJ0VG9MYXRMbmdTdHJpbmcodGhpcy5wcm9wcy5wb3NpdGlvbik7XHJcbiAgICB2YXIgcHJldkJvdW5kc1N0cmluZyA9IGNvbnZlcnRUb0xhdExuZ0JvdW5kc1N0cmluZyhwcmV2UHJvcHMuYm91bmRzKTtcclxuICAgIHZhciBib3VuZHNTdHJpbmcgPSBjb252ZXJ0VG9MYXRMbmdCb3VuZHNTdHJpbmcodGhpcy5wcm9wcy5ib3VuZHMpO1xyXG4gICAgaWYgKHByZXZQb3NpdGlvblN0cmluZyAhPT0gcG9zaXRpb25TdHJpbmcgfHwgcHJldkJvdW5kc1N0cmluZyAhPT0gYm91bmRzU3RyaW5nKSB7XHJcbiAgICAgIHRoaXMub3ZlcmxheVZpZXcuZHJhdygpO1xyXG4gICAgfVxyXG4gICAgaWYgKHByZXZQcm9wcy5tYXBQYW5lTmFtZSAhPT0gdGhpcy5wcm9wcy5tYXBQYW5lTmFtZSkge1xyXG4gICAgICB0aGlzLnVwZGF0ZVBhbmUoKTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICB0aGlzLm92ZXJsYXlWaWV3LnNldE1hcChudWxsKTtcclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgdmFyIHBhbmVFbCA9IHRoaXMuc3RhdGUucGFuZUVsO1xyXG4gICAgaWYgKHBhbmVFbCkge1xyXG4gICAgICByZXR1cm4gUmVhY3RET00uY3JlYXRlUG9ydGFsKGpzeChcImRpdlwiLCB7XHJcbiAgICAgICAgcmVmOiB0aGlzLmNvbnRhaW5lclJlZixcclxuICAgICAgICBzdHlsZTogdGhpcy5zdGF0ZS5jb250YWluZXJTdHlsZSxcclxuICAgICAgICBjaGlsZHJlbjogQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKVxyXG4gICAgICB9KSwgcGFuZUVsKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoT3ZlcmxheVZpZXcsIFwiRkxPQVRfUEFORVwiLCBcImZsb2F0UGFuZVwiKTtcclxuX2RlZmluZVByb3BlcnR5KE92ZXJsYXlWaWV3LCBcIk1BUF9QQU5FXCIsIFwibWFwUGFuZVwiKTtcclxuX2RlZmluZVByb3BlcnR5KE92ZXJsYXlWaWV3LCBcIk1BUktFUl9MQVlFUlwiLCBcIm1hcmtlckxheWVyXCIpO1xyXG5fZGVmaW5lUHJvcGVydHkoT3ZlcmxheVZpZXcsIFwiT1ZFUkxBWV9MQVlFUlwiLCBcIm92ZXJsYXlMYXllclwiKTtcclxuX2RlZmluZVByb3BlcnR5KE92ZXJsYXlWaWV3LCBcIk9WRVJMQVlfTU9VU0VfVEFSR0VUXCIsIFwib3ZlcmxheU1vdXNlVGFyZ2V0XCIpO1xyXG5fZGVmaW5lUHJvcGVydHkoT3ZlcmxheVZpZXcsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBub29wKCkge1xyXG4gIHJldHVybjtcclxufVxyXG5cclxuZnVuY3Rpb24gb3duS2V5cyQxKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH1cclxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCQxKGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMkMShPYmplY3QodCksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7IF9kZWZpbmVQcm9wZXJ0eShlLCByLCB0W3JdKTsgfSkgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHQpKSA6IG93bktleXMkMShPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfVxyXG52YXIgZXZlbnRNYXAkNSA9IHtcclxuICBvbkRibENsaWNrOiAnZGJsY2xpY2snLFxyXG4gIG9uQ2xpY2s6ICdjbGljaydcclxufTtcclxudmFyIHVwZGF0ZXJNYXAkNSA9IHtcclxuICBvcGFjaXR5KGluc3RhbmNlLCBvcGFjaXR5KSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcGFjaXR5KG9wYWNpdHkpO1xyXG4gIH1cclxufTtcclxuZnVuY3Rpb24gR3JvdW5kT3ZlcmxheUZ1bmN0aW9uYWwoX3JlZikge1xyXG4gIHZhciB7XHJcbiAgICB1cmwsXHJcbiAgICBib3VuZHMsXHJcbiAgICBvcHRpb25zLFxyXG4gICAgdmlzaWJsZVxyXG4gIH0gPSBfcmVmO1xyXG4gIHZhciBtYXAgPSB1c2VDb250ZXh0KE1hcENvbnRleHQpO1xyXG4gIHZhciBpbWFnZUJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhib3VuZHMuc291dGgsIGJvdW5kcy53ZXN0KSwgbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhib3VuZHMubm9ydGgsIGJvdW5kcy5lYXN0KSk7XHJcbiAgdmFyIGdyb3VuZE92ZXJsYXkgPSB1c2VNZW1vKCgpID0+IHtcclxuICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuR3JvdW5kT3ZlcmxheSh1cmwsIGltYWdlQm91bmRzLCBvcHRpb25zKTtcclxuICB9LCBbXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChncm91bmRPdmVybGF5ICE9PSBudWxsKSB7XHJcbiAgICAgIGdyb3VuZE92ZXJsYXkuc2V0TWFwKG1hcCk7XHJcbiAgICB9XHJcbiAgfSwgW21hcF0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodHlwZW9mIHVybCAhPT0gJ3VuZGVmaW5lZCcgJiYgZ3JvdW5kT3ZlcmxheSAhPT0gbnVsbCkge1xyXG4gICAgICBncm91bmRPdmVybGF5LnNldCgndXJsJywgdXJsKTtcclxuICAgICAgZ3JvdW5kT3ZlcmxheS5zZXRNYXAobWFwKTtcclxuICAgIH1cclxuICB9LCBbZ3JvdW5kT3ZlcmxheSwgdXJsXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgZ3JvdW5kT3ZlcmxheSAhPT0gbnVsbCkge1xyXG4gICAgICBncm91bmRPdmVybGF5LnNldE9wYWNpdHkodmlzaWJsZSA/IDEgOiAwKTtcclxuICAgIH1cclxuICB9LCBbZ3JvdW5kT3ZlcmxheSwgdmlzaWJsZV0pO1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2YXIgbmV3Qm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcyhuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGJvdW5kcy5zb3V0aCwgYm91bmRzLndlc3QpLCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGJvdW5kcy5ub3J0aCwgYm91bmRzLmVhc3QpKTtcclxuICAgIGlmICh0eXBlb2YgYm91bmRzICE9PSAndW5kZWZpbmVkJyAmJiBncm91bmRPdmVybGF5ICE9PSBudWxsKSB7XHJcbiAgICAgIGdyb3VuZE92ZXJsYXkuc2V0KCdib3VuZHMnLCBuZXdCb3VuZHMpO1xyXG4gICAgICBncm91bmRPdmVybGF5LnNldE1hcChtYXApO1xyXG4gICAgfVxyXG4gIH0sIFtncm91bmRPdmVybGF5LCBib3VuZHNdKTtcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgR3JvdW5kT3ZlcmxheUYgPSBtZW1vKEdyb3VuZE92ZXJsYXlGdW5jdGlvbmFsKTtcclxuY2xhc3MgR3JvdW5kT3ZlcmxheSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBncm91bmRPdmVybGF5OiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldEdyb3VuZE92ZXJsYXlDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLmdyb3VuZE92ZXJsYXkgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLmdyb3VuZE92ZXJsYXkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICBpbnZhcmlhbnQoISF0aGlzLnByb3BzLnVybCB8fCAhIXRoaXMucHJvcHMuYm91bmRzLCBcIkZvciBHcm91bmRPdmVybGF5LCB1cmwgYW5kIGJvdW5kcyBhcmUgcGFzc2VkIGluIHRvIGNvbnN0cnVjdG9yIGFuZCBhcmUgaW1tdXRhYmxlIGFmdGVyIGluc3RhbnRpYXRlZC4gVGhpcyBpcyB0aGUgYmVoYXZpb3Igb2YgR29vZ2xlIE1hcHMgSmF2YVNjcmlwdCBBUEkgdjMgKCBTZWUgaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vbWFwcy9kb2N1bWVudGF0aW9uL2phdmFzY3JpcHQvcmVmZXJlbmNlI0dyb3VuZE92ZXJsYXkpIEhlbmNlLCB1c2UgdGhlIGNvcnJlc3BvbmRpbmcgdHdvIHByb3BzIHByb3ZpZGVkIGJ5IGByZWFjdC1nb29nbGUtbWFwcy1hcGlgLCB1cmwgYW5kIGJvdW5kcy4gSW4gc29tZSBjYXNlcywgeW91J2xsIG5lZWQgdGhlIEdyb3VuZE92ZXJsYXkgY29tcG9uZW50IHRvIHJlZmxlY3QgdGhlIGNoYW5nZXMgb2YgdXJsIGFuZCBib3VuZHMuIFlvdSBjYW4gbGV2ZXJhZ2UgdGhlIFJlYWN0J3Mga2V5IHByb3BlcnR5IHRvIHJlbW91bnQgdGhlIGNvbXBvbmVudC4gVHlwaWNhbGx5LCBqdXN0IGBrZXk9e3VybH1gIHdvdWxkIHNlcnZlIHlvdXIgbmVlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS90b21jaGVudHcvcmVhY3QtZ29vZ2xlLW1hcHMvaXNzdWVzLzY1NVwiKTtcclxuICAgIHZhciBncm91bmRPdmVybGF5ID0gbmV3IGdvb2dsZS5tYXBzLkdyb3VuZE92ZXJsYXkodGhpcy5wcm9wcy51cmwsIHRoaXMucHJvcHMuYm91bmRzLCBfb2JqZWN0U3ByZWFkJDEoX29iamVjdFNwcmVhZCQxKHt9LCB0aGlzLnByb3BzLm9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBtYXA6IHRoaXMuY29udGV4dFxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkNSxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDUsXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IGdyb3VuZE92ZXJsYXlcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRHcm91bmRPdmVybGF5KCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGdyb3VuZE92ZXJsYXlcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0R3JvdW5kT3ZlcmxheUNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZ3JvdW5kT3ZlcmxheSAhPT0gbnVsbCkge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkNSxcclxuICAgICAgICBldmVudE1hcDogZXZlbnRNYXAkNSxcclxuICAgICAgICBwcmV2UHJvcHMsXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiB0aGlzLnN0YXRlLmdyb3VuZE92ZXJsYXlcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZ3JvdW5kT3ZlcmxheSkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmdyb3VuZE92ZXJsYXkpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc3RhdGUuZ3JvdW5kT3ZlcmxheS5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoR3JvdW5kT3ZlcmxheSwgXCJkZWZhdWx0UHJvcHNcIiwge1xyXG4gIG9uTG9hZDogbm9vcFxyXG59KTtcclxuX2RlZmluZVByb3BlcnR5KEdyb3VuZE92ZXJsYXksIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5mdW5jdGlvbiBvd25LZXlzKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH1cclxuZnVuY3Rpb24gX29iamVjdFNwcmVhZChlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyhPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfVxyXG52YXIgZXZlbnRNYXAkNCA9IHt9O1xyXG52YXIgdXBkYXRlck1hcCQ0ID0ge1xyXG4gIGRhdGEoaW5zdGFuY2UsIGRhdGEpIHtcclxuICAgIGluc3RhbmNlLnNldERhdGEoZGF0YSk7XHJcbiAgfSxcclxuICBtYXAoaW5zdGFuY2UsIG1hcCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgfSxcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH1cclxufTtcclxuZnVuY3Rpb24gSGVhdG1hcExheWVyRnVuY3Rpb25hbChfcmVmKSB7XHJcbiAgdmFyIHtcclxuICAgIGRhdGEsXHJcbiAgICBvbkxvYWQsXHJcbiAgICBvblVubW91bnQsXHJcbiAgICBvcHRpb25zXHJcbiAgfSA9IF9yZWY7XHJcbiAgdmFyIG1hcCA9IHVzZUNvbnRleHQoTWFwQ29udGV4dCk7XHJcbiAgdmFyIFtpbnN0YW5jZSwgc2V0SW5zdGFuY2VdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICghZ29vZ2xlLm1hcHMudmlzdWFsaXphdGlvbikge1xyXG4gICAgICBpbnZhcmlhbnQoISFnb29nbGUubWFwcy52aXN1YWxpemF0aW9uLCAnRGlkIHlvdSBpbmNsdWRlIHByb3AgbGlicmFyaWVzPXtbXCJ2aXN1YWxpemF0aW9uXCJdfSBpbiB1c2VKc0FwaVNjcmlwdD8gJXMnLCBnb29nbGUubWFwcy52aXN1YWxpemF0aW9uKTtcclxuICAgIH1cclxuICB9LCBbXSk7XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGludmFyaWFudCghIWRhdGEsICdkYXRhIHByb3BlcnR5IGlzIHJlcXVpcmVkIGluIEhlYXRtYXBMYXllciAlcycsIGRhdGEpO1xyXG4gIH0sIFtkYXRhXSk7XHJcbiAgLy8gT3JkZXIgZG9lcyBtYXR0ZXJcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgIGluc3RhbmNlLnNldE1hcChtYXApO1xyXG4gICAgfVxyXG4gIH0sIFttYXBdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKG9wdGlvbnMgJiYgaW5zdGFuY2UgIT09IG51bGwpIHtcclxuICAgICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICAgIH1cclxuICB9LCBbaW5zdGFuY2UsIG9wdGlvbnNdKTtcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdmFyIGhlYXRtYXBMYXllciA9IG5ldyBnb29nbGUubWFwcy52aXN1YWxpemF0aW9uLkhlYXRtYXBMYXllcihfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG9wdGlvbnMpLCB7fSwge1xyXG4gICAgICBkYXRhLFxyXG4gICAgICBtYXBcclxuICAgIH0pKTtcclxuICAgIHNldEluc3RhbmNlKGhlYXRtYXBMYXllcik7XHJcbiAgICBpZiAob25Mb2FkKSB7XHJcbiAgICAgIG9uTG9hZChoZWF0bWFwTGF5ZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgaWYgKGluc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgaWYgKG9uVW5tb3VudCkge1xyXG4gICAgICAgICAgb25Vbm1vdW50KGluc3RhbmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5zdGFuY2Uuc2V0TWFwKG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuICByZXR1cm4gbnVsbDtcclxufVxyXG52YXIgSGVhdG1hcExheWVyRiA9IG1lbW8oSGVhdG1hcExheWVyRnVuY3Rpb25hbCk7XHJcbmNsYXNzIEhlYXRtYXBMYXllciBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBoZWF0bWFwTGF5ZXI6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0SGVhdG1hcExheWVyQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5oZWF0bWFwTGF5ZXIgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLmhlYXRtYXBMYXllcik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIGludmFyaWFudCghIWdvb2dsZS5tYXBzLnZpc3VhbGl6YXRpb24sICdEaWQgeW91IGluY2x1ZGUgcHJvcCBsaWJyYXJpZXM9e1tcInZpc3VhbGl6YXRpb25cIl19IHRvIDxMb2FkU2NyaXB0IC8+PyAlcycsIGdvb2dsZS5tYXBzLnZpc3VhbGl6YXRpb24pO1xyXG4gICAgaW52YXJpYW50KCEhdGhpcy5wcm9wcy5kYXRhLCAnZGF0YSBwcm9wZXJ0eSBpcyByZXF1aXJlZCBpbiBIZWF0bWFwTGF5ZXIgJXMnLCB0aGlzLnByb3BzLmRhdGEpO1xyXG4gICAgdmFyIGhlYXRtYXBMYXllciA9IG5ldyBnb29nbGUubWFwcy52aXN1YWxpemF0aW9uLkhlYXRtYXBMYXllcihfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMucHJvcHMub3B0aW9ucyksIHt9LCB7XHJcbiAgICAgIGRhdGE6IHRoaXMucHJvcHMuZGF0YSxcclxuICAgICAgbWFwOiB0aGlzLmNvbnRleHRcclxuICAgIH0pKTtcclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDQsXHJcbiAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQ0LFxyXG4gICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIGluc3RhbmNlOiBoZWF0bWFwTGF5ZXJcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXRIZWF0bWFwTGF5ZXIoKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgaGVhdG1hcExheWVyXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldEhlYXRtYXBMYXllckNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkNCxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDQsXHJcbiAgICAgIHByZXZQcm9wcyxcclxuICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5oZWF0bWFwTGF5ZXJcclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmhlYXRtYXBMYXllciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmhlYXRtYXBMYXllcik7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnN0YXRlLmhlYXRtYXBMYXllci5zZXRNYXAobnVsbCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoSGVhdG1hcExheWVyLCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxudmFyIGV2ZW50TWFwJDMgPSB7XHJcbiAgb25DbG9zZUNsaWNrOiAnY2xvc2VjbGljaycsXHJcbiAgb25QYW5vQ2hhbmdlZDogJ3Bhbm9fY2hhbmdlZCcsXHJcbiAgb25Qb3NpdGlvbkNoYW5nZWQ6ICdwb3NpdGlvbl9jaGFuZ2VkJyxcclxuICBvblBvdkNoYW5nZWQ6ICdwb3ZfY2hhbmdlZCcsXHJcbiAgb25SZXNpemU6ICdyZXNpemUnLFxyXG4gIG9uU3RhdHVzQ2hhbmdlZDogJ3N0YXR1c19jaGFuZ2VkJyxcclxuICBvblZpc2libGVDaGFuZ2VkOiAndmlzaWJsZV9jaGFuZ2VkJyxcclxuICBvblpvb21DaGFuZ2VkOiAnem9vbV9jaGFuZ2VkJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQzID0ge1xyXG4gIHJlZ2lzdGVyKGluc3RhbmNlLCBwcm92aWRlciwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2UucmVnaXN0ZXJQYW5vUHJvdmlkZXIocHJvdmlkZXIsIG9wdGlvbnMpO1xyXG4gIH0sXHJcbiAgbGlua3MoaW5zdGFuY2UsIGxpbmtzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRMaW5rcyhsaW5rcyk7XHJcbiAgfSxcclxuICBtb3Rpb25UcmFja2luZyhpbnN0YW5jZSwgbW90aW9uVHJhY2tpbmcpIHtcclxuICAgIGluc3RhbmNlLnNldE1vdGlvblRyYWNraW5nKG1vdGlvblRyYWNraW5nKTtcclxuICB9LFxyXG4gIG9wdGlvbnMoaW5zdGFuY2UsIG9wdGlvbnMpIHtcclxuICAgIGluc3RhbmNlLnNldE9wdGlvbnMob3B0aW9ucyk7XHJcbiAgfSxcclxuICBwYW5vKGluc3RhbmNlLCBwYW5vKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRQYW5vKHBhbm8pO1xyXG4gIH0sXHJcbiAgcG9zaXRpb24oaW5zdGFuY2UsIHBvc2l0aW9uKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgfSxcclxuICBwb3YoaW5zdGFuY2UsIHBvdikge1xyXG4gICAgaW5zdGFuY2Uuc2V0UG92KHBvdik7XHJcbiAgfSxcclxuICB2aXNpYmxlKGluc3RhbmNlLCB2aXNpYmxlKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRWaXNpYmxlKHZpc2libGUpO1xyXG4gIH0sXHJcbiAgem9vbShpbnN0YW5jZSwgem9vbSkge1xyXG4gICAgaW5zdGFuY2Uuc2V0Wm9vbSh6b29tKTtcclxuICB9XHJcbn07XHJcbmNsYXNzIFN0cmVldFZpZXdQYW5vcmFtYSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZ2lzdGVyZWRFdmVudHNcIiwgW10pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBzdHJlZXRWaWV3UGFub3JhbWE6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0U3RyZWV0Vmlld1Bhbm9yYW1hQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5zdHJlZXRWaWV3UGFub3JhbWEgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLnN0cmVldFZpZXdQYW5vcmFtYSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIHZhciBfdGhpcyRjb250ZXh0JGdldFN0cmUsIF90aGlzJGNvbnRleHQ7XHJcbiAgICB2YXIgc3RyZWV0Vmlld1Bhbm9yYW1hID0gKF90aGlzJGNvbnRleHQkZ2V0U3RyZSA9IChfdGhpcyRjb250ZXh0ID0gdGhpcy5jb250ZXh0KSA9PT0gbnVsbCB8fCBfdGhpcyRjb250ZXh0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRjb250ZXh0LmdldFN0cmVldFZpZXcoKSkgIT09IG51bGwgJiYgX3RoaXMkY29udGV4dCRnZXRTdHJlICE9PSB2b2lkIDAgPyBfdGhpcyRjb250ZXh0JGdldFN0cmUgOiBudWxsO1xyXG4gICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkMyxcclxuICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDMsXHJcbiAgICAgIHByZXZQcm9wczoge30sXHJcbiAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgaW5zdGFuY2U6IHN0cmVldFZpZXdQYW5vcmFtYVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKCgpID0+IHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdHJlZXRWaWV3UGFub3JhbWFcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0U3RyZWV0Vmlld1Bhbm9yYW1hQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5zdHJlZXRWaWV3UGFub3JhbWEgIT09IG51bGwpIHtcclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDMsXHJcbiAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDMsXHJcbiAgICAgICAgcHJldlByb3BzLFxyXG4gICAgICAgIG5leHRQcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5zdHJlZXRWaWV3UGFub3JhbWFcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuc3RyZWV0Vmlld1Bhbm9yYW1hICE9PSBudWxsKSB7XHJcbiAgICAgIGlmICh0aGlzLnByb3BzLm9uVW5tb3VudCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUuc3RyZWV0Vmlld1Bhbm9yYW1hKTtcclxuICAgICAgfVxyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMuc3RhdGUuc3RyZWV0Vmlld1Bhbm9yYW1hLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KFN0cmVldFZpZXdQYW5vcmFtYSwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmNsYXNzIFN0cmVldFZpZXdTZXJ2aWNlIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBzdHJlZXRWaWV3U2VydmljZTogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXRTdHJlZXRWaWV3U2VydmljZUNhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUuc3RyZWV0Vmlld1NlcnZpY2UgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLnN0cmVldFZpZXdTZXJ2aWNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIHN0cmVldFZpZXdTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLlN0cmVldFZpZXdTZXJ2aWNlKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldFN0cmVldFZpZXdTZXJ2aWNlKCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN0cmVldFZpZXdTZXJ2aWNlXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldFN0cmVldFZpZXdTZXJ2aWNlQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLnN0cmVldFZpZXdTZXJ2aWNlICE9PSBudWxsICYmIHRoaXMucHJvcHMub25Vbm1vdW50KSB7XHJcbiAgICAgIHRoaXMucHJvcHMub25Vbm1vdW50KHRoaXMuc3RhdGUuc3RyZWV0Vmlld1NlcnZpY2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuX2RlZmluZVByb3BlcnR5KFN0cmVldFZpZXdTZXJ2aWNlLCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxuY2xhc3MgRGlyZWN0aW9uc1NlcnZpY2UgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlOiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldERpcmVjdGlvbnNTZXJ2aWNlQ2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5kaXJlY3Rpb25zU2VydmljZSAhPT0gbnVsbCAmJiB0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUuZGlyZWN0aW9uc1NlcnZpY2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICBpbnZhcmlhbnQoISF0aGlzLnByb3BzLm9wdGlvbnMsICdEaXJlY3Rpb25zU2VydmljZSBleHBlY3RlZCBvcHRpb25zIG9iamVjdCBhcyBwYXJhbWV0ZXIsIGJ1dCBnb3QgJXMnLCB0aGlzLnByb3BzLm9wdGlvbnMpO1xyXG4gICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldERpcmVjdGlvbnNTZXJ2aWNlKCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldERpcmVjdGlvbnNTZXJ2aWNlQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kaXJlY3Rpb25zU2VydmljZSAhPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnN0YXRlLmRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHRoaXMucHJvcHMub3B0aW9ucywgdGhpcy5wcm9wcy5jYWxsYmFjayk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZGlyZWN0aW9uc1NlcnZpY2UgIT09IG51bGwpIHtcclxuICAgICAgaWYgKHRoaXMucHJvcHMub25Vbm1vdW50KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQodGhpcy5zdGF0ZS5kaXJlY3Rpb25zU2VydmljZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG52YXIgZXZlbnRNYXAkMiA9IHtcclxuICBvbkRpcmVjdGlvbnNDaGFuZ2VkOiAnZGlyZWN0aW9uc19jaGFuZ2VkJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQyID0ge1xyXG4gIGRpcmVjdGlvbnMoaW5zdGFuY2UsIGRpcmVjdGlvbnMpIHtcclxuICAgIGluc3RhbmNlLnNldERpcmVjdGlvbnMoZGlyZWN0aW9ucyk7XHJcbiAgfSxcclxuICBtYXAoaW5zdGFuY2UsIG1hcCkge1xyXG4gICAgaW5zdGFuY2Uuc2V0TWFwKG1hcCk7XHJcbiAgfSxcclxuICBvcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRPcHRpb25zKG9wdGlvbnMpO1xyXG4gIH0sXHJcbiAgcGFuZWwoaW5zdGFuY2UsIHBhbmVsKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRQYW5lbChwYW5lbCk7XHJcbiAgfSxcclxuICByb3V0ZUluZGV4KGluc3RhbmNlLCByb3V0ZUluZGV4KSB7XHJcbiAgICBpbnN0YW5jZS5zZXRSb3V0ZUluZGV4KHJvdXRlSW5kZXgpO1xyXG4gIH1cclxufTtcclxuY2xhc3MgRGlyZWN0aW9uc1JlbmRlcmVyIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVnaXN0ZXJlZEV2ZW50c1wiLCBbXSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIGRpcmVjdGlvbnNSZW5kZXJlcjogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXREaXJlY3Rpb25zUmVuZGVyZXJDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLmRpcmVjdGlvbnNSZW5kZXJlciAhPT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuc3RhdGUuZGlyZWN0aW9uc1JlbmRlcmVyLnNldE1hcCh0aGlzLmNvbnRleHQpO1xyXG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQodGhpcy5zdGF0ZS5kaXJlY3Rpb25zUmVuZGVyZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdmFyIGRpcmVjdGlvbnNSZW5kZXJlciA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zUmVuZGVyZXIodGhpcy5wcm9wcy5vcHRpb25zKTtcclxuICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICB1cGRhdGVyTWFwOiB1cGRhdGVyTWFwJDIsXHJcbiAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQyLFxyXG4gICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIGluc3RhbmNlOiBkaXJlY3Rpb25zUmVuZGVyZXJcclxuICAgIH0pO1xyXG4gICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiBzZXREaXJlY3Rpb25zUmVuZGVyZXIoKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZGlyZWN0aW9uc1JlbmRlcmVyXHJcbiAgICAgIH07XHJcbiAgICB9LCB0aGlzLnNldERpcmVjdGlvbnNSZW5kZXJlckNhbGxiYWNrKTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuZGlyZWN0aW9uc1JlbmRlcmVyICE9PSBudWxsKSB7XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgICAgdGhpcy5yZWdpc3RlcmVkRXZlbnRzID0gYXBwbHlVcGRhdGVyc1RvUHJvcHNBbmRSZWdpc3RlckV2ZW50cyh7XHJcbiAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCQyLFxyXG4gICAgICAgIGV2ZW50TWFwOiBldmVudE1hcCQyLFxyXG4gICAgICAgIHByZXZQcm9wcyxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IHRoaXMuc3RhdGUuZGlyZWN0aW9uc1JlbmRlcmVyXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmRpcmVjdGlvbnNSZW5kZXJlciAhPT0gbnVsbCkge1xyXG4gICAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uVW5tb3VudCh0aGlzLnN0YXRlLmRpcmVjdGlvbnNSZW5kZXJlcik7XHJcbiAgICAgIH1cclxuICAgICAgdW5yZWdpc3RlckV2ZW50cyh0aGlzLnJlZ2lzdGVyZWRFdmVudHMpO1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5kaXJlY3Rpb25zUmVuZGVyZXIpIHtcclxuICAgICAgICB0aGlzLnN0YXRlLmRpcmVjdGlvbnNSZW5kZXJlci5zZXRNYXAobnVsbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShEaXJlY3Rpb25zUmVuZGVyZXIsIFwiY29udGV4dFR5cGVcIiwgTWFwQ29udGV4dCk7XHJcblxyXG5jbGFzcyBEaXN0YW5jZU1hdHJpeFNlcnZpY2UgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdGF0ZVwiLCB7XHJcbiAgICAgIGRpc3RhbmNlTWF0cml4U2VydmljZTogbnVsbFxyXG4gICAgfSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJzZXREaXN0YW5jZU1hdHJpeFNlcnZpY2VDYWxsYmFja1wiLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnN0YXRlLmRpc3RhbmNlTWF0cml4U2VydmljZSAhPT0gbnVsbCAmJiB0aGlzLnByb3BzLm9uTG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25Mb2FkKHRoaXMuc3RhdGUuZGlzdGFuY2VNYXRyaXhTZXJ2aWNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgaW52YXJpYW50KCEhdGhpcy5wcm9wcy5vcHRpb25zLCAnRGlzdGFuY2VNYXRyaXhTZXJ2aWNlIGV4cGVjdGVkIG9wdGlvbnMgb2JqZWN0IGFzIHBhcmFtZXRlciwgYnV0IGdvICVzJywgdGhpcy5wcm9wcy5vcHRpb25zKTtcclxuICAgIHZhciBkaXN0YW5jZU1hdHJpeFNlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlzdGFuY2VNYXRyaXhTZXJ2aWNlKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKGZ1bmN0aW9uIHNldERpc3RhbmNlTWF0cml4U2VydmljZSgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBkaXN0YW5jZU1hdHJpeFNlcnZpY2VcclxuICAgICAgfTtcclxuICAgIH0sIHRoaXMuc2V0RGlzdGFuY2VNYXRyaXhTZXJ2aWNlQ2FsbGJhY2spO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kaXN0YW5jZU1hdHJpeFNlcnZpY2UgIT09IG51bGwpIHtcclxuICAgICAgdGhpcy5zdGF0ZS5kaXN0YW5jZU1hdHJpeFNlcnZpY2UuZ2V0RGlzdGFuY2VNYXRyaXgodGhpcy5wcm9wcy5vcHRpb25zLCB0aGlzLnByb3BzLmNhbGxiYWNrKTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kaXN0YW5jZU1hdHJpeFNlcnZpY2UgIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vblVubW91bnQpIHtcclxuICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQodGhpcy5zdGF0ZS5kaXN0YW5jZU1hdHJpeFNlcnZpY2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbnZhciBldmVudE1hcCQxID0ge1xyXG4gIG9uUGxhY2VzQ2hhbmdlZDogJ3BsYWNlc19jaGFuZ2VkJ1xyXG59O1xyXG52YXIgdXBkYXRlck1hcCQxID0ge1xyXG4gIGJvdW5kcyhpbnN0YW5jZSwgYm91bmRzKSB7XHJcbiAgICBpbnN0YW5jZS5zZXRCb3VuZHMoYm91bmRzKTtcclxuICB9XHJcbn07XHJcbmNsYXNzIFN0YW5kYWxvbmVTZWFyY2hCb3ggZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZWdpc3RlcmVkRXZlbnRzXCIsIFtdKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbnRhaW5lckVsZW1lbnRcIiwgY3JlYXRlUmVmKCkpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic3RhdGVcIiwge1xyXG4gICAgICBzZWFyY2hCb3g6IG51bGxcclxuICAgIH0pO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwic2V0U2VhcmNoQm94Q2FsbGJhY2tcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zdGF0ZS5zZWFyY2hCb3ggIT09IG51bGwgJiYgdGhpcy5wcm9wcy5vbkxvYWQpIHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uTG9hZCh0aGlzLnN0YXRlLnNlYXJjaEJveCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIGludmFyaWFudCghIWdvb2dsZS5tYXBzLnBsYWNlcywgJ1lvdSBuZWVkIHRvIHByb3ZpZGUgbGlicmFyaWVzPXtbXCJwbGFjZXNcIl19IHByb3AgdG8gPExvYWRTY3JpcHQgLz4gY29tcG9uZW50ICVzJywgZ29vZ2xlLm1hcHMucGxhY2VzKTtcclxuICAgIGlmICh0aGlzLmNvbnRhaW5lckVsZW1lbnQgIT09IG51bGwgJiYgdGhpcy5jb250YWluZXJFbGVtZW50LmN1cnJlbnQgIT09IG51bGwpIHtcclxuICAgICAgdmFyIGlucHV0ID0gdGhpcy5jb250YWluZXJFbGVtZW50LmN1cnJlbnQucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcclxuICAgICAgaWYgKGlucHV0ICE9PSBudWxsKSB7XHJcbiAgICAgICAgdmFyIHNlYXJjaEJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KGlucHV0LCB0aGlzLnByb3BzLm9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgICAgdXBkYXRlck1hcDogdXBkYXRlck1hcCQxLFxyXG4gICAgICAgICAgZXZlbnRNYXA6IGV2ZW50TWFwJDEsXHJcbiAgICAgICAgICBwcmV2UHJvcHM6IHt9LFxyXG4gICAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgICAgaW5zdGFuY2U6IHNlYXJjaEJveFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoZnVuY3Rpb24gc2V0U2VhcmNoQm94KCkge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2VhcmNoQm94XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH0sIHRoaXMuc2V0U2VhcmNoQm94Q2FsbGJhY2spO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLnNlYXJjaEJveCAhPT0gbnVsbCkge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXA6IHVwZGF0ZXJNYXAkMSxcclxuICAgICAgICBldmVudE1hcDogZXZlbnRNYXAkMSxcclxuICAgICAgICBwcmV2UHJvcHMsXHJcbiAgICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICAgIGluc3RhbmNlOiB0aGlzLnN0YXRlLnNlYXJjaEJveFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5zZWFyY2hCb3ggIT09IG51bGwpIHtcclxuICAgICAgaWYgKHRoaXMucHJvcHMub25Vbm1vdW50KSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vblVubW91bnQodGhpcy5zdGF0ZS5zZWFyY2hCb3gpO1xyXG4gICAgICB9XHJcbiAgICAgIHVucmVnaXN0ZXJFdmVudHModGhpcy5yZWdpc3RlcmVkRXZlbnRzKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmVuZGVyKCkge1xyXG4gICAgcmV0dXJuIGpzeChcImRpdlwiLCB7XHJcbiAgICAgIHJlZjogdGhpcy5jb250YWluZXJFbGVtZW50LFxyXG4gICAgICBjaGlsZHJlbjogQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbl9kZWZpbmVQcm9wZXJ0eShTdGFuZGFsb25lU2VhcmNoQm94LCBcImNvbnRleHRUeXBlXCIsIE1hcENvbnRleHQpO1xyXG5cclxudmFyIGV2ZW50TWFwID0ge1xyXG4gIG9uUGxhY2VDaGFuZ2VkOiAncGxhY2VfY2hhbmdlZCdcclxufTtcclxudmFyIHVwZGF0ZXJNYXAgPSB7XHJcbiAgYm91bmRzKGluc3RhbmNlLCBib3VuZHMpIHtcclxuICAgIGluc3RhbmNlLnNldEJvdW5kcyhib3VuZHMpO1xyXG4gIH0sXHJcbiAgcmVzdHJpY3Rpb25zKGluc3RhbmNlLCByZXN0cmljdGlvbnMpIHtcclxuICAgIGluc3RhbmNlLnNldENvbXBvbmVudFJlc3RyaWN0aW9ucyhyZXN0cmljdGlvbnMpO1xyXG4gIH0sXHJcbiAgZmllbGRzKGluc3RhbmNlLCBmaWVsZHMpIHtcclxuICAgIGluc3RhbmNlLnNldEZpZWxkcyhmaWVsZHMpO1xyXG4gIH0sXHJcbiAgb3B0aW9ucyhpbnN0YW5jZSwgb3B0aW9ucykge1xyXG4gICAgaW5zdGFuY2Uuc2V0T3B0aW9ucyhvcHRpb25zKTtcclxuICB9LFxyXG4gIHR5cGVzKGluc3RhbmNlLCB0eXBlcykge1xyXG4gICAgaW5zdGFuY2Uuc2V0VHlwZXModHlwZXMpO1xyXG4gIH1cclxufTtcclxuY2xhc3MgQXV0b2NvbXBsZXRlIGV4dGVuZHMgUHVyZUNvbXBvbmVudCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xyXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVnaXN0ZXJlZEV2ZW50c1wiLCBbXSk7XHJcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb250YWluZXJFbGVtZW50XCIsIGNyZWF0ZVJlZigpKTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXRlXCIsIHtcclxuICAgICAgYXV0b2NvbXBsZXRlOiBudWxsXHJcbiAgICB9KTtcclxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInNldEF1dG9jb21wbGV0ZUNhbGxiYWNrXCIsICgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUuYXV0b2NvbXBsZXRlICE9PSBudWxsICYmIHRoaXMucHJvcHMub25Mb2FkKSB7XHJcbiAgICAgICAgdGhpcy5wcm9wcy5vbkxvYWQodGhpcy5zdGF0ZS5hdXRvY29tcGxldGUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB2YXIgX3RoaXMkY29udGFpbmVyRWxlbWVuO1xyXG4gICAgaW52YXJpYW50KCEhZ29vZ2xlLm1hcHMucGxhY2VzLCAnWW91IG5lZWQgdG8gcHJvdmlkZSBsaWJyYXJpZXM9e1tcInBsYWNlc1wiXX0gcHJvcCB0byA8TG9hZFNjcmlwdCAvPiBjb21wb25lbnQgJXMnLCBnb29nbGUubWFwcy5wbGFjZXMpO1xyXG4gICAgLy8gVE9ETzogd2h5IGN1cnJlbnQgY291bGQgYmUgZXF1YWwgbnVsbD9cclxuICAgIHZhciBpbnB1dCA9IChfdGhpcyRjb250YWluZXJFbGVtZW4gPSB0aGlzLmNvbnRhaW5lckVsZW1lbnQuY3VycmVudCkgPT09IG51bGwgfHwgX3RoaXMkY29udGFpbmVyRWxlbWVuID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRjb250YWluZXJFbGVtZW4ucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcclxuICAgIGlmIChpbnB1dCkge1xyXG4gICAgICB2YXIgYXV0b2NvbXBsZXRlID0gbmV3IGdvb2dsZS5tYXBzLnBsYWNlcy5BdXRvY29tcGxldGUoaW5wdXQsIHRoaXMucHJvcHMub3B0aW9ucyk7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJlZEV2ZW50cyA9IGFwcGx5VXBkYXRlcnNUb1Byb3BzQW5kUmVnaXN0ZXJFdmVudHMoe1xyXG4gICAgICAgIHVwZGF0ZXJNYXAsXHJcbiAgICAgICAgZXZlbnRNYXAsXHJcbiAgICAgICAgcHJldlByb3BzOiB7fSxcclxuICAgICAgICBuZXh0UHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgICAgaW5zdGFuY2U6IGF1dG9jb21wbGV0ZVxyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGF1dG9jb21wbGV0ZVxyXG4gICAgICAgIH07XHJcbiAgICAgIH0sIHRoaXMuc2V0QXV0b2NvbXBsZXRlQ2FsbGJhY2spO1xyXG4gICAgfVxyXG4gIH1cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XHJcbiAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRFdmVudHMgPSBhcHBseVVwZGF0ZXJzVG9Qcm9wc0FuZFJlZ2lzdGVyRXZlbnRzKHtcclxuICAgICAgdXBkYXRlck1hcCxcclxuICAgICAgZXZlbnRNYXAsXHJcbiAgICAgIHByZXZQcm9wcyxcclxuICAgICAgbmV4dFByb3BzOiB0aGlzLnByb3BzLFxyXG4gICAgICBpbnN0YW5jZTogdGhpcy5zdGF0ZS5hdXRvY29tcGxldGVcclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIGlmICh0aGlzLnN0YXRlLmF1dG9jb21wbGV0ZSAhPT0gbnVsbCkge1xyXG4gICAgICB1bnJlZ2lzdGVyRXZlbnRzKHRoaXMucmVnaXN0ZXJlZEV2ZW50cyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiBqc3goXCJkaXZcIiwge1xyXG4gICAgICByZWY6IHRoaXMuY29udGFpbmVyRWxlbWVudCxcclxuICAgICAgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSxcclxuICAgICAgY2hpbGRyZW46IENoaWxkcmVuLm9ubHkodGhpcy5wcm9wcy5jaGlsZHJlbilcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5fZGVmaW5lUHJvcGVydHkoQXV0b2NvbXBsZXRlLCBcImRlZmF1bHRQcm9wc1wiLCB7XHJcbiAgY2xhc3NOYW1lOiAnJ1xyXG59KTtcclxuX2RlZmluZVByb3BlcnR5KEF1dG9jb21wbGV0ZSwgXCJjb250ZXh0VHlwZVwiLCBNYXBDb250ZXh0KTtcclxuXHJcbmV4cG9ydCB7IEF1dG9jb21wbGV0ZSwgQmljeWNsaW5nTGF5ZXIsIEJpY3ljbGluZ0xheWVyRiwgQ2lyY2xlLCBDaXJjbGVGLCBEYXRhLCBEYXRhRiwgRGlyZWN0aW9uc1JlbmRlcmVyLCBEaXJlY3Rpb25zU2VydmljZSwgRGlzdGFuY2VNYXRyaXhTZXJ2aWNlLCBEcmF3aW5nTWFuYWdlciwgRHJhd2luZ01hbmFnZXJGLCBGTE9BVF9QQU5FLCBHb29nbGVNYXAsIGluZGV4X2VzbSBhcyBHb29nbGVNYXBzTWFya2VyQ2x1c3RlcmVyLCBHb29nbGVNYXJrZXJDbHVzdGVyZXIkMSBhcyBHb29nbGVNYXJrZXJDbHVzdGVyZXIsIEdyb3VuZE92ZXJsYXksIEdyb3VuZE92ZXJsYXlGLCBIZWF0bWFwTGF5ZXIsIEhlYXRtYXBMYXllckYsIEluZm9Cb3hDb21wb25lbnQgYXMgSW5mb0JveCwgSW5mb0JveEYsIEluZm9XaW5kb3csIEluZm9XaW5kb3dGLCBLbWxMYXllciwgTG9hZFNjcmlwdCwgTG9hZFNjcmlwdE5leHQkMSBhcyBMb2FkU2NyaXB0TmV4dCwgTUFQX1BBTkUsIE1BUktFUl9MQVlFUiwgTWFwQ29udGV4dCwgTWFya2VyLCBDbHVzdGVyZXJDb21wb25lbnQgYXMgTWFya2VyQ2x1c3RlcmVyLCBNYXJrZXJDbHVzdGVyZXJGLCBNYXJrZXJGLCBPVkVSTEFZX0xBWUVSLCBPVkVSTEFZX01PVVNFX1RBUkdFVCwgT3ZlcmxheVZpZXcsIE92ZXJsYXlWaWV3RiwgUG9seWdvbiwgUG9seWdvbkYsIFBvbHlsaW5lLCBQb2x5bGluZUYsIFJlY3RhbmdsZSwgUmVjdGFuZ2xlRiwgU3RhbmRhbG9uZVNlYXJjaEJveCwgU3RyZWV0Vmlld1Bhbm9yYW1hLCBTdHJlZXRWaWV3U2VydmljZSwgVHJhZmZpY0xheWVyLCBUcmFmZmljTGF5ZXJGLCBUcmFuc2l0TGF5ZXIsIFRyYW5zaXRMYXllckYsIHVzZUdvb2dsZU1hcCwgdXNlSnNBcGlMb2FkZXIsIHVzZUxvYWRTY3JpcHQgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXNtLmpzLm1hcFxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/@react-google-maps/api/dist/esm.js\n"));

/***/ }),

/***/ "(app-pages-browser)/./components/SingleBoardingMap.tsx":
/*!******************************************!*\
  !*** ./components/SingleBoardingMap.tsx ***!
  \******************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ SingleBoardingMap; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-dev-runtime */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/jsx-dev-runtime.js\");\n/* harmony import */ var _react_google_maps_api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @react-google-maps/api */ \"(app-pages-browser)/./node_modules/@react-google-maps/api/dist/esm.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* __next_internal_client_entry_do_not_use__ default auto */ \nvar _s = $RefreshSig$();\n\n\n// Default center: Sri Lanka (fallback if lat/lng are null)\nconst DEFAULT_CENTER = {\n    lat: 7.8731,\n    lng: 80.7718\n};\nconst DEFAULT_ZOOM = 15; // Higher zoom for single location\nfunction SingleBoardingMap(param) {\n    let { lat, lng, title } = param;\n    _s();\n    const apiKey = \"AIzaSyCODGMpenLklXyN3u0-JtP_kOhQ9PgpTnI\" || 0;\n    const { isLoaded, loadError } = (0,_react_google_maps_api__WEBPACK_IMPORTED_MODULE_2__.useJsApiLoader)({\n        googleMapsApiKey: apiKey || \"dummy-key\"\n    });\n    const mapCenter = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>{\n        if (lat !== null && lng !== null) {\n            return {\n                lat,\n                lng\n            };\n        }\n        return DEFAULT_CENTER;\n    }, [\n        lat,\n        lng\n    ]);\n    if (!apiKey) {\n        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n            className: \"flex h-56 w-full items-center justify-center rounded-2xl border border-slate-200 bg-red-50 text-sm text-red-600\",\n            children: \"Google Maps API key not configured.\"\n        }, void 0, false, {\n            fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n            lineNumber: 32,\n            columnNumber: 7\n        }, this);\n    }\n    if (loadError) {\n        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n            className: \"flex h-56 w-full items-center justify-center rounded-2xl border border-slate-200 bg-red-50 text-sm text-red-600\",\n            children: \"Error loading map. Please check your Google Maps API key.\"\n        }, void 0, false, {\n            fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n            lineNumber: 40,\n            columnNumber: 7\n        }, this);\n    }\n    if (!isLoaded) {\n        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n            className: \"flex h-56 w-full items-center justify-center rounded-2xl border border-slate-200 bg-slate-50 text-sm text-slate-500\",\n            children: \"Loading map...\"\n        }, void 0, false, {\n            fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n            lineNumber: 48,\n            columnNumber: 7\n        }, this);\n    }\n    if (lat === null || lng === null) {\n        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n            className: \"flex h-56 w-full items-center justify-center rounded-2xl border border-slate-200 bg-slate-50 text-sm text-slate-500\",\n            children: \"Location not available\"\n        }, void 0, false, {\n            fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n            lineNumber: 56,\n            columnNumber: 7\n        }, this);\n    }\n    return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"div\", {\n        className: \"relative h-56 w-full overflow-hidden rounded-2xl border border-slate-200 shadow-inner\",\n        children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_react_google_maps_api__WEBPACK_IMPORTED_MODULE_2__.GoogleMap, {\n            mapContainerStyle: {\n                width: \"100%\",\n                height: \"100%\"\n            },\n            center: mapCenter,\n            zoom: DEFAULT_ZOOM,\n            options: {\n                streetViewControl: false,\n                mapTypeControl: false,\n                fullscreenControl: false\n            },\n            children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_react_google_maps_api__WEBPACK_IMPORTED_MODULE_2__.Marker, {\n                position: {\n                    lat,\n                    lng\n                },\n                title: title\n            }, void 0, false, {\n                fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n                lineNumber: 74,\n                columnNumber: 9\n            }, this)\n        }, void 0, false, {\n            fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n            lineNumber: 64,\n            columnNumber: 7\n        }, this)\n    }, void 0, false, {\n        fileName: \"C:\\\\Users\\\\Nemitha\\\\OneDrive\\\\Documents\\\\GitHub\\\\Boarding Project - Product\\\\Frontend\\\\components\\\\SingleBoardingMap.tsx\",\n        lineNumber: 63,\n        columnNumber: 5\n    }, this);\n}\n_s(SingleBoardingMap, \"kIJrKjsLrV1ngQW3+TEJ2oCw/uU=\", false, function() {\n    return [\n        _react_google_maps_api__WEBPACK_IMPORTED_MODULE_2__.useJsApiLoader\n    ];\n});\n_c = SingleBoardingMap;\nvar _c;\n$RefreshReg$(_c, \"SingleBoardingMap\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL2NvbXBvbmVudHMvU2luZ2xlQm9hcmRpbmdNYXAudHN4IiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFFMkU7QUFDM0M7QUFRaEMsMkRBQTJEO0FBQzNELE1BQU1JLGlCQUFpQjtJQUFFQyxLQUFLO0lBQVFDLEtBQUs7QUFBUTtBQUNuRCxNQUFNQyxlQUFlLElBQUksa0NBQWtDO0FBRTVDLFNBQVNDLGtCQUFrQixLQUEyQztRQUEzQyxFQUFFSCxHQUFHLEVBQUVDLEdBQUcsRUFBRUcsS0FBSyxFQUEwQixHQUEzQzs7SUFDeEMsTUFBTUMsU0FBU0MseUNBQTJDLElBQUksQ0FBRTtJQUVoRSxNQUFNLEVBQUVHLFFBQVEsRUFBRUMsU0FBUyxFQUFFLEdBQUdmLHNFQUFjQSxDQUFDO1FBQzdDZ0Isa0JBQWtCTixVQUFVO0lBQzlCO0lBRUEsTUFBTU8sWUFBWWQsOENBQU9BLENBQUM7UUFDeEIsSUFBSUUsUUFBUSxRQUFRQyxRQUFRLE1BQU07WUFDaEMsT0FBTztnQkFBRUQ7Z0JBQUtDO1lBQUk7UUFDcEI7UUFDQSxPQUFPRjtJQUNULEdBQUc7UUFBQ0M7UUFBS0M7S0FBSTtJQUViLElBQUksQ0FBQ0ksUUFBUTtRQUNYLHFCQUNFLDhEQUFDUTtZQUFJQyxXQUFVO3NCQUFrSDs7Ozs7O0lBSXJJO0lBRUEsSUFBSUosV0FBVztRQUNiLHFCQUNFLDhEQUFDRztZQUFJQyxXQUFVO3NCQUFrSDs7Ozs7O0lBSXJJO0lBRUEsSUFBSSxDQUFDTCxVQUFVO1FBQ2IscUJBQ0UsOERBQUNJO1lBQUlDLFdBQVU7c0JBQXNIOzs7Ozs7SUFJekk7SUFFQSxJQUFJZCxRQUFRLFFBQVFDLFFBQVEsTUFBTTtRQUNoQyxxQkFDRSw4REFBQ1k7WUFBSUMsV0FBVTtzQkFBc0g7Ozs7OztJQUl6STtJQUVBLHFCQUNFLDhEQUFDRDtRQUFJQyxXQUFVO2tCQUNiLDRFQUFDbEIsNkRBQVNBO1lBQ1JtQixtQkFBbUI7Z0JBQUVDLE9BQU87Z0JBQVFDLFFBQVE7WUFBTztZQUNuREMsUUFBUU47WUFDUk8sTUFBTWpCO1lBQ05rQixTQUFTO2dCQUNQQyxtQkFBbUI7Z0JBQ25CQyxnQkFBZ0I7Z0JBQ2hCQyxtQkFBbUI7WUFDckI7c0JBRUEsNEVBQUMxQiwwREFBTUE7Z0JBQUMyQixVQUFVO29CQUFFeEI7b0JBQUtDO2dCQUFJO2dCQUFHRyxPQUFPQTs7Ozs7Ozs7Ozs7Ozs7OztBQUkvQztHQTlEd0JEOztRQUdVUixrRUFBY0E7OztLQUh4QlEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vY29tcG9uZW50cy9TaW5nbGVCb2FyZGluZ01hcC50c3g/NGVlMCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcclxuXHJcbmltcG9ydCB7IHVzZUpzQXBpTG9hZGVyLCBHb29nbGVNYXAsIE1hcmtlciB9IGZyb20gXCJAcmVhY3QtZ29vZ2xlLW1hcHMvYXBpXCI7XHJcbmltcG9ydCB7IHVzZU1lbW8gfSBmcm9tIFwicmVhY3RcIjtcclxuXHJcbmludGVyZmFjZSBTaW5nbGVCb2FyZGluZ01hcFByb3BzIHtcclxuICBsYXQ6IG51bWJlciB8IG51bGw7XHJcbiAgbG5nOiBudW1iZXIgfCBudWxsO1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vIERlZmF1bHQgY2VudGVyOiBTcmkgTGFua2EgKGZhbGxiYWNrIGlmIGxhdC9sbmcgYXJlIG51bGwpXHJcbmNvbnN0IERFRkFVTFRfQ0VOVEVSID0geyBsYXQ6IDcuODczMSwgbG5nOiA4MC43NzE4IH07XHJcbmNvbnN0IERFRkFVTFRfWk9PTSA9IDE1OyAvLyBIaWdoZXIgem9vbSBmb3Igc2luZ2xlIGxvY2F0aW9uXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBTaW5nbGVCb2FyZGluZ01hcCh7IGxhdCwgbG5nLCB0aXRsZSB9OiBTaW5nbGVCb2FyZGluZ01hcFByb3BzKSB7XHJcbiAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfR09PR0xFX01BUFNfQVBJX0tFWSB8fCBcIlwiO1xyXG5cclxuICBjb25zdCB7IGlzTG9hZGVkLCBsb2FkRXJyb3IgfSA9IHVzZUpzQXBpTG9hZGVyKHtcclxuICAgIGdvb2dsZU1hcHNBcGlLZXk6IGFwaUtleSB8fCBcImR1bW15LWtleVwiLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBtYXBDZW50ZXIgPSB1c2VNZW1vKCgpID0+IHtcclxuICAgIGlmIChsYXQgIT09IG51bGwgJiYgbG5nICE9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiB7IGxhdCwgbG5nIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gREVGQVVMVF9DRU5URVI7XHJcbiAgfSwgW2xhdCwgbG5nXSk7XHJcblxyXG4gIGlmICghYXBpS2V5KSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaC01NiB3LWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtMnhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIGJnLXJlZC01MCB0ZXh0LXNtIHRleHQtcmVkLTYwMFwiPlxyXG4gICAgICAgIEdvb2dsZSBNYXBzIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQuXHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmIChsb2FkRXJyb3IpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBoLTU2IHctZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgYmctcmVkLTUwIHRleHQtc20gdGV4dC1yZWQtNjAwXCI+XHJcbiAgICAgICAgRXJyb3IgbG9hZGluZyBtYXAuIFBsZWFzZSBjaGVjayB5b3VyIEdvb2dsZSBNYXBzIEFQSSBrZXkuXHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmICghaXNMb2FkZWQpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBoLTU2IHctZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgYmctc2xhdGUtNTAgdGV4dC1zbSB0ZXh0LXNsYXRlLTUwMFwiPlxyXG4gICAgICAgIExvYWRpbmcgbWFwLi4uXHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmIChsYXQgPT09IG51bGwgfHwgbG5nID09PSBudWxsKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaC01NiB3LWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtMnhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIGJnLXNsYXRlLTUwIHRleHQtc20gdGV4dC1zbGF0ZS01MDBcIj5cclxuICAgICAgICBMb2NhdGlvbiBub3QgYXZhaWxhYmxlXHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlIGgtNTYgdy1mdWxsIG92ZXJmbG93LWhpZGRlbiByb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBzaGFkb3ctaW5uZXJcIj5cclxuICAgICAgPEdvb2dsZU1hcFxyXG4gICAgICAgIG1hcENvbnRhaW5lclN0eWxlPXt7IHdpZHRoOiBcIjEwMCVcIiwgaGVpZ2h0OiBcIjEwMCVcIiB9fVxyXG4gICAgICAgIGNlbnRlcj17bWFwQ2VudGVyfVxyXG4gICAgICAgIHpvb209e0RFRkFVTFRfWk9PTX1cclxuICAgICAgICBvcHRpb25zPXt7XHJcbiAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICBmdWxsc2NyZWVuQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgfX1cclxuICAgICAgPlxyXG4gICAgICAgIDxNYXJrZXIgcG9zaXRpb249e3sgbGF0LCBsbmcgfX0gdGl0bGU9e3RpdGxlfSAvPlxyXG4gICAgICA8L0dvb2dsZU1hcD5cclxuICAgIDwvZGl2PlxyXG4gICk7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJ1c2VKc0FwaUxvYWRlciIsIkdvb2dsZU1hcCIsIk1hcmtlciIsInVzZU1lbW8iLCJERUZBVUxUX0NFTlRFUiIsImxhdCIsImxuZyIsIkRFRkFVTFRfWk9PTSIsIlNpbmdsZUJvYXJkaW5nTWFwIiwidGl0bGUiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfR09PR0xFX01BUFNfQVBJX0tFWSIsImlzTG9hZGVkIiwibG9hZEVycm9yIiwiZ29vZ2xlTWFwc0FwaUtleSIsIm1hcENlbnRlciIsImRpdiIsImNsYXNzTmFtZSIsIm1hcENvbnRhaW5lclN0eWxlIiwid2lkdGgiLCJoZWlnaHQiLCJjZW50ZXIiLCJ6b29tIiwib3B0aW9ucyIsInN0cmVldFZpZXdDb250cm9sIiwibWFwVHlwZUNvbnRyb2wiLCJmdWxsc2NyZWVuQ29udHJvbCIsInBvc2l0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./components/SingleBoardingMap.tsx\n"));

/***/ })

}]);